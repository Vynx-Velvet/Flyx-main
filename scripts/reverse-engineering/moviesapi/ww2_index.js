(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var ge=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Pg(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function ry(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),t}var Fg={exports:{}},el={},Bg={exports:{}},xe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zs=Symbol.for("react.element"),ny=Symbol.for("react.portal"),iy=Symbol.for("react.fragment"),sy=Symbol.for("react.strict_mode"),ay=Symbol.for("react.profiler"),oy=Symbol.for("react.provider"),ly=Symbol.for("react.context"),uy=Symbol.for("react.forward_ref"),cy=Symbol.for("react.suspense"),dy=Symbol.for("react.memo"),fy=Symbol.for("react.lazy"),m0=Symbol.iterator;function hy(r){return r===null||typeof r!="object"?null:(r=m0&&r[m0]||r["@@iterator"],typeof r=="function"?r:null)}var Og={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Mg=Object.assign,Ng={};function Vi(r,e,t){this.props=r,this.context=e,this.refs=Ng,this.updater=t||Og}Vi.prototype.isReactComponent={};Vi.prototype.setState=function(r,e){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,e,"setState")};Vi.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function $g(){}$g.prototype=Vi.prototype;function kd(r,e,t){this.props=r,this.context=e,this.refs=Ng,this.updater=t||Og}var wd=kd.prototype=new $g;wd.constructor=kd;Mg(wd,Vi.prototype);wd.isPureReactComponent=!0;var x0=Array.isArray,Ug=Object.prototype.hasOwnProperty,bd={current:null},Gg={key:!0,ref:!0,__self:!0,__source:!0};function Hg(r,e,t){var n,i={},s=null,a=null;if(e!=null)for(n in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(s=""+e.key),e)Ug.call(e,n)&&!Gg.hasOwnProperty(n)&&(i[n]=e[n]);var o=arguments.length-2;if(o===1)i.children=t;else if(1<o){for(var u=Array(o),l=0;l<o;l++)u[l]=arguments[l+2];i.children=u}if(r&&r.defaultProps)for(n in o=r.defaultProps,o)i[n]===void 0&&(i[n]=o[n]);return{$$typeof:Zs,type:r,key:s,ref:a,props:i,_owner:bd.current}}function py(r,e){return{$$typeof:Zs,type:r.type,key:e,ref:r.ref,props:r.props,_owner:r._owner}}function Pd(r){return typeof r=="object"&&r!==null&&r.$$typeof===Zs}function gy(r){var e={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(t){return e[t]})}var v0=/\/+/g;function kl(r,e){return typeof r=="object"&&r!==null&&r.key!=null?gy(""+r.key):e.toString(36)}function qa(r,e,t,n,i){var s=typeof r;(s==="undefined"||s==="boolean")&&(r=null);var a=!1;if(r===null)a=!0;else switch(s){case"string":case"number":a=!0;break;case"object":switch(r.$$typeof){case Zs:case ny:a=!0}}if(a)return a=r,i=i(a),r=n===""?"."+kl(a,0):n,x0(i)?(t="",r!=null&&(t=r.replace(v0,"$&/")+"/"),qa(i,e,t,"",function(l){return l})):i!=null&&(Pd(i)&&(i=py(i,t+(!i.key||a&&a.key===i.key?"":(""+i.key).replace(v0,"$&/")+"/")+r)),e.push(i)),1;if(a=0,n=n===""?".":n+":",x0(r))for(var o=0;o<r.length;o++){s=r[o];var u=n+kl(s,o);a+=qa(s,e,t,u,i)}else if(u=hy(r),typeof u=="function")for(r=u.call(r),o=0;!(s=r.next()).done;)s=s.value,u=n+kl(s,o++),a+=qa(s,e,t,u,i);else if(s==="object")throw e=String(r),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function ga(r,e,t){if(r==null)return r;var n=[],i=0;return qa(r,n,"","",function(s){return e.call(t,s,i++)}),n}function my(r){if(r._status===-1){var e=r._result;e=e(),e.then(function(t){(r._status===0||r._status===-1)&&(r._status=1,r._result=t)},function(t){(r._status===0||r._status===-1)&&(r._status=2,r._result=t)}),r._status===-1&&(r._status=0,r._result=e)}if(r._status===1)return r._result.default;throw r._result}var _t={current:null},Xa={transition:null},xy={ReactCurrentDispatcher:_t,ReactCurrentBatchConfig:Xa,ReactCurrentOwner:bd};function Vg(){throw Error("act(...) is not supported in production builds of React.")}xe.Children={map:ga,forEach:function(r,e,t){ga(r,function(){e.apply(this,arguments)},t)},count:function(r){var e=0;return ga(r,function(){e++}),e},toArray:function(r){return ga(r,function(e){return e})||[]},only:function(r){if(!Pd(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};xe.Component=Vi;xe.Fragment=iy;xe.Profiler=ay;xe.PureComponent=kd;xe.StrictMode=sy;xe.Suspense=cy;xe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=xy;xe.act=Vg;xe.cloneElement=function(r,e,t){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var n=Mg({},r.props),i=r.key,s=r.ref,a=r._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,a=bd.current),e.key!==void 0&&(i=""+e.key),r.type&&r.type.defaultProps)var o=r.type.defaultProps;for(u in e)Ug.call(e,u)&&!Gg.hasOwnProperty(u)&&(n[u]=e[u]===void 0&&o!==void 0?o[u]:e[u])}var u=arguments.length-2;if(u===1)n.children=t;else if(1<u){o=Array(u);for(var l=0;l<u;l++)o[l]=arguments[l+2];n.children=o}return{$$typeof:Zs,type:r.type,key:i,ref:s,props:n,_owner:a}};xe.createContext=function(r){return r={$$typeof:ly,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:oy,_context:r},r.Consumer=r};xe.createElement=Hg;xe.createFactory=function(r){var e=Hg.bind(null,r);return e.type=r,e};xe.createRef=function(){return{current:null}};xe.forwardRef=function(r){return{$$typeof:uy,render:r}};xe.isValidElement=Pd;xe.lazy=function(r){return{$$typeof:fy,_payload:{_status:-1,_result:r},_init:my}};xe.memo=function(r,e){return{$$typeof:dy,type:r,compare:e===void 0?null:e}};xe.startTransition=function(r){var e=Xa.transition;Xa.transition={};try{r()}finally{Xa.transition=e}};xe.unstable_act=Vg;xe.useCallback=function(r,e){return _t.current.useCallback(r,e)};xe.useContext=function(r){return _t.current.useContext(r)};xe.useDebugValue=function(){};xe.useDeferredValue=function(r){return _t.current.useDeferredValue(r)};xe.useEffect=function(r,e){return _t.current.useEffect(r,e)};xe.useId=function(){return _t.current.useId()};xe.useImperativeHandle=function(r,e,t){return _t.current.useImperativeHandle(r,e,t)};xe.useInsertionEffect=function(r,e){return _t.current.useInsertionEffect(r,e)};xe.useLayoutEffect=function(r,e){return _t.current.useLayoutEffect(r,e)};xe.useMemo=function(r,e){return _t.current.useMemo(r,e)};xe.useReducer=function(r,e,t){return _t.current.useReducer(r,e,t)};xe.useRef=function(r){return _t.current.useRef(r)};xe.useState=function(r){return _t.current.useState(r)};xe.useSyncExternalStore=function(r,e,t){return _t.current.useSyncExternalStore(r,e,t)};xe.useTransition=function(){return _t.current.useTransition()};xe.version="18.3.1";Bg.exports=xe;var b=Bg.exports;const vy=Pg(b);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yy=b,Ey=Symbol.for("react.element"),Sy=Symbol.for("react.fragment"),Ty=Object.prototype.hasOwnProperty,Ay=yy.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Cy={key:!0,ref:!0,__self:!0,__source:!0};function jg(r,e,t){var n,i={},s=null,a=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(a=e.ref);for(n in e)Ty.call(e,n)&&!Cy.hasOwnProperty(n)&&(i[n]=e[n]);if(r&&r.defaultProps)for(n in e=r.defaultProps,e)i[n]===void 0&&(i[n]=e[n]);return{$$typeof:Ey,type:r,key:s,ref:a,props:i,_owner:Ay.current}}el.Fragment=Sy;el.jsx=jg;el.jsxs=jg;Fg.exports=el;var D=Fg.exports,fc={},Kg={exports:{}},Jt={},zg={exports:{}},Wg={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function e(O,H){var K=O.length;O.push(H);e:for(;0<K;){var w=K-1>>>1,P=O[w];if(0<i(P,H))O[w]=H,O[K]=P,K=w;else break e}}function t(O){return O.length===0?null:O[0]}function n(O){if(O.length===0)return null;var H=O[0],K=O.pop();if(K!==H){O[0]=K;e:for(var w=0,P=O.length,U=P>>>1;w<U;){var $=2*(w+1)-1,Q=O[$],J=$+1,he=O[J];if(0>i(Q,K))J<P&&0>i(he,Q)?(O[w]=he,O[J]=K,w=J):(O[w]=Q,O[$]=K,w=$);else if(J<P&&0>i(he,K))O[w]=he,O[J]=K,w=J;else break e}}return H}function i(O,H){var K=O.sortIndex-H.sortIndex;return K!==0?K:O.id-H.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;r.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();r.unstable_now=function(){return a.now()-o}}var u=[],l=[],c=1,d=null,f=3,h=!1,p=!1,x=!1,v=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,g=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function m(O){for(var H=t(l);H!==null;){if(H.callback===null)n(l);else if(H.startTime<=O)n(l),H.sortIndex=H.expirationTime,e(u,H);else break;H=t(l)}}function E(O){if(x=!1,m(O),!p)if(t(u)!==null)p=!0,G(T);else{var H=t(l);H!==null&&Y(E,H.startTime-O)}}function T(O,H){p=!1,x&&(x=!1,y(R),R=-1),h=!0;var K=f;try{for(m(H),d=t(u);d!==null&&(!(d.expirationTime>H)||O&&!_());){var w=d.callback;if(typeof w=="function"){d.callback=null,f=d.priorityLevel;var P=w(d.expirationTime<=H);H=r.unstable_now(),typeof P=="function"?d.callback=P:d===t(u)&&n(u),m(H)}else n(u);d=t(u)}if(d!==null)var U=!0;else{var $=t(l);$!==null&&Y(E,$.startTime-H),U=!1}return U}finally{d=null,f=K,h=!1}}var L=!1,A=null,R=-1,I=5,C=-1;function _(){return!(r.unstable_now()-C<I)}function F(){if(A!==null){var O=r.unstable_now();C=O;var H=!0;try{H=A(!0,O)}finally{H?B():(L=!1,A=null)}}else L=!1}var B;if(typeof g=="function")B=function(){g(F)};else if(typeof MessageChannel<"u"){var V=new MessageChannel,j=V.port2;V.port1.onmessage=F,B=function(){j.postMessage(null)}}else B=function(){v(F,0)};function G(O){A=O,L||(L=!0,B())}function Y(O,H){R=v(function(){O(r.unstable_now())},H)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(O){O.callback=null},r.unstable_continueExecution=function(){p||h||(p=!0,G(T))},r.unstable_forceFrameRate=function(O){0>O||125<O?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<O?Math.floor(1e3/O):5},r.unstable_getCurrentPriorityLevel=function(){return f},r.unstable_getFirstCallbackNode=function(){return t(u)},r.unstable_next=function(O){switch(f){case 1:case 2:case 3:var H=3;break;default:H=f}var K=f;f=H;try{return O()}finally{f=K}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(O,H){switch(O){case 1:case 2:case 3:case 4:case 5:break;default:O=3}var K=f;f=O;try{return H()}finally{f=K}},r.unstable_scheduleCallback=function(O,H,K){var w=r.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?w+K:w):K=w,O){case 1:var P=-1;break;case 2:P=250;break;case 5:P=1073741823;break;case 4:P=1e4;break;default:P=5e3}return P=K+P,O={id:c++,callback:H,priorityLevel:O,startTime:K,expirationTime:P,sortIndex:-1},K>w?(O.sortIndex=K,e(l,O),t(u)===null&&O===t(l)&&(x?(y(R),R=-1):x=!0,Y(E,K-w))):(O.sortIndex=P,e(u,O),p||h||(p=!0,G(T))),O},r.unstable_shouldYield=_,r.unstable_wrapCallback=function(O){var H=f;return function(){var K=f;f=H;try{return O.apply(this,arguments)}finally{f=K}}}})(Wg);zg.exports=Wg;var Ly=zg.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ry=b,Qt=Ly;function X(r){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+r,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+r+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Yg=new Set,Is={};function Zn(r,e){Fi(r,e),Fi(r+"Capture",e)}function Fi(r,e){for(Is[r]=e,r=0;r<e.length;r++)Yg.add(e[r])}var Wr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),hc=Object.prototype.hasOwnProperty,Iy=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,y0={},E0={};function _y(r){return hc.call(E0,r)?!0:hc.call(y0,r)?!1:Iy.test(r)?E0[r]=!0:(y0[r]=!0,!1)}function Dy(r,e,t,n){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:t!==null?!t.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function ky(r,e,t,n){if(e===null||typeof e>"u"||Dy(r,e,t,n))return!0;if(n)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Dt(r,e,t,n,i,s,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=r,this.type=e,this.sanitizeURL=s,this.removeEmptyString=a}var ft={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){ft[r]=new Dt(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var e=r[0];ft[e]=new Dt(e,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){ft[r]=new Dt(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){ft[r]=new Dt(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){ft[r]=new Dt(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){ft[r]=new Dt(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){ft[r]=new Dt(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){ft[r]=new Dt(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){ft[r]=new Dt(r,5,!1,r.toLowerCase(),null,!1,!1)});var Fd=/[\-:]([a-z])/g;function Bd(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var e=r.replace(Fd,Bd);ft[e]=new Dt(e,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var e=r.replace(Fd,Bd);ft[e]=new Dt(e,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var e=r.replace(Fd,Bd);ft[e]=new Dt(e,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){ft[r]=new Dt(r,1,!1,r.toLowerCase(),null,!1,!1)});ft.xlinkHref=new Dt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){ft[r]=new Dt(r,1,!1,r.toLowerCase(),null,!0,!0)});function Od(r,e,t,n){var i=ft.hasOwnProperty(e)?ft[e]:null;(i!==null?i.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(ky(e,t,i,n)&&(t=null),n||i===null?_y(e)&&(t===null?r.removeAttribute(e):r.setAttribute(e,""+t)):i.mustUseProperty?r[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,n=i.attributeNamespace,t===null?r.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,n?r.setAttributeNS(n,e,t):r.setAttribute(e,t))))}var Zr=Ry.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ma=Symbol.for("react.element"),di=Symbol.for("react.portal"),fi=Symbol.for("react.fragment"),Md=Symbol.for("react.strict_mode"),pc=Symbol.for("react.profiler"),qg=Symbol.for("react.provider"),Xg=Symbol.for("react.context"),Nd=Symbol.for("react.forward_ref"),gc=Symbol.for("react.suspense"),mc=Symbol.for("react.suspense_list"),$d=Symbol.for("react.memo"),sn=Symbol.for("react.lazy"),Qg=Symbol.for("react.offscreen"),S0=Symbol.iterator;function es(r){return r===null||typeof r!="object"?null:(r=S0&&r[S0]||r["@@iterator"],typeof r=="function"?r:null)}var Ve=Object.assign,wl;function cs(r){if(wl===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);wl=e&&e[1]||""}return`
`+wl+r}var bl=!1;function Pl(r,e){if(!r||bl)return"";bl=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var n=l}Reflect.construct(r,[],e)}else{try{e.call()}catch(l){n=l}r.call(e.prototype)}else{try{throw Error()}catch(l){n=l}r()}}catch(l){if(l&&n&&typeof l.stack=="string"){for(var i=l.stack.split(`
`),s=n.stack.split(`
`),a=i.length-1,o=s.length-1;1<=a&&0<=o&&i[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(i[a]!==s[o]){if(a!==1||o!==1)do if(a--,o--,0>o||i[a]!==s[o]){var u=`
`+i[a].replace(" at new "," at ");return r.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",r.displayName)),u}while(1<=a&&0<=o);break}}}finally{bl=!1,Error.prepareStackTrace=t}return(r=r?r.displayName||r.name:"")?cs(r):""}function wy(r){switch(r.tag){case 5:return cs(r.type);case 16:return cs("Lazy");case 13:return cs("Suspense");case 19:return cs("SuspenseList");case 0:case 2:case 15:return r=Pl(r.type,!1),r;case 11:return r=Pl(r.type.render,!1),r;case 1:return r=Pl(r.type,!0),r;default:return""}}function xc(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case fi:return"Fragment";case di:return"Portal";case pc:return"Profiler";case Md:return"StrictMode";case gc:return"Suspense";case mc:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case Xg:return(r.displayName||"Context")+".Consumer";case qg:return(r._context.displayName||"Context")+".Provider";case Nd:var e=r.render;return r=r.displayName,r||(r=e.displayName||e.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case $d:return e=r.displayName||null,e!==null?e:xc(r.type)||"Memo";case sn:e=r._payload,r=r._init;try{return xc(r(e))}catch{}}return null}function by(r){var e=r.type;switch(r.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=e.render,r=r.displayName||r.name||"",e.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return xc(e);case 8:return e===Md?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Sn(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function Zg(r){var e=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Py(r){var e=Zg(r)?"checked":"value",t=Object.getOwnPropertyDescriptor(r.constructor.prototype,e),n=""+r[e];if(!r.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,s=t.set;return Object.defineProperty(r,e,{configurable:!0,get:function(){return i.call(this)},set:function(a){n=""+a,s.call(this,a)}}),Object.defineProperty(r,e,{enumerable:t.enumerable}),{getValue:function(){return n},setValue:function(a){n=""+a},stopTracking:function(){r._valueTracker=null,delete r[e]}}}}function xa(r){r._valueTracker||(r._valueTracker=Py(r))}function Jg(r){if(!r)return!1;var e=r._valueTracker;if(!e)return!0;var t=e.getValue(),n="";return r&&(n=Zg(r)?r.checked?"true":"false":r.value),r=n,r!==t?(e.setValue(r),!0):!1}function vo(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function vc(r,e){var t=e.checked;return Ve({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??r._wrapperState.initialChecked})}function T0(r,e){var t=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;t=Sn(e.value!=null?e.value:t),r._wrapperState={initialChecked:n,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function em(r,e){e=e.checked,e!=null&&Od(r,"checked",e,!1)}function yc(r,e){em(r,e);var t=Sn(e.value),n=e.type;if(t!=null)n==="number"?(t===0&&r.value===""||r.value!=t)&&(r.value=""+t):r.value!==""+t&&(r.value=""+t);else if(n==="submit"||n==="reset"){r.removeAttribute("value");return}e.hasOwnProperty("value")?Ec(r,e.type,t):e.hasOwnProperty("defaultValue")&&Ec(r,e.type,Sn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(r.defaultChecked=!!e.defaultChecked)}function A0(r,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+r._wrapperState.initialValue,t||e===r.value||(r.value=e),r.defaultValue=e}t=r.name,t!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,t!==""&&(r.name=t)}function Ec(r,e,t){(e!=="number"||vo(r.ownerDocument)!==r)&&(t==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+t&&(r.defaultValue=""+t))}var ds=Array.isArray;function Ci(r,e,t,n){if(r=r.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<r.length;t++)i=e.hasOwnProperty("$"+r[t].value),r[t].selected!==i&&(r[t].selected=i),i&&n&&(r[t].defaultSelected=!0)}else{for(t=""+Sn(t),e=null,i=0;i<r.length;i++){if(r[i].value===t){r[i].selected=!0,n&&(r[i].defaultSelected=!0);return}e!==null||r[i].disabled||(e=r[i])}e!==null&&(e.selected=!0)}}function Sc(r,e){if(e.dangerouslySetInnerHTML!=null)throw Error(X(91));return Ve({},e,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function C0(r,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(X(92));if(ds(t)){if(1<t.length)throw Error(X(93));t=t[0]}e=t}e==null&&(e=""),t=e}r._wrapperState={initialValue:Sn(t)}}function tm(r,e){var t=Sn(e.value),n=Sn(e.defaultValue);t!=null&&(t=""+t,t!==r.value&&(r.value=t),e.defaultValue==null&&r.defaultValue!==t&&(r.defaultValue=t)),n!=null&&(r.defaultValue=""+n)}function L0(r){var e=r.textContent;e===r._wrapperState.initialValue&&e!==""&&e!==null&&(r.value=e)}function rm(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Tc(r,e){return r==null||r==="http://www.w3.org/1999/xhtml"?rm(e):r==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var va,nm=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction(function(){return r(e,t,n,i)})}:r}(function(r,e){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=e;else{for(va=va||document.createElement("div"),va.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=va.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;e.firstChild;)r.appendChild(e.firstChild)}});function _s(r,e){if(e){var t=r.firstChild;if(t&&t===r.lastChild&&t.nodeType===3){t.nodeValue=e;return}}r.textContent=e}var gs={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Fy=["Webkit","ms","Moz","O"];Object.keys(gs).forEach(function(r){Fy.forEach(function(e){e=e+r.charAt(0).toUpperCase()+r.substring(1),gs[e]=gs[r]})});function im(r,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||gs.hasOwnProperty(r)&&gs[r]?(""+e).trim():e+"px"}function sm(r,e){r=r.style;for(var t in e)if(e.hasOwnProperty(t)){var n=t.indexOf("--")===0,i=im(t,e[t],n);t==="float"&&(t="cssFloat"),n?r.setProperty(t,i):r[t]=i}}var By=Ve({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ac(r,e){if(e){if(By[r]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(X(137,r));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(X(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(X(61))}if(e.style!=null&&typeof e.style!="object")throw Error(X(62))}}function Cc(r,e){if(r.indexOf("-")===-1)return typeof e.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Lc=null;function Ud(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Rc=null,Li=null,Ri=null;function R0(r){if(r=ta(r)){if(typeof Rc!="function")throw Error(X(280));var e=r.stateNode;e&&(e=sl(e),Rc(r.stateNode,r.type,e))}}function am(r){Li?Ri?Ri.push(r):Ri=[r]:Li=r}function om(){if(Li){var r=Li,e=Ri;if(Ri=Li=null,R0(r),e)for(r=0;r<e.length;r++)R0(e[r])}}function lm(r,e){return r(e)}function um(){}var Fl=!1;function cm(r,e,t){if(Fl)return r(e,t);Fl=!0;try{return lm(r,e,t)}finally{Fl=!1,(Li!==null||Ri!==null)&&(um(),om())}}function Ds(r,e){var t=r.stateNode;if(t===null)return null;var n=sl(t);if(n===null)return null;t=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(r=r.type,n=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!n;break e;default:r=!1}if(r)return null;if(t&&typeof t!="function")throw Error(X(231,e,typeof t));return t}var Ic=!1;if(Wr)try{var ts={};Object.defineProperty(ts,"passive",{get:function(){Ic=!0}}),window.addEventListener("test",ts,ts),window.removeEventListener("test",ts,ts)}catch{Ic=!1}function Oy(r,e,t,n,i,s,a,o,u){var l=Array.prototype.slice.call(arguments,3);try{e.apply(t,l)}catch(c){this.onError(c)}}var ms=!1,yo=null,Eo=!1,_c=null,My={onError:function(r){ms=!0,yo=r}};function Ny(r,e,t,n,i,s,a,o,u){ms=!1,yo=null,Oy.apply(My,arguments)}function $y(r,e,t,n,i,s,a,o,u){if(Ny.apply(this,arguments),ms){if(ms){var l=yo;ms=!1,yo=null}else throw Error(X(198));Eo||(Eo=!0,_c=l)}}function Jn(r){var e=r,t=r;if(r.alternate)for(;e.return;)e=e.return;else{r=e;do e=r,e.flags&4098&&(t=e.return),r=e.return;while(r)}return e.tag===3?t:null}function dm(r){if(r.tag===13){var e=r.memoizedState;if(e===null&&(r=r.alternate,r!==null&&(e=r.memoizedState)),e!==null)return e.dehydrated}return null}function I0(r){if(Jn(r)!==r)throw Error(X(188))}function Uy(r){var e=r.alternate;if(!e){if(e=Jn(r),e===null)throw Error(X(188));return e!==r?null:r}for(var t=r,n=e;;){var i=t.return;if(i===null)break;var s=i.alternate;if(s===null){if(n=i.return,n!==null){t=n;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===t)return I0(i),r;if(s===n)return I0(i),e;s=s.sibling}throw Error(X(188))}if(t.return!==n.return)t=i,n=s;else{for(var a=!1,o=i.child;o;){if(o===t){a=!0,t=i,n=s;break}if(o===n){a=!0,n=i,t=s;break}o=o.sibling}if(!a){for(o=s.child;o;){if(o===t){a=!0,t=s,n=i;break}if(o===n){a=!0,n=s,t=i;break}o=o.sibling}if(!a)throw Error(X(189))}}if(t.alternate!==n)throw Error(X(190))}if(t.tag!==3)throw Error(X(188));return t.stateNode.current===t?r:e}function fm(r){return r=Uy(r),r!==null?hm(r):null}function hm(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var e=hm(r);if(e!==null)return e;r=r.sibling}return null}var pm=Qt.unstable_scheduleCallback,_0=Qt.unstable_cancelCallback,Gy=Qt.unstable_shouldYield,Hy=Qt.unstable_requestPaint,We=Qt.unstable_now,Vy=Qt.unstable_getCurrentPriorityLevel,Gd=Qt.unstable_ImmediatePriority,gm=Qt.unstable_UserBlockingPriority,So=Qt.unstable_NormalPriority,jy=Qt.unstable_LowPriority,mm=Qt.unstable_IdlePriority,tl=null,wr=null;function Ky(r){if(wr&&typeof wr.onCommitFiberRoot=="function")try{wr.onCommitFiberRoot(tl,r,void 0,(r.current.flags&128)===128)}catch{}}var mr=Math.clz32?Math.clz32:Yy,zy=Math.log,Wy=Math.LN2;function Yy(r){return r>>>=0,r===0?32:31-(zy(r)/Wy|0)|0}var ya=64,Ea=4194304;function fs(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function To(r,e){var t=r.pendingLanes;if(t===0)return 0;var n=0,i=r.suspendedLanes,s=r.pingedLanes,a=t&268435455;if(a!==0){var o=a&~i;o!==0?n=fs(o):(s&=a,s!==0&&(n=fs(s)))}else a=t&~i,a!==0?n=fs(a):s!==0&&(n=fs(s));if(n===0)return 0;if(e!==0&&e!==n&&!(e&i)&&(i=n&-n,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(n&4&&(n|=t&16),e=r.entangledLanes,e!==0)for(r=r.entanglements,e&=n;0<e;)t=31-mr(e),i=1<<t,n|=r[t],e&=~i;return n}function qy(r,e){switch(r){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Xy(r,e){for(var t=r.suspendedLanes,n=r.pingedLanes,i=r.expirationTimes,s=r.pendingLanes;0<s;){var a=31-mr(s),o=1<<a,u=i[a];u===-1?(!(o&t)||o&n)&&(i[a]=qy(o,e)):u<=e&&(r.expiredLanes|=o),s&=~o}}function Dc(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function xm(){var r=ya;return ya<<=1,!(ya&4194240)&&(ya=64),r}function Bl(r){for(var e=[],t=0;31>t;t++)e.push(r);return e}function Js(r,e,t){r.pendingLanes|=e,e!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,e=31-mr(e),r[e]=t}function Qy(r,e){var t=r.pendingLanes&~e;r.pendingLanes=e,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=e,r.mutableReadLanes&=e,r.entangledLanes&=e,e=r.entanglements;var n=r.eventTimes;for(r=r.expirationTimes;0<t;){var i=31-mr(t),s=1<<i;e[i]=0,n[i]=-1,r[i]=-1,t&=~s}}function Hd(r,e){var t=r.entangledLanes|=e;for(r=r.entanglements;t;){var n=31-mr(t),i=1<<n;i&e|r[n]&e&&(r[n]|=e),t&=~i}}var Le=0;function vm(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var ym,Vd,Em,Sm,Tm,kc=!1,Sa=[],hn=null,pn=null,gn=null,ks=new Map,ws=new Map,un=[],Zy="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function D0(r,e){switch(r){case"focusin":case"focusout":hn=null;break;case"dragenter":case"dragleave":pn=null;break;case"mouseover":case"mouseout":gn=null;break;case"pointerover":case"pointerout":ks.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ws.delete(e.pointerId)}}function rs(r,e,t,n,i,s){return r===null||r.nativeEvent!==s?(r={blockedOn:e,domEventName:t,eventSystemFlags:n,nativeEvent:s,targetContainers:[i]},e!==null&&(e=ta(e),e!==null&&Vd(e)),r):(r.eventSystemFlags|=n,e=r.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),r)}function Jy(r,e,t,n,i){switch(e){case"focusin":return hn=rs(hn,r,e,t,n,i),!0;case"dragenter":return pn=rs(pn,r,e,t,n,i),!0;case"mouseover":return gn=rs(gn,r,e,t,n,i),!0;case"pointerover":var s=i.pointerId;return ks.set(s,rs(ks.get(s)||null,r,e,t,n,i)),!0;case"gotpointercapture":return s=i.pointerId,ws.set(s,rs(ws.get(s)||null,r,e,t,n,i)),!0}return!1}function Am(r){var e=$n(r.target);if(e!==null){var t=Jn(e);if(t!==null){if(e=t.tag,e===13){if(e=dm(t),e!==null){r.blockedOn=e,Tm(r.priority,function(){Em(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){r.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Qa(r){if(r.blockedOn!==null)return!1;for(var e=r.targetContainers;0<e.length;){var t=wc(r.domEventName,r.eventSystemFlags,e[0],r.nativeEvent);if(t===null){t=r.nativeEvent;var n=new t.constructor(t.type,t);Lc=n,t.target.dispatchEvent(n),Lc=null}else return e=ta(t),e!==null&&Vd(e),r.blockedOn=t,!1;e.shift()}return!0}function k0(r,e,t){Qa(r)&&t.delete(e)}function eE(){kc=!1,hn!==null&&Qa(hn)&&(hn=null),pn!==null&&Qa(pn)&&(pn=null),gn!==null&&Qa(gn)&&(gn=null),ks.forEach(k0),ws.forEach(k0)}function ns(r,e){r.blockedOn===e&&(r.blockedOn=null,kc||(kc=!0,Qt.unstable_scheduleCallback(Qt.unstable_NormalPriority,eE)))}function bs(r){function e(i){return ns(i,r)}if(0<Sa.length){ns(Sa[0],r);for(var t=1;t<Sa.length;t++){var n=Sa[t];n.blockedOn===r&&(n.blockedOn=null)}}for(hn!==null&&ns(hn,r),pn!==null&&ns(pn,r),gn!==null&&ns(gn,r),ks.forEach(e),ws.forEach(e),t=0;t<un.length;t++)n=un[t],n.blockedOn===r&&(n.blockedOn=null);for(;0<un.length&&(t=un[0],t.blockedOn===null);)Am(t),t.blockedOn===null&&un.shift()}var Ii=Zr.ReactCurrentBatchConfig,Ao=!0;function tE(r,e,t,n){var i=Le,s=Ii.transition;Ii.transition=null;try{Le=1,jd(r,e,t,n)}finally{Le=i,Ii.transition=s}}function rE(r,e,t,n){var i=Le,s=Ii.transition;Ii.transition=null;try{Le=4,jd(r,e,t,n)}finally{Le=i,Ii.transition=s}}function jd(r,e,t,n){if(Ao){var i=wc(r,e,t,n);if(i===null)Kl(r,e,n,Co,t),D0(r,n);else if(Jy(i,r,e,t,n))n.stopPropagation();else if(D0(r,n),e&4&&-1<Zy.indexOf(r)){for(;i!==null;){var s=ta(i);if(s!==null&&ym(s),s=wc(r,e,t,n),s===null&&Kl(r,e,n,Co,t),s===i)break;i=s}i!==null&&n.stopPropagation()}else Kl(r,e,n,null,t)}}var Co=null;function wc(r,e,t,n){if(Co=null,r=Ud(n),r=$n(r),r!==null)if(e=Jn(r),e===null)r=null;else if(t=e.tag,t===13){if(r=dm(e),r!==null)return r;r=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;r=null}else e!==r&&(r=null);return Co=r,null}function Cm(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Vy()){case Gd:return 1;case gm:return 4;case So:case jy:return 16;case mm:return 536870912;default:return 16}default:return 16}}var dn=null,Kd=null,Za=null;function Lm(){if(Za)return Za;var r,e=Kd,t=e.length,n,i="value"in dn?dn.value:dn.textContent,s=i.length;for(r=0;r<t&&e[r]===i[r];r++);var a=t-r;for(n=1;n<=a&&e[t-n]===i[s-n];n++);return Za=i.slice(r,1<n?1-n:void 0)}function Ja(r){var e=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&e===13&&(r=13)):r=e,r===10&&(r=13),32<=r||r===13?r:0}function Ta(){return!0}function w0(){return!1}function er(r){function e(t,n,i,s,a){this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=s,this.target=a,this.currentTarget=null;for(var o in r)r.hasOwnProperty(o)&&(t=r[o],this[o]=t?t(s):s[o]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Ta:w0,this.isPropagationStopped=w0,this}return Ve(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Ta)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Ta)},persist:function(){},isPersistent:Ta}),e}var ji={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},zd=er(ji),ea=Ve({},ji,{view:0,detail:0}),nE=er(ea),Ol,Ml,is,rl=Ve({},ea,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Wd,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==is&&(is&&r.type==="mousemove"?(Ol=r.screenX-is.screenX,Ml=r.screenY-is.screenY):Ml=Ol=0,is=r),Ol)},movementY:function(r){return"movementY"in r?r.movementY:Ml}}),b0=er(rl),iE=Ve({},rl,{dataTransfer:0}),sE=er(iE),aE=Ve({},ea,{relatedTarget:0}),Nl=er(aE),oE=Ve({},ji,{animationName:0,elapsedTime:0,pseudoElement:0}),lE=er(oE),uE=Ve({},ji,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),cE=er(uE),dE=Ve({},ji,{data:0}),P0=er(dE),fE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},pE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function gE(r){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(r):(r=pE[r])?!!e[r]:!1}function Wd(){return gE}var mE=Ve({},ea,{key:function(r){if(r.key){var e=fE[r.key]||r.key;if(e!=="Unidentified")return e}return r.type==="keypress"?(r=Ja(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?hE[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Wd,charCode:function(r){return r.type==="keypress"?Ja(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Ja(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),xE=er(mE),vE=Ve({},rl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),F0=er(vE),yE=Ve({},ea,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Wd}),EE=er(yE),SE=Ve({},ji,{propertyName:0,elapsedTime:0,pseudoElement:0}),TE=er(SE),AE=Ve({},rl,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),CE=er(AE),LE=[9,13,27,32],Yd=Wr&&"CompositionEvent"in window,xs=null;Wr&&"documentMode"in document&&(xs=document.documentMode);var RE=Wr&&"TextEvent"in window&&!xs,Rm=Wr&&(!Yd||xs&&8<xs&&11>=xs),B0=" ",O0=!1;function Im(r,e){switch(r){case"keyup":return LE.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function _m(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var hi=!1;function IE(r,e){switch(r){case"compositionend":return _m(e);case"keypress":return e.which!==32?null:(O0=!0,B0);case"textInput":return r=e.data,r===B0&&O0?null:r;default:return null}}function _E(r,e){if(hi)return r==="compositionend"||!Yd&&Im(r,e)?(r=Lm(),Za=Kd=dn=null,hi=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Rm&&e.locale!=="ko"?null:e.data;default:return null}}var DE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function M0(r){var e=r&&r.nodeName&&r.nodeName.toLowerCase();return e==="input"?!!DE[r.type]:e==="textarea"}function Dm(r,e,t,n){am(n),e=Lo(e,"onChange"),0<e.length&&(t=new zd("onChange","change",null,t,n),r.push({event:t,listeners:e}))}var vs=null,Ps=null;function kE(r){Um(r,0)}function nl(r){var e=mi(r);if(Jg(e))return r}function wE(r,e){if(r==="change")return e}var km=!1;if(Wr){var $l;if(Wr){var Ul="oninput"in document;if(!Ul){var N0=document.createElement("div");N0.setAttribute("oninput","return;"),Ul=typeof N0.oninput=="function"}$l=Ul}else $l=!1;km=$l&&(!document.documentMode||9<document.documentMode)}function $0(){vs&&(vs.detachEvent("onpropertychange",wm),Ps=vs=null)}function wm(r){if(r.propertyName==="value"&&nl(Ps)){var e=[];Dm(e,Ps,r,Ud(r)),cm(kE,e)}}function bE(r,e,t){r==="focusin"?($0(),vs=e,Ps=t,vs.attachEvent("onpropertychange",wm)):r==="focusout"&&$0()}function PE(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return nl(Ps)}function FE(r,e){if(r==="click")return nl(e)}function BE(r,e){if(r==="input"||r==="change")return nl(e)}function OE(r,e){return r===e&&(r!==0||1/r===1/e)||r!==r&&e!==e}var vr=typeof Object.is=="function"?Object.is:OE;function Fs(r,e){if(vr(r,e))return!0;if(typeof r!="object"||r===null||typeof e!="object"||e===null)return!1;var t=Object.keys(r),n=Object.keys(e);if(t.length!==n.length)return!1;for(n=0;n<t.length;n++){var i=t[n];if(!hc.call(e,i)||!vr(r[i],e[i]))return!1}return!0}function U0(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function G0(r,e){var t=U0(r);r=0;for(var n;t;){if(t.nodeType===3){if(n=r+t.textContent.length,r<=e&&n>=e)return{node:t,offset:e-r};r=n}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=U0(t)}}function bm(r,e){return r&&e?r===e?!0:r&&r.nodeType===3?!1:e&&e.nodeType===3?bm(r,e.parentNode):"contains"in r?r.contains(e):r.compareDocumentPosition?!!(r.compareDocumentPosition(e)&16):!1:!1}function Pm(){for(var r=window,e=vo();e instanceof r.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)r=e.contentWindow;else break;e=vo(r.document)}return e}function qd(r){var e=r&&r.nodeName&&r.nodeName.toLowerCase();return e&&(e==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||e==="textarea"||r.contentEditable==="true")}function ME(r){var e=Pm(),t=r.focusedElem,n=r.selectionRange;if(e!==t&&t&&t.ownerDocument&&bm(t.ownerDocument.documentElement,t)){if(n!==null&&qd(t)){if(e=n.start,r=n.end,r===void 0&&(r=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(r,t.value.length);else if(r=(e=t.ownerDocument||document)&&e.defaultView||window,r.getSelection){r=r.getSelection();var i=t.textContent.length,s=Math.min(n.start,i);n=n.end===void 0?s:Math.min(n.end,i),!r.extend&&s>n&&(i=n,n=s,s=i),i=G0(t,s);var a=G0(t,n);i&&a&&(r.rangeCount!==1||r.anchorNode!==i.node||r.anchorOffset!==i.offset||r.focusNode!==a.node||r.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),r.removeAllRanges(),s>n?(r.addRange(e),r.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),r.addRange(e)))}}for(e=[],r=t;r=r.parentNode;)r.nodeType===1&&e.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)r=e[t],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var NE=Wr&&"documentMode"in document&&11>=document.documentMode,pi=null,bc=null,ys=null,Pc=!1;function H0(r,e,t){var n=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;Pc||pi==null||pi!==vo(n)||(n=pi,"selectionStart"in n&&qd(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),ys&&Fs(ys,n)||(ys=n,n=Lo(bc,"onSelect"),0<n.length&&(e=new zd("onSelect","select",null,e,t),r.push({event:e,listeners:n}),e.target=pi)))}function Aa(r,e){var t={};return t[r.toLowerCase()]=e.toLowerCase(),t["Webkit"+r]="webkit"+e,t["Moz"+r]="moz"+e,t}var gi={animationend:Aa("Animation","AnimationEnd"),animationiteration:Aa("Animation","AnimationIteration"),animationstart:Aa("Animation","AnimationStart"),transitionend:Aa("Transition","TransitionEnd")},Gl={},Fm={};Wr&&(Fm=document.createElement("div").style,"AnimationEvent"in window||(delete gi.animationend.animation,delete gi.animationiteration.animation,delete gi.animationstart.animation),"TransitionEvent"in window||delete gi.transitionend.transition);function il(r){if(Gl[r])return Gl[r];if(!gi[r])return r;var e=gi[r],t;for(t in e)if(e.hasOwnProperty(t)&&t in Fm)return Gl[r]=e[t];return r}var Bm=il("animationend"),Om=il("animationiteration"),Mm=il("animationstart"),Nm=il("transitionend"),$m=new Map,V0="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ln(r,e){$m.set(r,e),Zn(e,[r])}for(var Hl=0;Hl<V0.length;Hl++){var Vl=V0[Hl],$E=Vl.toLowerCase(),UE=Vl[0].toUpperCase()+Vl.slice(1);Ln($E,"on"+UE)}Ln(Bm,"onAnimationEnd");Ln(Om,"onAnimationIteration");Ln(Mm,"onAnimationStart");Ln("dblclick","onDoubleClick");Ln("focusin","onFocus");Ln("focusout","onBlur");Ln(Nm,"onTransitionEnd");Fi("onMouseEnter",["mouseout","mouseover"]);Fi("onMouseLeave",["mouseout","mouseover"]);Fi("onPointerEnter",["pointerout","pointerover"]);Fi("onPointerLeave",["pointerout","pointerover"]);Zn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Zn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Zn("onBeforeInput",["compositionend","keypress","textInput","paste"]);Zn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Zn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Zn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var hs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),GE=new Set("cancel close invalid load scroll toggle".split(" ").concat(hs));function j0(r,e,t){var n=r.type||"unknown-event";r.currentTarget=t,$y(n,e,void 0,r),r.currentTarget=null}function Um(r,e){e=(e&4)!==0;for(var t=0;t<r.length;t++){var n=r[t],i=n.event;n=n.listeners;e:{var s=void 0;if(e)for(var a=n.length-1;0<=a;a--){var o=n[a],u=o.instance,l=o.currentTarget;if(o=o.listener,u!==s&&i.isPropagationStopped())break e;j0(i,o,l),s=u}else for(a=0;a<n.length;a++){if(o=n[a],u=o.instance,l=o.currentTarget,o=o.listener,u!==s&&i.isPropagationStopped())break e;j0(i,o,l),s=u}}}if(Eo)throw r=_c,Eo=!1,_c=null,r}function ke(r,e){var t=e[Nc];t===void 0&&(t=e[Nc]=new Set);var n=r+"__bubble";t.has(n)||(Gm(e,r,2,!1),t.add(n))}function jl(r,e,t){var n=0;e&&(n|=4),Gm(t,r,n,e)}var Ca="_reactListening"+Math.random().toString(36).slice(2);function Bs(r){if(!r[Ca]){r[Ca]=!0,Yg.forEach(function(t){t!=="selectionchange"&&(GE.has(t)||jl(t,!1,r),jl(t,!0,r))});var e=r.nodeType===9?r:r.ownerDocument;e===null||e[Ca]||(e[Ca]=!0,jl("selectionchange",!1,e))}}function Gm(r,e,t,n){switch(Cm(e)){case 1:var i=tE;break;case 4:i=rE;break;default:i=jd}t=i.bind(null,e,t,r),i=void 0,!Ic||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),n?i!==void 0?r.addEventListener(e,t,{capture:!0,passive:i}):r.addEventListener(e,t,!0):i!==void 0?r.addEventListener(e,t,{passive:i}):r.addEventListener(e,t,!1)}function Kl(r,e,t,n,i){var s=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var a=n.tag;if(a===3||a===4){var o=n.stateNode.containerInfo;if(o===i||o.nodeType===8&&o.parentNode===i)break;if(a===4)for(a=n.return;a!==null;){var u=a.tag;if((u===3||u===4)&&(u=a.stateNode.containerInfo,u===i||u.nodeType===8&&u.parentNode===i))return;a=a.return}for(;o!==null;){if(a=$n(o),a===null)return;if(u=a.tag,u===5||u===6){n=s=a;continue e}o=o.parentNode}}n=n.return}cm(function(){var l=s,c=Ud(t),d=[];e:{var f=$m.get(r);if(f!==void 0){var h=zd,p=r;switch(r){case"keypress":if(Ja(t)===0)break e;case"keydown":case"keyup":h=xE;break;case"focusin":p="focus",h=Nl;break;case"focusout":p="blur",h=Nl;break;case"beforeblur":case"afterblur":h=Nl;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=b0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=sE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=EE;break;case Bm:case Om:case Mm:h=lE;break;case Nm:h=TE;break;case"scroll":h=nE;break;case"wheel":h=CE;break;case"copy":case"cut":case"paste":h=cE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=F0}var x=(e&4)!==0,v=!x&&r==="scroll",y=x?f!==null?f+"Capture":null:f;x=[];for(var g=l,m;g!==null;){m=g;var E=m.stateNode;if(m.tag===5&&E!==null&&(m=E,y!==null&&(E=Ds(g,y),E!=null&&x.push(Os(g,E,m)))),v)break;g=g.return}0<x.length&&(f=new h(f,p,null,t,c),d.push({event:f,listeners:x}))}}if(!(e&7)){e:{if(f=r==="mouseover"||r==="pointerover",h=r==="mouseout"||r==="pointerout",f&&t!==Lc&&(p=t.relatedTarget||t.fromElement)&&($n(p)||p[Yr]))break e;if((h||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,h?(p=t.relatedTarget||t.toElement,h=l,p=p?$n(p):null,p!==null&&(v=Jn(p),p!==v||p.tag!==5&&p.tag!==6)&&(p=null)):(h=null,p=l),h!==p)){if(x=b0,E="onMouseLeave",y="onMouseEnter",g="mouse",(r==="pointerout"||r==="pointerover")&&(x=F0,E="onPointerLeave",y="onPointerEnter",g="pointer"),v=h==null?f:mi(h),m=p==null?f:mi(p),f=new x(E,g+"leave",h,t,c),f.target=v,f.relatedTarget=m,E=null,$n(c)===l&&(x=new x(y,g+"enter",p,t,c),x.target=m,x.relatedTarget=v,E=x),v=E,h&&p)t:{for(x=h,y=p,g=0,m=x;m;m=ni(m))g++;for(m=0,E=y;E;E=ni(E))m++;for(;0<g-m;)x=ni(x),g--;for(;0<m-g;)y=ni(y),m--;for(;g--;){if(x===y||y!==null&&x===y.alternate)break t;x=ni(x),y=ni(y)}x=null}else x=null;h!==null&&K0(d,f,h,x,!1),p!==null&&v!==null&&K0(d,v,p,x,!0)}}e:{if(f=l?mi(l):window,h=f.nodeName&&f.nodeName.toLowerCase(),h==="select"||h==="input"&&f.type==="file")var T=wE;else if(M0(f))if(km)T=BE;else{T=PE;var L=bE}else(h=f.nodeName)&&h.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(T=FE);if(T&&(T=T(r,l))){Dm(d,T,t,c);break e}L&&L(r,f,l),r==="focusout"&&(L=f._wrapperState)&&L.controlled&&f.type==="number"&&Ec(f,"number",f.value)}switch(L=l?mi(l):window,r){case"focusin":(M0(L)||L.contentEditable==="true")&&(pi=L,bc=l,ys=null);break;case"focusout":ys=bc=pi=null;break;case"mousedown":Pc=!0;break;case"contextmenu":case"mouseup":case"dragend":Pc=!1,H0(d,t,c);break;case"selectionchange":if(NE)break;case"keydown":case"keyup":H0(d,t,c)}var A;if(Yd)e:{switch(r){case"compositionstart":var R="onCompositionStart";break e;case"compositionend":R="onCompositionEnd";break e;case"compositionupdate":R="onCompositionUpdate";break e}R=void 0}else hi?Im(r,t)&&(R="onCompositionEnd"):r==="keydown"&&t.keyCode===229&&(R="onCompositionStart");R&&(Rm&&t.locale!=="ko"&&(hi||R!=="onCompositionStart"?R==="onCompositionEnd"&&hi&&(A=Lm()):(dn=c,Kd="value"in dn?dn.value:dn.textContent,hi=!0)),L=Lo(l,R),0<L.length&&(R=new P0(R,r,null,t,c),d.push({event:R,listeners:L}),A?R.data=A:(A=_m(t),A!==null&&(R.data=A)))),(A=RE?IE(r,t):_E(r,t))&&(l=Lo(l,"onBeforeInput"),0<l.length&&(c=new P0("onBeforeInput","beforeinput",null,t,c),d.push({event:c,listeners:l}),c.data=A))}Um(d,e)})}function Os(r,e,t){return{instance:r,listener:e,currentTarget:t}}function Lo(r,e){for(var t=e+"Capture",n=[];r!==null;){var i=r,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=Ds(r,t),s!=null&&n.unshift(Os(r,s,i)),s=Ds(r,e),s!=null&&n.push(Os(r,s,i))),r=r.return}return n}function ni(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function K0(r,e,t,n,i){for(var s=e._reactName,a=[];t!==null&&t!==n;){var o=t,u=o.alternate,l=o.stateNode;if(u!==null&&u===n)break;o.tag===5&&l!==null&&(o=l,i?(u=Ds(t,s),u!=null&&a.unshift(Os(t,u,o))):i||(u=Ds(t,s),u!=null&&a.push(Os(t,u,o)))),t=t.return}a.length!==0&&r.push({event:e,listeners:a})}var HE=/\r\n?/g,VE=/\u0000|\uFFFD/g;function z0(r){return(typeof r=="string"?r:""+r).replace(HE,`
`).replace(VE,"")}function La(r,e,t){if(e=z0(e),z0(r)!==e&&t)throw Error(X(425))}function Ro(){}var Fc=null,Bc=null;function Oc(r,e){return r==="textarea"||r==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Mc=typeof setTimeout=="function"?setTimeout:void 0,jE=typeof clearTimeout=="function"?clearTimeout:void 0,W0=typeof Promise=="function"?Promise:void 0,KE=typeof queueMicrotask=="function"?queueMicrotask:typeof W0<"u"?function(r){return W0.resolve(null).then(r).catch(zE)}:Mc;function zE(r){setTimeout(function(){throw r})}function zl(r,e){var t=e,n=0;do{var i=t.nextSibling;if(r.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(n===0){r.removeChild(i),bs(e);return}n--}else t!=="$"&&t!=="$?"&&t!=="$!"||n++;t=i}while(t);bs(e)}function mn(r){for(;r!=null;r=r.nextSibling){var e=r.nodeType;if(e===1||e===3)break;if(e===8){if(e=r.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return r}function Y0(r){r=r.previousSibling;for(var e=0;r;){if(r.nodeType===8){var t=r.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return r;e--}else t==="/$"&&e++}r=r.previousSibling}return null}var Ki=Math.random().toString(36).slice(2),_r="__reactFiber$"+Ki,Ms="__reactProps$"+Ki,Yr="__reactContainer$"+Ki,Nc="__reactEvents$"+Ki,WE="__reactListeners$"+Ki,YE="__reactHandles$"+Ki;function $n(r){var e=r[_r];if(e)return e;for(var t=r.parentNode;t;){if(e=t[Yr]||t[_r]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(r=Y0(r);r!==null;){if(t=r[_r])return t;r=Y0(r)}return e}r=t,t=r.parentNode}return null}function ta(r){return r=r[_r]||r[Yr],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function mi(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(X(33))}function sl(r){return r[Ms]||null}var $c=[],xi=-1;function Rn(r){return{current:r}}function we(r){0>xi||(r.current=$c[xi],$c[xi]=null,xi--)}function De(r,e){xi++,$c[xi]=r.current,r.current=e}var Tn={},yt=Rn(Tn),Ot=Rn(!1),zn=Tn;function Bi(r,e){var t=r.type.contextTypes;if(!t)return Tn;var n=r.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in t)i[s]=e[s];return n&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=e,r.__reactInternalMemoizedMaskedChildContext=i),i}function Mt(r){return r=r.childContextTypes,r!=null}function Io(){we(Ot),we(yt)}function q0(r,e,t){if(yt.current!==Tn)throw Error(X(168));De(yt,e),De(Ot,t)}function Hm(r,e,t){var n=r.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return t;n=n.getChildContext();for(var i in n)if(!(i in e))throw Error(X(108,by(r)||"Unknown",i));return Ve({},t,n)}function _o(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||Tn,zn=yt.current,De(yt,r),De(Ot,Ot.current),!0}function X0(r,e,t){var n=r.stateNode;if(!n)throw Error(X(169));t?(r=Hm(r,e,zn),n.__reactInternalMemoizedMergedChildContext=r,we(Ot),we(yt),De(yt,r)):we(Ot),De(Ot,t)}var Hr=null,al=!1,Wl=!1;function Vm(r){Hr===null?Hr=[r]:Hr.push(r)}function qE(r){al=!0,Vm(r)}function In(){if(!Wl&&Hr!==null){Wl=!0;var r=0,e=Le;try{var t=Hr;for(Le=1;r<t.length;r++){var n=t[r];do n=n(!0);while(n!==null)}Hr=null,al=!1}catch(i){throw Hr!==null&&(Hr=Hr.slice(r+1)),pm(Gd,In),i}finally{Le=e,Wl=!1}}return null}var vi=[],yi=0,Do=null,ko=0,tr=[],rr=0,Wn=null,Vr=1,jr="";function On(r,e){vi[yi++]=ko,vi[yi++]=Do,Do=r,ko=e}function jm(r,e,t){tr[rr++]=Vr,tr[rr++]=jr,tr[rr++]=Wn,Wn=r;var n=Vr;r=jr;var i=32-mr(n)-1;n&=~(1<<i),t+=1;var s=32-mr(e)+i;if(30<s){var a=i-i%5;s=(n&(1<<a)-1).toString(32),n>>=a,i-=a,Vr=1<<32-mr(e)+i|t<<i|n,jr=s+r}else Vr=1<<s|t<<i|n,jr=r}function Xd(r){r.return!==null&&(On(r,1),jm(r,1,0))}function Qd(r){for(;r===Do;)Do=vi[--yi],vi[yi]=null,ko=vi[--yi],vi[yi]=null;for(;r===Wn;)Wn=tr[--rr],tr[rr]=null,jr=tr[--rr],tr[rr]=null,Vr=tr[--rr],tr[rr]=null}var qt=null,Yt=null,be=!1,gr=null;function Km(r,e){var t=nr(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=r,e=r.deletions,e===null?(r.deletions=[t],r.flags|=16):e.push(t)}function Q0(r,e){switch(r.tag){case 5:var t=r.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(r.stateNode=e,qt=r,Yt=mn(e.firstChild),!0):!1;case 6:return e=r.pendingProps===""||e.nodeType!==3?null:e,e!==null?(r.stateNode=e,qt=r,Yt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Wn!==null?{id:Vr,overflow:jr}:null,r.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=nr(18,null,null,0),t.stateNode=e,t.return=r,r.child=t,qt=r,Yt=null,!0):!1;default:return!1}}function Uc(r){return(r.mode&1)!==0&&(r.flags&128)===0}function Gc(r){if(be){var e=Yt;if(e){var t=e;if(!Q0(r,e)){if(Uc(r))throw Error(X(418));e=mn(t.nextSibling);var n=qt;e&&Q0(r,e)?Km(n,t):(r.flags=r.flags&-4097|2,be=!1,qt=r)}}else{if(Uc(r))throw Error(X(418));r.flags=r.flags&-4097|2,be=!1,qt=r}}}function Z0(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;qt=r}function Ra(r){if(r!==qt)return!1;if(!be)return Z0(r),be=!0,!1;var e;if((e=r.tag!==3)&&!(e=r.tag!==5)&&(e=r.type,e=e!=="head"&&e!=="body"&&!Oc(r.type,r.memoizedProps)),e&&(e=Yt)){if(Uc(r))throw zm(),Error(X(418));for(;e;)Km(r,e),e=mn(e.nextSibling)}if(Z0(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(X(317));e:{for(r=r.nextSibling,e=0;r;){if(r.nodeType===8){var t=r.data;if(t==="/$"){if(e===0){Yt=mn(r.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}r=r.nextSibling}Yt=null}}else Yt=qt?mn(r.stateNode.nextSibling):null;return!0}function zm(){for(var r=Yt;r;)r=mn(r.nextSibling)}function Oi(){Yt=qt=null,be=!1}function Zd(r){gr===null?gr=[r]:gr.push(r)}var XE=Zr.ReactCurrentBatchConfig;function ss(r,e,t){if(r=t.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(X(309));var n=t.stateNode}if(!n)throw Error(X(147,r));var i=n,s=""+r;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(a){var o=i.refs;a===null?delete o[s]:o[s]=a},e._stringRef=s,e)}if(typeof r!="string")throw Error(X(284));if(!t._owner)throw Error(X(290,r))}return r}function Ia(r,e){throw r=Object.prototype.toString.call(e),Error(X(31,r==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":r))}function J0(r){var e=r._init;return e(r._payload)}function Wm(r){function e(y,g){if(r){var m=y.deletions;m===null?(y.deletions=[g],y.flags|=16):m.push(g)}}function t(y,g){if(!r)return null;for(;g!==null;)e(y,g),g=g.sibling;return null}function n(y,g){for(y=new Map;g!==null;)g.key!==null?y.set(g.key,g):y.set(g.index,g),g=g.sibling;return y}function i(y,g){return y=En(y,g),y.index=0,y.sibling=null,y}function s(y,g,m){return y.index=m,r?(m=y.alternate,m!==null?(m=m.index,m<g?(y.flags|=2,g):m):(y.flags|=2,g)):(y.flags|=1048576,g)}function a(y){return r&&y.alternate===null&&(y.flags|=2),y}function o(y,g,m,E){return g===null||g.tag!==6?(g=eu(m,y.mode,E),g.return=y,g):(g=i(g,m),g.return=y,g)}function u(y,g,m,E){var T=m.type;return T===fi?c(y,g,m.props.children,E,m.key):g!==null&&(g.elementType===T||typeof T=="object"&&T!==null&&T.$$typeof===sn&&J0(T)===g.type)?(E=i(g,m.props),E.ref=ss(y,g,m),E.return=y,E):(E=ao(m.type,m.key,m.props,null,y.mode,E),E.ref=ss(y,g,m),E.return=y,E)}function l(y,g,m,E){return g===null||g.tag!==4||g.stateNode.containerInfo!==m.containerInfo||g.stateNode.implementation!==m.implementation?(g=tu(m,y.mode,E),g.return=y,g):(g=i(g,m.children||[]),g.return=y,g)}function c(y,g,m,E,T){return g===null||g.tag!==7?(g=Vn(m,y.mode,E,T),g.return=y,g):(g=i(g,m),g.return=y,g)}function d(y,g,m){if(typeof g=="string"&&g!==""||typeof g=="number")return g=eu(""+g,y.mode,m),g.return=y,g;if(typeof g=="object"&&g!==null){switch(g.$$typeof){case ma:return m=ao(g.type,g.key,g.props,null,y.mode,m),m.ref=ss(y,null,g),m.return=y,m;case di:return g=tu(g,y.mode,m),g.return=y,g;case sn:var E=g._init;return d(y,E(g._payload),m)}if(ds(g)||es(g))return g=Vn(g,y.mode,m,null),g.return=y,g;Ia(y,g)}return null}function f(y,g,m,E){var T=g!==null?g.key:null;if(typeof m=="string"&&m!==""||typeof m=="number")return T!==null?null:o(y,g,""+m,E);if(typeof m=="object"&&m!==null){switch(m.$$typeof){case ma:return m.key===T?u(y,g,m,E):null;case di:return m.key===T?l(y,g,m,E):null;case sn:return T=m._init,f(y,g,T(m._payload),E)}if(ds(m)||es(m))return T!==null?null:c(y,g,m,E,null);Ia(y,m)}return null}function h(y,g,m,E,T){if(typeof E=="string"&&E!==""||typeof E=="number")return y=y.get(m)||null,o(g,y,""+E,T);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case ma:return y=y.get(E.key===null?m:E.key)||null,u(g,y,E,T);case di:return y=y.get(E.key===null?m:E.key)||null,l(g,y,E,T);case sn:var L=E._init;return h(y,g,m,L(E._payload),T)}if(ds(E)||es(E))return y=y.get(m)||null,c(g,y,E,T,null);Ia(g,E)}return null}function p(y,g,m,E){for(var T=null,L=null,A=g,R=g=0,I=null;A!==null&&R<m.length;R++){A.index>R?(I=A,A=null):I=A.sibling;var C=f(y,A,m[R],E);if(C===null){A===null&&(A=I);break}r&&A&&C.alternate===null&&e(y,A),g=s(C,g,R),L===null?T=C:L.sibling=C,L=C,A=I}if(R===m.length)return t(y,A),be&&On(y,R),T;if(A===null){for(;R<m.length;R++)A=d(y,m[R],E),A!==null&&(g=s(A,g,R),L===null?T=A:L.sibling=A,L=A);return be&&On(y,R),T}for(A=n(y,A);R<m.length;R++)I=h(A,y,R,m[R],E),I!==null&&(r&&I.alternate!==null&&A.delete(I.key===null?R:I.key),g=s(I,g,R),L===null?T=I:L.sibling=I,L=I);return r&&A.forEach(function(_){return e(y,_)}),be&&On(y,R),T}function x(y,g,m,E){var T=es(m);if(typeof T!="function")throw Error(X(150));if(m=T.call(m),m==null)throw Error(X(151));for(var L=T=null,A=g,R=g=0,I=null,C=m.next();A!==null&&!C.done;R++,C=m.next()){A.index>R?(I=A,A=null):I=A.sibling;var _=f(y,A,C.value,E);if(_===null){A===null&&(A=I);break}r&&A&&_.alternate===null&&e(y,A),g=s(_,g,R),L===null?T=_:L.sibling=_,L=_,A=I}if(C.done)return t(y,A),be&&On(y,R),T;if(A===null){for(;!C.done;R++,C=m.next())C=d(y,C.value,E),C!==null&&(g=s(C,g,R),L===null?T=C:L.sibling=C,L=C);return be&&On(y,R),T}for(A=n(y,A);!C.done;R++,C=m.next())C=h(A,y,R,C.value,E),C!==null&&(r&&C.alternate!==null&&A.delete(C.key===null?R:C.key),g=s(C,g,R),L===null?T=C:L.sibling=C,L=C);return r&&A.forEach(function(F){return e(y,F)}),be&&On(y,R),T}function v(y,g,m,E){if(typeof m=="object"&&m!==null&&m.type===fi&&m.key===null&&(m=m.props.children),typeof m=="object"&&m!==null){switch(m.$$typeof){case ma:e:{for(var T=m.key,L=g;L!==null;){if(L.key===T){if(T=m.type,T===fi){if(L.tag===7){t(y,L.sibling),g=i(L,m.props.children),g.return=y,y=g;break e}}else if(L.elementType===T||typeof T=="object"&&T!==null&&T.$$typeof===sn&&J0(T)===L.type){t(y,L.sibling),g=i(L,m.props),g.ref=ss(y,L,m),g.return=y,y=g;break e}t(y,L);break}else e(y,L);L=L.sibling}m.type===fi?(g=Vn(m.props.children,y.mode,E,m.key),g.return=y,y=g):(E=ao(m.type,m.key,m.props,null,y.mode,E),E.ref=ss(y,g,m),E.return=y,y=E)}return a(y);case di:e:{for(L=m.key;g!==null;){if(g.key===L)if(g.tag===4&&g.stateNode.containerInfo===m.containerInfo&&g.stateNode.implementation===m.implementation){t(y,g.sibling),g=i(g,m.children||[]),g.return=y,y=g;break e}else{t(y,g);break}else e(y,g);g=g.sibling}g=tu(m,y.mode,E),g.return=y,y=g}return a(y);case sn:return L=m._init,v(y,g,L(m._payload),E)}if(ds(m))return p(y,g,m,E);if(es(m))return x(y,g,m,E);Ia(y,m)}return typeof m=="string"&&m!==""||typeof m=="number"?(m=""+m,g!==null&&g.tag===6?(t(y,g.sibling),g=i(g,m),g.return=y,y=g):(t(y,g),g=eu(m,y.mode,E),g.return=y,y=g),a(y)):t(y,g)}return v}var Mi=Wm(!0),Ym=Wm(!1),wo=Rn(null),bo=null,Ei=null,Jd=null;function ef(){Jd=Ei=bo=null}function tf(r){var e=wo.current;we(wo),r._currentValue=e}function Hc(r,e,t){for(;r!==null;){var n=r.alternate;if((r.childLanes&e)!==e?(r.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),r===t)break;r=r.return}}function _i(r,e){bo=r,Jd=Ei=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&e&&(Ft=!0),r.firstContext=null)}function sr(r){var e=r._currentValue;if(Jd!==r)if(r={context:r,memoizedValue:e,next:null},Ei===null){if(bo===null)throw Error(X(308));Ei=r,bo.dependencies={lanes:0,firstContext:r}}else Ei=Ei.next=r;return e}var Un=null;function rf(r){Un===null?Un=[r]:Un.push(r)}function qm(r,e,t,n){var i=e.interleaved;return i===null?(t.next=t,rf(e)):(t.next=i.next,i.next=t),e.interleaved=t,qr(r,n)}function qr(r,e){r.lanes|=e;var t=r.alternate;for(t!==null&&(t.lanes|=e),t=r,r=r.return;r!==null;)r.childLanes|=e,t=r.alternate,t!==null&&(t.childLanes|=e),t=r,r=r.return;return t.tag===3?t.stateNode:null}var an=!1;function nf(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Xm(r,e){r=r.updateQueue,e.updateQueue===r&&(e.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function Kr(r,e){return{eventTime:r,lane:e,tag:0,payload:null,callback:null,next:null}}function xn(r,e,t){var n=r.updateQueue;if(n===null)return null;if(n=n.shared,ye&2){var i=n.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),n.pending=e,qr(r,t)}return i=n.interleaved,i===null?(e.next=e,rf(n)):(e.next=i.next,i.next=e),n.interleaved=e,qr(r,t)}function eo(r,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var n=e.lanes;n&=r.pendingLanes,t|=n,e.lanes=t,Hd(r,t)}}function eh(r,e){var t=r.updateQueue,n=r.alternate;if(n!==null&&(n=n.updateQueue,t===n)){var i=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?i=s=a:s=s.next=a,t=t.next}while(t!==null);s===null?i=s=e:s=s.next=e}else i=s=e;t={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:n.shared,effects:n.effects},r.updateQueue=t;return}r=t.lastBaseUpdate,r===null?t.firstBaseUpdate=e:r.next=e,t.lastBaseUpdate=e}function Po(r,e,t,n){var i=r.updateQueue;an=!1;var s=i.firstBaseUpdate,a=i.lastBaseUpdate,o=i.shared.pending;if(o!==null){i.shared.pending=null;var u=o,l=u.next;u.next=null,a===null?s=l:a.next=l,a=u;var c=r.alternate;c!==null&&(c=c.updateQueue,o=c.lastBaseUpdate,o!==a&&(o===null?c.firstBaseUpdate=l:o.next=l,c.lastBaseUpdate=u))}if(s!==null){var d=i.baseState;a=0,c=l=u=null,o=s;do{var f=o.lane,h=o.eventTime;if((n&f)===f){c!==null&&(c=c.next={eventTime:h,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var p=r,x=o;switch(f=e,h=t,x.tag){case 1:if(p=x.payload,typeof p=="function"){d=p.call(h,d,f);break e}d=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=x.payload,f=typeof p=="function"?p.call(h,d,f):p,f==null)break e;d=Ve({},d,f);break e;case 2:an=!0}}o.callback!==null&&o.lane!==0&&(r.flags|=64,f=i.effects,f===null?i.effects=[o]:f.push(o))}else h={eventTime:h,lane:f,tag:o.tag,payload:o.payload,callback:o.callback,next:null},c===null?(l=c=h,u=d):c=c.next=h,a|=f;if(o=o.next,o===null){if(o=i.shared.pending,o===null)break;f=o,o=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(!0);if(c===null&&(u=d),i.baseState=u,i.firstBaseUpdate=l,i.lastBaseUpdate=c,e=i.shared.interleaved,e!==null){i=e;do a|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);qn|=a,r.lanes=a,r.memoizedState=d}}function th(r,e,t){if(r=e.effects,e.effects=null,r!==null)for(e=0;e<r.length;e++){var n=r[e],i=n.callback;if(i!==null){if(n.callback=null,n=t,typeof i!="function")throw Error(X(191,i));i.call(n)}}}var ra={},br=Rn(ra),Ns=Rn(ra),$s=Rn(ra);function Gn(r){if(r===ra)throw Error(X(174));return r}function sf(r,e){switch(De($s,e),De(Ns,r),De(br,ra),r=e.nodeType,r){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Tc(null,"");break;default:r=r===8?e.parentNode:e,e=r.namespaceURI||null,r=r.tagName,e=Tc(e,r)}we(br),De(br,e)}function Ni(){we(br),we(Ns),we($s)}function Qm(r){Gn($s.current);var e=Gn(br.current),t=Tc(e,r.type);e!==t&&(De(Ns,r),De(br,t))}function af(r){Ns.current===r&&(we(br),we(Ns))}var Ue=Rn(0);function Fo(r){for(var e=r;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===r)break;for(;e.sibling===null;){if(e.return===null||e.return===r)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Yl=[];function of(){for(var r=0;r<Yl.length;r++)Yl[r]._workInProgressVersionPrimary=null;Yl.length=0}var to=Zr.ReactCurrentDispatcher,ql=Zr.ReactCurrentBatchConfig,Yn=0,He=null,Je=null,nt=null,Bo=!1,Es=!1,Us=0,QE=0;function mt(){throw Error(X(321))}function lf(r,e){if(e===null)return!1;for(var t=0;t<e.length&&t<r.length;t++)if(!vr(r[t],e[t]))return!1;return!0}function uf(r,e,t,n,i,s){if(Yn=s,He=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,to.current=r===null||r.memoizedState===null?t2:r2,r=t(n,i),Es){s=0;do{if(Es=!1,Us=0,25<=s)throw Error(X(301));s+=1,nt=Je=null,e.updateQueue=null,to.current=n2,r=t(n,i)}while(Es)}if(to.current=Oo,e=Je!==null&&Je.next!==null,Yn=0,nt=Je=He=null,Bo=!1,e)throw Error(X(300));return r}function cf(){var r=Us!==0;return Us=0,r}function Lr(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return nt===null?He.memoizedState=nt=r:nt=nt.next=r,nt}function ar(){if(Je===null){var r=He.alternate;r=r!==null?r.memoizedState:null}else r=Je.next;var e=nt===null?He.memoizedState:nt.next;if(e!==null)nt=e,Je=r;else{if(r===null)throw Error(X(310));Je=r,r={memoizedState:Je.memoizedState,baseState:Je.baseState,baseQueue:Je.baseQueue,queue:Je.queue,next:null},nt===null?He.memoizedState=nt=r:nt=nt.next=r}return nt}function Gs(r,e){return typeof e=="function"?e(r):e}function Xl(r){var e=ar(),t=e.queue;if(t===null)throw Error(X(311));t.lastRenderedReducer=r;var n=Je,i=n.baseQueue,s=t.pending;if(s!==null){if(i!==null){var a=i.next;i.next=s.next,s.next=a}n.baseQueue=i=s,t.pending=null}if(i!==null){s=i.next,n=n.baseState;var o=a=null,u=null,l=s;do{var c=l.lane;if((Yn&c)===c)u!==null&&(u=u.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),n=l.hasEagerState?l.eagerState:r(n,l.action);else{var d={lane:c,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};u===null?(o=u=d,a=n):u=u.next=d,He.lanes|=c,qn|=c}l=l.next}while(l!==null&&l!==s);u===null?a=n:u.next=o,vr(n,e.memoizedState)||(Ft=!0),e.memoizedState=n,e.baseState=a,e.baseQueue=u,t.lastRenderedState=n}if(r=t.interleaved,r!==null){i=r;do s=i.lane,He.lanes|=s,qn|=s,i=i.next;while(i!==r)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Ql(r){var e=ar(),t=e.queue;if(t===null)throw Error(X(311));t.lastRenderedReducer=r;var n=t.dispatch,i=t.pending,s=e.memoizedState;if(i!==null){t.pending=null;var a=i=i.next;do s=r(s,a.action),a=a.next;while(a!==i);vr(s,e.memoizedState)||(Ft=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,n]}function Zm(){}function Jm(r,e){var t=He,n=ar(),i=e(),s=!vr(n.memoizedState,i);if(s&&(n.memoizedState=i,Ft=!0),n=n.queue,df(r1.bind(null,t,n,r),[r]),n.getSnapshot!==e||s||nt!==null&&nt.memoizedState.tag&1){if(t.flags|=2048,Hs(9,t1.bind(null,t,n,i,e),void 0,null),it===null)throw Error(X(349));Yn&30||e1(t,e,i)}return i}function e1(r,e,t){r.flags|=16384,r={getSnapshot:e,value:t},e=He.updateQueue,e===null?(e={lastEffect:null,stores:null},He.updateQueue=e,e.stores=[r]):(t=e.stores,t===null?e.stores=[r]:t.push(r))}function t1(r,e,t,n){e.value=t,e.getSnapshot=n,n1(e)&&i1(r)}function r1(r,e,t){return t(function(){n1(e)&&i1(r)})}function n1(r){var e=r.getSnapshot;r=r.value;try{var t=e();return!vr(r,t)}catch{return!0}}function i1(r){var e=qr(r,1);e!==null&&xr(e,r,1,-1)}function rh(r){var e=Lr();return typeof r=="function"&&(r=r()),e.memoizedState=e.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Gs,lastRenderedState:r},e.queue=r,r=r.dispatch=e2.bind(null,He,r),[e.memoizedState,r]}function Hs(r,e,t,n){return r={tag:r,create:e,destroy:t,deps:n,next:null},e=He.updateQueue,e===null?(e={lastEffect:null,stores:null},He.updateQueue=e,e.lastEffect=r.next=r):(t=e.lastEffect,t===null?e.lastEffect=r.next=r:(n=t.next,t.next=r,r.next=n,e.lastEffect=r)),r}function s1(){return ar().memoizedState}function ro(r,e,t,n){var i=Lr();He.flags|=r,i.memoizedState=Hs(1|e,t,void 0,n===void 0?null:n)}function ol(r,e,t,n){var i=ar();n=n===void 0?null:n;var s=void 0;if(Je!==null){var a=Je.memoizedState;if(s=a.destroy,n!==null&&lf(n,a.deps)){i.memoizedState=Hs(e,t,s,n);return}}He.flags|=r,i.memoizedState=Hs(1|e,t,s,n)}function nh(r,e){return ro(8390656,8,r,e)}function df(r,e){return ol(2048,8,r,e)}function a1(r,e){return ol(4,2,r,e)}function o1(r,e){return ol(4,4,r,e)}function l1(r,e){if(typeof e=="function")return r=r(),e(r),function(){e(null)};if(e!=null)return r=r(),e.current=r,function(){e.current=null}}function u1(r,e,t){return t=t!=null?t.concat([r]):null,ol(4,4,l1.bind(null,e,r),t)}function ff(){}function c1(r,e){var t=ar();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&lf(e,n[1])?n[0]:(t.memoizedState=[r,e],r)}function d1(r,e){var t=ar();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&lf(e,n[1])?n[0]:(r=r(),t.memoizedState=[r,e],r)}function f1(r,e,t){return Yn&21?(vr(t,e)||(t=xm(),He.lanes|=t,qn|=t,r.baseState=!0),e):(r.baseState&&(r.baseState=!1,Ft=!0),r.memoizedState=t)}function ZE(r,e){var t=Le;Le=t!==0&&4>t?t:4,r(!0);var n=ql.transition;ql.transition={};try{r(!1),e()}finally{Le=t,ql.transition=n}}function h1(){return ar().memoizedState}function JE(r,e,t){var n=yn(r);if(t={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null},p1(r))g1(e,t);else if(t=qm(r,e,t,n),t!==null){var i=It();xr(t,r,n,i),m1(t,e,n)}}function e2(r,e,t){var n=yn(r),i={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null};if(p1(r))g1(e,i);else{var s=r.alternate;if(r.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var a=e.lastRenderedState,o=s(a,t);if(i.hasEagerState=!0,i.eagerState=o,vr(o,a)){var u=e.interleaved;u===null?(i.next=i,rf(e)):(i.next=u.next,u.next=i),e.interleaved=i;return}}catch{}finally{}t=qm(r,e,i,n),t!==null&&(i=It(),xr(t,r,n,i),m1(t,e,n))}}function p1(r){var e=r.alternate;return r===He||e!==null&&e===He}function g1(r,e){Es=Bo=!0;var t=r.pending;t===null?e.next=e:(e.next=t.next,t.next=e),r.pending=e}function m1(r,e,t){if(t&4194240){var n=e.lanes;n&=r.pendingLanes,t|=n,e.lanes=t,Hd(r,t)}}var Oo={readContext:sr,useCallback:mt,useContext:mt,useEffect:mt,useImperativeHandle:mt,useInsertionEffect:mt,useLayoutEffect:mt,useMemo:mt,useReducer:mt,useRef:mt,useState:mt,useDebugValue:mt,useDeferredValue:mt,useTransition:mt,useMutableSource:mt,useSyncExternalStore:mt,useId:mt,unstable_isNewReconciler:!1},t2={readContext:sr,useCallback:function(r,e){return Lr().memoizedState=[r,e===void 0?null:e],r},useContext:sr,useEffect:nh,useImperativeHandle:function(r,e,t){return t=t!=null?t.concat([r]):null,ro(4194308,4,l1.bind(null,e,r),t)},useLayoutEffect:function(r,e){return ro(4194308,4,r,e)},useInsertionEffect:function(r,e){return ro(4,2,r,e)},useMemo:function(r,e){var t=Lr();return e=e===void 0?null:e,r=r(),t.memoizedState=[r,e],r},useReducer:function(r,e,t){var n=Lr();return e=t!==void 0?t(e):e,n.memoizedState=n.baseState=e,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:e},n.queue=r,r=r.dispatch=JE.bind(null,He,r),[n.memoizedState,r]},useRef:function(r){var e=Lr();return r={current:r},e.memoizedState=r},useState:rh,useDebugValue:ff,useDeferredValue:function(r){return Lr().memoizedState=r},useTransition:function(){var r=rh(!1),e=r[0];return r=ZE.bind(null,r[1]),Lr().memoizedState=r,[e,r]},useMutableSource:function(){},useSyncExternalStore:function(r,e,t){var n=He,i=Lr();if(be){if(t===void 0)throw Error(X(407));t=t()}else{if(t=e(),it===null)throw Error(X(349));Yn&30||e1(n,e,t)}i.memoizedState=t;var s={value:t,getSnapshot:e};return i.queue=s,nh(r1.bind(null,n,s,r),[r]),n.flags|=2048,Hs(9,t1.bind(null,n,s,t,e),void 0,null),t},useId:function(){var r=Lr(),e=it.identifierPrefix;if(be){var t=jr,n=Vr;t=(n&~(1<<32-mr(n)-1)).toString(32)+t,e=":"+e+"R"+t,t=Us++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=QE++,e=":"+e+"r"+t.toString(32)+":";return r.memoizedState=e},unstable_isNewReconciler:!1},r2={readContext:sr,useCallback:c1,useContext:sr,useEffect:df,useImperativeHandle:u1,useInsertionEffect:a1,useLayoutEffect:o1,useMemo:d1,useReducer:Xl,useRef:s1,useState:function(){return Xl(Gs)},useDebugValue:ff,useDeferredValue:function(r){var e=ar();return f1(e,Je.memoizedState,r)},useTransition:function(){var r=Xl(Gs)[0],e=ar().memoizedState;return[r,e]},useMutableSource:Zm,useSyncExternalStore:Jm,useId:h1,unstable_isNewReconciler:!1},n2={readContext:sr,useCallback:c1,useContext:sr,useEffect:df,useImperativeHandle:u1,useInsertionEffect:a1,useLayoutEffect:o1,useMemo:d1,useReducer:Ql,useRef:s1,useState:function(){return Ql(Gs)},useDebugValue:ff,useDeferredValue:function(r){var e=ar();return Je===null?e.memoizedState=r:f1(e,Je.memoizedState,r)},useTransition:function(){var r=Ql(Gs)[0],e=ar().memoizedState;return[r,e]},useMutableSource:Zm,useSyncExternalStore:Jm,useId:h1,unstable_isNewReconciler:!1};function hr(r,e){if(r&&r.defaultProps){e=Ve({},e),r=r.defaultProps;for(var t in r)e[t]===void 0&&(e[t]=r[t]);return e}return e}function Vc(r,e,t,n){e=r.memoizedState,t=t(n,e),t=t==null?e:Ve({},e,t),r.memoizedState=t,r.lanes===0&&(r.updateQueue.baseState=t)}var ll={isMounted:function(r){return(r=r._reactInternals)?Jn(r)===r:!1},enqueueSetState:function(r,e,t){r=r._reactInternals;var n=It(),i=yn(r),s=Kr(n,i);s.payload=e,t!=null&&(s.callback=t),e=xn(r,s,i),e!==null&&(xr(e,r,i,n),eo(e,r,i))},enqueueReplaceState:function(r,e,t){r=r._reactInternals;var n=It(),i=yn(r),s=Kr(n,i);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=xn(r,s,i),e!==null&&(xr(e,r,i,n),eo(e,r,i))},enqueueForceUpdate:function(r,e){r=r._reactInternals;var t=It(),n=yn(r),i=Kr(t,n);i.tag=2,e!=null&&(i.callback=e),e=xn(r,i,n),e!==null&&(xr(e,r,n,t),eo(e,r,n))}};function ih(r,e,t,n,i,s,a){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(n,s,a):e.prototype&&e.prototype.isPureReactComponent?!Fs(t,n)||!Fs(i,s):!0}function x1(r,e,t){var n=!1,i=Tn,s=e.contextType;return typeof s=="object"&&s!==null?s=sr(s):(i=Mt(e)?zn:yt.current,n=e.contextTypes,s=(n=n!=null)?Bi(r,i):Tn),e=new e(t,s),r.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=ll,r.stateNode=e,e._reactInternals=r,n&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=i,r.__reactInternalMemoizedMaskedChildContext=s),e}function sh(r,e,t,n){r=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,n),e.state!==r&&ll.enqueueReplaceState(e,e.state,null)}function jc(r,e,t,n){var i=r.stateNode;i.props=t,i.state=r.memoizedState,i.refs={},nf(r);var s=e.contextType;typeof s=="object"&&s!==null?i.context=sr(s):(s=Mt(e)?zn:yt.current,i.context=Bi(r,s)),i.state=r.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Vc(r,e,s,t),i.state=r.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&ll.enqueueReplaceState(i,i.state,null),Po(r,t,i,n),i.state=r.memoizedState),typeof i.componentDidMount=="function"&&(r.flags|=4194308)}function $i(r,e){try{var t="",n=e;do t+=wy(n),n=n.return;while(n);var i=t}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:r,source:e,stack:i,digest:null}}function Zl(r,e,t){return{value:r,source:null,stack:t??null,digest:e??null}}function Kc(r,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var i2=typeof WeakMap=="function"?WeakMap:Map;function v1(r,e,t){t=Kr(-1,t),t.tag=3,t.payload={element:null};var n=e.value;return t.callback=function(){No||(No=!0,td=n),Kc(r,e)},t}function y1(r,e,t){t=Kr(-1,t),t.tag=3;var n=r.type.getDerivedStateFromError;if(typeof n=="function"){var i=e.value;t.payload=function(){return n(i)},t.callback=function(){Kc(r,e)}}var s=r.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){Kc(r,e),typeof n!="function"&&(vn===null?vn=new Set([this]):vn.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function ah(r,e,t){var n=r.pingCache;if(n===null){n=r.pingCache=new i2;var i=new Set;n.set(e,i)}else i=n.get(e),i===void 0&&(i=new Set,n.set(e,i));i.has(t)||(i.add(t),r=v2.bind(null,r,e,t),e.then(r,r))}function oh(r){do{var e;if((e=r.tag===13)&&(e=r.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return r;r=r.return}while(r!==null);return null}function lh(r,e,t,n,i){return r.mode&1?(r.flags|=65536,r.lanes=i,r):(r===e?r.flags|=65536:(r.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Kr(-1,1),e.tag=2,xn(t,e,1))),t.lanes|=1),r)}var s2=Zr.ReactCurrentOwner,Ft=!1;function At(r,e,t,n){e.child=r===null?Ym(e,null,t,n):Mi(e,r.child,t,n)}function uh(r,e,t,n,i){t=t.render;var s=e.ref;return _i(e,i),n=uf(r,e,t,n,s,i),t=cf(),r!==null&&!Ft?(e.updateQueue=r.updateQueue,e.flags&=-2053,r.lanes&=~i,Xr(r,e,i)):(be&&t&&Xd(e),e.flags|=1,At(r,e,n,i),e.child)}function ch(r,e,t,n,i){if(r===null){var s=t.type;return typeof s=="function"&&!Ef(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,E1(r,e,s,n,i)):(r=ao(t.type,null,n,e,e.mode,i),r.ref=e.ref,r.return=e,e.child=r)}if(s=r.child,!(r.lanes&i)){var a=s.memoizedProps;if(t=t.compare,t=t!==null?t:Fs,t(a,n)&&r.ref===e.ref)return Xr(r,e,i)}return e.flags|=1,r=En(s,n),r.ref=e.ref,r.return=e,e.child=r}function E1(r,e,t,n,i){if(r!==null){var s=r.memoizedProps;if(Fs(s,n)&&r.ref===e.ref)if(Ft=!1,e.pendingProps=n=s,(r.lanes&i)!==0)r.flags&131072&&(Ft=!0);else return e.lanes=r.lanes,Xr(r,e,i)}return zc(r,e,t,n,i)}function S1(r,e,t){var n=e.pendingProps,i=n.children,s=r!==null?r.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},De(Ti,zt),zt|=t;else{if(!(t&1073741824))return r=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:r,cachePool:null,transitions:null},e.updateQueue=null,De(Ti,zt),zt|=r,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=s!==null?s.baseLanes:t,De(Ti,zt),zt|=n}else s!==null?(n=s.baseLanes|t,e.memoizedState=null):n=t,De(Ti,zt),zt|=n;return At(r,e,i,t),e.child}function T1(r,e){var t=e.ref;(r===null&&t!==null||r!==null&&r.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function zc(r,e,t,n,i){var s=Mt(t)?zn:yt.current;return s=Bi(e,s),_i(e,i),t=uf(r,e,t,n,s,i),n=cf(),r!==null&&!Ft?(e.updateQueue=r.updateQueue,e.flags&=-2053,r.lanes&=~i,Xr(r,e,i)):(be&&n&&Xd(e),e.flags|=1,At(r,e,t,i),e.child)}function dh(r,e,t,n,i){if(Mt(t)){var s=!0;_o(e)}else s=!1;if(_i(e,i),e.stateNode===null)no(r,e),x1(e,t,n),jc(e,t,n,i),n=!0;else if(r===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var u=a.context,l=t.contextType;typeof l=="object"&&l!==null?l=sr(l):(l=Mt(t)?zn:yt.current,l=Bi(e,l));var c=t.getDerivedStateFromProps,d=typeof c=="function"||typeof a.getSnapshotBeforeUpdate=="function";d||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==n||u!==l)&&sh(e,a,n,l),an=!1;var f=e.memoizedState;a.state=f,Po(e,n,a,i),u=e.memoizedState,o!==n||f!==u||Ot.current||an?(typeof c=="function"&&(Vc(e,t,c,n),u=e.memoizedState),(o=an||ih(e,t,o,n,f,u,l))?(d||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=u),a.props=n,a.state=u,a.context=l,n=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{a=e.stateNode,Xm(r,e),o=e.memoizedProps,l=e.type===e.elementType?o:hr(e.type,o),a.props=l,d=e.pendingProps,f=a.context,u=t.contextType,typeof u=="object"&&u!==null?u=sr(u):(u=Mt(t)?zn:yt.current,u=Bi(e,u));var h=t.getDerivedStateFromProps;(c=typeof h=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==d||f!==u)&&sh(e,a,n,u),an=!1,f=e.memoizedState,a.state=f,Po(e,n,a,i);var p=e.memoizedState;o!==d||f!==p||Ot.current||an?(typeof h=="function"&&(Vc(e,t,h,n),p=e.memoizedState),(l=an||ih(e,t,l,n,f,p,u)||!1)?(c||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(n,p,u),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(n,p,u)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===r.memoizedProps&&f===r.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===r.memoizedProps&&f===r.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=p),a.props=n,a.state=p,a.context=u,n=l):(typeof a.componentDidUpdate!="function"||o===r.memoizedProps&&f===r.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===r.memoizedProps&&f===r.memoizedState||(e.flags|=1024),n=!1)}return Wc(r,e,t,n,s,i)}function Wc(r,e,t,n,i,s){T1(r,e);var a=(e.flags&128)!==0;if(!n&&!a)return i&&X0(e,t,!1),Xr(r,e,s);n=e.stateNode,s2.current=e;var o=a&&typeof t.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,r!==null&&a?(e.child=Mi(e,r.child,null,s),e.child=Mi(e,null,o,s)):At(r,e,o,s),e.memoizedState=n.state,i&&X0(e,t,!0),e.child}function A1(r){var e=r.stateNode;e.pendingContext?q0(r,e.pendingContext,e.pendingContext!==e.context):e.context&&q0(r,e.context,!1),sf(r,e.containerInfo)}function fh(r,e,t,n,i){return Oi(),Zd(i),e.flags|=256,At(r,e,t,n),e.child}var Yc={dehydrated:null,treeContext:null,retryLane:0};function qc(r){return{baseLanes:r,cachePool:null,transitions:null}}function C1(r,e,t){var n=e.pendingProps,i=Ue.current,s=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=r!==null&&r.memoizedState===null?!1:(i&2)!==0),o?(s=!0,e.flags&=-129):(r===null||r.memoizedState!==null)&&(i|=1),De(Ue,i&1),r===null)return Gc(e),r=e.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(e.mode&1?r.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=n.children,r=n.fallback,s?(n=e.mode,s=e.child,a={mode:"hidden",children:a},!(n&1)&&s!==null?(s.childLanes=0,s.pendingProps=a):s=dl(a,n,0,null),r=Vn(r,n,t,null),s.return=e,r.return=e,s.sibling=r,e.child=s,e.child.memoizedState=qc(t),e.memoizedState=Yc,r):hf(e,a));if(i=r.memoizedState,i!==null&&(o=i.dehydrated,o!==null))return a2(r,e,a,n,o,i,t);if(s){s=n.fallback,a=e.mode,i=r.child,o=i.sibling;var u={mode:"hidden",children:n.children};return!(a&1)&&e.child!==i?(n=e.child,n.childLanes=0,n.pendingProps=u,e.deletions=null):(n=En(i,u),n.subtreeFlags=i.subtreeFlags&14680064),o!==null?s=En(o,s):(s=Vn(s,a,t,null),s.flags|=2),s.return=e,n.return=e,n.sibling=s,e.child=n,n=s,s=e.child,a=r.child.memoizedState,a=a===null?qc(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},s.memoizedState=a,s.childLanes=r.childLanes&~t,e.memoizedState=Yc,n}return s=r.child,r=s.sibling,n=En(s,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=t),n.return=e,n.sibling=null,r!==null&&(t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)),e.child=n,e.memoizedState=null,n}function hf(r,e){return e=dl({mode:"visible",children:e},r.mode,0,null),e.return=r,r.child=e}function _a(r,e,t,n){return n!==null&&Zd(n),Mi(e,r.child,null,t),r=hf(e,e.pendingProps.children),r.flags|=2,e.memoizedState=null,r}function a2(r,e,t,n,i,s,a){if(t)return e.flags&256?(e.flags&=-257,n=Zl(Error(X(422))),_a(r,e,a,n)):e.memoizedState!==null?(e.child=r.child,e.flags|=128,null):(s=n.fallback,i=e.mode,n=dl({mode:"visible",children:n.children},i,0,null),s=Vn(s,i,a,null),s.flags|=2,n.return=e,s.return=e,n.sibling=s,e.child=n,e.mode&1&&Mi(e,r.child,null,a),e.child.memoizedState=qc(a),e.memoizedState=Yc,s);if(!(e.mode&1))return _a(r,e,a,null);if(i.data==="$!"){if(n=i.nextSibling&&i.nextSibling.dataset,n)var o=n.dgst;return n=o,s=Error(X(419)),n=Zl(s,n,void 0),_a(r,e,a,n)}if(o=(a&r.childLanes)!==0,Ft||o){if(n=it,n!==null){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(n.suspendedLanes|a)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,qr(r,i),xr(n,r,i,-1))}return yf(),n=Zl(Error(X(421))),_a(r,e,a,n)}return i.data==="$?"?(e.flags|=128,e.child=r.child,e=y2.bind(null,r),i._reactRetry=e,null):(r=s.treeContext,Yt=mn(i.nextSibling),qt=e,be=!0,gr=null,r!==null&&(tr[rr++]=Vr,tr[rr++]=jr,tr[rr++]=Wn,Vr=r.id,jr=r.overflow,Wn=e),e=hf(e,n.children),e.flags|=4096,e)}function hh(r,e,t){r.lanes|=e;var n=r.alternate;n!==null&&(n.lanes|=e),Hc(r.return,e,t)}function Jl(r,e,t,n,i){var s=r.memoizedState;s===null?r.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:t,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=n,s.tail=t,s.tailMode=i)}function L1(r,e,t){var n=e.pendingProps,i=n.revealOrder,s=n.tail;if(At(r,e,n.children,t),n=Ue.current,n&2)n=n&1|2,e.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=e.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&hh(r,t,e);else if(r.tag===19)hh(r,t,e);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break e;for(;r.sibling===null;){if(r.return===null||r.return===e)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}n&=1}if(De(Ue,n),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)r=t.alternate,r!==null&&Fo(r)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),Jl(e,!1,i,t,s);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(r=i.alternate,r!==null&&Fo(r)===null){e.child=i;break}r=i.sibling,i.sibling=t,t=i,i=r}Jl(e,!0,t,null,s);break;case"together":Jl(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function no(r,e){!(e.mode&1)&&r!==null&&(r.alternate=null,e.alternate=null,e.flags|=2)}function Xr(r,e,t){if(r!==null&&(e.dependencies=r.dependencies),qn|=e.lanes,!(t&e.childLanes))return null;if(r!==null&&e.child!==r.child)throw Error(X(153));if(e.child!==null){for(r=e.child,t=En(r,r.pendingProps),e.child=t,t.return=e;r.sibling!==null;)r=r.sibling,t=t.sibling=En(r,r.pendingProps),t.return=e;t.sibling=null}return e.child}function o2(r,e,t){switch(e.tag){case 3:A1(e),Oi();break;case 5:Qm(e);break;case 1:Mt(e.type)&&_o(e);break;case 4:sf(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,i=e.memoizedProps.value;De(wo,n._currentValue),n._currentValue=i;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(De(Ue,Ue.current&1),e.flags|=128,null):t&e.child.childLanes?C1(r,e,t):(De(Ue,Ue.current&1),r=Xr(r,e,t),r!==null?r.sibling:null);De(Ue,Ue.current&1);break;case 19:if(n=(t&e.childLanes)!==0,r.flags&128){if(n)return L1(r,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),De(Ue,Ue.current),n)break;return null;case 22:case 23:return e.lanes=0,S1(r,e,t)}return Xr(r,e,t)}var R1,Xc,I1,_1;R1=function(r,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)r.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Xc=function(){};I1=function(r,e,t,n){var i=r.memoizedProps;if(i!==n){r=e.stateNode,Gn(br.current);var s=null;switch(t){case"input":i=vc(r,i),n=vc(r,n),s=[];break;case"select":i=Ve({},i,{value:void 0}),n=Ve({},n,{value:void 0}),s=[];break;case"textarea":i=Sc(r,i),n=Sc(r,n),s=[];break;default:typeof i.onClick!="function"&&typeof n.onClick=="function"&&(r.onclick=Ro)}Ac(t,n);var a;t=null;for(l in i)if(!n.hasOwnProperty(l)&&i.hasOwnProperty(l)&&i[l]!=null)if(l==="style"){var o=i[l];for(a in o)o.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Is.hasOwnProperty(l)?s||(s=[]):(s=s||[]).push(l,null));for(l in n){var u=n[l];if(o=i!=null?i[l]:void 0,n.hasOwnProperty(l)&&u!==o&&(u!=null||o!=null))if(l==="style")if(o){for(a in o)!o.hasOwnProperty(a)||u&&u.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in u)u.hasOwnProperty(a)&&o[a]!==u[a]&&(t||(t={}),t[a]=u[a])}else t||(s||(s=[]),s.push(l,t)),t=u;else l==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,o=o?o.__html:void 0,u!=null&&o!==u&&(s=s||[]).push(l,u)):l==="children"?typeof u!="string"&&typeof u!="number"||(s=s||[]).push(l,""+u):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(Is.hasOwnProperty(l)?(u!=null&&l==="onScroll"&&ke("scroll",r),s||o===u||(s=[])):(s=s||[]).push(l,u))}t&&(s=s||[]).push("style",t);var l=s;(e.updateQueue=l)&&(e.flags|=4)}};_1=function(r,e,t,n){t!==n&&(e.flags|=4)};function as(r,e){if(!be)switch(r.tailMode){case"hidden":e=r.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?r.tail=null:t.sibling=null;break;case"collapsed":t=r.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e||r.tail===null?r.tail=null:r.tail.sibling=null:n.sibling=null}}function xt(r){var e=r.alternate!==null&&r.alternate.child===r.child,t=0,n=0;if(e)for(var i=r.child;i!==null;)t|=i.lanes|i.childLanes,n|=i.subtreeFlags&14680064,n|=i.flags&14680064,i.return=r,i=i.sibling;else for(i=r.child;i!==null;)t|=i.lanes|i.childLanes,n|=i.subtreeFlags,n|=i.flags,i.return=r,i=i.sibling;return r.subtreeFlags|=n,r.childLanes=t,e}function l2(r,e,t){var n=e.pendingProps;switch(Qd(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return xt(e),null;case 1:return Mt(e.type)&&Io(),xt(e),null;case 3:return n=e.stateNode,Ni(),we(Ot),we(yt),of(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(r===null||r.child===null)&&(Ra(e)?e.flags|=4:r===null||r.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,gr!==null&&(id(gr),gr=null))),Xc(r,e),xt(e),null;case 5:af(e);var i=Gn($s.current);if(t=e.type,r!==null&&e.stateNode!=null)I1(r,e,t,n,i),r.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(X(166));return xt(e),null}if(r=Gn(br.current),Ra(e)){n=e.stateNode,t=e.type;var s=e.memoizedProps;switch(n[_r]=e,n[Ms]=s,r=(e.mode&1)!==0,t){case"dialog":ke("cancel",n),ke("close",n);break;case"iframe":case"object":case"embed":ke("load",n);break;case"video":case"audio":for(i=0;i<hs.length;i++)ke(hs[i],n);break;case"source":ke("error",n);break;case"img":case"image":case"link":ke("error",n),ke("load",n);break;case"details":ke("toggle",n);break;case"input":T0(n,s),ke("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!s.multiple},ke("invalid",n);break;case"textarea":C0(n,s),ke("invalid",n)}Ac(t,s),i=null;for(var a in s)if(s.hasOwnProperty(a)){var o=s[a];a==="children"?typeof o=="string"?n.textContent!==o&&(s.suppressHydrationWarning!==!0&&La(n.textContent,o,r),i=["children",o]):typeof o=="number"&&n.textContent!==""+o&&(s.suppressHydrationWarning!==!0&&La(n.textContent,o,r),i=["children",""+o]):Is.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&ke("scroll",n)}switch(t){case"input":xa(n),A0(n,s,!0);break;case"textarea":xa(n),L0(n);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(n.onclick=Ro)}n=i,e.updateQueue=n,n!==null&&(e.flags|=4)}else{a=i.nodeType===9?i:i.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=rm(t)),r==="http://www.w3.org/1999/xhtml"?t==="script"?(r=a.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof n.is=="string"?r=a.createElement(t,{is:n.is}):(r=a.createElement(t),t==="select"&&(a=r,n.multiple?a.multiple=!0:n.size&&(a.size=n.size))):r=a.createElementNS(r,t),r[_r]=e,r[Ms]=n,R1(r,e,!1,!1),e.stateNode=r;e:{switch(a=Cc(t,n),t){case"dialog":ke("cancel",r),ke("close",r),i=n;break;case"iframe":case"object":case"embed":ke("load",r),i=n;break;case"video":case"audio":for(i=0;i<hs.length;i++)ke(hs[i],r);i=n;break;case"source":ke("error",r),i=n;break;case"img":case"image":case"link":ke("error",r),ke("load",r),i=n;break;case"details":ke("toggle",r),i=n;break;case"input":T0(r,n),i=vc(r,n),ke("invalid",r);break;case"option":i=n;break;case"select":r._wrapperState={wasMultiple:!!n.multiple},i=Ve({},n,{value:void 0}),ke("invalid",r);break;case"textarea":C0(r,n),i=Sc(r,n),ke("invalid",r);break;default:i=n}Ac(t,i),o=i;for(s in o)if(o.hasOwnProperty(s)){var u=o[s];s==="style"?sm(r,u):s==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&nm(r,u)):s==="children"?typeof u=="string"?(t!=="textarea"||u!=="")&&_s(r,u):typeof u=="number"&&_s(r,""+u):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Is.hasOwnProperty(s)?u!=null&&s==="onScroll"&&ke("scroll",r):u!=null&&Od(r,s,u,a))}switch(t){case"input":xa(r),A0(r,n,!1);break;case"textarea":xa(r),L0(r);break;case"option":n.value!=null&&r.setAttribute("value",""+Sn(n.value));break;case"select":r.multiple=!!n.multiple,s=n.value,s!=null?Ci(r,!!n.multiple,s,!1):n.defaultValue!=null&&Ci(r,!!n.multiple,n.defaultValue,!0);break;default:typeof i.onClick=="function"&&(r.onclick=Ro)}switch(t){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return xt(e),null;case 6:if(r&&e.stateNode!=null)_1(r,e,r.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(X(166));if(t=Gn($s.current),Gn(br.current),Ra(e)){if(n=e.stateNode,t=e.memoizedProps,n[_r]=e,(s=n.nodeValue!==t)&&(r=qt,r!==null))switch(r.tag){case 3:La(n.nodeValue,t,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&La(n.nodeValue,t,(r.mode&1)!==0)}s&&(e.flags|=4)}else n=(t.nodeType===9?t:t.ownerDocument).createTextNode(n),n[_r]=e,e.stateNode=n}return xt(e),null;case 13:if(we(Ue),n=e.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(be&&Yt!==null&&e.mode&1&&!(e.flags&128))zm(),Oi(),e.flags|=98560,s=!1;else if(s=Ra(e),n!==null&&n.dehydrated!==null){if(r===null){if(!s)throw Error(X(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(X(317));s[_r]=e}else Oi(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;xt(e),s=!1}else gr!==null&&(id(gr),gr=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(n=n!==null,n!==(r!==null&&r.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(r===null||Ue.current&1?tt===0&&(tt=3):yf())),e.updateQueue!==null&&(e.flags|=4),xt(e),null);case 4:return Ni(),Xc(r,e),r===null&&Bs(e.stateNode.containerInfo),xt(e),null;case 10:return tf(e.type._context),xt(e),null;case 17:return Mt(e.type)&&Io(),xt(e),null;case 19:if(we(Ue),s=e.memoizedState,s===null)return xt(e),null;if(n=(e.flags&128)!==0,a=s.rendering,a===null)if(n)as(s,!1);else{if(tt!==0||r!==null&&r.flags&128)for(r=e.child;r!==null;){if(a=Fo(r),a!==null){for(e.flags|=128,as(s,!1),n=a.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=t,t=e.child;t!==null;)s=t,r=n,s.flags&=14680066,a=s.alternate,a===null?(s.childLanes=0,s.lanes=r,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=a.childLanes,s.lanes=a.lanes,s.child=a.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=a.memoizedProps,s.memoizedState=a.memoizedState,s.updateQueue=a.updateQueue,s.type=a.type,r=a.dependencies,s.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),t=t.sibling;return De(Ue,Ue.current&1|2),e.child}r=r.sibling}s.tail!==null&&We()>Ui&&(e.flags|=128,n=!0,as(s,!1),e.lanes=4194304)}else{if(!n)if(r=Fo(a),r!==null){if(e.flags|=128,n=!0,t=r.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),as(s,!0),s.tail===null&&s.tailMode==="hidden"&&!a.alternate&&!be)return xt(e),null}else 2*We()-s.renderingStartTime>Ui&&t!==1073741824&&(e.flags|=128,n=!0,as(s,!1),e.lanes=4194304);s.isBackwards?(a.sibling=e.child,e.child=a):(t=s.last,t!==null?t.sibling=a:e.child=a,s.last=a)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=We(),e.sibling=null,t=Ue.current,De(Ue,n?t&1|2:t&1),e):(xt(e),null);case 22:case 23:return vf(),n=e.memoizedState!==null,r!==null&&r.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?zt&1073741824&&(xt(e),e.subtreeFlags&6&&(e.flags|=8192)):xt(e),null;case 24:return null;case 25:return null}throw Error(X(156,e.tag))}function u2(r,e){switch(Qd(e),e.tag){case 1:return Mt(e.type)&&Io(),r=e.flags,r&65536?(e.flags=r&-65537|128,e):null;case 3:return Ni(),we(Ot),we(yt),of(),r=e.flags,r&65536&&!(r&128)?(e.flags=r&-65537|128,e):null;case 5:return af(e),null;case 13:if(we(Ue),r=e.memoizedState,r!==null&&r.dehydrated!==null){if(e.alternate===null)throw Error(X(340));Oi()}return r=e.flags,r&65536?(e.flags=r&-65537|128,e):null;case 19:return we(Ue),null;case 4:return Ni(),null;case 10:return tf(e.type._context),null;case 22:case 23:return vf(),null;case 24:return null;default:return null}}var Da=!1,vt=!1,c2=typeof WeakSet=="function"?WeakSet:Set,te=null;function Si(r,e){var t=r.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(n){Ke(r,e,n)}else t.current=null}function Qc(r,e,t){try{t()}catch(n){Ke(r,e,n)}}var ph=!1;function d2(r,e){if(Fc=Ao,r=Pm(),qd(r)){if("selectionStart"in r)var t={start:r.selectionStart,end:r.selectionEnd};else e:{t=(t=r.ownerDocument)&&t.defaultView||window;var n=t.getSelection&&t.getSelection();if(n&&n.rangeCount!==0){t=n.anchorNode;var i=n.anchorOffset,s=n.focusNode;n=n.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var a=0,o=-1,u=-1,l=0,c=0,d=r,f=null;t:for(;;){for(var h;d!==t||i!==0&&d.nodeType!==3||(o=a+i),d!==s||n!==0&&d.nodeType!==3||(u=a+n),d.nodeType===3&&(a+=d.nodeValue.length),(h=d.firstChild)!==null;)f=d,d=h;for(;;){if(d===r)break t;if(f===t&&++l===i&&(o=a),f===s&&++c===n&&(u=a),(h=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=h}t=o===-1||u===-1?null:{start:o,end:u}}else t=null}t=t||{start:0,end:0}}else t=null;for(Bc={focusedElem:r,selectionRange:t},Ao=!1,te=e;te!==null;)if(e=te,r=e.child,(e.subtreeFlags&1028)!==0&&r!==null)r.return=e,te=r;else for(;te!==null;){e=te;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var x=p.memoizedProps,v=p.memoizedState,y=e.stateNode,g=y.getSnapshotBeforeUpdate(e.elementType===e.type?x:hr(e.type,x),v);y.__reactInternalSnapshotBeforeUpdate=g}break;case 3:var m=e.stateNode.containerInfo;m.nodeType===1?m.textContent="":m.nodeType===9&&m.documentElement&&m.removeChild(m.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(X(163))}}catch(E){Ke(e,e.return,E)}if(r=e.sibling,r!==null){r.return=e.return,te=r;break}te=e.return}return p=ph,ph=!1,p}function Ss(r,e,t){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var i=n=n.next;do{if((i.tag&r)===r){var s=i.destroy;i.destroy=void 0,s!==void 0&&Qc(e,t,s)}i=i.next}while(i!==n)}}function ul(r,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&r)===r){var n=t.create;t.destroy=n()}t=t.next}while(t!==e)}}function Zc(r){var e=r.ref;if(e!==null){var t=r.stateNode;switch(r.tag){case 5:r=t;break;default:r=t}typeof e=="function"?e(r):e.current=r}}function D1(r){var e=r.alternate;e!==null&&(r.alternate=null,D1(e)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(e=r.stateNode,e!==null&&(delete e[_r],delete e[Ms],delete e[Nc],delete e[WE],delete e[YE])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function k1(r){return r.tag===5||r.tag===3||r.tag===4}function gh(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||k1(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Jc(r,e,t){var n=r.tag;if(n===5||n===6)r=r.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(r,e):t.insertBefore(r,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(r,t)):(e=t,e.appendChild(r)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Ro));else if(n!==4&&(r=r.child,r!==null))for(Jc(r,e,t),r=r.sibling;r!==null;)Jc(r,e,t),r=r.sibling}function ed(r,e,t){var n=r.tag;if(n===5||n===6)r=r.stateNode,e?t.insertBefore(r,e):t.appendChild(r);else if(n!==4&&(r=r.child,r!==null))for(ed(r,e,t),r=r.sibling;r!==null;)ed(r,e,t),r=r.sibling}var lt=null,pr=!1;function tn(r,e,t){for(t=t.child;t!==null;)w1(r,e,t),t=t.sibling}function w1(r,e,t){if(wr&&typeof wr.onCommitFiberUnmount=="function")try{wr.onCommitFiberUnmount(tl,t)}catch{}switch(t.tag){case 5:vt||Si(t,e);case 6:var n=lt,i=pr;lt=null,tn(r,e,t),lt=n,pr=i,lt!==null&&(pr?(r=lt,t=t.stateNode,r.nodeType===8?r.parentNode.removeChild(t):r.removeChild(t)):lt.removeChild(t.stateNode));break;case 18:lt!==null&&(pr?(r=lt,t=t.stateNode,r.nodeType===8?zl(r.parentNode,t):r.nodeType===1&&zl(r,t),bs(r)):zl(lt,t.stateNode));break;case 4:n=lt,i=pr,lt=t.stateNode.containerInfo,pr=!0,tn(r,e,t),lt=n,pr=i;break;case 0:case 11:case 14:case 15:if(!vt&&(n=t.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){i=n=n.next;do{var s=i,a=s.destroy;s=s.tag,a!==void 0&&(s&2||s&4)&&Qc(t,e,a),i=i.next}while(i!==n)}tn(r,e,t);break;case 1:if(!vt&&(Si(t,e),n=t.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=t.memoizedProps,n.state=t.memoizedState,n.componentWillUnmount()}catch(o){Ke(t,e,o)}tn(r,e,t);break;case 21:tn(r,e,t);break;case 22:t.mode&1?(vt=(n=vt)||t.memoizedState!==null,tn(r,e,t),vt=n):tn(r,e,t);break;default:tn(r,e,t)}}function mh(r){var e=r.updateQueue;if(e!==null){r.updateQueue=null;var t=r.stateNode;t===null&&(t=r.stateNode=new c2),e.forEach(function(n){var i=E2.bind(null,r,n);t.has(n)||(t.add(n),n.then(i,i))})}}function cr(r,e){var t=e.deletions;if(t!==null)for(var n=0;n<t.length;n++){var i=t[n];try{var s=r,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:lt=o.stateNode,pr=!1;break e;case 3:lt=o.stateNode.containerInfo,pr=!0;break e;case 4:lt=o.stateNode.containerInfo,pr=!0;break e}o=o.return}if(lt===null)throw Error(X(160));w1(s,a,i),lt=null,pr=!1;var u=i.alternate;u!==null&&(u.return=null),i.return=null}catch(l){Ke(i,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)b1(e,r),e=e.sibling}function b1(r,e){var t=r.alternate,n=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(cr(e,r),Tr(r),n&4){try{Ss(3,r,r.return),ul(3,r)}catch(x){Ke(r,r.return,x)}try{Ss(5,r,r.return)}catch(x){Ke(r,r.return,x)}}break;case 1:cr(e,r),Tr(r),n&512&&t!==null&&Si(t,t.return);break;case 5:if(cr(e,r),Tr(r),n&512&&t!==null&&Si(t,t.return),r.flags&32){var i=r.stateNode;try{_s(i,"")}catch(x){Ke(r,r.return,x)}}if(n&4&&(i=r.stateNode,i!=null)){var s=r.memoizedProps,a=t!==null?t.memoizedProps:s,o=r.type,u=r.updateQueue;if(r.updateQueue=null,u!==null)try{o==="input"&&s.type==="radio"&&s.name!=null&&em(i,s),Cc(o,a);var l=Cc(o,s);for(a=0;a<u.length;a+=2){var c=u[a],d=u[a+1];c==="style"?sm(i,d):c==="dangerouslySetInnerHTML"?nm(i,d):c==="children"?_s(i,d):Od(i,c,d,l)}switch(o){case"input":yc(i,s);break;case"textarea":tm(i,s);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var h=s.value;h!=null?Ci(i,!!s.multiple,h,!1):f!==!!s.multiple&&(s.defaultValue!=null?Ci(i,!!s.multiple,s.defaultValue,!0):Ci(i,!!s.multiple,s.multiple?[]:"",!1))}i[Ms]=s}catch(x){Ke(r,r.return,x)}}break;case 6:if(cr(e,r),Tr(r),n&4){if(r.stateNode===null)throw Error(X(162));i=r.stateNode,s=r.memoizedProps;try{i.nodeValue=s}catch(x){Ke(r,r.return,x)}}break;case 3:if(cr(e,r),Tr(r),n&4&&t!==null&&t.memoizedState.isDehydrated)try{bs(e.containerInfo)}catch(x){Ke(r,r.return,x)}break;case 4:cr(e,r),Tr(r);break;case 13:cr(e,r),Tr(r),i=r.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(mf=We())),n&4&&mh(r);break;case 22:if(c=t!==null&&t.memoizedState!==null,r.mode&1?(vt=(l=vt)||c,cr(e,r),vt=l):cr(e,r),Tr(r),n&8192){if(l=r.memoizedState!==null,(r.stateNode.isHidden=l)&&!c&&r.mode&1)for(te=r,c=r.child;c!==null;){for(d=te=c;te!==null;){switch(f=te,h=f.child,f.tag){case 0:case 11:case 14:case 15:Ss(4,f,f.return);break;case 1:Si(f,f.return);var p=f.stateNode;if(typeof p.componentWillUnmount=="function"){n=f,t=f.return;try{e=n,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(x){Ke(n,t,x)}}break;case 5:Si(f,f.return);break;case 22:if(f.memoizedState!==null){vh(d);continue}}h!==null?(h.return=f,te=h):vh(d)}c=c.sibling}e:for(c=null,d=r;;){if(d.tag===5){if(c===null){c=d;try{i=d.stateNode,l?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(o=d.stateNode,u=d.memoizedProps.style,a=u!=null&&u.hasOwnProperty("display")?u.display:null,o.style.display=im("display",a))}catch(x){Ke(r,r.return,x)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(x){Ke(r,r.return,x)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===r)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===r)break e;for(;d.sibling===null;){if(d.return===null||d.return===r)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:cr(e,r),Tr(r),n&4&&mh(r);break;case 21:break;default:cr(e,r),Tr(r)}}function Tr(r){var e=r.flags;if(e&2){try{e:{for(var t=r.return;t!==null;){if(k1(t)){var n=t;break e}t=t.return}throw Error(X(160))}switch(n.tag){case 5:var i=n.stateNode;n.flags&32&&(_s(i,""),n.flags&=-33);var s=gh(r);ed(r,s,i);break;case 3:case 4:var a=n.stateNode.containerInfo,o=gh(r);Jc(r,o,a);break;default:throw Error(X(161))}}catch(u){Ke(r,r.return,u)}r.flags&=-3}e&4096&&(r.flags&=-4097)}function f2(r,e,t){te=r,P1(r)}function P1(r,e,t){for(var n=(r.mode&1)!==0;te!==null;){var i=te,s=i.child;if(i.tag===22&&n){var a=i.memoizedState!==null||Da;if(!a){var o=i.alternate,u=o!==null&&o.memoizedState!==null||vt;o=Da;var l=vt;if(Da=a,(vt=u)&&!l)for(te=i;te!==null;)a=te,u=a.child,a.tag===22&&a.memoizedState!==null?yh(i):u!==null?(u.return=a,te=u):yh(i);for(;s!==null;)te=s,P1(s),s=s.sibling;te=i,Da=o,vt=l}xh(r)}else i.subtreeFlags&8772&&s!==null?(s.return=i,te=s):xh(r)}}function xh(r){for(;te!==null;){var e=te;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:vt||ul(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!vt)if(t===null)n.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:hr(e.type,t.memoizedProps);n.componentDidUpdate(i,t.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&th(e,s,n);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}th(e,a,t)}break;case 5:var o=e.stateNode;if(t===null&&e.flags&4){t=o;var u=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&t.focus();break;case"img":u.src&&(t.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var c=l.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&bs(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(X(163))}vt||e.flags&512&&Zc(e)}catch(f){Ke(e,e.return,f)}}if(e===r){te=null;break}if(t=e.sibling,t!==null){t.return=e.return,te=t;break}te=e.return}}function vh(r){for(;te!==null;){var e=te;if(e===r){te=null;break}var t=e.sibling;if(t!==null){t.return=e.return,te=t;break}te=e.return}}function yh(r){for(;te!==null;){var e=te;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{ul(4,e)}catch(u){Ke(e,t,u)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var i=e.return;try{n.componentDidMount()}catch(u){Ke(e,i,u)}}var s=e.return;try{Zc(e)}catch(u){Ke(e,s,u)}break;case 5:var a=e.return;try{Zc(e)}catch(u){Ke(e,a,u)}}}catch(u){Ke(e,e.return,u)}if(e===r){te=null;break}var o=e.sibling;if(o!==null){o.return=e.return,te=o;break}te=e.return}}var h2=Math.ceil,Mo=Zr.ReactCurrentDispatcher,pf=Zr.ReactCurrentOwner,ir=Zr.ReactCurrentBatchConfig,ye=0,it=null,Qe=null,dt=0,zt=0,Ti=Rn(0),tt=0,Vs=null,qn=0,cl=0,gf=0,Ts=null,Pt=null,mf=0,Ui=1/0,$r=null,No=!1,td=null,vn=null,ka=!1,fn=null,$o=0,As=0,rd=null,io=-1,so=0;function It(){return ye&6?We():io!==-1?io:io=We()}function yn(r){return r.mode&1?ye&2&&dt!==0?dt&-dt:XE.transition!==null?(so===0&&(so=xm()),so):(r=Le,r!==0||(r=window.event,r=r===void 0?16:Cm(r.type)),r):1}function xr(r,e,t,n){if(50<As)throw As=0,rd=null,Error(X(185));Js(r,t,n),(!(ye&2)||r!==it)&&(r===it&&(!(ye&2)&&(cl|=t),tt===4&&cn(r,dt)),Nt(r,n),t===1&&ye===0&&!(e.mode&1)&&(Ui=We()+500,al&&In()))}function Nt(r,e){var t=r.callbackNode;Xy(r,e);var n=To(r,r===it?dt:0);if(n===0)t!==null&&_0(t),r.callbackNode=null,r.callbackPriority=0;else if(e=n&-n,r.callbackPriority!==e){if(t!=null&&_0(t),e===1)r.tag===0?qE(Eh.bind(null,r)):Vm(Eh.bind(null,r)),KE(function(){!(ye&6)&&In()}),t=null;else{switch(vm(n)){case 1:t=Gd;break;case 4:t=gm;break;case 16:t=So;break;case 536870912:t=mm;break;default:t=So}t=G1(t,F1.bind(null,r))}r.callbackPriority=e,r.callbackNode=t}}function F1(r,e){if(io=-1,so=0,ye&6)throw Error(X(327));var t=r.callbackNode;if(Di()&&r.callbackNode!==t)return null;var n=To(r,r===it?dt:0);if(n===0)return null;if(n&30||n&r.expiredLanes||e)e=Uo(r,n);else{e=n;var i=ye;ye|=2;var s=O1();(it!==r||dt!==e)&&($r=null,Ui=We()+500,Hn(r,e));do try{m2();break}catch(o){B1(r,o)}while(!0);ef(),Mo.current=s,ye=i,Qe!==null?e=0:(it=null,dt=0,e=tt)}if(e!==0){if(e===2&&(i=Dc(r),i!==0&&(n=i,e=nd(r,i))),e===1)throw t=Vs,Hn(r,0),cn(r,n),Nt(r,We()),t;if(e===6)cn(r,n);else{if(i=r.current.alternate,!(n&30)&&!p2(i)&&(e=Uo(r,n),e===2&&(s=Dc(r),s!==0&&(n=s,e=nd(r,s))),e===1))throw t=Vs,Hn(r,0),cn(r,n),Nt(r,We()),t;switch(r.finishedWork=i,r.finishedLanes=n,e){case 0:case 1:throw Error(X(345));case 2:Mn(r,Pt,$r);break;case 3:if(cn(r,n),(n&130023424)===n&&(e=mf+500-We(),10<e)){if(To(r,0)!==0)break;if(i=r.suspendedLanes,(i&n)!==n){It(),r.pingedLanes|=r.suspendedLanes&i;break}r.timeoutHandle=Mc(Mn.bind(null,r,Pt,$r),e);break}Mn(r,Pt,$r);break;case 4:if(cn(r,n),(n&4194240)===n)break;for(e=r.eventTimes,i=-1;0<n;){var a=31-mr(n);s=1<<a,a=e[a],a>i&&(i=a),n&=~s}if(n=i,n=We()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*h2(n/1960))-n,10<n){r.timeoutHandle=Mc(Mn.bind(null,r,Pt,$r),n);break}Mn(r,Pt,$r);break;case 5:Mn(r,Pt,$r);break;default:throw Error(X(329))}}}return Nt(r,We()),r.callbackNode===t?F1.bind(null,r):null}function nd(r,e){var t=Ts;return r.current.memoizedState.isDehydrated&&(Hn(r,e).flags|=256),r=Uo(r,e),r!==2&&(e=Pt,Pt=t,e!==null&&id(e)),r}function id(r){Pt===null?Pt=r:Pt.push.apply(Pt,r)}function p2(r){for(var e=r;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var n=0;n<t.length;n++){var i=t[n],s=i.getSnapshot;i=i.value;try{if(!vr(s(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===r)break;for(;e.sibling===null;){if(e.return===null||e.return===r)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function cn(r,e){for(e&=~gf,e&=~cl,r.suspendedLanes|=e,r.pingedLanes&=~e,r=r.expirationTimes;0<e;){var t=31-mr(e),n=1<<t;r[t]=-1,e&=~n}}function Eh(r){if(ye&6)throw Error(X(327));Di();var e=To(r,0);if(!(e&1))return Nt(r,We()),null;var t=Uo(r,e);if(r.tag!==0&&t===2){var n=Dc(r);n!==0&&(e=n,t=nd(r,n))}if(t===1)throw t=Vs,Hn(r,0),cn(r,e),Nt(r,We()),t;if(t===6)throw Error(X(345));return r.finishedWork=r.current.alternate,r.finishedLanes=e,Mn(r,Pt,$r),Nt(r,We()),null}function xf(r,e){var t=ye;ye|=1;try{return r(e)}finally{ye=t,ye===0&&(Ui=We()+500,al&&In())}}function Xn(r){fn!==null&&fn.tag===0&&!(ye&6)&&Di();var e=ye;ye|=1;var t=ir.transition,n=Le;try{if(ir.transition=null,Le=1,r)return r()}finally{Le=n,ir.transition=t,ye=e,!(ye&6)&&In()}}function vf(){zt=Ti.current,we(Ti)}function Hn(r,e){r.finishedWork=null,r.finishedLanes=0;var t=r.timeoutHandle;if(t!==-1&&(r.timeoutHandle=-1,jE(t)),Qe!==null)for(t=Qe.return;t!==null;){var n=t;switch(Qd(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&Io();break;case 3:Ni(),we(Ot),we(yt),of();break;case 5:af(n);break;case 4:Ni();break;case 13:we(Ue);break;case 19:we(Ue);break;case 10:tf(n.type._context);break;case 22:case 23:vf()}t=t.return}if(it=r,Qe=r=En(r.current,null),dt=zt=e,tt=0,Vs=null,gf=cl=qn=0,Pt=Ts=null,Un!==null){for(e=0;e<Un.length;e++)if(t=Un[e],n=t.interleaved,n!==null){t.interleaved=null;var i=n.next,s=t.pending;if(s!==null){var a=s.next;s.next=i,n.next=a}t.pending=n}Un=null}return r}function B1(r,e){do{var t=Qe;try{if(ef(),to.current=Oo,Bo){for(var n=He.memoizedState;n!==null;){var i=n.queue;i!==null&&(i.pending=null),n=n.next}Bo=!1}if(Yn=0,nt=Je=He=null,Es=!1,Us=0,pf.current=null,t===null||t.return===null){tt=1,Vs=e,Qe=null;break}e:{var s=r,a=t.return,o=t,u=e;if(e=dt,o.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var l=u,c=o,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var f=c.alternate;f?(c.updateQueue=f.updateQueue,c.memoizedState=f.memoizedState,c.lanes=f.lanes):(c.updateQueue=null,c.memoizedState=null)}var h=oh(a);if(h!==null){h.flags&=-257,lh(h,a,o,s,e),h.mode&1&&ah(s,l,e),e=h,u=l;var p=e.updateQueue;if(p===null){var x=new Set;x.add(u),e.updateQueue=x}else p.add(u);break e}else{if(!(e&1)){ah(s,l,e),yf();break e}u=Error(X(426))}}else if(be&&o.mode&1){var v=oh(a);if(v!==null){!(v.flags&65536)&&(v.flags|=256),lh(v,a,o,s,e),Zd($i(u,o));break e}}s=u=$i(u,o),tt!==4&&(tt=2),Ts===null?Ts=[s]:Ts.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var y=v1(s,u,e);eh(s,y);break e;case 1:o=u;var g=s.type,m=s.stateNode;if(!(s.flags&128)&&(typeof g.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(vn===null||!vn.has(m)))){s.flags|=65536,e&=-e,s.lanes|=e;var E=y1(s,o,e);eh(s,E);break e}}s=s.return}while(s!==null)}N1(t)}catch(T){e=T,Qe===t&&t!==null&&(Qe=t=t.return);continue}break}while(!0)}function O1(){var r=Mo.current;return Mo.current=Oo,r===null?Oo:r}function yf(){(tt===0||tt===3||tt===2)&&(tt=4),it===null||!(qn&268435455)&&!(cl&268435455)||cn(it,dt)}function Uo(r,e){var t=ye;ye|=2;var n=O1();(it!==r||dt!==e)&&($r=null,Hn(r,e));do try{g2();break}catch(i){B1(r,i)}while(!0);if(ef(),ye=t,Mo.current=n,Qe!==null)throw Error(X(261));return it=null,dt=0,tt}function g2(){for(;Qe!==null;)M1(Qe)}function m2(){for(;Qe!==null&&!Gy();)M1(Qe)}function M1(r){var e=U1(r.alternate,r,zt);r.memoizedProps=r.pendingProps,e===null?N1(r):Qe=e,pf.current=null}function N1(r){var e=r;do{var t=e.alternate;if(r=e.return,e.flags&32768){if(t=u2(t,e),t!==null){t.flags&=32767,Qe=t;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{tt=6,Qe=null;return}}else if(t=l2(t,e,zt),t!==null){Qe=t;return}if(e=e.sibling,e!==null){Qe=e;return}Qe=e=r}while(e!==null);tt===0&&(tt=5)}function Mn(r,e,t){var n=Le,i=ir.transition;try{ir.transition=null,Le=1,x2(r,e,t,n)}finally{ir.transition=i,Le=n}return null}function x2(r,e,t,n){do Di();while(fn!==null);if(ye&6)throw Error(X(327));t=r.finishedWork;var i=r.finishedLanes;if(t===null)return null;if(r.finishedWork=null,r.finishedLanes=0,t===r.current)throw Error(X(177));r.callbackNode=null,r.callbackPriority=0;var s=t.lanes|t.childLanes;if(Qy(r,s),r===it&&(Qe=it=null,dt=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||ka||(ka=!0,G1(So,function(){return Di(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=ir.transition,ir.transition=null;var a=Le;Le=1;var o=ye;ye|=4,pf.current=null,d2(r,t),b1(t,r),ME(Bc),Ao=!!Fc,Bc=Fc=null,r.current=t,f2(t),Hy(),ye=o,Le=a,ir.transition=s}else r.current=t;if(ka&&(ka=!1,fn=r,$o=i),s=r.pendingLanes,s===0&&(vn=null),Ky(t.stateNode),Nt(r,We()),e!==null)for(n=r.onRecoverableError,t=0;t<e.length;t++)i=e[t],n(i.value,{componentStack:i.stack,digest:i.digest});if(No)throw No=!1,r=td,td=null,r;return $o&1&&r.tag!==0&&Di(),s=r.pendingLanes,s&1?r===rd?As++:(As=0,rd=r):As=0,In(),null}function Di(){if(fn!==null){var r=vm($o),e=ir.transition,t=Le;try{if(ir.transition=null,Le=16>r?16:r,fn===null)var n=!1;else{if(r=fn,fn=null,$o=0,ye&6)throw Error(X(331));var i=ye;for(ye|=4,te=r.current;te!==null;){var s=te,a=s.child;if(te.flags&16){var o=s.deletions;if(o!==null){for(var u=0;u<o.length;u++){var l=o[u];for(te=l;te!==null;){var c=te;switch(c.tag){case 0:case 11:case 15:Ss(8,c,s)}var d=c.child;if(d!==null)d.return=c,te=d;else for(;te!==null;){c=te;var f=c.sibling,h=c.return;if(D1(c),c===l){te=null;break}if(f!==null){f.return=h,te=f;break}te=h}}}var p=s.alternate;if(p!==null){var x=p.child;if(x!==null){p.child=null;do{var v=x.sibling;x.sibling=null,x=v}while(x!==null)}}te=s}}if(s.subtreeFlags&2064&&a!==null)a.return=s,te=a;else e:for(;te!==null;){if(s=te,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Ss(9,s,s.return)}var y=s.sibling;if(y!==null){y.return=s.return,te=y;break e}te=s.return}}var g=r.current;for(te=g;te!==null;){a=te;var m=a.child;if(a.subtreeFlags&2064&&m!==null)m.return=a,te=m;else e:for(a=g;te!==null;){if(o=te,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:ul(9,o)}}catch(T){Ke(o,o.return,T)}if(o===a){te=null;break e}var E=o.sibling;if(E!==null){E.return=o.return,te=E;break e}te=o.return}}if(ye=i,In(),wr&&typeof wr.onPostCommitFiberRoot=="function")try{wr.onPostCommitFiberRoot(tl,r)}catch{}n=!0}return n}finally{Le=t,ir.transition=e}}return!1}function Sh(r,e,t){e=$i(t,e),e=v1(r,e,1),r=xn(r,e,1),e=It(),r!==null&&(Js(r,1,e),Nt(r,e))}function Ke(r,e,t){if(r.tag===3)Sh(r,r,t);else for(;e!==null;){if(e.tag===3){Sh(e,r,t);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(vn===null||!vn.has(n))){r=$i(t,r),r=y1(e,r,1),e=xn(e,r,1),r=It(),e!==null&&(Js(e,1,r),Nt(e,r));break}}e=e.return}}function v2(r,e,t){var n=r.pingCache;n!==null&&n.delete(e),e=It(),r.pingedLanes|=r.suspendedLanes&t,it===r&&(dt&t)===t&&(tt===4||tt===3&&(dt&130023424)===dt&&500>We()-mf?Hn(r,0):gf|=t),Nt(r,e)}function $1(r,e){e===0&&(r.mode&1?(e=Ea,Ea<<=1,!(Ea&130023424)&&(Ea=4194304)):e=1);var t=It();r=qr(r,e),r!==null&&(Js(r,e,t),Nt(r,t))}function y2(r){var e=r.memoizedState,t=0;e!==null&&(t=e.retryLane),$1(r,t)}function E2(r,e){var t=0;switch(r.tag){case 13:var n=r.stateNode,i=r.memoizedState;i!==null&&(t=i.retryLane);break;case 19:n=r.stateNode;break;default:throw Error(X(314))}n!==null&&n.delete(e),$1(r,t)}var U1;U1=function(r,e,t){if(r!==null)if(r.memoizedProps!==e.pendingProps||Ot.current)Ft=!0;else{if(!(r.lanes&t)&&!(e.flags&128))return Ft=!1,o2(r,e,t);Ft=!!(r.flags&131072)}else Ft=!1,be&&e.flags&1048576&&jm(e,ko,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;no(r,e),r=e.pendingProps;var i=Bi(e,yt.current);_i(e,t),i=uf(null,e,n,r,i,t);var s=cf();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Mt(n)?(s=!0,_o(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,nf(e),i.updater=ll,e.stateNode=i,i._reactInternals=e,jc(e,n,r,t),e=Wc(null,e,n,!0,s,t)):(e.tag=0,be&&s&&Xd(e),At(null,e,i,t),e=e.child),e;case 16:n=e.elementType;e:{switch(no(r,e),r=e.pendingProps,i=n._init,n=i(n._payload),e.type=n,i=e.tag=T2(n),r=hr(n,r),i){case 0:e=zc(null,e,n,r,t);break e;case 1:e=dh(null,e,n,r,t);break e;case 11:e=uh(null,e,n,r,t);break e;case 14:e=ch(null,e,n,hr(n.type,r),t);break e}throw Error(X(306,n,""))}return e;case 0:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:hr(n,i),zc(r,e,n,i,t);case 1:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:hr(n,i),dh(r,e,n,i,t);case 3:e:{if(A1(e),r===null)throw Error(X(387));n=e.pendingProps,s=e.memoizedState,i=s.element,Xm(r,e),Po(e,n,null,t);var a=e.memoizedState;if(n=a.element,s.isDehydrated)if(s={element:n,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=$i(Error(X(423)),e),e=fh(r,e,n,t,i);break e}else if(n!==i){i=$i(Error(X(424)),e),e=fh(r,e,n,t,i);break e}else for(Yt=mn(e.stateNode.containerInfo.firstChild),qt=e,be=!0,gr=null,t=Ym(e,null,n,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Oi(),n===i){e=Xr(r,e,t);break e}At(r,e,n,t)}e=e.child}return e;case 5:return Qm(e),r===null&&Gc(e),n=e.type,i=e.pendingProps,s=r!==null?r.memoizedProps:null,a=i.children,Oc(n,i)?a=null:s!==null&&Oc(n,s)&&(e.flags|=32),T1(r,e),At(r,e,a,t),e.child;case 6:return r===null&&Gc(e),null;case 13:return C1(r,e,t);case 4:return sf(e,e.stateNode.containerInfo),n=e.pendingProps,r===null?e.child=Mi(e,null,n,t):At(r,e,n,t),e.child;case 11:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:hr(n,i),uh(r,e,n,i,t);case 7:return At(r,e,e.pendingProps,t),e.child;case 8:return At(r,e,e.pendingProps.children,t),e.child;case 12:return At(r,e,e.pendingProps.children,t),e.child;case 10:e:{if(n=e.type._context,i=e.pendingProps,s=e.memoizedProps,a=i.value,De(wo,n._currentValue),n._currentValue=a,s!==null)if(vr(s.value,a)){if(s.children===i.children&&!Ot.current){e=Xr(r,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var o=s.dependencies;if(o!==null){a=s.child;for(var u=o.firstContext;u!==null;){if(u.context===n){if(s.tag===1){u=Kr(-1,t&-t),u.tag=2;var l=s.updateQueue;if(l!==null){l=l.shared;var c=l.pending;c===null?u.next=u:(u.next=c.next,c.next=u),l.pending=u}}s.lanes|=t,u=s.alternate,u!==null&&(u.lanes|=t),Hc(s.return,t,e),o.lanes|=t;break}u=u.next}}else if(s.tag===10)a=s.type===e.type?null:s.child;else if(s.tag===18){if(a=s.return,a===null)throw Error(X(341));a.lanes|=t,o=a.alternate,o!==null&&(o.lanes|=t),Hc(a,t,e),a=s.sibling}else a=s.child;if(a!==null)a.return=s;else for(a=s;a!==null;){if(a===e){a=null;break}if(s=a.sibling,s!==null){s.return=a.return,a=s;break}a=a.return}s=a}At(r,e,i.children,t),e=e.child}return e;case 9:return i=e.type,n=e.pendingProps.children,_i(e,t),i=sr(i),n=n(i),e.flags|=1,At(r,e,n,t),e.child;case 14:return n=e.type,i=hr(n,e.pendingProps),i=hr(n.type,i),ch(r,e,n,i,t);case 15:return E1(r,e,e.type,e.pendingProps,t);case 17:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:hr(n,i),no(r,e),e.tag=1,Mt(n)?(r=!0,_o(e)):r=!1,_i(e,t),x1(e,n,i),jc(e,n,i,t),Wc(null,e,n,!0,r,t);case 19:return L1(r,e,t);case 22:return S1(r,e,t)}throw Error(X(156,e.tag))};function G1(r,e){return pm(r,e)}function S2(r,e,t,n){this.tag=r,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function nr(r,e,t,n){return new S2(r,e,t,n)}function Ef(r){return r=r.prototype,!(!r||!r.isReactComponent)}function T2(r){if(typeof r=="function")return Ef(r)?1:0;if(r!=null){if(r=r.$$typeof,r===Nd)return 11;if(r===$d)return 14}return 2}function En(r,e){var t=r.alternate;return t===null?(t=nr(r.tag,e,r.key,r.mode),t.elementType=r.elementType,t.type=r.type,t.stateNode=r.stateNode,t.alternate=r,r.alternate=t):(t.pendingProps=e,t.type=r.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=r.flags&14680064,t.childLanes=r.childLanes,t.lanes=r.lanes,t.child=r.child,t.memoizedProps=r.memoizedProps,t.memoizedState=r.memoizedState,t.updateQueue=r.updateQueue,e=r.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=r.sibling,t.index=r.index,t.ref=r.ref,t}function ao(r,e,t,n,i,s){var a=2;if(n=r,typeof r=="function")Ef(r)&&(a=1);else if(typeof r=="string")a=5;else e:switch(r){case fi:return Vn(t.children,i,s,e);case Md:a=8,i|=8;break;case pc:return r=nr(12,t,e,i|2),r.elementType=pc,r.lanes=s,r;case gc:return r=nr(13,t,e,i),r.elementType=gc,r.lanes=s,r;case mc:return r=nr(19,t,e,i),r.elementType=mc,r.lanes=s,r;case Qg:return dl(t,i,s,e);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case qg:a=10;break e;case Xg:a=9;break e;case Nd:a=11;break e;case $d:a=14;break e;case sn:a=16,n=null;break e}throw Error(X(130,r==null?r:typeof r,""))}return e=nr(a,t,e,i),e.elementType=r,e.type=n,e.lanes=s,e}function Vn(r,e,t,n){return r=nr(7,r,n,e),r.lanes=t,r}function dl(r,e,t,n){return r=nr(22,r,n,e),r.elementType=Qg,r.lanes=t,r.stateNode={isHidden:!1},r}function eu(r,e,t){return r=nr(6,r,null,e),r.lanes=t,r}function tu(r,e,t){return e=nr(4,r.children!==null?r.children:[],r.key,e),e.lanes=t,e.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},e}function A2(r,e,t,n,i){this.tag=e,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Bl(0),this.expirationTimes=Bl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Bl(0),this.identifierPrefix=n,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Sf(r,e,t,n,i,s,a,o,u){return r=new A2(r,e,t,o,u),e===1?(e=1,s===!0&&(e|=8)):e=0,s=nr(3,null,null,e),r.current=s,s.stateNode=r,s.memoizedState={element:n,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},nf(s),r}function C2(r,e,t){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:di,key:n==null?null:""+n,children:r,containerInfo:e,implementation:t}}function H1(r){if(!r)return Tn;r=r._reactInternals;e:{if(Jn(r)!==r||r.tag!==1)throw Error(X(170));var e=r;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Mt(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(X(171))}if(r.tag===1){var t=r.type;if(Mt(t))return Hm(r,t,e)}return e}function V1(r,e,t,n,i,s,a,o,u){return r=Sf(t,n,!0,r,i,s,a,o,u),r.context=H1(null),t=r.current,n=It(),i=yn(t),s=Kr(n,i),s.callback=e??null,xn(t,s,i),r.current.lanes=i,Js(r,i,n),Nt(r,n),r}function fl(r,e,t,n){var i=e.current,s=It(),a=yn(i);return t=H1(t),e.context===null?e.context=t:e.pendingContext=t,e=Kr(s,a),e.payload={element:r},n=n===void 0?null:n,n!==null&&(e.callback=n),r=xn(i,e,a),r!==null&&(xr(r,i,a,s),eo(r,i,a)),a}function Go(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function Th(r,e){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var t=r.retryLane;r.retryLane=t!==0&&t<e?t:e}}function Tf(r,e){Th(r,e),(r=r.alternate)&&Th(r,e)}function L2(){return null}var j1=typeof reportError=="function"?reportError:function(r){console.error(r)};function Af(r){this._internalRoot=r}hl.prototype.render=Af.prototype.render=function(r){var e=this._internalRoot;if(e===null)throw Error(X(409));fl(r,e,null,null)};hl.prototype.unmount=Af.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var e=r.containerInfo;Xn(function(){fl(null,r,null,null)}),e[Yr]=null}};function hl(r){this._internalRoot=r}hl.prototype.unstable_scheduleHydration=function(r){if(r){var e=Sm();r={blockedOn:null,target:r,priority:e};for(var t=0;t<un.length&&e!==0&&e<un[t].priority;t++);un.splice(t,0,r),t===0&&Am(r)}};function Cf(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function pl(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function Ah(){}function R2(r,e,t,n,i){if(i){if(typeof n=="function"){var s=n;n=function(){var l=Go(a);s.call(l)}}var a=V1(e,n,r,0,null,!1,!1,"",Ah);return r._reactRootContainer=a,r[Yr]=a.current,Bs(r.nodeType===8?r.parentNode:r),Xn(),a}for(;i=r.lastChild;)r.removeChild(i);if(typeof n=="function"){var o=n;n=function(){var l=Go(u);o.call(l)}}var u=Sf(r,0,!1,null,null,!1,!1,"",Ah);return r._reactRootContainer=u,r[Yr]=u.current,Bs(r.nodeType===8?r.parentNode:r),Xn(function(){fl(e,u,t,n)}),u}function gl(r,e,t,n,i){var s=t._reactRootContainer;if(s){var a=s;if(typeof i=="function"){var o=i;i=function(){var u=Go(a);o.call(u)}}fl(e,a,r,i)}else a=R2(t,e,r,i,n);return Go(a)}ym=function(r){switch(r.tag){case 3:var e=r.stateNode;if(e.current.memoizedState.isDehydrated){var t=fs(e.pendingLanes);t!==0&&(Hd(e,t|1),Nt(e,We()),!(ye&6)&&(Ui=We()+500,In()))}break;case 13:Xn(function(){var n=qr(r,1);if(n!==null){var i=It();xr(n,r,1,i)}}),Tf(r,1)}};Vd=function(r){if(r.tag===13){var e=qr(r,134217728);if(e!==null){var t=It();xr(e,r,134217728,t)}Tf(r,134217728)}};Em=function(r){if(r.tag===13){var e=yn(r),t=qr(r,e);if(t!==null){var n=It();xr(t,r,e,n)}Tf(r,e)}};Sm=function(){return Le};Tm=function(r,e){var t=Le;try{return Le=r,e()}finally{Le=t}};Rc=function(r,e,t){switch(e){case"input":if(yc(r,t),e=t.name,t.type==="radio"&&e!=null){for(t=r;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var n=t[e];if(n!==r&&n.form===r.form){var i=sl(n);if(!i)throw Error(X(90));Jg(n),yc(n,i)}}}break;case"textarea":tm(r,t);break;case"select":e=t.value,e!=null&&Ci(r,!!t.multiple,e,!1)}};lm=xf;um=Xn;var I2={usingClientEntryPoint:!1,Events:[ta,mi,sl,am,om,xf]},os={findFiberByHostInstance:$n,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},_2={bundleType:os.bundleType,version:os.version,rendererPackageName:os.rendererPackageName,rendererConfig:os.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Zr.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=fm(r),r===null?null:r.stateNode},findFiberByHostInstance:os.findFiberByHostInstance||L2,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var wa=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!wa.isDisabled&&wa.supportsFiber)try{tl=wa.inject(_2),wr=wa}catch{}}Jt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=I2;Jt.createPortal=function(r,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Cf(e))throw Error(X(200));return C2(r,e,null,t)};Jt.createRoot=function(r,e){if(!Cf(r))throw Error(X(299));var t=!1,n="",i=j1;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=Sf(r,1,!1,null,null,t,!1,n,i),r[Yr]=e.current,Bs(r.nodeType===8?r.parentNode:r),new Af(e)};Jt.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var e=r._reactInternals;if(e===void 0)throw typeof r.render=="function"?Error(X(188)):(r=Object.keys(r).join(","),Error(X(268,r)));return r=fm(e),r=r===null?null:r.stateNode,r};Jt.flushSync=function(r){return Xn(r)};Jt.hydrate=function(r,e,t){if(!pl(e))throw Error(X(200));return gl(null,r,e,!0,t)};Jt.hydrateRoot=function(r,e,t){if(!Cf(r))throw Error(X(405));var n=t!=null&&t.hydratedSources||null,i=!1,s="",a=j1;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=V1(e,null,r,1,t??null,i,!1,s,a),r[Yr]=e.current,Bs(r),n)for(r=0;r<n.length;r++)t=n[r],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new hl(e)};Jt.render=function(r,e,t){if(!pl(e))throw Error(X(200));return gl(null,r,e,!1,t)};Jt.unmountComponentAtNode=function(r){if(!pl(r))throw Error(X(40));return r._reactRootContainer?(Xn(function(){gl(null,null,r,!1,function(){r._reactRootContainer=null,r[Yr]=null})}),!0):!1};Jt.unstable_batchedUpdates=xf;Jt.unstable_renderSubtreeIntoContainer=function(r,e,t,n){if(!pl(t))throw Error(X(200));if(r==null||r._reactInternals===void 0)throw Error(X(38));return gl(r,e,t,!1,n)};Jt.version="18.3.1-next-f1338f8080-20240426";function K1(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(K1)}catch(r){console.error(r)}}K1(),Kg.exports=Jt;var D2=Kg.exports,Ch=D2;fc.createRoot=Ch.createRoot,fc.hydrateRoot=Ch.hydrateRoot;/**
 * react-router v7.9.6
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Lh="popstate";function k2(r={}){function e(n,i){let{pathname:s,search:a,hash:o}=n.location;return sd("",{pathname:s,search:a,hash:o},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function t(n,i){return typeof i=="string"?i:js(i)}return b2(e,t,null,r)}function Pe(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}function Zt(r,e){if(!r){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function w2(){return Math.random().toString(36).substring(2,10)}function Rh(r,e){return{usr:r.state,key:r.key,idx:e}}function sd(r,e,t=null,n){return{pathname:typeof r=="string"?r:r.pathname,search:"",hash:"",...typeof e=="string"?zi(e):e,state:t,key:e&&e.key||n||w2()}}function js({pathname:r="/",search:e="",hash:t=""}){return e&&e!=="?"&&(r+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(r+=t.charAt(0)==="#"?t:"#"+t),r}function zi(r){let e={};if(r){let t=r.indexOf("#");t>=0&&(e.hash=r.substring(t),r=r.substring(0,t));let n=r.indexOf("?");n>=0&&(e.search=r.substring(n),r=r.substring(0,n)),r&&(e.pathname=r)}return e}function b2(r,e,t,n={}){let{window:i=document.defaultView,v5Compat:s=!1}=n,a=i.history,o="POP",u=null,l=c();l==null&&(l=0,a.replaceState({...a.state,idx:l},""));function c(){return(a.state||{idx:null}).idx}function d(){o="POP";let v=c(),y=v==null?null:v-l;l=v,u&&u({action:o,location:x.location,delta:y})}function f(v,y){o="PUSH";let g=sd(x.location,v,y);l=c()+1;let m=Rh(g,l),E=x.createHref(g);try{a.pushState(m,"",E)}catch(T){if(T instanceof DOMException&&T.name==="DataCloneError")throw T;i.location.assign(E)}s&&u&&u({action:o,location:x.location,delta:1})}function h(v,y){o="REPLACE";let g=sd(x.location,v,y);l=c();let m=Rh(g,l),E=x.createHref(g);a.replaceState(m,"",E),s&&u&&u({action:o,location:x.location,delta:0})}function p(v){return P2(v)}let x={get action(){return o},get location(){return r(i,a)},listen(v){if(u)throw new Error("A history only accepts one active listener");return i.addEventListener(Lh,d),u=v,()=>{i.removeEventListener(Lh,d),u=null}},createHref(v){return e(i,v)},createURL:p,encodeLocation(v){let y=p(v);return{pathname:y.pathname,search:y.search,hash:y.hash}},push:f,replace:h,go(v){return a.go(v)}};return x}function P2(r,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),Pe(t,"No window.location.(origin|href) available to create URL");let n=typeof r=="string"?r:js(r);return n=n.replace(/ $/,"%20"),!e&&n.startsWith("//")&&(n=t+n),new URL(n,t)}function z1(r,e,t="/"){return F2(r,e,t,!1)}function F2(r,e,t,n){let i=typeof e=="string"?zi(e):e,s=Qr(i.pathname||"/",t);if(s==null)return null;let a=W1(r);B2(a);let o=null;for(let u=0;o==null&&u<a.length;++u){let l=z2(s);o=j2(a[u],l,n)}return o}function W1(r,e=[],t=[],n="",i=!1){let s=(a,o,u=i,l)=>{let c={relativePath:l===void 0?a.path||"":l,caseSensitive:a.caseSensitive===!0,childrenIndex:o,route:a};if(c.relativePath.startsWith("/")){if(!c.relativePath.startsWith(n)&&u)return;Pe(c.relativePath.startsWith(n),`Absolute route path "${c.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),c.relativePath=c.relativePath.slice(n.length)}let d=zr([n,c.relativePath]),f=t.concat(c);a.children&&a.children.length>0&&(Pe(a.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${d}".`),W1(a.children,e,f,d,u)),!(a.path==null&&!a.index)&&e.push({path:d,score:H2(d,a.index),routesMeta:f})};return r.forEach((a,o)=>{var u;if(a.path===""||!((u=a.path)!=null&&u.includes("?")))s(a,o);else for(let l of Y1(a.path))s(a,o,!0,l)}),e}function Y1(r){let e=r.split("/");if(e.length===0)return[];let[t,...n]=e,i=t.endsWith("?"),s=t.replace(/\?$/,"");if(n.length===0)return i?[s,""]:[s];let a=Y1(n.join("/")),o=[];return o.push(...a.map(u=>u===""?s:[s,u].join("/"))),i&&o.push(...a),o.map(u=>r.startsWith("/")&&u===""?"/":u)}function B2(r){r.sort((e,t)=>e.score!==t.score?t.score-e.score:V2(e.routesMeta.map(n=>n.childrenIndex),t.routesMeta.map(n=>n.childrenIndex)))}var O2=/^:[\w-]+$/,M2=3,N2=2,$2=1,U2=10,G2=-2,Ih=r=>r==="*";function H2(r,e){let t=r.split("/"),n=t.length;return t.some(Ih)&&(n+=G2),e&&(n+=N2),t.filter(i=>!Ih(i)).reduce((i,s)=>i+(O2.test(s)?M2:s===""?$2:U2),n)}function V2(r,e){return r.length===e.length&&r.slice(0,-1).every((n,i)=>n===e[i])?r[r.length-1]-e[e.length-1]:0}function j2(r,e,t=!1){let{routesMeta:n}=r,i={},s="/",a=[];for(let o=0;o<n.length;++o){let u=n[o],l=o===n.length-1,c=s==="/"?e:e.slice(s.length)||"/",d=Ho({path:u.relativePath,caseSensitive:u.caseSensitive,end:l},c),f=u.route;if(!d&&l&&t&&!n[n.length-1].route.index&&(d=Ho({path:u.relativePath,caseSensitive:u.caseSensitive,end:!1},c)),!d)return null;Object.assign(i,d.params),a.push({params:i,pathname:zr([s,d.pathname]),pathnameBase:Q2(zr([s,d.pathnameBase])),route:f}),d.pathnameBase!=="/"&&(s=zr([s,d.pathnameBase]))}return a}function Ho(r,e){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[t,n]=K2(r.path,r.caseSensitive,r.end),i=e.match(t);if(!i)return null;let s=i[0],a=s.replace(/(.)\/+$/,"$1"),o=i.slice(1);return{params:n.reduce((l,{paramName:c,isOptional:d},f)=>{if(c==="*"){let p=o[f]||"";a=s.slice(0,s.length-p.length).replace(/(.)\/+$/,"$1")}const h=o[f];return d&&!h?l[c]=void 0:l[c]=(h||"").replace(/%2F/g,"/"),l},{}),pathname:s,pathnameBase:a,pattern:r}}function K2(r,e=!1,t=!0){Zt(r==="*"||!r.endsWith("*")||r.endsWith("/*"),`Route path "${r}" will be treated as if it were "${r.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${r.replace(/\*$/,"/*")}".`);let n=[],i="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,o,u)=>(n.push({paramName:o,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return r.endsWith("*")?(n.push({paramName:"*"}),i+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":r!==""&&r!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),n]}function z2(r){try{return r.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Zt(!1,`The URL path "${r}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),r}}function Qr(r,e){if(e==="/")return r;if(!r.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,n=r.charAt(t);return n&&n!=="/"?null:r.slice(t)||"/"}var W2=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Y2=r=>W2.test(r);function q2(r,e="/"){let{pathname:t,search:n="",hash:i=""}=typeof r=="string"?zi(r):r,s;if(t)if(Y2(t))s=t;else{if(t.includes("//")){let a=t;t=t.replace(/\/\/+/g,"/"),Zt(!1,`Pathnames cannot have embedded double slashes - normalizing ${a} -> ${t}`)}t.startsWith("/")?s=_h(t.substring(1),"/"):s=_h(t,e)}else s=e;return{pathname:s,search:Z2(n),hash:J2(i)}}function _h(r,e){let t=e.replace(/\/+$/,"").split("/");return r.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function ru(r,e,t,n){return`Cannot include a '${r}' character in a manually specified \`to.${e}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function X2(r){return r.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function Lf(r){let e=X2(r);return e.map((t,n)=>n===e.length-1?t.pathname:t.pathnameBase)}function Rf(r,e,t,n=!1){let i;typeof r=="string"?i=zi(r):(i={...r},Pe(!i.pathname||!i.pathname.includes("?"),ru("?","pathname","search",i)),Pe(!i.pathname||!i.pathname.includes("#"),ru("#","pathname","hash",i)),Pe(!i.search||!i.search.includes("#"),ru("#","search","hash",i)));let s=r===""||i.pathname==="",a=s?"/":i.pathname,o;if(a==null)o=t;else{let d=e.length-1;if(!n&&a.startsWith("..")){let f=a.split("/");for(;f[0]==="..";)f.shift(),d-=1;i.pathname=f.join("/")}o=d>=0?e[d]:"/"}let u=q2(i,o),l=a&&a!=="/"&&a.endsWith("/"),c=(s||a===".")&&t.endsWith("/");return!u.pathname.endsWith("/")&&(l||c)&&(u.pathname+="/"),u}var zr=r=>r.join("/").replace(/\/\/+/g,"/"),Q2=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),Z2=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,J2=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function eS(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var q1=["POST","PUT","PATCH","DELETE"];new Set(q1);var tS=["GET",...q1];new Set(tS);var Wi=b.createContext(null);Wi.displayName="DataRouter";var ml=b.createContext(null);ml.displayName="DataRouterState";b.createContext(!1);var X1=b.createContext({isTransitioning:!1});X1.displayName="ViewTransition";var rS=b.createContext(new Map);rS.displayName="Fetchers";var nS=b.createContext(null);nS.displayName="Await";var yr=b.createContext(null);yr.displayName="Navigation";var na=b.createContext(null);na.displayName="Location";var Er=b.createContext({outlet:null,matches:[],isDataRoute:!1});Er.displayName="Route";var If=b.createContext(null);If.displayName="RouteError";function iS(r,{relative:e}={}){Pe(Yi(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:n}=b.useContext(yr),{hash:i,pathname:s,search:a}=ia(r,{relative:e}),o=s;return t!=="/"&&(o=s==="/"?t:zr([t,s])),n.createHref({pathname:o,search:a,hash:i})}function Yi(){return b.useContext(na)!=null}function Jr(){return Pe(Yi(),"useLocation() may be used only in the context of a <Router> component."),b.useContext(na).location}var Q1="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Z1(r){b.useContext(yr).static||b.useLayoutEffect(r)}function _f(){let{isDataRoute:r}=b.useContext(Er);return r?vS():sS()}function sS(){Pe(Yi(),"useNavigate() may be used only in the context of a <Router> component.");let r=b.useContext(Wi),{basename:e,navigator:t}=b.useContext(yr),{matches:n}=b.useContext(Er),{pathname:i}=Jr(),s=JSON.stringify(Lf(n)),a=b.useRef(!1);return Z1(()=>{a.current=!0}),b.useCallback((u,l={})=>{if(Zt(a.current,Q1),!a.current)return;if(typeof u=="number"){t.go(u);return}let c=Rf(u,JSON.parse(s),i,l.relative==="path");r==null&&e!=="/"&&(c.pathname=c.pathname==="/"?e:zr([e,c.pathname])),(l.replace?t.replace:t.push)(c,l.state,l)},[e,t,s,i,r])}b.createContext(null);function aS(){let{matches:r}=b.useContext(Er),e=r[r.length-1];return e?e.params:{}}function ia(r,{relative:e}={}){let{matches:t}=b.useContext(Er),{pathname:n}=Jr(),i=JSON.stringify(Lf(t));return b.useMemo(()=>Rf(r,JSON.parse(i),n,e==="path"),[r,i,n,e])}function oS(r,e){return J1(r,e)}function J1(r,e,t,n,i){var g;Pe(Yi(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:s}=b.useContext(yr),{matches:a}=b.useContext(Er),o=a[a.length-1],u=o?o.params:{},l=o?o.pathname:"/",c=o?o.pathnameBase:"/",d=o&&o.route;{let m=d&&d.path||"";ex(l,!d||m.endsWith("*")||m.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${l}" (under <Route path="${m}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${m}"> to <Route path="${m==="/"?"*":`${m}/*`}">.`)}let f=Jr(),h;if(e){let m=typeof e=="string"?zi(e):e;Pe(c==="/"||((g=m.pathname)==null?void 0:g.startsWith(c)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${c}" but pathname "${m.pathname}" was given in the \`location\` prop.`),h=m}else h=f;let p=h.pathname||"/",x=p;if(c!=="/"){let m=c.replace(/^\//,"").split("/");x="/"+p.replace(/^\//,"").split("/").slice(m.length).join("/")}let v=z1(r,{pathname:x});Zt(d||v!=null,`No routes matched location "${h.pathname}${h.search}${h.hash}" `),Zt(v==null||v[v.length-1].route.element!==void 0||v[v.length-1].route.Component!==void 0||v[v.length-1].route.lazy!==void 0,`Matched leaf route at location "${h.pathname}${h.search}${h.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let y=fS(v&&v.map(m=>Object.assign({},m,{params:Object.assign({},u,m.params),pathname:zr([c,s.encodeLocation?s.encodeLocation(m.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:m.pathname]),pathnameBase:m.pathnameBase==="/"?c:zr([c,s.encodeLocation?s.encodeLocation(m.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:m.pathnameBase])})),a,t,n,i);return e&&y?b.createElement(na.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...h},navigationType:"POP"}},y):y}function lS(){let r=xS(),e=eS(r)?`${r.status} ${r.statusText}`:r instanceof Error?r.message:JSON.stringify(r),t=r instanceof Error?r.stack:null,n="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:n},s={padding:"2px 4px",backgroundColor:n},a=null;return console.error("Error handled by React Router default ErrorBoundary:",r),a=b.createElement(b.Fragment,null,b.createElement("p",null," Hey developer "),b.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",b.createElement("code",{style:s},"ErrorBoundary")," or"," ",b.createElement("code",{style:s},"errorElement")," prop on your route.")),b.createElement(b.Fragment,null,b.createElement("h2",null,"Unexpected Application Error!"),b.createElement("h3",{style:{fontStyle:"italic"}},e),t?b.createElement("pre",{style:i},t):null,a)}var uS=b.createElement(lS,null),cS=class extends b.Component{constructor(r){super(r),this.state={location:r.location,revalidation:r.revalidation,error:r.error}}static getDerivedStateFromError(r){return{error:r}}static getDerivedStateFromProps(r,e){return e.location!==r.location||e.revalidation!=="idle"&&r.revalidation==="idle"?{error:r.error,location:r.location,revalidation:r.revalidation}:{error:r.error!==void 0?r.error:e.error,location:e.location,revalidation:r.revalidation||e.revalidation}}componentDidCatch(r,e){this.props.onError?this.props.onError(r,e):console.error("React Router caught the following error during render",r)}render(){return this.state.error!==void 0?b.createElement(Er.Provider,{value:this.props.routeContext},b.createElement(If.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function dS({routeContext:r,match:e,children:t}){let n=b.useContext(Wi);return n&&n.static&&n.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=e.route.id),b.createElement(Er.Provider,{value:r},t)}function fS(r,e=[],t=null,n=null,i=null){if(r==null){if(!t)return null;if(t.errors)r=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)r=t.matches;else return null}let s=r,a=t==null?void 0:t.errors;if(a!=null){let c=s.findIndex(d=>d.route.id&&(a==null?void 0:a[d.route.id])!==void 0);Pe(c>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(a).join(",")}`),s=s.slice(0,Math.min(s.length,c+1))}let o=!1,u=-1;if(t)for(let c=0;c<s.length;c++){let d=s[c];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(u=c),d.route.id){let{loaderData:f,errors:h}=t,p=d.route.loader&&!f.hasOwnProperty(d.route.id)&&(!h||h[d.route.id]===void 0);if(d.route.lazy||p){o=!0,u>=0?s=s.slice(0,u+1):s=[s[0]];break}}}let l=t&&n?(c,d)=>{var f,h;n(c,{location:t.location,params:((h=(f=t.matches)==null?void 0:f[0])==null?void 0:h.params)??{},errorInfo:d})}:void 0;return s.reduceRight((c,d,f)=>{let h,p=!1,x=null,v=null;t&&(h=a&&d.route.id?a[d.route.id]:void 0,x=d.route.errorElement||uS,o&&(u<0&&f===0?(ex("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),p=!0,v=null):u===f&&(p=!0,v=d.route.hydrateFallbackElement||null)));let y=e.concat(s.slice(0,f+1)),g=()=>{let m;return h?m=x:p?m=v:d.route.Component?m=b.createElement(d.route.Component,null):d.route.element?m=d.route.element:m=c,b.createElement(dS,{match:d,routeContext:{outlet:c,matches:y,isDataRoute:t!=null},children:m})};return t&&(d.route.ErrorBoundary||d.route.errorElement||f===0)?b.createElement(cS,{location:t.location,revalidation:t.revalidation,component:x,error:h,children:g(),routeContext:{outlet:null,matches:y,isDataRoute:!0},onError:l}):g()},null)}function Df(r){return`${r} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function hS(r){let e=b.useContext(Wi);return Pe(e,Df(r)),e}function pS(r){let e=b.useContext(ml);return Pe(e,Df(r)),e}function gS(r){let e=b.useContext(Er);return Pe(e,Df(r)),e}function kf(r){let e=gS(r),t=e.matches[e.matches.length-1];return Pe(t.route.id,`${r} can only be used on routes that contain a unique "id"`),t.route.id}function mS(){return kf("useRouteId")}function xS(){var n;let r=b.useContext(If),e=pS("useRouteError"),t=kf("useRouteError");return r!==void 0?r:(n=e.errors)==null?void 0:n[t]}function vS(){let{router:r}=hS("useNavigate"),e=kf("useNavigate"),t=b.useRef(!1);return Z1(()=>{t.current=!0}),b.useCallback(async(i,s={})=>{Zt(t.current,Q1),t.current&&(typeof i=="number"?r.navigate(i):await r.navigate(i,{fromRouteId:e,...s}))},[r,e])}var Dh={};function ex(r,e,t){!e&&!Dh[r]&&(Dh[r]=!0,Zt(!1,t))}b.memo(yS);function yS({routes:r,future:e,state:t,unstable_onError:n}){return J1(r,void 0,t,n,e)}function ES({to:r,replace:e,state:t,relative:n}){Pe(Yi(),"<Navigate> may be used only in the context of a <Router> component.");let{static:i}=b.useContext(yr);Zt(!i,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:s}=b.useContext(Er),{pathname:a}=Jr(),o=_f(),u=Rf(r,Lf(s),a,n==="path"),l=JSON.stringify(u);return b.useEffect(()=>{o(JSON.parse(l),{replace:e,state:t,relative:n})},[o,l,n,e,t]),null}function ui(r){Pe(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function SS({basename:r="/",children:e=null,location:t,navigationType:n="POP",navigator:i,static:s=!1}){Pe(!Yi(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=r.replace(/^\/*/,"/"),o=b.useMemo(()=>({basename:a,navigator:i,static:s,future:{}}),[a,i,s]);typeof t=="string"&&(t=zi(t));let{pathname:u="/",search:l="",hash:c="",state:d=null,key:f="default"}=t,h=b.useMemo(()=>{let p=Qr(u,a);return p==null?null:{location:{pathname:p,search:l,hash:c,state:d,key:f},navigationType:n}},[a,u,l,c,d,f,n]);return Zt(h!=null,`<Router basename="${a}"> is not able to match the URL "${u}${l}${c}" because it does not start with the basename, so the <Router> won't render anything.`),h==null?null:b.createElement(yr.Provider,{value:o},b.createElement(na.Provider,{children:e,value:h}))}function TS({children:r,location:e}){return oS(ad(r),e)}function ad(r,e=[]){let t=[];return b.Children.forEach(r,(n,i)=>{if(!b.isValidElement(n))return;let s=[...e,i];if(n.type===b.Fragment){t.push.apply(t,ad(n.props.children,s));return}Pe(n.type===ui,`[${typeof n.type=="string"?n.type:n.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Pe(!n.props.index||!n.props.children,"An index route cannot have child routes.");let a={id:n.props.id||s.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,middleware:n.props.middleware,loader:n.props.loader,action:n.props.action,hydrateFallbackElement:n.props.hydrateFallbackElement,HydrateFallback:n.props.HydrateFallback,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.hasErrorBoundary===!0||n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(a.children=ad(n.props.children,s)),t.push(a)}),t}var oo="get",lo="application/x-www-form-urlencoded";function xl(r){return r!=null&&typeof r.tagName=="string"}function AS(r){return xl(r)&&r.tagName.toLowerCase()==="button"}function CS(r){return xl(r)&&r.tagName.toLowerCase()==="form"}function LS(r){return xl(r)&&r.tagName.toLowerCase()==="input"}function RS(r){return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}function IS(r,e){return r.button===0&&(!e||e==="_self")&&!RS(r)}function od(r=""){return new URLSearchParams(typeof r=="string"||Array.isArray(r)||r instanceof URLSearchParams?r:Object.keys(r).reduce((e,t)=>{let n=r[t];return e.concat(Array.isArray(n)?n.map(i=>[t,i]):[[t,n]])},[]))}function _S(r,e){let t=od(r);return e&&e.forEach((n,i)=>{t.has(i)||e.getAll(i).forEach(s=>{t.append(i,s)})}),t}var ba=null;function DS(){if(ba===null)try{new FormData(document.createElement("form"),0),ba=!1}catch{ba=!0}return ba}var kS=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function nu(r){return r!=null&&!kS.has(r)?(Zt(!1,`"${r}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${lo}"`),null):r}function wS(r,e){let t,n,i,s,a;if(CS(r)){let o=r.getAttribute("action");n=o?Qr(o,e):null,t=r.getAttribute("method")||oo,i=nu(r.getAttribute("enctype"))||lo,s=new FormData(r)}else if(AS(r)||LS(r)&&(r.type==="submit"||r.type==="image")){let o=r.form;if(o==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let u=r.getAttribute("formaction")||o.getAttribute("action");if(n=u?Qr(u,e):null,t=r.getAttribute("formmethod")||o.getAttribute("method")||oo,i=nu(r.getAttribute("formenctype"))||nu(o.getAttribute("enctype"))||lo,s=new FormData(o,r),!DS()){let{name:l,type:c,value:d}=r;if(c==="image"){let f=l?`${l}.`:"";s.append(`${f}x`,"0"),s.append(`${f}y`,"0")}else l&&s.append(l,d)}}else{if(xl(r))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=oo,n=null,i=lo,a=r}return s&&i==="text/plain"&&(a=s,s=void 0),{action:n,method:t.toLowerCase(),encType:i,formData:s,body:a}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function wf(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}function bS(r,e,t){let n=typeof r=="string"?new URL(r,typeof window>"u"?"server://singlefetch/":window.location.origin):r;return n.pathname==="/"?n.pathname=`_root.${t}`:e&&Qr(n.pathname,e)==="/"?n.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:n.pathname=`${n.pathname.replace(/\/$/,"")}.${t}`,n}async function PS(r,e){if(r.id in e)return e[r.id];try{let t=await import(r.module);return e[r.id]=t,t}catch(t){return console.error(`Error loading route module \`${r.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function FS(r){return r==null?!1:r.href==null?r.rel==="preload"&&typeof r.imageSrcSet=="string"&&typeof r.imageSizes=="string":typeof r.rel=="string"&&typeof r.href=="string"}async function BS(r,e,t){let n=await Promise.all(r.map(async i=>{let s=e.routes[i.route.id];if(s){let a=await PS(s,t);return a.links?a.links():[]}return[]}));return $S(n.flat(1).filter(FS).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function kh(r,e,t,n,i,s){let a=(u,l)=>t[l]?u.route.id!==t[l].route.id:!0,o=(u,l)=>{var c;return t[l].pathname!==u.pathname||((c=t[l].route.path)==null?void 0:c.endsWith("*"))&&t[l].params["*"]!==u.params["*"]};return s==="assets"?e.filter((u,l)=>a(u,l)||o(u,l)):s==="data"?e.filter((u,l)=>{var d;let c=n.routes[u.route.id];if(!c||!c.hasLoader)return!1;if(a(u,l)||o(u,l))return!0;if(u.route.shouldRevalidate){let f=u.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:((d=t[0])==null?void 0:d.params)||{},nextUrl:new URL(r,window.origin),nextParams:u.params,defaultShouldRevalidate:!0});if(typeof f=="boolean")return f}return!0}):[]}function OS(r,e,{includeHydrateFallback:t}={}){return MS(r.map(n=>{let i=e.routes[n.route.id];if(!i)return[];let s=[i.module];return i.clientActionModule&&(s=s.concat(i.clientActionModule)),i.clientLoaderModule&&(s=s.concat(i.clientLoaderModule)),t&&i.hydrateFallbackModule&&(s=s.concat(i.hydrateFallbackModule)),i.imports&&(s=s.concat(i.imports)),s}).flat(1))}function MS(r){return[...new Set(r)]}function NS(r){let e={},t=Object.keys(r).sort();for(let n of t)e[n]=r[n];return e}function $S(r,e){let t=new Set;return new Set(e),r.reduce((n,i)=>{let s=JSON.stringify(NS(i));return t.has(s)||(t.add(s),n.push({key:s,link:i})),n},[])}function tx(){let r=b.useContext(Wi);return wf(r,"You must render this element inside a <DataRouterContext.Provider> element"),r}function US(){let r=b.useContext(ml);return wf(r,"You must render this element inside a <DataRouterStateContext.Provider> element"),r}var bf=b.createContext(void 0);bf.displayName="FrameworkContext";function rx(){let r=b.useContext(bf);return wf(r,"You must render this element inside a <HydratedRouter> element"),r}function GS(r,e){let t=b.useContext(bf),[n,i]=b.useState(!1),[s,a]=b.useState(!1),{onFocus:o,onBlur:u,onMouseEnter:l,onMouseLeave:c,onTouchStart:d}=e,f=b.useRef(null);b.useEffect(()=>{if(r==="render"&&a(!0),r==="viewport"){let x=y=>{y.forEach(g=>{a(g.isIntersecting)})},v=new IntersectionObserver(x,{threshold:.5});return f.current&&v.observe(f.current),()=>{v.disconnect()}}},[r]),b.useEffect(()=>{if(n){let x=setTimeout(()=>{a(!0)},100);return()=>{clearTimeout(x)}}},[n]);let h=()=>{i(!0)},p=()=>{i(!1),a(!1)};return t?r!=="intent"?[s,f,{}]:[s,f,{onFocus:ls(o,h),onBlur:ls(u,p),onMouseEnter:ls(l,h),onMouseLeave:ls(c,p),onTouchStart:ls(d,h)}]:[!1,f,{}]}function ls(r,e){return t=>{r&&r(t),t.defaultPrevented||e(t)}}function HS({page:r,...e}){let{router:t}=tx(),n=b.useMemo(()=>z1(t.routes,r,t.basename),[t.routes,r,t.basename]);return n?b.createElement(jS,{page:r,matches:n,...e}):null}function VS(r){let{manifest:e,routeModules:t}=rx(),[n,i]=b.useState([]);return b.useEffect(()=>{let s=!1;return BS(r,e,t).then(a=>{s||i(a)}),()=>{s=!0}},[r,e,t]),n}function jS({page:r,matches:e,...t}){let n=Jr(),{manifest:i,routeModules:s}=rx(),{basename:a}=tx(),{loaderData:o,matches:u}=US(),l=b.useMemo(()=>kh(r,e,u,i,n,"data"),[r,e,u,i,n]),c=b.useMemo(()=>kh(r,e,u,i,n,"assets"),[r,e,u,i,n]),d=b.useMemo(()=>{if(r===n.pathname+n.search+n.hash)return[];let p=new Set,x=!1;if(e.forEach(y=>{var m;let g=i.routes[y.route.id];!g||!g.hasLoader||(!l.some(E=>E.route.id===y.route.id)&&y.route.id in o&&((m=s[y.route.id])!=null&&m.shouldRevalidate)||g.hasClientLoader?x=!0:p.add(y.route.id))}),p.size===0)return[];let v=bS(r,a,"data");return x&&p.size>0&&v.searchParams.set("_routes",e.filter(y=>p.has(y.route.id)).map(y=>y.route.id).join(",")),[v.pathname+v.search]},[a,o,n,i,l,e,r,s]),f=b.useMemo(()=>OS(c,i),[c,i]),h=VS(c);return b.createElement(b.Fragment,null,d.map(p=>b.createElement("link",{key:p,rel:"prefetch",as:"fetch",href:p,...t})),f.map(p=>b.createElement("link",{key:p,rel:"modulepreload",href:p,...t})),h.map(({key:p,link:x})=>b.createElement("link",{key:p,nonce:t.nonce,...x})))}function KS(...r){return e=>{r.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var nx=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{nx&&(window.__reactRouterVersion="7.9.6")}catch{}function zS({basename:r,children:e,window:t}){let n=b.useRef();n.current==null&&(n.current=k2({window:t,v5Compat:!0}));let i=n.current,[s,a]=b.useState({action:i.action,location:i.location}),o=b.useCallback(u=>{b.startTransition(()=>a(u))},[a]);return b.useLayoutEffect(()=>i.listen(o),[i,o]),b.createElement(SS,{basename:r,children:e,location:s.location,navigationType:s.action,navigator:i})}var ix=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,sx=b.forwardRef(function({onClick:e,discover:t="render",prefetch:n="none",relative:i,reloadDocument:s,replace:a,state:o,target:u,to:l,preventScrollReset:c,viewTransition:d,...f},h){let{basename:p}=b.useContext(yr),x=typeof l=="string"&&ix.test(l),v,y=!1;if(typeof l=="string"&&x&&(v=l,nx))try{let I=new URL(window.location.href),C=l.startsWith("//")?new URL(I.protocol+l):new URL(l),_=Qr(C.pathname,p);C.origin===I.origin&&_!=null?l=_+C.search+C.hash:y=!0}catch{Zt(!1,`<Link to="${l}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let g=iS(l,{relative:i}),[m,E,T]=GS(n,f),L=XS(l,{replace:a,state:o,target:u,preventScrollReset:c,relative:i,viewTransition:d});function A(I){e&&e(I),I.defaultPrevented||L(I)}let R=b.createElement("a",{...f,...T,href:v||g,onClick:y||s?e:A,ref:KS(h,E),target:u,"data-discover":!x&&t==="render"?"true":void 0});return m&&!x?b.createElement(b.Fragment,null,R,b.createElement(HS,{page:g})):R});sx.displayName="Link";var WS=b.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:n="",end:i=!1,style:s,to:a,viewTransition:o,children:u,...l},c){let d=ia(a,{relative:l.relative}),f=Jr(),h=b.useContext(ml),{navigator:p,basename:x}=b.useContext(yr),v=h!=null&&rT(d)&&o===!0,y=p.encodeLocation?p.encodeLocation(d).pathname:d.pathname,g=f.pathname,m=h&&h.navigation&&h.navigation.location?h.navigation.location.pathname:null;t||(g=g.toLowerCase(),m=m?m.toLowerCase():null,y=y.toLowerCase()),m&&x&&(m=Qr(m,x)||m);const E=y!=="/"&&y.endsWith("/")?y.length-1:y.length;let T=g===y||!i&&g.startsWith(y)&&g.charAt(E)==="/",L=m!=null&&(m===y||!i&&m.startsWith(y)&&m.charAt(y.length)==="/"),A={isActive:T,isPending:L,isTransitioning:v},R=T?e:void 0,I;typeof n=="function"?I=n(A):I=[n,T?"active":null,L?"pending":null,v?"transitioning":null].filter(Boolean).join(" ");let C=typeof s=="function"?s(A):s;return b.createElement(sx,{...l,"aria-current":R,className:I,ref:c,style:C,to:a,viewTransition:o},typeof u=="function"?u(A):u)});WS.displayName="NavLink";var YS=b.forwardRef(({discover:r="render",fetcherKey:e,navigate:t,reloadDocument:n,replace:i,state:s,method:a=oo,action:o,onSubmit:u,relative:l,preventScrollReset:c,viewTransition:d,...f},h)=>{let p=eT(),x=tT(o,{relative:l}),v=a.toLowerCase()==="get"?"get":"post",y=typeof o=="string"&&ix.test(o),g=m=>{if(u&&u(m),m.defaultPrevented)return;m.preventDefault();let E=m.nativeEvent.submitter,T=(E==null?void 0:E.getAttribute("formmethod"))||a;p(E||m.currentTarget,{fetcherKey:e,method:T,navigate:t,replace:i,state:s,relative:l,preventScrollReset:c,viewTransition:d})};return b.createElement("form",{ref:h,method:v,action:x,onSubmit:n?u:g,...f,"data-discover":!y&&r==="render"?"true":void 0})});YS.displayName="Form";function qS(r){return`${r} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function ax(r){let e=b.useContext(Wi);return Pe(e,qS(r)),e}function XS(r,{target:e,replace:t,state:n,preventScrollReset:i,relative:s,viewTransition:a}={}){let o=_f(),u=Jr(),l=ia(r,{relative:s});return b.useCallback(c=>{if(IS(c,e)){c.preventDefault();let d=t!==void 0?t:js(u)===js(l);o(r,{replace:d,state:n,preventScrollReset:i,relative:s,viewTransition:a})}},[u,o,l,t,n,e,r,i,s,a])}function QS(r){Zt(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=b.useRef(od(r)),t=b.useRef(!1),n=Jr(),i=b.useMemo(()=>_S(n.search,t.current?null:e.current),[n.search]),s=_f(),a=b.useCallback((o,u)=>{const l=od(typeof o=="function"?o(new URLSearchParams(i)):o);t.current=!0,s("?"+l,u)},[s,i]);return[i,a]}var ZS=0,JS=()=>`__${String(++ZS)}__`;function eT(){let{router:r}=ax("useSubmit"),{basename:e}=b.useContext(yr),t=mS();return b.useCallback(async(n,i={})=>{let{action:s,method:a,encType:o,formData:u,body:l}=wS(n,e);if(i.navigate===!1){let c=i.fetcherKey||JS();await r.fetch(c,t,i.action||s,{preventScrollReset:i.preventScrollReset,formData:u,body:l,formMethod:i.method||a,formEncType:i.encType||o,flushSync:i.flushSync})}else await r.navigate(i.action||s,{preventScrollReset:i.preventScrollReset,formData:u,body:l,formMethod:i.method||a,formEncType:i.encType||o,replace:i.replace,state:i.state,fromRouteId:t,flushSync:i.flushSync,viewTransition:i.viewTransition})},[r,e,t])}function tT(r,{relative:e}={}){let{basename:t}=b.useContext(yr),n=b.useContext(Er);Pe(n,"useFormAction must be used inside a RouteContext");let[i]=n.matches.slice(-1),s={...ia(r||".",{relative:e})},a=Jr();if(r==null){s.search=a.search;let o=new URLSearchParams(s.search),u=o.getAll("index");if(u.some(c=>c==="")){o.delete("index"),u.filter(d=>d).forEach(d=>o.append("index",d));let c=o.toString();s.search=c?`?${c}`:""}}return(!r||r===".")&&i.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(s.pathname=s.pathname==="/"?t:zr([t,s.pathname])),js(s)}function rT(r,{relative:e}={}){let t=b.useContext(X1);Pe(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=ax("useViewTransitionState"),i=ia(r,{relative:e});if(!t.isTransitioning)return!1;let s=Qr(t.currentLocation.pathname,n)||t.currentLocation.pathname,a=Qr(t.nextLocation.pathname,n)||t.nextLocation.pathname;return Ho(i.pathname,a)!=null||Ho(i.pathname,s)!=null}const Z=Number.isFinite||function(r){return typeof r=="number"&&isFinite(r)},nT=Number.isSafeInteger||function(r){return typeof r=="number"&&Math.abs(r)<=iT},iT=Number.MAX_SAFE_INTEGER||9007199254740991;let re=function(r){return r.NETWORK_ERROR="networkError",r.MEDIA_ERROR="mediaError",r.KEY_SYSTEM_ERROR="keySystemError",r.MUX_ERROR="muxError",r.OTHER_ERROR="otherError",r}({}),N=function(r){return r.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",r.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",r.KEY_SYSTEM_NO_SESSION="keySystemNoSession",r.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",r.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",r.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",r.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",r.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",r.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",r.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",r.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",r.MANIFEST_LOAD_ERROR="manifestLoadError",r.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",r.MANIFEST_PARSING_ERROR="manifestParsingError",r.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",r.LEVEL_EMPTY_ERROR="levelEmptyError",r.LEVEL_LOAD_ERROR="levelLoadError",r.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",r.LEVEL_PARSING_ERROR="levelParsingError",r.LEVEL_SWITCH_ERROR="levelSwitchError",r.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",r.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",r.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",r.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",r.FRAG_LOAD_ERROR="fragLoadError",r.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",r.FRAG_DECRYPT_ERROR="fragDecryptError",r.FRAG_PARSING_ERROR="fragParsingError",r.FRAG_GAP="fragGap",r.REMUX_ALLOC_ERROR="remuxAllocError",r.KEY_LOAD_ERROR="keyLoadError",r.KEY_LOAD_TIMEOUT="keyLoadTimeOut",r.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",r.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",r.BUFFER_APPEND_ERROR="bufferAppendError",r.BUFFER_APPENDING_ERROR="bufferAppendingError",r.BUFFER_STALLED_ERROR="bufferStalledError",r.BUFFER_FULL_ERROR="bufferFullError",r.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",r.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",r.ASSET_LIST_LOAD_ERROR="assetListLoadError",r.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",r.ASSET_LIST_PARSING_ERROR="assetListParsingError",r.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",r.INTERNAL_EXCEPTION="internalException",r.INTERNAL_ABORTED="aborted",r.ATTACH_MEDIA_ERROR="attachMediaError",r.UNKNOWN="unknown",r}({}),S=function(r){return r.MEDIA_ATTACHING="hlsMediaAttaching",r.MEDIA_ATTACHED="hlsMediaAttached",r.MEDIA_DETACHING="hlsMediaDetaching",r.MEDIA_DETACHED="hlsMediaDetached",r.MEDIA_ENDED="hlsMediaEnded",r.STALL_RESOLVED="hlsStallResolved",r.BUFFER_RESET="hlsBufferReset",r.BUFFER_CODECS="hlsBufferCodecs",r.BUFFER_CREATED="hlsBufferCreated",r.BUFFER_APPENDING="hlsBufferAppending",r.BUFFER_APPENDED="hlsBufferAppended",r.BUFFER_EOS="hlsBufferEos",r.BUFFERED_TO_END="hlsBufferedToEnd",r.BUFFER_FLUSHING="hlsBufferFlushing",r.BUFFER_FLUSHED="hlsBufferFlushed",r.MANIFEST_LOADING="hlsManifestLoading",r.MANIFEST_LOADED="hlsManifestLoaded",r.MANIFEST_PARSED="hlsManifestParsed",r.LEVEL_SWITCHING="hlsLevelSwitching",r.LEVEL_SWITCHED="hlsLevelSwitched",r.LEVEL_LOADING="hlsLevelLoading",r.LEVEL_LOADED="hlsLevelLoaded",r.LEVEL_UPDATED="hlsLevelUpdated",r.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",r.LEVELS_UPDATED="hlsLevelsUpdated",r.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",r.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",r.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",r.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",r.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",r.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",r.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",r.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",r.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",r.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",r.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",r.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",r.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",r.CUES_PARSED="hlsCuesParsed",r.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",r.INIT_PTS_FOUND="hlsInitPtsFound",r.FRAG_LOADING="hlsFragLoading",r.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",r.FRAG_LOADED="hlsFragLoaded",r.FRAG_DECRYPTED="hlsFragDecrypted",r.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",r.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",r.FRAG_PARSING_METADATA="hlsFragParsingMetadata",r.FRAG_PARSED="hlsFragParsed",r.FRAG_BUFFERED="hlsFragBuffered",r.FRAG_CHANGED="hlsFragChanged",r.FPS_DROP="hlsFpsDrop",r.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",r.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",r.ERROR="hlsError",r.DESTROYING="hlsDestroying",r.KEY_LOADING="hlsKeyLoading",r.KEY_LOADED="hlsKeyLoaded",r.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",r.BACK_BUFFER_REACHED="hlsBackBufferReached",r.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",r.ASSET_LIST_LOADING="hlsAssetListLoading",r.ASSET_LIST_LOADED="hlsAssetListLoaded",r.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",r.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",r.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",r.INTERSTITIAL_STARTED="hlsInterstitialStarted",r.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",r.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",r.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",r.INTERSTITIAL_ENDED="hlsInterstitialEnded",r.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",r.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",r.EVENT_CUE_ENTER="hlsEventCueEnter",r}({});var me={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},ee={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class ii{constructor(e,t=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){const n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class sT{constructor(e,t,n,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new ii(e),this.fast_=new ii(t),this.defaultTTFB_=i,this.ttfb_=new ii(e)}update(e,t){const{slow_:n,fast_:i,ttfb_:s}=this;n.halfLife!==e&&(this.slow_=new ii(e,n.getEstimate(),n.getTotalWeight())),i.halfLife!==t&&(this.fast_=new ii(t,i.getEstimate(),i.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new ii(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const n=8*t,i=e/1e3,s=n/i;this.fast_.sample(i,s),this.slow_.sample(i,s)}sampleTTFB(e){const t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function aT(r,e,t){return(e=lT(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Re(){return Re=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Re.apply(null,arguments)}function wh(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function Ae(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?wh(Object(t),!0).forEach(function(n){aT(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):wh(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function oT(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function lT(r){var e=oT(r,"string");return typeof e=="symbol"?e:e+""}class lr{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const n=`[${e}]:`;this.trace=on,this.debug=t.debug.bind(null,n),this.log=t.log.bind(null,n),this.warn=t.warn.bind(null,n),this.info=t.info.bind(null,n),this.error=t.error.bind(null,n)}}const on=function(){},uT={trace:on,debug:on,log:on,warn:on,info:on,error:on};function ld(){return Re({},uT)}function cT(r,e){const t=self.console[r];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${r}] >`):on}function bh(r,e,t){return e[r]?e[r].bind(e):cT(r,t)}const ud=ld();function dT(r,e,t){const n=ld();if(typeof console=="object"&&r===!0||typeof r=="object"){const i=["debug","log","info","warn","error"];i.forEach(s=>{n[s]=bh(s,r,t)});try{n.log(`Debug logs enabled for "${e}" in hls.js version 1.6.14`)}catch{return ld()}i.forEach(s=>{ud[s]=bh(s,r)})}else Re(ud,n);return n}const Ce=ud;function An(r=!0){return typeof self>"u"?void 0:(r||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function fT(r){return typeof self<"u"&&r===self.ManagedMediaSource}function ox(r,e){const t=Object.keys(r),n=Object.keys(e),i=t.length,s=n.length;return!i||!s||i===s&&!t.some(a=>n.indexOf(a)===-1)}function Xt(r,e=!1){if(typeof TextDecoder<"u"){const l=new TextDecoder("utf-8").decode(r);if(e){const c=l.indexOf("\0");return c!==-1?l.substring(0,c):l}return l.replace(/\0/g,"")}const t=r.length;let n,i,s,a="",o=0;for(;o<t;){if(n=r[o++],n===0&&e)return a;if(n===0||n===3)continue;switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(n);break;case 12:case 13:i=r[o++],a+=String.fromCharCode((n&31)<<6|i&63);break;case 14:i=r[o++],s=r[o++],a+=String.fromCharCode((n&15)<<12|(i&63)<<6|(s&63)<<0);break}}return a}function Lt(r){let e="";for(let t=0;t<r.length;t++){let n=r[t].toString(16);n.length<2&&(n="0"+n),e+=n}return e}function lx(r){return Uint8Array.from(r.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function hT(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var iu={exports:{}},Ph;function pT(){return Ph||(Ph=1,function(r,e){(function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(u,l,c){if(c=c||{},u=u.trim(),l=l.trim(),!l){if(!c.alwaysNormalize)return u;var d=o.parseURL(u);if(!d)throw new Error("Error trying to parse base URL.");return d.path=o.normalizePath(d.path),o.buildURLFromParts(d)}var f=o.parseURL(l);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return c.alwaysNormalize?(f.path=o.normalizePath(f.path),o.buildURLFromParts(f)):l;var h=o.parseURL(u);if(!h)throw new Error("Error trying to parse base URL.");if(!h.netLoc&&h.path&&h.path[0]!=="/"){var p=i.exec(h.path);h.netLoc=p[1],h.path=p[2]}h.netLoc&&!h.path&&(h.path="/");var x={scheme:h.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(x.netLoc=h.netLoc,f.path[0]!=="/"))if(!f.path)x.path=h.path,f.params||(x.params=h.params,f.query||(x.query=h.query));else{var v=h.path,y=v.substring(0,v.lastIndexOf("/")+1)+f.path;x.path=o.normalizePath(y)}return x.path===null&&(x.path=c.alwaysNormalize?o.normalizePath(f.path):f.path),o.buildURLFromParts(x)},parseURL:function(u){var l=n.exec(u);return l?{scheme:l[1]||"",netLoc:l[2]||"",path:l[3]||"",params:l[4]||"",query:l[5]||"",fragment:l[6]||""}:null},normalizePath:function(u){for(u=u.split("").reverse().join("").replace(s,"");u.length!==(u=u.replace(a,"")).length;);return u.split("").reverse().join("")},buildURLFromParts:function(u){return u.scheme+u.netLoc+u.path+u.params+u.query+u.fragment}};r.exports=o})()}(iu)),iu.exports}var Pf=pT();class Ff{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Ie={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class ux{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,mT(this,"stats")}setByteRange(e,t){const n=e.split("@",2);let i;n.length===1?i=(t==null?void 0:t.byteRangeEndOffset)||0:i=parseInt(n[1]),this._byteRange=[i,parseInt(n[0])+i]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Ie.AUDIO]:null,[Ie.VIDEO]:null,[Ie.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Ff),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Pf.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Ie.AUDIO]=null,e[Ie.VIDEO]=null,e[Ie.AUDIOVIDEO]=null}}function Xe(r){return r.sn!=="initSegment"}class su extends ux{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(Z(e)&&Z(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const n=Object.keys(t);if(n.length===1){const i=this._decryptdata=t[n[0]]||null;i&&(this._decryptdata=i.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=Z(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const n=Object.keys(this.levelkeys),i=n.length;if(i>1||i===1&&(t=this.levelkeys[n[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!Z(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Xe(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var n;const i=t[e];i&&!((n=this._decryptdata)!=null&&n.keyId)&&(this._decryptdata=i.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,n,i,s,a=!1){const{elementaryStreams:o}=this,u=o[e];if(!u){o[e]={startPTS:t,endPTS:n,startDTS:i,endDTS:s,partial:a};return}u.startPTS=Math.min(u.startPTS,t),u.endPTS=Math.max(u.endPTS,n),u.startDTS=Math.min(u.startDTS,i),u.endDTS=Math.max(u.endDTS,s)}}class gT extends ux{constructor(e,t,n,i,s){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function cx(r,e){const t=Object.getPrototypeOf(r);if(t){const n=Object.getOwnPropertyDescriptor(t,e);return n||cx(t,e)}}function mT(r,e){const t=cx(r,e);t&&(t.enumerable=!0,Object.defineProperty(r,e,t))}const Fh=Math.pow(2,32)-1,xT=[].push,dx={video:1,audio:2,id3:3,text:4};function Ze(r){return String.fromCharCode.apply(null,r)}function fx(r,e){const t=r[e]<<8|r[e+1];return t<0?65536+t:t}function ae(r,e){const t=hx(r,e);return t<0?4294967296+t:t}function Bh(r,e){let t=ae(r,e);return t*=Math.pow(2,32),t+=ae(r,e+4),t}function hx(r,e){return r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3]}function vT(r){const e=r.byteLength;for(let t=0;t<e;){const n=ae(r,t);if(n>8&&r[t+4]===109&&r[t+5]===111&&r[t+6]===111&&r[t+7]===102)return!0;t=n>1?t+n:e}return!1}function pe(r,e){const t=[];if(!e.length)return t;const n=r.byteLength;for(let i=0;i<n;){const s=ae(r,i),a=Ze(r.subarray(i+4,i+8)),o=s>1?i+s:n;if(a===e[0])if(e.length===1)t.push(r.subarray(i+8,o));else{const u=pe(r.subarray(i+8,o),e.slice(1));u.length&&xT.apply(t,u)}i=o}return t}function yT(r){const e=[],t=r[0];let n=8;const i=ae(r,n);n+=4;let s=0,a=0;t===0?(s=ae(r,n),a=ae(r,n+4),n+=8):(s=Bh(r,n),a=Bh(r,n+8),n+=16),n+=2;let o=r.length+a;const u=fx(r,n);n+=2;for(let l=0;l<u;l++){let c=n;const d=ae(r,c);c+=4;const f=d&2147483647;if((d&2147483648)>>>31===1)return Ce.warn("SIDX has hierarchical references (not supported)"),null;const p=ae(r,c);c+=4,e.push({referenceSize:f,subsegmentDuration:p,info:{duration:p/i,start:o,end:o+f-1}}),o+=f,c+=4,n=c}return{earliestPresentationTime:s,timescale:i,version:t,referencesCount:u,references:e}}function px(r){const e=[],t=pe(r,["moov","trak"]);for(let i=0;i<t.length;i++){const s=t[i],a=pe(s,["tkhd"])[0];if(a){let o=a[0];const u=ae(a,o===0?12:20),l=pe(s,["mdia","mdhd"])[0];if(l){o=l[0];const c=ae(l,o===0?12:20),d=pe(s,["mdia","hdlr"])[0];if(d){const f=Ze(d.subarray(8,12)),h={soun:Ie.AUDIO,vide:Ie.VIDEO}[f],p=pe(s,["mdia","minf","stbl","stsd"])[0],x=ET(p);h?(e[u]={timescale:c,type:h,stsd:x},e[h]=Ae({timescale:c,id:u},x)):e[u]={timescale:c,type:f,stsd:x}}}}}return pe(r,["moov","mvex","trex"]).forEach(i=>{const s=ae(i,4),a=e[s];a&&(a.default={duration:ae(i,12),flags:ae(i,20)})}),e}function ET(r){const e=r.subarray(8),t=e.subarray(86),n=Ze(e.subarray(4,8));let i=n,s;const a=n==="enca"||n==="encv";if(a){const l=pe(e,[n])[0].subarray(n==="enca"?28:78);pe(l,["sinf"]).forEach(d=>{const f=pe(d,["schm"])[0];if(f){const h=Ze(f.subarray(4,8));if(h==="cbcs"||h==="cenc"){const p=pe(d,["frma"])[0];p&&(i=Ze(p))}}})}const o=i;switch(i){case"avc1":case"avc2":case"avc3":case"avc4":{const u=pe(t,["avcC"])[0];u&&u.length>3&&(i+="."+Fa(u[1])+Fa(u[2])+Fa(u[3]),s=Pa(o==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const u=pe(e,[n])[0],l=pe(u.subarray(28),["esds"])[0];if(l&&l.length>7){let c=4;if(l[c++]!==3)break;c=au(l,c),c+=2;const d=l[c++];if(d&128&&(c+=2),d&64&&(c+=l[c++]),l[c++]!==4)break;c=au(l,c);const f=l[c++];if(f===64)i+="."+Fa(f);else break;if(c+=12,l[c++]!==5)break;c=au(l,c);const h=l[c++];let p=(h&248)>>3;p===31&&(p+=1+((h&7)<<3)+((l[c]&224)>>5)),i+="."+p}break}case"hvc1":case"hev1":{const u=pe(t,["hvcC"])[0];if(u&&u.length>12){const l=u[1],c=["","A","B","C"][l>>6],d=l&31,f=ae(u,2),h=(l&32)>>5?"H":"L",p=u[12],x=u.subarray(6,12);i+="."+c+d,i+="."+ST(f).toString(16).toUpperCase(),i+="."+h+p;let v="";for(let y=x.length;y--;){const g=x[y];(g||v)&&(v="."+g.toString(16).toUpperCase()+v)}i+=v}s=Pa(o=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{i=Pa(i,t)||i;break}case"vp09":{const u=pe(t,["vpcC"])[0];if(u&&u.length>6){const l=u[4],c=u[5],d=u[6]>>4&15;i+="."+Rr(l)+"."+Rr(c)+"."+Rr(d)}break}case"av01":{const u=pe(t,["av1C"])[0];if(u&&u.length>2){const l=u[1]>>>5,c=u[1]&31,d=u[2]>>>7?"H":"M",f=(u[2]&64)>>6,h=(u[2]&32)>>5,p=l===2&&f?h?12:10:f?10:8,x=(u[2]&16)>>4,v=(u[2]&8)>>3,y=(u[2]&4)>>2,g=u[2]&3;i+="."+l+"."+Rr(c)+d+"."+Rr(p)+"."+x+"."+v+y+g+"."+Rr(1)+"."+Rr(1)+"."+Rr(1)+"."+0,s=Pa("dav1",t)}break}}return{codec:i,encrypted:a,supplemental:s}}function Pa(r,e){const t=pe(e,["dvvC"]),n=t.length?t[0]:pe(e,["dvcC"])[0];if(n){const i=n[2]>>1&127,s=n[2]<<5&32|n[3]>>3&31;return r+"."+Rr(i)+"."+Rr(s)}}function ST(r){let e=0;for(let t=0;t<32;t++)e|=(r>>t&1)<<31-t;return e>>>0}function au(r,e){const t=e+5;for(;r[e++]&128&&e<t;);return e}function Fa(r){return("0"+r.toString(16).toUpperCase()).slice(-2)}function Rr(r){return(r<10?"0":"")+r}function TT(r,e){if(!r||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&gx(r,(n,i)=>{const s=n.subarray(8,24);s.some(a=>a!==0)||(Ce.log(`[eme] Patching keyId in 'enc${i?"a":"v"}>sinf>>tenc' box: ${Lt(s)} -> ${Lt(t)}`),n.set(t,8))})}function AT(r){const e=[];return gx(r,t=>e.push(t.subarray(8,24))),e}function gx(r,e){pe(r,["moov","trak"]).forEach(n=>{const i=pe(n,["mdia","minf","stbl","stsd"])[0];if(!i)return;const s=i.subarray(8);let a=pe(s,["enca"]);const o=a.length>0;o||(a=pe(s,["encv"])),a.forEach(u=>{const l=o?u.subarray(28):u.subarray(78);pe(l,["sinf"]).forEach(d=>{const f=mx(d);f&&e(f,o)})})})}function mx(r){const e=pe(r,["schm"])[0];if(e){const t=Ze(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const n=pe(r,["schi","tenc"])[0];if(n)return n}}}function CT(r,e,t){const n={},i=pe(r,["moof","traf"]);for(let s=0;s<i.length;s++){const a=i[s],o=pe(a,["tfhd"])[0],u=ae(o,4),l=e[u];if(!l)continue;n[u]||(n[u]={start:NaN,duration:0,sampleCount:0,timescale:l.timescale,type:l.type});const c=n[u],d=pe(a,["tfdt"])[0];if(d){const m=d[0];let E=ae(d,4);m===1&&(E===Fh?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(E*=Fh+1,E+=ae(d,8))),Z(E)&&(!Z(c.start)||E<c.start)&&(c.start=E)}const f=l.default,h=ae(o,0)|(f==null?void 0:f.flags);let p=(f==null?void 0:f.duration)||0;h&8&&(h&2?p=ae(o,12):p=ae(o,8));const x=pe(a,["trun"]);let v=c.start||0,y=0,g=p;for(let m=0;m<x.length;m++){const E=x[m],T=ae(E,4),L=c.sampleCount;c.sampleCount+=T;const A=E[3]&1,R=E[3]&4,I=E[2]&1,C=E[2]&2,_=E[2]&4,F=E[2]&8;let B=8,V=T;for(A&&(B+=4),R&&T&&(!(E[B+1]&1)&&c.keyFrameIndex===void 0&&(c.keyFrameIndex=L),B+=4,I?(g=ae(E,B),B+=4):g=p,C&&(B+=4),F&&(B+=4),v+=g,y+=g,V--);V--;)I?(g=ae(E,B),B+=4):g=p,C&&(B+=4),_&&(E[B+1]&1||c.keyFrameIndex===void 0&&(c.keyFrameIndex=c.sampleCount-(V+1),c.keyFrameStart=v),B+=4),F&&(B+=4),v+=g,y+=g;!y&&p&&(y+=p*T)}c.duration+=y}if(!Object.keys(n).some(s=>n[s].duration)){let s=1/0,a=0;const o=pe(r,["sidx"]);for(let u=0;u<o.length;u++){const l=yT(o[u]);if(l!=null&&l.references){s=Math.min(s,l.earliestPresentationTime/l.timescale);const c=l.references.reduce((d,f)=>d+f.info.duration||0,0);a=Math.max(a,c+l.earliestPresentationTime/l.timescale)}}a&&Z(a)&&Object.keys(n).forEach(u=>{n[u].duration||(n[u].duration=a*n[u].timescale-n[u].start)})}return n}function LT(r){const e={valid:null,remainder:null},t=pe(r,["moof"]);if(t.length<2)return e.remainder=r,e;const n=t[t.length-1];return e.valid=r.slice(0,n.byteOffset-8),e.remainder=r.slice(n.byteOffset-8),e}function or(r,e){const t=new Uint8Array(r.length+e.length);return t.set(r),t.set(e,r.length),t}function Oh(r,e){const t=[],n=e.samples,i=e.timescale,s=e.id;let a=!1;return pe(n,["moof"]).map(u=>{const l=u.byteOffset-8;pe(u,["traf"]).map(d=>{const f=pe(d,["tfdt"]).map(h=>{const p=h[0];let x=ae(h,4);return p===1&&(x*=Math.pow(2,32),x+=ae(h,8)),x/i})[0];return f!==void 0&&(r=f),pe(d,["tfhd"]).map(h=>{const p=ae(h,4),x=ae(h,0)&16777215,v=(x&1)!==0,y=(x&2)!==0,g=(x&8)!==0;let m=0;const E=(x&16)!==0;let T=0;const L=(x&32)!==0;let A=8;p===s&&(v&&(A+=8),y&&(A+=4),g&&(m=ae(h,A),A+=4),E&&(T=ae(h,A),A+=4),L&&(A+=4),e.type==="video"&&(a=vl(e.codec)),pe(d,["trun"]).map(R=>{const I=R[0],C=ae(R,0)&16777215,_=(C&1)!==0;let F=0;const B=(C&4)!==0,V=(C&256)!==0;let j=0;const G=(C&512)!==0;let Y=0;const O=(C&1024)!==0,H=(C&2048)!==0;let K=0;const w=ae(R,4);let P=8;_&&(F=ae(R,P),P+=4),B&&(P+=4);let U=F+l;for(let $=0;$<w;$++){if(V?(j=ae(R,P),P+=4):j=m,G?(Y=ae(R,P),P+=4):Y=T,O&&(P+=4),H&&(I===0?K=ae(R,P):K=hx(R,P),P+=4),e.type===Ie.VIDEO){let Q=0;for(;Q<Y;){const J=ae(n,U);if(U+=4,RT(a,n[U])){const he=n.subarray(U,U+J);Bf(he,a?2:1,r+K/i,t)}U+=J,Q+=J+4}}r+=j/i}}))})})}),t}function vl(r){if(!r)return!1;const e=r.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function RT(r,e){if(r){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Bf(r,e,t,n){const i=xx(r);let s=0;s+=e;let a=0,o=0,u=0;for(;s<i.length;){a=0;do{if(s>=i.length)break;u=i[s++],a+=u}while(u===255);o=0;do{if(s>=i.length)break;u=i[s++],o+=u}while(u===255);const l=i.length-s;let c=s;if(o<l)s+=o;else if(o>l){Ce.error(`Malformed SEI payload. ${o} is too small, only ${l} bytes left to parse.`);break}if(a===4){if(i[c++]===181){const f=fx(i,c);if(c+=2,f===49){const h=ae(i,c);if(c+=4,h===1195456820){const p=i[c++];if(p===3){const x=i[c++],v=31&x,y=64&x,g=y?2+v*3:0,m=new Uint8Array(g);if(y){m[0]=x;for(let E=1;E<g;E++)m[E]=i[c++]}n.push({type:p,payloadType:a,pts:t,bytes:m})}}}}}else if(a===5&&o>16){const d=[];for(let p=0;p<16;p++){const x=i[c++].toString(16);d.push(x.length==1?"0"+x:x),(p===3||p===5||p===7||p===9)&&d.push("-")}const f=o-16,h=new Uint8Array(f);for(let p=0;p<f;p++)h[p]=i[c++];n.push({payloadType:a,pts:t,uuid:d.join(""),userData:Xt(h),userDataBytes:h})}}}function xx(r){const e=r.byteLength,t=[];let n=1;for(;n<e-2;)r[n]===0&&r[n+1]===0&&r[n+2]===3?(t.push(n+2),n+=2):n++;if(t.length===0)return r;const i=e-t.length,s=new Uint8Array(i);let a=0;for(n=0;n<i;a++,n++)a===t[0]&&(a++,t.shift()),s[n]=r[a];return s}function IT(r){const e=r[0];let t="",n="",i=0,s=0,a=0,o=0,u=0,l=0;if(e===0){for(;Ze(r.subarray(l,l+1))!=="\0";)t+=Ze(r.subarray(l,l+1)),l+=1;for(t+=Ze(r.subarray(l,l+1)),l+=1;Ze(r.subarray(l,l+1))!=="\0";)n+=Ze(r.subarray(l,l+1)),l+=1;n+=Ze(r.subarray(l,l+1)),l+=1,i=ae(r,12),s=ae(r,16),o=ae(r,20),u=ae(r,24),l=28}else if(e===1){l+=4,i=ae(r,l),l+=4;const d=ae(r,l);l+=4;const f=ae(r,l);for(l+=4,a=2**32*d+f,nT(a)||(a=Number.MAX_SAFE_INTEGER,Ce.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=ae(r,l),l+=4,u=ae(r,l),l+=4;Ze(r.subarray(l,l+1))!=="\0";)t+=Ze(r.subarray(l,l+1)),l+=1;for(t+=Ze(r.subarray(l,l+1)),l+=1;Ze(r.subarray(l,l+1))!=="\0";)n+=Ze(r.subarray(l,l+1)),l+=1;n+=Ze(r.subarray(l,l+1)),l+=1}const c=r.subarray(l,r.byteLength);return{schemeIdUri:t,value:n,timeScale:i,presentationTime:a,presentationTimeDelta:s,eventDuration:o,id:u,payload:c}}function _T(r,...e){const t=e.length;let n=8,i=t;for(;i--;)n+=e[i].byteLength;const s=new Uint8Array(n);for(s[0]=n>>24&255,s[1]=n>>16&255,s[2]=n>>8&255,s[3]=n&255,s.set(r,4),i=0,n=8;i<t;i++)s.set(e[i],n),n+=e[i].byteLength;return s}function DT(r,e,t){if(r.byteLength!==16)throw new RangeError("Invalid system id");let n,i;n=0,i=new Uint8Array;let s;n>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;const a=new Uint8Array(4);return t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),_T([112,115,115,104],new Uint8Array([n,0,0,0]),r,s,i,a,t)}function kT(r){const e=[];if(r instanceof ArrayBuffer){const t=r.byteLength;let n=0;for(;n+32<t;){const i=new DataView(r,n),s=wT(i);e.push(s),n+=s.size}}return e}function wT(r){const e=r.getUint32(0),t=r.byteOffset,n=r.byteLength;if(n<e)return{offset:t,size:n};if(r.getUint32(4)!==1886614376)return{offset:t,size:e};const s=r.getUint32(8)>>>24;if(s!==0&&s!==1)return{offset:t,size:e};const a=r.buffer,o=Lt(new Uint8Array(a,t+12,16));let u=null,l=null,c=0;if(s===0)c=28;else{const f=r.getUint32(28);if(!f||n<32+f*16)return{offset:t,size:e};u=[];for(let h=0;h<f;h++)u.push(new Uint8Array(a,t+32+h*16,16));c=32+f*16}if(!c)return{offset:t,size:e};const d=r.getUint32(c);return e-32<d?{offset:t,size:e}:(l=new Uint8Array(a,t+c+4,d),{version:s,systemId:o,kids:u,data:l,offset:t,size:e})}const vx=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Gi={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Of(r,e){const t=Gi[e];return!!t&&!!t[r.slice(0,4)]}function Ks(r,e,t=!0){return!r.split(",").some(n=>!Mf(n,e,t))}function Mf(r,e,t=!0){var n;const i=An(t);return(n=i==null?void 0:i.isTypeSupported(zs(r,e)))!=null?n:!1}function zs(r,e){return`${e}/mp4;codecs=${r}`}function Mh(r){if(r){const e=r.substring(0,4);return Gi.video[e]}return 2}function Vo(r){const e=vx();return r.split(",").reduce((t,n)=>{const s=e&&vl(n)?9:Gi.video[n];return s?(s*2+t)/(t?3:2):(Gi.audio[n]+t)/(t?2:1)},0)}const ou={};function bT(r,e=!0){if(ou[r])return ou[r];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[r];for(let i=0;i<t.length;i++){var n;if(Mf(t[i],"audio",e))return ou[r]=t[i],t[i];if(t[i]==="mp3"&&(n=An(e))!=null&&n.isTypeSupported("audio/mpeg"))return""}return r}const PT=/flac|opus|mp4a\.40\.34/i;function jo(r,e=!0){return r.replace(PT,t=>bT(t.toLowerCase(),e))}function FT(r,e){const t=[];if(r){const n=r.split(",");for(let i=0;i<n.length;i++)Of(n[i],"video")||t.push(n[i])}return e&&t.push(e),t.join(",")}function uo(r,e){if(r&&(r.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(r)!==-1)&&(Nh(r,"audio")||Nh(r,"video")))return r;if(e){const t=e.split(",");if(t.length>1){if(r){for(let n=t.length;n--;)if(t[n].substring(0,4)===r.substring(0,4))return t[n]}return t[0]}}return e||r}function Nh(r,e){return Of(r,e)&&Mf(r,e)}function BT(r){const e=r.split(",");for(let t=0;t<e.length;t++){const n=e[t].split(".");n.length>2&&n[0]==="avc1"&&(e[t]=`avc1.${parseInt(n[1]).toString(16)}${("000"+parseInt(n[2]).toString(16)).slice(-4)}`)}return e.join(",")}function OT(r){if(r.startsWith("av01.")){const e=r.split("."),t=["0","111","01","01","01","0"];for(let n=e.length;n>4&&n<10;n++)e[n]=t[n-4];return e.join(".")}return r}function $h(r){const e=An(r)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function cd(r){return r.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const MT={supported:!0,powerEfficient:!0,smooth:!0},NT={supported:!1,smooth:!1,powerEfficient:!1},yx={supported:!0,configurations:[],decodingInfoResults:[MT]};function Ex(r,e){return{supported:!1,configurations:e,decodingInfoResults:[NT],error:r}}function $T(r,e,t,n,i,s){const a=r.videoCodec,o=r.audioCodec?r.audioGroups:null,u=s==null?void 0:s.audioCodec,l=s==null?void 0:s.channels,c=l?parseInt(l):u?1/0:2;let d=null;if(o!=null&&o.length)try{o.length===1&&o[0]?d=e.groups[o[0]].channels:d=o.reduce((f,h)=>{if(h){const p=e.groups[h];if(!p)throw new Error(`Audio track group ${h} not found`);Object.keys(p.channels).forEach(x=>{f[x]=(f[x]||0)+p.channels[x]})}return f},{2:0})}catch{return!0}return a!==void 0&&(a.split(",").some(f=>vl(f))||r.width>1920&&r.height>1088||r.height>1920&&r.width>1088||r.frameRate>Math.max(n,30)||r.videoRange!=="SDR"&&r.videoRange!==t||r.bitrate>Math.max(i,8e6))||!!d&&Z(c)&&Object.keys(d).some(f=>parseInt(f)>c)}function Sx(r,e,t,n={}){const i=r.videoCodec;if(!i&&!r.audioCodec||!t)return Promise.resolve(yx);const s=[],a=UT(r),o=a.length,u=GT(r,e,o>0),l=u.length;for(let c=o||1*l||1;c--;){const d={type:"media-source"};if(o&&(d.video=a[c%o]),l){d.audio=u[c%l];const f=d.audio.bitrate;d.video&&f&&(d.video.bitrate-=f)}s.push(d)}if(i){const c=navigator.userAgent;if(i.split(",").some(d=>vl(d))&&vx())return Promise.resolve(Ex(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${c})`),s))}return Promise.all(s.map(c=>{const d=VT(c);return n[d]||(n[d]=t.decodingInfo(c))})).then(c=>({supported:!c.some(d=>!d.supported),configurations:s,decodingInfoResults:c})).catch(c=>({supported:!1,configurations:s,decodingInfoResults:[],error:c}))}function UT(r){var e;const t=(e=r.videoCodec)==null?void 0:e.split(","),n=Tx(r),i=r.width||640,s=r.height||480,a=r.frameRate||30,o=r.videoRange.toLowerCase();return t?t.map(u=>{const l={contentType:zs(OT(u),"video"),width:i,height:s,bitrate:n,framerate:a};return o!=="sdr"&&(l.transferFunction=o),l}):[]}function GT(r,e,t){var n;const i=(n=r.audioCodec)==null?void 0:n.split(","),s=Tx(r);return i&&r.audioGroups?r.audioGroups.reduce((a,o)=>{var u;const l=o?(u=e.groups[o])==null?void 0:u.tracks:null;return l?l.reduce((c,d)=>{if(d.groupId===o){const f=parseFloat(d.channels||"");i.forEach(h=>{const p={contentType:zs(h,"audio"),bitrate:t?HT(h,s):s};f&&(p.channels=""+f),c.push(p)})}return c},a):a},[]):[]}function HT(r,e){if(e<=1)return 1;let t=128e3;return r==="ec-3"?t=768e3:r==="ac-3"&&(t=64e4),Math.min(e/2,t)}function Tx(r){return Math.ceil(Math.max(r.bitrate*.9,r.averageBitrate)/1e3)*1e3||1}function VT(r){let e="";const{audio:t,video:n}=r;if(n){const i=cd(n.contentType);e+=`${i}_r${n.height}x${n.width}f${Math.ceil(n.framerate)}${n.transferFunction||"sd"}_${Math.ceil(n.bitrate/1e5)}`}if(t){const i=cd(t.contentType);e+=`${n?"_":""}${i}_c${t.channels}`}return e}const dd=["NONE","TYPE-0","TYPE-1",null];function jT(r){return dd.indexOf(r)>-1}const Ko=["SDR","PQ","HLG"];function KT(r){return!!r&&Ko.indexOf(r)>-1}var co={No:"",Yes:"YES",v2:"v2"};function Uh(r){const{canSkipUntil:e,canSkipDateRanges:t,age:n}=r,i=n<e/2;return e&&i?t?co.v2:co.Yes:co.No}class Gh{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Ws{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(n=>!!n).map(n=>n.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const n=(t=e.supplemental)==null?void 0:t.videoCodec;n&&n!==e.videoCodec&&(this.codecSet+=`,${n.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Hh(this._audioGroups,e)}hasSubtitleGroup(e){return Hh(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let n=this._audioGroups;n||(n=this._audioGroups=[]),n.indexOf(t)===-1&&n.push(t)}else if(e==="text"){let n=this._subtitleGroups;n||(n=this._subtitleGroups=[]),n.indexOf(t)===-1&&n.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Hh(r,e){return!e||!r?!1:r.indexOf(e)!==-1}function zT(){if(typeof matchMedia=="function"){const r=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(r.media!==e.media)return r.matches===!0}return!1}function WT(r,e){let t=!1,n=[];if(r&&(t=r!=="SDR",n=[r]),e){n=e.allowedVideoRanges||Ko.slice(0);const i=n.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:i&&zT(),t||(n=["SDR"])}return{preferHDR:t,allowedVideoRanges:n}}const YT=r=>{const e=new WeakSet;return(t,n)=>{if(r&&(n=r(t,n)),typeof n=="object"&&n!==null){if(e.has(n))return;e.add(n)}return n}},_e=(r,e)=>JSON.stringify(r,YT(e));function qT(r,e,t,n,i){const s=Object.keys(r),a=n==null?void 0:n.channels,o=n==null?void 0:n.audioCodec,u=i==null?void 0:i.videoCodec,l=a&&parseInt(a)===2;let c=!1,d=!1,f=1/0,h=1/0,p=1/0,x=1/0,v=0,y=[];const{preferHDR:g,allowedVideoRanges:m}=WT(e,i);for(let R=s.length;R--;){const I=r[s[R]];c||(c=I.channels[2]>0),f=Math.min(f,I.minHeight),h=Math.min(h,I.minFramerate),p=Math.min(p,I.minBitrate),m.filter(_=>I.videoRanges[_]>0).length>0&&(d=!0)}f=Z(f)?f:0,h=Z(h)?h:0;const E=Math.max(1080,f),T=Math.max(30,h);p=Z(p)?p:t,t=Math.max(p,t),d||(e=void 0);const L=s.length>1;return{codecSet:s.reduce((R,I)=>{const C=r[I];if(I===R)return R;if(y=d?m.filter(_=>C.videoRanges[_]>0):[],L){if(C.minBitrate>t)return Ar(I,`min bitrate of ${C.minBitrate} > current estimate of ${t}`),R;if(!C.hasDefaultAudio)return Ar(I,"no renditions with default or auto-select sound found"),R;if(o&&I.indexOf(o.substring(0,4))%5!==0)return Ar(I,`audio codec preference "${o}" not found`),R;if(a&&!l){if(!C.channels[a])return Ar(I,`no renditions with ${a} channel sound found (channels options: ${Object.keys(C.channels)})`),R}else if((!o||l)&&c&&C.channels[2]===0)return Ar(I,"no renditions with stereo sound found"),R;if(C.minHeight>E)return Ar(I,`min resolution of ${C.minHeight} > maximum of ${E}`),R;if(C.minFramerate>T)return Ar(I,`min framerate of ${C.minFramerate} > maximum of ${T}`),R;if(!y.some(_=>C.videoRanges[_]>0))return Ar(I,`no variants with VIDEO-RANGE of ${_e(y)} found`),R;if(u&&I.indexOf(u.substring(0,4))%5!==0)return Ar(I,`video codec preference "${u}" not found`),R;if(C.maxScore<v)return Ar(I,`max score of ${C.maxScore} < selected max of ${v}`),R}return R&&(Vo(I)>=Vo(R)||C.fragmentError>r[R].fragmentError)?R:(x=C.minIndex,v=C.maxScore,I)},void 0),videoRanges:y,preferHDR:g,minFramerate:h,minBitrate:p,minIndex:x}}function Ar(r,e){Ce.log(`[abr] start candidates with "${r}" ignored because ${e}`)}function Ax(r){return r.reduce((e,t)=>{let n=e.groups[t.groupId];n||(n=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(t);const i=t.channels||"2";return n.channels[i]=(n.channels[i]||0)+1,n.hasDefault=n.hasDefault||t.default,n.hasAutoSelect=n.hasAutoSelect||t.autoselect,n.hasDefault&&(e.hasDefaultAudio=!0),n.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function XT(r,e,t,n){return r.slice(t,n+1).reduce((i,s,a)=>{if(!s.codecSet)return i;const o=s.audioGroups;let u=i[s.codecSet];u||(i[s.codecSet]=u={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:a,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!o,fragmentError:0}),u.minBitrate=Math.min(u.minBitrate,s.bitrate);const l=Math.min(s.height,s.width);return u.minHeight=Math.min(u.minHeight,l),u.minFramerate=Math.min(u.minFramerate,s.frameRate),u.minIndex=Math.min(u.minIndex,a),u.maxScore=Math.max(u.maxScore,s.score),u.fragmentError+=s.fragmentError,u.videoRanges[s.videoRange]=(u.videoRanges[s.videoRange]||0)+1,o&&o.forEach(c=>{if(!c)return;const d=e.groups[c];d&&(u.hasDefaultAudio=u.hasDefaultAudio||e.hasDefaultAudio?d.hasDefault:d.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(d.channels).forEach(f=>{u.channels[f]=(u.channels[f]||0)+d.channels[f]}))}),i},{})}function Vh(r){if(!r)return r;const{lang:e,assocLang:t,characteristics:n,channels:i,audioCodec:s}=r;return{lang:e,assocLang:t,characteristics:n,channels:i,audioCodec:s}}function Dr(r,e,t){if("attrs"in r){const n=e.indexOf(r);if(n!==-1)return n}for(let n=0;n<e.length;n++){const i=e[n];if(jn(r,i,t))return n}return-1}function jn(r,e,t){const{groupId:n,name:i,lang:s,assocLang:a,default:o}=r,u=r.forced;return(n===void 0||e.groupId===n)&&(i===void 0||e.name===i)&&(s===void 0||QT(s,e.lang))&&(s===void 0||e.assocLang===a)&&(o===void 0||e.default===o)&&(u===void 0||e.forced===u)&&(!("characteristics"in r)||ZT(r.characteristics||"",e.characteristics))&&(t===void 0||t(r,e))}function QT(r,e="--"){return r.length===e.length?r===e:r.startsWith(e)||e.startsWith(r)}function ZT(r,e=""){const t=r.split(","),n=e.split(",");return t.length===n.length&&!t.some(i=>n.indexOf(i)===-1)}function Nn(r,e){const{audioCodec:t,channels:n}=r;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(n===void 0||n===(e.channels||"2"))}function JT(r,e,t,n,i){const s=e[n],o=e.reduce((f,h,p)=>{const x=h.uri;return(f[x]||(f[x]=[])).push(p),f},{})[s.uri];o.length>1&&(n=Math.max.apply(Math,o));const u=s.videoRange,l=s.frameRate,c=s.codecSet.substring(0,4),d=jh(e,n,f=>{if(f.videoRange!==u||f.frameRate!==l||f.codecSet.substring(0,4)!==c)return!1;const h=f.audioGroups,p=t.filter(x=>!h||h.indexOf(x.groupId)!==-1);return Dr(r,p,i)>-1});return d>-1?d:jh(e,n,f=>{const h=f.audioGroups,p=t.filter(x=>!h||h.indexOf(x.groupId)!==-1);return Dr(r,p,i)>-1})}function jh(r,e,t){for(let n=e;n>-1;n--)if(t(r[n]))return n;for(let n=e+1;n<r.length;n++)if(t(r[n]))return n;return-1}function zo(r,e){var t;return!!r&&r!==((t=e.loadLevelObj)==null?void 0:t.uri)}class eA extends lr{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var n;const{fragCurrent:i,partCurrent:s,hls:a}=this,{autoLevelEnabled:o,media:u}=a;if(!i||!u)return;const l=performance.now(),c=s?s.stats:i.stats,d=s?s.duration:i.duration,f=l-c.loading.start,h=a.minAutoLevel,p=i.level,x=this._nextAutoLevel;if(c.aborted||c.loaded&&c.loaded===c.total||p<=h){this.clearTimer(),this._nextAutoLevel=-1;return}if(!o)return;const v=x>-1&&x!==p,y=!!t||v;if(!y&&(u.paused||!u.playbackRate||!u.readyState))return;const g=a.mainForwardBufferInfo;if(!y&&g===null)return;const m=this.bwEstimator.getEstimateTTFB(),E=Math.abs(u.playbackRate);if(f<=Math.max(m,1e3*(d/(E*2))))return;const T=g?g.len/E:0,L=c.loading.first?c.loading.first-c.loading.start:-1,A=c.loaded&&L>-1,R=this.getBwEstimate(),I=a.levels,C=I[p],_=Math.max(c.loaded,Math.round(d*(i.bitrate||C.averageBitrate)/8));let F=A?f-L:f;F<1&&A&&(F=Math.min(f,c.loaded*8/R));const B=A?c.loaded*1e3/F:0,V=m/1e3,j=B?(_-c.loaded)/B:_*8/R+V;if(j<=T)return;const G=B?B*8:R,Y=((n=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:n.live)===!0,O=this.hls.config.abrBandWidthUpFactor;let H=Number.POSITIVE_INFINITY,K;for(K=p-1;K>h;K--){const $=I[K].maxBitrate,Q=!I[K].details||Y;if(H=this.getTimeToLoadFrag(V,G,d*$,Q),H<Math.min(T,d+V))break}if(H>=j||H>d*10)return;A?this.bwEstimator.sample(f-Math.min(m,L),c.loaded):this.bwEstimator.sampleTTFB(f);const w=I[K].maxBitrate;this.getBwEstimate()*O>w&&this.resetEstimator(w);const P=this.findBestLevel(w,h,K,0,T,1,1);P>-1&&(K=P),this.warn(`Fragment ${i.sn}${s?" part "+s.index:""} of level ${p} is loading too slowly;
      Fragment duration: ${i.duration.toFixed(3)}
      Time to underbuffer: ${T.toFixed(3)} s
      Estimated load time for current fragment: ${j.toFixed(3)} s
      Estimated load time for down switch fragment: ${H.toFixed(3)} s
      TTFB estimate: ${L|0} ms
      Current BW estimate: ${Z(R)?R|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${K} @ ${w|0} bps`),a.nextLoadLevel=a.nextAutoLevel=K,this.clearTimer();const U=()=>{if(this.clearTimer(),this.fragCurrent===i&&this.hls.loadLevel===K&&K>0){const $=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${K>0?"and switching down":""}
      Fragment duration: ${i.duration.toFixed(3)} s
      Time to underbuffer: ${$.toFixed(3)} s`),i.abortRequests(),this.fragCurrent=this.partCurrent=null,K>h){let Q=this.findBestLevel(this.hls.levels[h].bitrate,h,K,0,$,1,1);Q===-1&&(Q=h),this.hls.nextLoadLevel=this.hls.nextAutoLevel=Q,this.resetEstimator(this.hls.levels[Q].bitrate)}}};v||j>H*2?U():this.timer=self.setInterval(U,H*1e3),a.trigger(S.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:s,stats:c})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new sT(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(S.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const n=t.frag;if(!this.ignoreFragment(n)){if(!n.bitrateTest){var i;this.fragCurrent=n,this.partCurrent=(i=t.part)!=null?i:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case N.BUFFER_ADD_CODEC_ERROR:case N.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case N.FRAG_LOAD_TIMEOUT:{const n=t.frag,{fragCurrent:i,partCurrent:s}=this;if(n&&i&&n.sn===i.sn&&n.level===i.level){const a=performance.now(),o=s?s.stats:n.stats,u=a-o.loading.start,l=o.loading.first?o.loading.first-o.loading.start:-1;if(o.loaded&&l>-1){const d=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(u-Math.min(d,l),o.loaded)}else this.bwEstimator.sampleTTFB(u)}break}}}getTimeToLoadFrag(e,t,n,i){const s=e+n/t,a=i?e+this.lastLevelLoadSec:0;return s+a}onLevelLoaded(e,t){const n=this.hls.config,{loading:i}=t.stats,s=i.end-i.first;Z(s)&&(this.lastLevelLoadSec=s/1e3),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:n}){const i=n?n.stats:t.stats;if(t.type===ee.MAIN&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const s=n?n.duration:t.duration,a=this.hls.levels[t.level],o=(a.loaded?a.loaded.bytes:0)+i.loaded,u=(a.loaded?a.loaded.duration:0)+s;a.loaded={bytes:o,duration:u},a.realBitrate=Math.round(8*o/u)}if(t.bitrateTest){const s={stats:i,frag:t,part:n,id:t.type};this.onFragBuffered(S.FRAG_BUFFERED,s),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:n,part:i}=t,s=i!=null&&i.stats.loaded?i.stats:n.stats;if(s.aborted||this.ignoreFragment(n))return;const a=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,s.loaded),s.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==ee.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,n=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,s=this.findBestLevel(n,t,e,0,i,1,1);if(s>-1)return s;const a=this.hls.firstLevel,o=Math.min(Math.max(a,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${o}`),o}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,n=this.bwEstimator.canEstimate(),i=this.lastLoadedFragLevel>-1;if(e!==-1&&(!n||!i||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const s=n&&i?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,s)&&a[e].loadError<=a[s].loadError)return e}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:n}=this;if(n.levels.length<=1)return n.loadLevel;const{maxAutoLevel:i,config:s,minAutoLevel:a}=n,o=t?t.duration:e?e.duration:0,u=this.getBwEstimate(),l=this.getStarvationDelay();let c=s.abrBandWidthFactor,d=s.abrBandWidthUpFactor;if(l){const v=this.findBestLevel(u,a,i,l,0,c,d);if(v>=0)return this.rebufferNotice=-1,v}let f=o?Math.min(o,s.maxStarvationDelay):s.maxStarvationDelay;if(!l){const v=this.bitrateTestDelay;v&&(f=(o?Math.min(o,s.maxLoadingDelay):s.maxLoadingDelay)-v,this.info(`bitrate test took ${Math.round(1e3*v)}ms, set first fragment max fetchDuration to ${Math.round(1e3*f)} ms`),c=d=1)}const h=this.findBestLevel(u,a,i,l,f,c,d);if(this.rebufferNotice!==h&&(this.rebufferNotice=h,this.info(`${l?"rebuffering expected":"buffer is empty"}, optimal quality level ${h}`)),h>-1)return h;const p=n.levels[a],x=n.loadLevelObj;return x&&(p==null?void 0:p.bitrate)<x.bitrate?a:n.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const n=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,n,i,s,a,o){var u;const l=i+s,c=this.lastLoadedFragLevel,d=c===-1?this.hls.firstLevel:c,{fragCurrent:f,partCurrent:h}=this,{levels:p,allAudioTracks:x,loadLevel:v,config:y}=this.hls;if(p.length===1)return 0;const g=p[d],m=!!((u=this.hls.latestLevelDetails)!=null&&u.live),E=v===-1||c===-1;let T,L="SDR",A=(g==null?void 0:g.frameRate)||0;const{audioPreference:R,videoPreference:I}=y,C=this.audioTracksByGroup||(this.audioTracksByGroup=Ax(x));let _=-1;if(E){if(this.firstSelection!==-1)return this.firstSelection;const G=this.codecTiers||(this.codecTiers=XT(p,C,t,n)),Y=qT(G,L,e,R,I),{codecSet:O,videoRanges:H,minFramerate:K,minBitrate:w,minIndex:P,preferHDR:U}=Y;_=P,T=O,L=U?H[H.length-1]:H[0],A=K,e=Math.max(e,w),this.log(`picked start tier ${_e(Y)}`)}else T=g==null?void 0:g.codecSet,L=g==null?void 0:g.videoRange;const F=h?h.duration:f?f.duration:0,B=this.bwEstimator.getEstimateTTFB()/1e3,V=[];for(let G=n;G>=t;G--){var j;const Y=p[G],O=G>d;if(!Y)continue;if(y.useMediaCapabilities&&!Y.supportedResult&&!Y.supportedPromise){const Q=navigator.mediaCapabilities;typeof(Q==null?void 0:Q.decodingInfo)=="function"&&$T(Y,C,L,A,e,R)?(Y.supportedPromise=Sx(Y,C,Q,this.supportedCache),Y.supportedPromise.then(J=>{if(!this.hls)return;Y.supportedResult=J;const he=this.hls.levels,ne=he.indexOf(Y);J.error?this.warn(`MediaCapabilities decodingInfo error: "${J.error}" for level ${ne} ${_e(J)}`):J.supported?J.decodingInfoResults.some(Fe=>Fe.smooth===!1||Fe.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${ne} not smooth or powerEfficient: ${_e(J)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${ne} ${_e(J)}`),ne>-1&&he.length>1&&(this.log(`Removing unsupported level ${ne}`),this.hls.removeLevel(ne),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(J=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${J}`)})):Y.supportedResult=yx}if((T&&Y.codecSet!==T||L&&Y.videoRange!==L||O&&A>Y.frameRate||!O&&A>0&&A<Y.frameRate||(j=Y.supportedResult)!=null&&(j=j.decodingInfoResults)!=null&&j.some(Q=>Q.smooth===!1))&&(!E||G!==_)){V.push(G);continue}const H=Y.details,K=(h?H==null?void 0:H.partTarget:H==null?void 0:H.averagetargetduration)||F;let w;O?w=o*e:w=a*e;const P=F&&i>=F*2&&s===0?Y.averageBitrate:Y.maxBitrate,U=this.getTimeToLoadFrag(B,w,P*K,H===void 0);if(w>=P&&(G===c||Y.loadError===0&&Y.fragmentError===0)&&(U<=B||!Z(U)||m&&!this.bitrateTestDelay||U<l)){const Q=this.forcedAutoLevel;return G!==v&&(Q===-1||Q!==v)&&(V.length&&this.trace(`Skipped level(s) ${V.join(",")} of ${n} max with CODECS and VIDEO-RANGE:"${p[V[0]].codecs}" ${p[V[0]].videoRange}; not compatible with "${T}" ${L}`),this.info(`switch candidate:${d}->${G} adjustedbw(${Math.round(w)})-bitrate=${Math.round(w-P)} ttfb:${B.toFixed(1)} avgDuration:${K.toFixed(1)} maxFetchDuration:${l.toFixed(1)} fetchDuration:${U.toFixed(1)} firstSelection:${E} codecSet:${Y.codecSet} videoRange:${Y.videoRange} hls.loadLevel:${v}`)),E&&(this.firstSelection=G),G}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:n}=this.hls;return Math.min(Math.max(e,n),t)}}const Cx={search:function(r,e){let t=0,n=r.length-1,i=null,s=null;for(;t<=n;){i=(t+n)/2|0,s=r[i];const a=e(s);if(a>0)t=i+1;else if(a<0)n=i-1;else return s}return null}};function tA(r,e,t){if(e===null||!Array.isArray(r)||!r.length||!Z(e))return null;const n=r[0].programDateTime;if(e<(n||0))return null;const i=r[r.length-1].endProgramDateTime;if(e>=(i||0))return null;for(let s=0;s<r.length;++s){const a=r[s];if(nA(e,t,a))return a}return null}function Qn(r,e,t=0,n=0,i=.005){let s=null;if(r){s=e[1+r.sn-e[0].sn]||null;const o=r.endDTS-t;o>0&&o<15e-7&&(t+=15e-7),s&&r.level!==s.level&&s.end<=r.end&&(s=e[2+r.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(s=e[0]);if(s&&((!r||r.level===s.level)&&Kh(t,n,s)===0||rA(s,r,Math.min(i,n))))return s;const a=Cx.search(e,Kh.bind(null,t,n));return a&&(a!==r||!s)?a:s}function rA(r,e,t){if(e&&e.start===0&&e.level<r.level&&(e.endPTS||0)>0){const n=e.tagList.reduce((i,s)=>(s[0]==="INF"&&(i+=parseFloat(s[1])),i),t);return r.start<=n}return!1}function Kh(r=0,e=0,t){if(t.start<=r&&t.start+t.duration>r)return 0;const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-n<=r?1:t.start-n>r&&t.start?-1:0}function nA(r,e,t){const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-n>r}function Lx(r,e,t){if(r&&r.startCC<=e&&r.endCC>=e){let n=r.fragments;const{fragmentHint:i}=r;i&&(n=n.concat(i));let s;return Cx.search(n,a=>a.cc<e?1:a.cc>e?-1:(s=a,a.end<=t?1:a.start>t?-1:0)),s||null}return null}function Wo(r){switch(r.details){case N.FRAG_LOAD_TIMEOUT:case N.KEY_LOAD_TIMEOUT:case N.LEVEL_LOAD_TIMEOUT:case N.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Rx(r){return r.details.startsWith("key")}function Ix(r){return Rx(r)&&!!r.frag&&!r.frag.decryptdata}function zh(r,e){const t=Wo(e);return r.default[`${t?"timeout":"error"}Retry`]}function Nf(r,e){const t=r.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*r.retryDelayMs,r.maxRetryDelayMs)}function Wh(r){return Ae(Ae({},r),{errorRetry:null,timeoutRetry:null})}function Yo(r,e,t,n){if(!r)return!1;const i=n==null?void 0:n.code,s=e<r.maxNumRetry&&(iA(i)||!!t);return r.shouldRetry?r.shouldRetry(r,e,t,n,s):s}function iA(r){return fd(r)||!!r&&(r<400||r>499)}function fd(r){return r===0&&navigator.onLine===!1}var ut={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},jt={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class sA extends lr{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(S.ERROR,this.onError,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(S.ERROR,this.onError,this),e.off(S.ERROR,this.onErrorOut,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===ee.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,n=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||n===-1?t.loadLevel:n}variantHasKey(e,t){if(e){var n;if((n=e.details)!=null&&n.hasKey(t))return!0;const i=e.audioGroups;if(i)return this.hls.allAudioTracks.filter(a=>i.indexOf(a.groupId)>=0).some(a=>{var o;return(o=a.details)==null?void 0:o.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var n;if(t.fatal)return;const i=this.hls,s=t.context;switch(t.details){case N.FRAG_LOAD_ERROR:case N.FRAG_LOAD_TIMEOUT:case N.KEY_LOAD_ERROR:case N.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case N.FRAG_PARSING_ERROR:if((n=t.frag)!=null&&n.gap){t.errorAction=ki();return}case N.FRAG_GAP:case N.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=ut.SendAlternateToPenaltyBox;return}case N.LEVEL_EMPTY_ERROR:case N.LEVEL_PARSING_ERROR:{var a;const u=t.parent===ee.MAIN?t.level:i.loadLevel;t.details===N.LEVEL_EMPTY_ERROR&&((a=t.context)!=null&&(a=a.levelDetails)!=null&&a.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,u):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,u))}return;case N.LEVEL_LOAD_ERROR:case N.LEVEL_LOAD_TIMEOUT:typeof(s==null?void 0:s.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level));return;case N.AUDIO_TRACK_LOAD_ERROR:case N.AUDIO_TRACK_LOAD_TIMEOUT:case N.SUBTITLE_LOAD_ERROR:case N.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const u=i.loadLevelObj;if(u&&(s.type===me.AUDIO_TRACK&&u.hasAudioGroup(s.groupId)||s.type===me.SUBTITLE_TRACK&&u.hasSubtitleGroup(s.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=ut.SendAlternateToPenaltyBox,t.errorAction.flags=jt.MoveAllAlternatesMatchingHost;return}}return;case N.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:ut.SendAlternateToPenaltyBox,flags:jt.MoveAllAlternatesMatchingHDCP};return;case N.KEY_SYSTEM_SESSION_UPDATE_FAILED:case N.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case N.KEY_SYSTEM_NO_SESSION:t.errorAction={action:ut.SendAlternateToPenaltyBox,flags:jt.MoveAllAlternatesMatchingKey};return;case N.BUFFER_ADD_CODEC_ERROR:case N.REMUX_ALLOC_ERROR:case N.BUFFER_APPEND_ERROR:if(!t.errorAction){var o;t.errorAction=this.getLevelSwitchAction(t,(o=t.level)!=null?o:i.loadLevel)}return;case N.INTERNAL_EXCEPTION:case N.BUFFER_APPENDING_ERROR:case N.BUFFER_FULL_ERROR:case N.LEVEL_SWITCH_ERROR:case N.BUFFER_STALLED_ERROR:case N.BUFFER_SEEK_OVER_HOLE:case N.BUFFER_NUDGE_ON_STALL:t.errorAction=ki();return}t.type===re.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=ki())}getPlaylistRetryOrSwitchAction(e,t){const n=this.hls,i=zh(n.config.playlistLoadPolicy,e),s=this.playlistError++;if(Yo(i,s,Wo(e),e.response))return{action:ut.RetryRequest,flags:jt.None,retryConfig:i,retryCount:s};const o=this.getLevelSwitchAction(e,t);return i&&(o.retryConfig=i,o.retryCount=s),o}getFragRetryOrSwitchAction(e){const t=this.hls,n=this.getVariantLevelIndex(e.frag),i=t.levels[n],{fragLoadPolicy:s,keyLoadPolicy:a}=t.config,o=zh(Rx(e)?a:s,e),u=t.levels.reduce((c,d)=>c+d.fragmentError,0);if(i&&(e.details!==N.FRAG_GAP&&i.fragmentError++,!Ix(e)&&Yo(o,u,Wo(e),e.response)))return{action:ut.RetryRequest,flags:jt.None,retryConfig:o,retryCount:u};const l=this.getLevelSwitchAction(e,n);return o&&(l.retryConfig=o,l.retryCount=u),l}getLevelSwitchAction(e,t){const n=this.hls;t==null&&(t=n.loadLevel);const i=this.hls.levels[t];if(i){var s,a;const l=e.details;i.loadError++,l===N.BUFFER_APPEND_ERROR&&i.fragmentError++;let c=-1;const{levels:d,loadLevel:f,minAutoLevel:h,maxAutoLevel:p}=n;!n.autoLevelEnabled&&!n.config.preserveManualLevelOnError&&(n.loadLevel=-1);const x=(s=e.frag)==null?void 0:s.type,y=(x===ee.AUDIO&&l===N.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(l===N.BUFFER_ADD_CODEC_ERROR||l===N.BUFFER_APPEND_ERROR))&&d.some(({audioCodec:L})=>i.audioCodec!==L),m=e.sourceBufferName==="video"&&(l===N.BUFFER_ADD_CODEC_ERROR||l===N.BUFFER_APPEND_ERROR)&&d.some(({codecSet:L,audioCodec:A})=>i.codecSet!==L&&i.audioCodec===A),{type:E,groupId:T}=(a=e.context)!=null?a:{};for(let L=d.length;L--;){const A=(L+f)%d.length;if(A!==f&&A>=h&&A<=p&&d[A].loadError===0){var o,u;const R=d[A];if(l===N.FRAG_GAP&&x===ee.MAIN&&e.frag){const I=d[A].details;if(I){const C=Qn(e.frag,I.fragments,e.frag.start);if(C!=null&&C.gap)continue}}else{if(E===me.AUDIO_TRACK&&R.hasAudioGroup(T)||E===me.SUBTITLE_TRACK&&R.hasSubtitleGroup(T))continue;if(x===ee.AUDIO&&(o=i.audioGroups)!=null&&o.some(I=>R.hasAudioGroup(I))||x===ee.SUBTITLE&&(u=i.subtitleGroups)!=null&&u.some(I=>R.hasSubtitleGroup(I))||y&&i.audioCodec===R.audioCodec||m&&i.codecSet===R.codecSet||!y&&i.codecSet!==R.codecSet)continue}c=A;break}}if(c>-1&&n.loadLevel!==c)return e.levelRetry=!0,this.playlistError=0,{action:ut.SendAlternateToPenaltyBox,flags:jt.None,nextAutoLevel:c}}return{action:ut.SendAlternateToPenaltyBox,flags:jt.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var n;switch((n=t.errorAction)==null?void 0:n.action){case ut.DoNothing:break;case ut.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==N.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,n=e.errorAction;if(!n)return;const{flags:i}=n,s=n.nextAutoLevel;switch(i){case jt.None:this.switchLevel(e,s);break;case jt.MoveAllAlternatesMatchingHDCP:{const u=this.getVariantLevelIndex(e.frag),l=t.levels[u],c=l==null?void 0:l.attrs["HDCP-LEVEL"];if(n.hdcpLevel=c,c==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(c){t.maxHdcpLevel=dd[dd.indexOf(c)-1],n.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case jt.MoveAllAlternatesMatchingKey:{const u=e.decryptdata;if(u){const l=this.hls.levels,c=l.length;for(let f=c;f--;)if(this.variantHasKey(l[f],u)){var a,o;this.log(`Banned key found in level ${f} (${l[f].bitrate}bps) or audio group "${(a=l[f].audioGroups)==null?void 0:a.join(",")}" (${(o=e.frag)==null?void 0:o.type} fragment) ${Lt(u.keyId||[])}`),l[f].fragmentError++,l[f].loadError++,this.log(`Removing level ${f} with key error (${e.error})`),this.hls.removeLevel(f)}const d=e.frag;if(this.hls.levels.length<c)n.resolved=!0;else if(d&&d.type!==ee.MAIN){const f=d.decryptdata;f&&!u.matches(f)&&(n.resolved=!0)}}break}}n.resolved||this.switchLevel(e,s)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===N.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const n=cd(e.mimeType),i=this.hls.levels;for(let s=i.length;s--;)i[s][`${e.sourceBufferName}Codec`]===n&&(this.log(`Removing level ${s} for ${e.details} ("${n}" not supported)`),this.hls.removeLevel(s))}}}function ki(r){const e={action:ut.DoNothing,flags:jt.None};return r&&(e.resolved=!0),e}var et={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class aA{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const n=this.activePartLists[t];if(n)for(let i=n.length;i--;){const s=n[i];if(!s)break;if(s.start<=e&&e<=s.end&&s.loaded)return s}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,n){const{fragments:i}=this,s=Object.keys(i);for(let a=s.length;a--;){const o=i[s[a]];if((o==null?void 0:o.body.type)===t&&(!n||o.buffered)){const u=o.body;if(u.start<=e&&e<=u.end)return u}}return null}detectEvictedFragments(e,t,n,i,s){this.timeRanges&&(this.timeRanges[e]=t);const a=(i==null?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach(o=>{const u=this.fragments[o];if(!u||a>=u.body.sn)return;if(!u.buffered&&(!u.loaded||s)){u.body.type===n&&this.removeFragment(u.body);return}const l=u.range[e];if(l){if(l.time.length===0){this.removeFragment(u.body);return}l.time.some(c=>{const d=!this.isTimeBuffered(c.startPTS,c.endPTS,t);return d&&this.removeFragment(u.body),d})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const n=e.frag,i=si(n),s=this.fragments[i];if(!s||s.buffered&&n.gap)return;const a=!n.relurl;Object.keys(t).forEach(o=>{const u=n.elementaryStreams[o];if(!u)return;const l=t[o],c=a||u.partial===!0;s.range[o]=this.getBufferedTimes(n,e.part,c,l)}),s.loaded=null,Object.keys(s.range).length?(s.buffered=!0,(s.body.endList=n.endList||s.body.endList)&&(this.endListFragments[s.body.type]=s),Ba(s)||this.removeParts(n.sn-1,n.type)):this.removeFragment(s.body)}removeParts(e,t){const n=this.activePartLists[t];n&&(this.activePartLists[t]=Yh(n,i=>i.fragment.sn>=e))}fragBuffered(e,t){const n=si(e);let i=this.fragments[n];!i&&t&&(i=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)}getBufferedTimes(e,t,n,i){const s={time:[],partial:n},a=e.start,o=e.end,u=e.minEndPTS||o,l=e.maxStartPTS||a;for(let c=0;c<i.length;c++){const d=i.start(c)-this.bufferPadding,f=i.end(c)+this.bufferPadding;if(l>=d&&u<=f){s.time.push({startPTS:Math.max(a,i.start(c)),endPTS:Math.min(o,i.end(c))});break}else if(a<f&&o>d){const h=Math.max(a,i.start(c)),p=Math.min(o,i.end(c));p>h&&(s.partial=!0,s.time.push({startPTS:h,endPTS:p}))}else if(o<=d)break}return s}getPartialFragment(e){let t=null,n,i,s,a=0;const{bufferPadding:o,fragments:u}=this;return Object.keys(u).forEach(l=>{const c=u[l];c&&Ba(c)&&(i=c.body.start-o,s=c.body.end+o,e>=i&&e<=s&&(n=Math.min(e-i,s-e),a<=n&&(t=c.body,a=n)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Ba(t))}getState(e){const t=si(e),n=this.fragments[t];return n?n.buffered?Ba(n)?et.PARTIAL:et.OK:et.APPENDING:et.NOT_LOADED}isTimeBuffered(e,t,n){let i,s;for(let a=0;a<n.length;a++){if(i=n.start(a)-this.bufferPadding,s=n.end(a)+this.bufferPadding,e>=i&&t<=s)return!0;if(t<=i)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const n=t.frag,i=t.part?null:t,s=si(n);this.fragments[s]={body:n,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:n,part:i,timeRanges:s,type:a}=t;if(n.sn==="initSegment")return;const o=n.type;if(i){let l=this.activePartLists[o];l||(this.activePartLists[o]=l=[]),l.push(i)}this.timeRanges=s;const u=s[a];this.detectEvictedFragments(a,u,o,i)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=si(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,n=Object.keys(t);if(!e)return n.length>0;for(let i=n.length;i--;){const s=t[n[i]];if((s==null?void 0:s.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,n,i,s){i&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const o=this.fragments[a];if(!o)return;const u=o.body;u.type!==n||i&&!u.gap||u.start<t&&u.end>e&&(o.buffered||s)&&this.removeFragment(u)})}removeFragment(e){const t=si(e);e.clearElementaryStreamInfo();const n=this.activePartLists[e.type];if(n){const i=e.sn;this.activePartLists[e.type]=Yh(n,s=>s.fragment.sn!==i)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(n=>n.clearElementaryStreamInfo())}}function Ba(r){var e,t,n;return r.buffered&&!!(r.body.gap||(e=r.range.video)!=null&&e.partial||(t=r.range.audio)!=null&&t.partial||(n=r.range.audiovideo)!=null&&n.partial)}function si(r){return`${r.type}_${r.level}_${r.sn}`}function Yh(r,e){return r.filter(t=>{const n=e(t);return n||t.clearElementaryStreamInfo(),n})}var Cn={cbc:0,ctr:1};class oA{constructor(e,t,n){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=n}decrypt(e,t){switch(this.aesMode){case Cn.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Cn.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function lA(r){const e=r.byteLength,t=e&&new DataView(r.buffer).getUint8(e-1);return t?r.slice(0,e-t):r}class uA{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),n=new Uint32Array(4);for(let i=0;i<4;i++)n[i]=t.getUint32(i*4);return n}initTable(){const e=this.sBox,t=this.invSBox,n=this.subMix,i=n[0],s=n[1],a=n[2],o=n[3],u=this.invSubMix,l=u[0],c=u[1],d=u[2],f=u[3],h=new Uint32Array(256);let p=0,x=0,v=0;for(v=0;v<256;v++)v<128?h[v]=v<<1:h[v]=v<<1^283;for(v=0;v<256;v++){let y=x^x<<1^x<<2^x<<3^x<<4;y=y>>>8^y&255^99,e[p]=y,t[y]=p;const g=h[p],m=h[g],E=h[m];let T=h[y]*257^y*16843008;i[p]=T<<24|T>>>8,s[p]=T<<16|T>>>16,a[p]=T<<8|T>>>24,o[p]=T,T=E*16843009^m*65537^g*257^p*16843008,l[y]=T<<24|T>>>8,c[y]=T<<16|T>>>16,d[y]=T<<8|T>>>24,f[y]=T,p?(p=g^h[h[h[E^g]]],x^=h[h[x]]):p=x=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let n=!0,i=0;for(;i<t.length&&n;)n=t[i]===this.key[i],i++;if(n)return;this.key=t;const s=this.keySize=t.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);const a=this.ksRows=(s+6+1)*4;let o,u;const l=this.keySchedule=new Uint32Array(a),c=this.invKeySchedule=new Uint32Array(a),d=this.sBox,f=this.rcon,h=this.invSubMix,p=h[0],x=h[1],v=h[2],y=h[3];let g,m;for(o=0;o<a;o++){if(o<s){g=l[o]=t[o];continue}m=g,o%s===0?(m=m<<8|m>>>24,m=d[m>>>24]<<24|d[m>>>16&255]<<16|d[m>>>8&255]<<8|d[m&255],m^=f[o/s|0]<<24):s>6&&o%s===4&&(m=d[m>>>24]<<24|d[m>>>16&255]<<16|d[m>>>8&255]<<8|d[m&255]),l[o]=g=(l[o-s]^m)>>>0}for(u=0;u<a;u++)o=a-u,u&3?m=l[o]:m=l[o-4],u<4||o<=4?c[u]=m:c[u]=p[d[m>>>24]]^x[d[m>>>16&255]]^v[d[m>>>8&255]]^y[d[m&255]],c[u]=c[u]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,n){const i=this.keySize+6,s=this.invKeySchedule,a=this.invSBox,o=this.invSubMix,u=o[0],l=o[1],c=o[2],d=o[3],f=this.uint8ArrayToUint32Array_(n);let h=f[0],p=f[1],x=f[2],v=f[3];const y=new Int32Array(e),g=new Int32Array(y.length);let m,E,T,L,A,R,I,C,_,F,B,V,j,G;const Y=this.networkToHostOrderSwap;for(;t<y.length;){for(_=Y(y[t]),F=Y(y[t+1]),B=Y(y[t+2]),V=Y(y[t+3]),A=_^s[0],R=V^s[1],I=B^s[2],C=F^s[3],j=4,G=1;G<i;G++)m=u[A>>>24]^l[R>>16&255]^c[I>>8&255]^d[C&255]^s[j],E=u[R>>>24]^l[I>>16&255]^c[C>>8&255]^d[A&255]^s[j+1],T=u[I>>>24]^l[C>>16&255]^c[A>>8&255]^d[R&255]^s[j+2],L=u[C>>>24]^l[A>>16&255]^c[R>>8&255]^d[I&255]^s[j+3],A=m,R=E,I=T,C=L,j=j+4;m=a[A>>>24]<<24^a[R>>16&255]<<16^a[I>>8&255]<<8^a[C&255]^s[j],E=a[R>>>24]<<24^a[I>>16&255]<<16^a[C>>8&255]<<8^a[A&255]^s[j+1],T=a[I>>>24]<<24^a[C>>16&255]<<16^a[A>>8&255]<<8^a[R&255]^s[j+2],L=a[C>>>24]<<24^a[A>>16&255]<<16^a[R>>8&255]<<8^a[I&255]^s[j+3],g[t]=Y(m^h),g[t+1]=Y(L^p),g[t+2]=Y(T^x),g[t+3]=Y(E^v),h=_,p=F,x=B,v=V,t=t+4}return g.buffer}}class cA{constructor(e,t,n){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=n}expandKey(){const e=dA(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function dA(r){switch(r){case Cn.cbc:return"AES-CBC";case Cn.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${r}`)}}const fA=16;class $f{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?lA(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n,i){return this.useSoftware?new Promise((s,a)=>{const o=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(o,t,n,i);const u=this.flush();u?s(u.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n,i)}softwareDecrypt(e,t,n,i){const{currentIV:s,currentResult:a,remainderData:o}=this;if(i!==Cn.cbc||t.byteLength!==16)return Ce.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),o&&(e=or(o,e),this.remainderData=null);const u=this.getValidChunk(e);if(!u.length)return null;s&&(n=s);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new uA),l.expandKey(t);const c=a;return this.currentResult=l.decrypt(u.buffer,0,n),this.currentIV=u.slice(-16).buffer,c||null}webCryptoDecrypt(e,t,n,i){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,n,i));this.key=t,this.fastAesKey=new cA(this.subtle,t,i)}return this.fastAesKey.expandKey().then(s=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new oA(this.subtle,new Uint8Array(n),i).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(Ce.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,t,n,i)))}onWebCryptoError(e,t,n,i){const s=this.enableSoftwareAES;if(s){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n,i);const a=this.flush();if(a)return a.buffer}throw new Error("WebCrypto"+(s?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const n=e.length-e.length%fA;return n!==e.length&&(t=e.slice(0,n),this.remainderData=e.slice(n)),t}logOnce(e){this.logEnabled&&(Ce.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const qh=Math.pow(2,17);class hA{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const n=e.url;if(!n)return Promise.reject(new Ur({type:re.NETWORK_ERROR,details:N.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${n?"part list":"url"}`),networkDetails:null}));this.abort();const i=this.config,s=i.fLoader,a=i.loader;return new Promise((o,u)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(p=>p[0]==="GAP")){u(Qh(e));return}else e.gap=!1;const l=this.loader=s?new s(i):new a(i),c=Xh(e);e.loader=l;const d=Wh(i.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:qh};e.stats=l.stats;const h={onSuccess:(p,x,v,y)=>{this.resetLoader(e,l);let g=p.data;v.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(g.slice(0,16)),g=g.slice(16)),o({frag:e,part:null,payload:g,networkDetails:y})},onError:(p,x,v,y)=>{this.resetLoader(e,l),u(new Ur({type:re.NETWORK_ERROR,details:N.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Ae({url:n,data:void 0},p),error:new Error(`HTTP Error ${p.code} ${p.text}`),networkDetails:v,stats:y}))},onAbort:(p,x,v)=>{this.resetLoader(e,l),u(new Ur({type:re.NETWORK_ERROR,details:N.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:v,stats:p}))},onTimeout:(p,x,v)=>{this.resetLoader(e,l),u(new Ur({type:re.NETWORK_ERROR,details:N.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:v,stats:p}))}};t&&(h.onProgress=(p,x,v,y)=>t({frag:e,part:null,payload:v,networkDetails:y})),l.load(c,f,h)})}loadPart(e,t,n){this.abort();const i=this.config,s=i.fLoader,a=i.loader;return new Promise((o,u)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){u(Qh(e,t));return}const l=this.loader=s?new s(i):new a(i),c=Xh(e,t);e.loader=l;const d=Wh(i.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:qh};t.stats=l.stats,l.load(c,f,{onSuccess:(h,p,x,v)=>{this.resetLoader(e,l),this.updateStatsFromPart(e,t);const y={frag:e,part:t,payload:h.data,networkDetails:v};n(y),o(y)},onError:(h,p,x,v)=>{this.resetLoader(e,l),u(new Ur({type:re.NETWORK_ERROR,details:N.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Ae({url:c.url,data:void 0},h),error:new Error(`HTTP Error ${h.code} ${h.text}`),networkDetails:x,stats:v}))},onAbort:(h,p,x)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,l),u(new Ur({type:re.NETWORK_ERROR,details:N.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:x,stats:h}))},onTimeout:(h,p,x)=>{this.resetLoader(e,l),u(new Ur({type:re.NETWORK_ERROR,details:N.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:x,stats:h}))}})})}updateStatsFromPart(e,t){const n=e.stats,i=t.stats,s=i.total;if(n.loaded+=i.loaded,s){const u=Math.round(e.duration/t.duration),l=Math.min(Math.round(n.loaded/s),u),d=(u-l)*Math.round(n.loaded/l);n.total=n.loaded+d}else n.total=Math.max(n.loaded,n.total);const a=n.loading,o=i.loading;a.start?a.first+=o.first-o.start:(a.start=o.start,a.first=o.first),a.end=o.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Xh(r,e=null){const t=e||r,n={frag:r,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},i=t.byteRangeStartOffset,s=t.byteRangeEndOffset;if(Z(i)&&Z(s)){var a;let o=i,u=s;if(r.sn==="initSegment"&&pA((a=r.decryptdata)==null?void 0:a.method)){const l=s-i;l%16&&(u=s+(16-l%16)),i!==0&&(n.resetIV=!0,o=i-16)}n.rangeStart=o,n.rangeEnd=u}return n}function Qh(r,e){const t=new Error(`GAP ${r.gap?"tag":"attribute"} found`),n={type:re.MEDIA_ERROR,details:N.FRAG_GAP,fatal:!1,frag:r,error:t,networkDetails:null};return e&&(n.part=e),(e||r).stats.aborted=!0,new Ur(n)}function pA(r){return r==="AES-128"||r==="AES-256"}class Ur extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class _x extends lr{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Uf{constructor(e,t,n,i=0,s=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Oa(),this.buffering={audio:Oa(),video:Oa(),audiovideo:Oa()},this.level=e,this.sn=t,this.id=n,this.size=i,this.part=s,this.partial=a}}function Oa(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Zh={length:0,start:()=>0,end:()=>0};class ue{static isBuffered(e,t){if(e){const n=ue.getBuffered(e);for(let i=n.length;i--;)if(t>=n.start(i)&&t<=n.end(i))return!0}return!1}static bufferedRanges(e){if(e){const t=ue.getBuffered(e);return ue.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}static bufferInfo(e,t,n){if(e){const i=ue.bufferedRanges(e);if(i.length)return ue.bufferedInfo(i,t,n)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.length>1&&e.sort((c,d)=>c.start-d.start||d.end-c.end);let i=-1,s=[];if(n)for(let c=0;c<e.length;c++){t>=e[c].start&&t<=e[c].end&&(i=c);const d=s.length;if(d){const f=s[d-1].end;e[c].start-f<n?e[c].end>f&&(s[d-1].end=e[c].end):s.push(e[c])}else s.push(e[c])}else s=e;let a=0,o,u=t,l=t;for(let c=0;c<s.length;c++){const d=s[c].start,f=s[c].end;if(i===-1&&t>=d&&t<=f&&(i=c),t+n>=d&&t<f)u=d,l=f,a=l-t;else if(t+n<d){o=d;break}}return{len:a,start:u||0,end:l||0,nextStart:o,buffered:e,bufferedIndex:i}}static getBuffered(e){try{return e.buffered||Zh}catch(t){return Ce.log("failed to get media.buffered",t),Zh}}}const Dx=/\{\$([a-zA-Z0-9-_]+)\}/g;function Jh(r){return Dx.test(r)}function hd(r,e){if(r.variableList!==null||r.hasVariableRefs){const t=r.variableList;return e.replace(Dx,n=>{const i=n.substring(2,n.length-1),s=t==null?void 0:t[i];return s===void 0?(r.playlistParsingError||(r.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),n):s})}return e}function ep(r,e,t){let n=r.variableList;n||(r.variableList=n={});let i,s;if("QUERYPARAM"in e){i=e.QUERYPARAM;try{const a=new self.URL(t).searchParams;if(a.has(i))s=a.get(i);else throw new Error(`"${i}" does not match any query parameter in URI: "${t}"`)}catch(a){r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else i=e.NAME,s=e.VALUE;i in n?r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):n[i]=s||""}function gA(r,e,t){const n=e.IMPORT;if(t&&n in t){let i=r.variableList;i||(r.variableList=i={}),i[n]=t[n]}else r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${n}"`))}const mA=/^(\d+)x(\d+)$/,tp=/(.+?)=(".*?"|.*?)(?:,|$)/g;class $e{constructor(e,t){typeof e=="string"&&(e=$e.parseAttrList(e,t)),Re(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const n=new Uint8Array(t.length/2);for(let i=0;i<t.length/2;i++)n[i]=parseInt(t.slice(i*2,i*2+2),16);return n}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const n=this[e];return(n?n.split(/[ ,]+/):[]).reduce((i,s)=>(i[s.toLowerCase()]=!0,i),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=mA.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let n;const i={},s='"';for(tp.lastIndex=0;(n=tp.exec(e))!==null;){const a=n[1].trim();let o=n[2];const u=o.indexOf(s)===0&&o.lastIndexOf(s)===o.length-1;let l=!1;if(u)o=o.slice(1,-1);else switch(a){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":l=!0}if(t&&(u||l))o=hd(t,o);else if(!l&&!u)switch(a){case"CLOSED-CAPTIONS":if(o==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Ce.warn(`${e}: attribute ${a} is missing quotes`)}i[a]=o}return i}}const xA="com.apple.hls.interstitial";function vA(r){return r!=="ID"&&r!=="CLASS"&&r!=="CUE"&&r!=="START-DATE"&&r!=="DURATION"&&r!=="END-DATE"&&r!=="END-ON-NEXT"}function yA(r){return r==="SCTE35-OUT"||r==="SCTE35-IN"||r==="SCTE35-CMD"}class kx{constructor(e,t,n=0){var i;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(i=t==null?void 0:t.tagOrder)!=null?i:n,t){const s=t.attr;for(const a in s)if(Object.prototype.hasOwnProperty.call(e,a)&&e[a]!==s[a]){Ce.warn(`DATERANGE tag attribute: "${a}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=a;break}e=Re(new $e({}),s,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const s=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);Z(s.getTime())&&(this._endDate=s)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Ce.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(Z(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===xA}get isValid(){return!!this.id&&!this._badValueForSameId&&Z(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const EA=10;class SA{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let n=t.decryptdata;return n||(t.setKeyFormat(e.keyFormat),n=t.decryptdata),!!n&&e.matches(n)})}get hasProgramDateTime(){return this.fragments.length?Z(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||EA}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let n=e.length;n--;)if(e[n].index>t)return e[n].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function qo(r,e){return r.length===e.length?!r.some((t,n)=>t!==e[n]):!1}function rp(r,e){return!r&&!e?!0:!r||!e?!1:qo(r,e)}function wi(r){return r==="AES-128"||r==="AES-256"||r==="AES-256-CTR"}function Gf(r){switch(r){case"AES-128":case"AES-256":return Cn.cbc;case"AES-256-CTR":return Cn.ctr;default:throw new Error(`invalid full segment method ${r}`)}}function Hf(r){return Uint8Array.from(atob(r),e=>e.charCodeAt(0))}function pd(r){return Uint8Array.from(unescape(encodeURIComponent(r)),e=>e.charCodeAt(0))}function TA(r){const e=pd(r).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function wx(r){const e=function(n,i,s){const a=n[i];n[i]=n[s],n[s]=a};e(r,0,3),e(r,1,2),e(r,4,5),e(r,6,7)}function bx(r){const e=r.split(":");let t=null;if(e[0]==="data"&&e.length===2){const n=e[1].split(";"),i=n[n.length-1].split(",");if(i.length===2){const s=i[0]==="base64",a=i[1];s?(n.splice(-1,1),t=Hf(a)):t=TA(a)}}return t}const Xo=typeof self<"u"?self:void 0;var Ge={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},ct={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function fo(r){switch(r){case ct.FAIRPLAY:return Ge.FAIRPLAY;case ct.PLAYREADY:return Ge.PLAYREADY;case ct.WIDEVINE:return Ge.WIDEVINE;case ct.CLEARKEY:return Ge.CLEARKEY}}function lu(r){switch(r){case Ge.FAIRPLAY:return ct.FAIRPLAY;case Ge.PLAYREADY:return ct.PLAYREADY;case Ge.WIDEVINE:return ct.WIDEVINE;case Ge.CLEARKEY:return ct.CLEARKEY}}function ps(r){const{drmSystems:e,widevineLicenseUrl:t}=r,n=e?[Ge.FAIRPLAY,Ge.WIDEVINE,Ge.PLAYREADY,Ge.CLEARKEY].filter(i=>!!e[i]):[];return!n[Ge.WIDEVINE]&&t&&n.push(Ge.WIDEVINE),n}const Px=function(r){return Xo!=null&&(r=Xo.navigator)!=null&&r.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function AA(r,e,t,n){let i;switch(r){case Ge.FAIRPLAY:i=["cenc","sinf"];break;case Ge.WIDEVINE:case Ge.PLAYREADY:i=["cenc"];break;case Ge.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${r}`)}return CA(i,e,t,n)}function CA(r,e,t,n){return[{initDataTypes:r,persistentState:n.persistentState||"optional",distinctiveIdentifier:n.distinctiveIdentifier||"optional",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs=${s}`,robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null})),videoCapabilities:t.map(s=>({contentType:`video/mp4; codecs=${s}`,robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}))}]}function LA(r){var e;return!!r&&(r.sessionType==="persistent-license"||!!((e=r.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function Fx(r){const e=new Uint16Array(r.buffer,r.byteOffset,r.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),n=t.substring(t.indexOf("<"),t.length),a=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("KID")[0];if(a){const o=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(o){const u=Hf(o).subarray(0,16);return wx(u),u}}return null}let Ma={};class Kn{static clearKeyUriToKeyIdMap(){Ma={}}static setKeyIdForUri(e,t){Ma[e]=t}constructor(e,t,n,i=[1],s=null,a){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=i,this.iv=s,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!wi(e),a!=null&&a.startsWith("0x")&&(this.keyId=new Uint8Array(lx(a)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&qo(e.keyFormatVersions,this.keyFormatVersions)&&rp(e.iv,this.iv)&&rp(e.keyId,this.keyId)}isSupported(){if(this.method){if(wi(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case ct.FAIRPLAY:case ct.WIDEVINE:case ct.PLAYREADY:case ct.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(wi(this.method)){let s=this.iv;return s||(typeof e!="number"&&(Ce.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),s=IA(e)),new Kn(this.method,this.uri,"identity",this.keyFormatVersions,s)}if(this.keyId){const s=Ma[this.uri];if(s&&!qo(this.keyId,s)&&Kn.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const n=bx(this.uri);if(n)switch(this.keyFormat){case ct.WIDEVINE:if(this.pssh=n,!this.keyId){const s=kT(n.buffer);if(s.length){var i;const a=s[0];this.keyId=(i=a.kids)!=null&&i.length?a.kids[0]:null}}this.keyId||(this.keyId=np(t));break;case ct.PLAYREADY:{const s=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=DT(s,null,n),this.keyId=Fx(n);break}default:{let s=n.subarray(0,16);if(s.length!==16){const a=new Uint8Array(16);a.set(s,16-s.length),s=a}this.keyId=s;break}}if(!this.keyId||this.keyId.byteLength!==16){let s;s=RA(t),s||(s=np(t),s||(s=Ma[this.uri])),s&&(this.keyId=s,Kn.setKeyIdForUri(this.uri,s))}return this}}function RA(r){const e=r==null?void 0:r[ct.WIDEVINE];return e?e.keyId:null}function np(r){const e=r==null?void 0:r[ct.PLAYREADY];if(e){const t=bx(e.uri);if(t)return Fx(t)}return null}function IA(r){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=r>>8*(15-t)&255;return e}const ip=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,sp=/#EXT-X-MEDIA:(.*)/g,_A=/^#EXT(?:INF|-X-TARGETDURATION):/m,uu=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),DA=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class kr{static findGroup(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(i.id===t)return i}}static resolve(e,t){return Pf.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return _A.test(e)}static parseMasterPlaylist(e,t){const n=Jh(e),i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:n},s=[];if(ip.lastIndex=0,!e.startsWith("#EXTM3U"))return i.playlistParsingError=new Error("no EXTM3U delimiter"),i;let a;for(;(a=ip.exec(e))!=null;)if(a[1]){var o;const l=new $e(a[1],i),c=hd(i,a[2]),d={attrs:l,bitrate:l.decimalInteger("BANDWIDTH")||l.decimalInteger("AVERAGE-BANDWIDTH"),name:l.NAME,url:kr.resolve(c,t)},f=l.decimalResolution("RESOLUTION");f&&(d.width=f.width,d.height=f.height),lp(l.CODECS,d);const h=l["SUPPLEMENTAL-CODECS"];h&&(d.supplemental={},lp(h,d.supplemental)),(o=d.unknownCodecs)!=null&&o.length||s.push(d),i.levels.push(d)}else if(a[3]){const l=a[3],c=a[4];switch(l){case"SESSION-DATA":{const d=new $e(c,i),f=d["DATA-ID"];f&&(i.sessionData===null&&(i.sessionData={}),i.sessionData[f]=d);break}case"SESSION-KEY":{const d=ap(c,t,i);d.encrypted&&d.isSupported()?(i.sessionKeys===null&&(i.sessionKeys=[]),i.sessionKeys.push(d)):Ce.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${c}"`);break}case"DEFINE":{{const d=new $e(c,i);ep(i,d,t)}break}case"CONTENT-STEERING":{const d=new $e(c,i);i.contentSteering={uri:kr.resolve(d["SERVER-URI"],t),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":{i.startTimeOffset=op(c);break}}}const u=s.length>0&&s.length<i.levels.length;return i.levels=u?s:i.levels,i.levels.length===0&&(i.playlistParsingError=new Error("no levels found in manifest")),i}static parseMasterPlaylistMedia(e,t,n){let i;const s={},a=n.levels,o={AUDIO:a.map(l=>({id:l.attrs.AUDIO,audioCodec:l.audioCodec})),SUBTITLES:a.map(l=>({id:l.attrs.SUBTITLES,textCodec:l.textCodec})),"CLOSED-CAPTIONS":[]};let u=0;for(sp.lastIndex=0;(i=sp.exec(e))!==null;){const l=new $e(i[1],n),c=l.TYPE;if(c){const d=o[c],f=s[c]||[];s[c]=f;const h=l.LANGUAGE,p=l["ASSOC-LANGUAGE"],x=l.CHANNELS,v=l.CHARACTERISTICS,y=l["INSTREAM-ID"],g={attrs:l,bitrate:0,id:u++,groupId:l["GROUP-ID"]||"",name:l.NAME||h||"",type:c,default:l.bool("DEFAULT"),autoselect:l.bool("AUTOSELECT"),forced:l.bool("FORCED"),lang:h,url:l.URI?kr.resolve(l.URI,t):""};if(p&&(g.assocLang=p),x&&(g.channels=x),v&&(g.characteristics=v),y&&(g.instreamId=y),d!=null&&d.length){const m=kr.findGroup(d,g.groupId)||d[0];up(g,m,"audioCodec"),up(g,m,"textCodec")}f.push(g)}}return s}static parseLevelPlaylist(e,t,n,i,s,a){var o;const u={url:t},l=new SA(t),c=l.fragments,d=[];let f=null,h=0,p=0,x=0,v=0,y=0,g=null,m=new su(i,u),E,T,L,A=-1,R=!1,I=null,C;if(uu.lastIndex=0,l.m3u8=e,l.hasVariableRefs=Jh(e),((o=uu.exec(e))==null?void 0:o[0])!=="#EXTM3U")return l.playlistParsingError=new Error("Missing format identifier #EXTM3U"),l;for(;(E=uu.exec(e))!==null;){R&&(R=!1,m=new su(i,u),m.playlistOffset=x,m.setStart(x),m.sn=h,m.cc=v,y&&(m.bitrate=y),m.level=n,f&&(m.initSegment=f,f.rawProgramDateTime&&(m.rawProgramDateTime=f.rawProgramDateTime,f.rawProgramDateTime=null),I&&(m.setByteRange(I),I=null)));const V=E[1];if(V){m.duration=parseFloat(V);const j=(" "+E[2]).slice(1);m.title=j||null,m.tagList.push(j?["INF",V,j]:["INF",V])}else if(E[3]){if(Z(m.duration)){m.playlistOffset=x,m.setStart(x),L&&dp(m,L,l),m.sn=h,m.level=n,m.cc=v,c.push(m);const j=(" "+E[3]).slice(1);m.relurl=hd(l,j),gd(m,g,d),g=m,x+=m.duration,h++,p=0,R=!0}}else{if(E=E[0].match(DA),!E){Ce.warn("No matches on slow regex match for level playlist!");continue}for(T=1;T<E.length&&E[T]===void 0;T++);const j=(" "+E[T]).slice(1),G=(" "+E[T+1]).slice(1),Y=E[T+2]?(" "+E[T+2]).slice(1):null;switch(j){case"BYTERANGE":g?m.setByteRange(G,g):m.setByteRange(G);break;case"PROGRAM-DATE-TIME":m.rawProgramDateTime=G,m.tagList.push(["PROGRAM-DATE-TIME",G]),A===-1&&(A=c.length);break;case"PLAYLIST-TYPE":l.type&&Mr(l,j,E),l.type=G.toUpperCase();break;case"MEDIA-SEQUENCE":l.startSN!==0?Mr(l,j,E):c.length>0&&fp(l,j,E),h=l.startSN=parseInt(G);break;case"SKIP":{l.skippedSegments&&Mr(l,j,E);const O=new $e(G,l),H=O.decimalInteger("SKIPPED-SEGMENTS");if(Z(H)){l.skippedSegments+=H;for(let w=H;w--;)c.push(null);h+=H}const K=O.enumeratedString("RECENTLY-REMOVED-DATERANGES");K&&(l.recentlyRemovedDateranges=(l.recentlyRemovedDateranges||[]).concat(K.split("	")));break}case"TARGETDURATION":l.targetduration!==0&&Mr(l,j,E),l.targetduration=Math.max(parseInt(G),1);break;case"VERSION":l.version!==null&&Mr(l,j,E),l.version=parseInt(G);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":l.live||Mr(l,j,E),l.live=!1;break;case"#":(G||Y)&&m.tagList.push(Y?[G,Y]:[G]);break;case"DISCONTINUITY":v++,m.tagList.push(["DIS"]);break;case"GAP":m.gap=!0,m.tagList.push([j]);break;case"BITRATE":m.tagList.push([j,G]),y=parseInt(G)*1e3,Z(y)?m.bitrate=y:y=0;break;case"DATERANGE":{const O=new $e(G,l),H=new kx(O,l.dateRanges[O.ID],l.dateRangeTagCount);l.dateRangeTagCount++,H.isValid||l.skippedSegments?l.dateRanges[H.id]=H:Ce.warn(`Ignoring invalid DATERANGE tag: "${G}"`),m.tagList.push(["EXT-X-DATERANGE",G]);break}case"DEFINE":{{const O=new $e(G,l);"IMPORT"in O?gA(l,O,a):ep(l,O,t)}break}case"DISCONTINUITY-SEQUENCE":l.startCC!==0?Mr(l,j,E):c.length>0&&fp(l,j,E),l.startCC=v=parseInt(G);break;case"KEY":{const O=ap(G,t,l);if(O.isSupported()){if(O.method==="NONE"){L=void 0;break}L||(L={});const H=L[O.keyFormat];H!=null&&H.matches(O)||(H&&(L=Re({},L)),L[O.keyFormat]=O)}else Ce.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${G}"`);break}case"START":l.startTimeOffset=op(G);break;case"MAP":{const O=new $e(G,l);if(m.duration){const H=new su(i,u);cp(H,O,n,L),f=H,m.initSegment=f,f.rawProgramDateTime&&!m.rawProgramDateTime&&(m.rawProgramDateTime=f.rawProgramDateTime)}else{const H=m.byteRangeEndOffset;if(H){const K=m.byteRangeStartOffset;I=`${H-K}@${K}`}else I=null;cp(m,O,n,L),f=m,R=!0}f.cc=v;break}case"SERVER-CONTROL":{C&&Mr(l,j,E),C=new $e(G),l.canBlockReload=C.bool("CAN-BLOCK-RELOAD"),l.canSkipUntil=C.optionalFloat("CAN-SKIP-UNTIL",0),l.canSkipDateRanges=l.canSkipUntil>0&&C.bool("CAN-SKIP-DATERANGES"),l.partHoldBack=C.optionalFloat("PART-HOLD-BACK",0),l.holdBack=C.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{l.partTarget&&Mr(l,j,E);const O=new $e(G);l.partTarget=O.decimalFloatingPoint("PART-TARGET");break}case"PART":{let O=l.partList;O||(O=l.partList=[]);const H=p>0?O[O.length-1]:void 0,K=p++,w=new $e(G,l),P=new gT(w,m,u,K,H);O.push(P),m.duration+=P.duration;break}case"PRELOAD-HINT":{const O=new $e(G,l);l.preloadHint=O;break}case"RENDITION-REPORT":{const O=new $e(G,l);l.renditionReports=l.renditionReports||[],l.renditionReports.push(O);break}default:Ce.warn(`line parsed but not handled: ${E}`);break}}}g&&!g.relurl?(c.pop(),x-=g.duration,l.partList&&(l.fragmentHint=g)):l.partList&&(gd(m,g,d),m.cc=v,l.fragmentHint=m,L&&dp(m,L,l)),l.targetduration||(l.playlistParsingError=new Error("Missing Target Duration"));const _=c.length,F=c[0],B=c[_-1];if(x+=l.skippedSegments*l.targetduration,x>0&&_&&B){l.averagetargetduration=x/_;const V=B.sn;l.endSN=V!=="initSegment"?V:0,l.live||(B.endList=!0),A>0&&(wA(c,A),F&&d.unshift(F))}return l.fragmentHint&&(x+=l.fragmentHint.duration),l.totalduration=x,d.length&&l.dateRangeTagCount&&F&&Bx(d,l),l.endCC=v,l}}function Bx(r,e){let t=r.length;if(!t)if(e.hasProgramDateTime){const o=e.fragments[e.fragments.length-1];r.push(o),t++}else return;const n=r[t-1],i=e.live?1/0:e.totalduration,s=Object.keys(e.dateRanges);for(let o=s.length;o--;){const u=e.dateRanges[s[o]],l=u.startDate.getTime();u.tagAnchor=n.ref;for(let c=t;c--;){var a;if(((a=r[c])==null?void 0:a.sn)<e.startSN)break;const d=kA(e,l,r,c,i);if(d!==-1){u.tagAnchor=e.fragments[d].ref;break}}}}function kA(r,e,t,n,i){const s=t[n];if(s){const o=s.programDateTime;if(e>=o||n===0){var a;const u=(((a=t[n+1])==null?void 0:a.start)||i)-s.start;if(e<=o+u*1e3){const l=t[n].sn-r.startSN;if(l<0)return-1;const c=r.fragments;if(c.length>t.length){const f=(t[n+1]||c[c.length-1]).sn-r.startSN;for(let h=f;h>l;h--){const p=c[h].programDateTime;if(e>=p&&e<p+c[h].duration*1e3)return h}}return l}}}return-1}function ap(r,e,t){var n,i;const s=new $e(r,t),a=(n=s.METHOD)!=null?n:"",o=s.URI,u=s.hexadecimalInteger("IV"),l=s.KEYFORMATVERSIONS,c=(i=s.KEYFORMAT)!=null?i:"identity";o&&s.IV&&!u&&Ce.error(`Invalid IV: ${s.IV}`);const d=o?kr.resolve(o,e):"",f=(l||"1").split("/").map(Number).filter(Number.isFinite);return new Kn(a,d,c,f,u,s.KEYID)}function op(r){const t=new $e(r).decimalFloatingPoint("TIME-OFFSET");return Z(t)?t:null}function lp(r,e){let t=(r||"").split(/[ ,]+/).filter(n=>n);["video","audio","text"].forEach(n=>{const i=t.filter(s=>Of(s,n));i.length&&(e[`${n}Codec`]=i.map(s=>s.split("/")[0]).join(","),t=t.filter(s=>i.indexOf(s)===-1))}),e.unknownCodecs=t}function up(r,e,t){const n=e[t];n&&(r[t]=n)}function wA(r,e){let t=r[e];for(let n=e;n--;){const i=r[n];if(!i)return;i.programDateTime=t.programDateTime-i.duration*1e3,t=i}}function gd(r,e,t){r.rawProgramDateTime?t.push(r):e!=null&&e.programDateTime&&(r.programDateTime=e.endProgramDateTime)}function cp(r,e,t,n){r.relurl=e.URI,e.BYTERANGE&&r.setByteRange(e.BYTERANGE),r.level=t,r.sn="initSegment",n&&(r.levelkeys=n),r.initSegment=null}function dp(r,e,t){r.levelkeys=e;const{encryptedFragments:n}=t;(!n.length||n[n.length-1].levelkeys!==e)&&Object.keys(e).some(i=>e[i].isCommonEncryption)&&n.push(r)}function Mr(r,e,t){r.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function fp(r,e,t){r.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function cu(r,e){const t=e.startPTS;if(Z(t)){let n=0,i;e.sn>r.sn?(n=t-r.start,i=r):(n=r.start-t,i=e),i.duration!==n&&i.setDuration(n)}else e.sn>r.sn?r.cc===e.cc&&r.minEndPTS?e.setStart(r.start+(r.minEndPTS-r.start)):e.setStart(r.start+r.duration):e.setStart(Math.max(r.start-e.duration,0))}function Ox(r,e,t,n,i,s,a){n-t<=0&&(a.warn("Fragment should have a positive duration",e),n=t+e.duration,s=i+e.duration);let u=t,l=n;const c=e.startPTS,d=e.endPTS;if(Z(c)){const y=Math.abs(c-t);r&&y>r.totalduration?a.warn(`media timestamps and playlist times differ by ${y}s for level ${e.level} ${r.url}`):Z(e.deltaPTS)?e.deltaPTS=Math.max(y,e.deltaPTS):e.deltaPTS=y,u=Math.max(t,c),t=Math.min(t,c),i=e.startDTS!==void 0?Math.min(i,e.startDTS):i,l=Math.min(n,d),n=Math.max(n,d),s=e.endDTS!==void 0?Math.max(s,e.endDTS):s}const f=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(n-e.start),e.startPTS=t,e.maxStartPTS=u,e.startDTS=i,e.endPTS=n,e.minEndPTS=l,e.endDTS=s;const h=e.sn;if(!r||h<r.startSN||h>r.endSN)return 0;let p;const x=h-r.startSN,v=r.fragments;for(v[x]=e,p=x;p>0;p--)cu(v[p],v[p-1]);for(p=x;p<v.length-1;p++)cu(v[p],v[p+1]);return r.fragmentHint&&cu(v[v.length-1],r.fragmentHint),r.PTSKnown=r.alignedSliding=!0,f}function bA(r,e,t){if(r===e)return;let n=null;const i=r.fragments;for(let c=i.length-1;c>=0;c--){const d=i[c].initSegment;if(d){n=d;break}}r.fragmentHint&&delete r.fragmentHint.endPTS;let s;BA(r,e,(c,d,f,h)=>{if((!e.startCC||e.skippedSegments)&&d.cc!==c.cc){const p=c.cc-d.cc;for(let x=f;x<h.length;x++)h[x].cc+=p;e.endCC=h[h.length-1].cc}Z(c.startPTS)&&Z(c.endPTS)&&(d.setStart(d.startPTS=c.startPTS),d.startDTS=c.startDTS,d.maxStartPTS=c.maxStartPTS,d.endPTS=c.endPTS,d.endDTS=c.endDTS,d.minEndPTS=c.minEndPTS,d.setDuration(c.endPTS-c.startPTS),d.duration&&(s=d),e.PTSKnown=e.alignedSliding=!0),c.hasStreams&&(d.elementaryStreams=c.elementaryStreams),d.loader=c.loader,c.hasStats&&(d.stats=c.stats),c.initSegment&&(d.initSegment=c.initSegment,n=c.initSegment)});const a=e.fragments,o=e.fragmentHint?a.concat(e.fragmentHint):a;if(n&&o.forEach(c=>{var d;c&&(!c.initSegment||c.initSegment.relurl===((d=n)==null?void 0:d.relurl))&&(c.initSegment=n)}),e.skippedSegments){if(e.deltaUpdateFailed=a.some(c=>!c),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let c=e.skippedSegments;c--;)a.shift();e.startSN=a[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=PA(r.dateRanges,e,t));const c=r.fragments.filter(d=>d.rawProgramDateTime);if(r.hasProgramDateTime&&!e.hasProgramDateTime)for(let d=1;d<o.length;d++)o[d].programDateTime===null&&gd(o[d],o[d-1],c);Bx(c,e)}e.endCC=a[a.length-1].cc}if(!e.startCC){var u;const c=$x(r,e.startSN-1);e.startCC=(u=c==null?void 0:c.cc)!=null?u:a[0].cc}FA(r.partList,e.partList,(c,d)=>{d.elementaryStreams=c.elementaryStreams,d.stats=c.stats}),s?Ox(e,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS,t):Mx(r,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=r.driftStartTime,e.driftStart=r.driftStart;const l=e.advancedDateTime;if(e.advanced&&l){const c=e.edge;e.driftStart||(e.driftStartTime=l,e.driftStart=c),e.driftEndTime=l,e.driftEnd=c}else e.driftEndTime=r.driftEndTime,e.driftEnd=r.driftEnd,e.advancedDateTime=r.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=r.requestScheduled)}function PA(r,e,t){const{dateRanges:n,recentlyRemovedDateranges:i}=e,s=Re({},r);i&&i.forEach(u=>{delete s[u]});const o=Object.keys(s).length;return o?(Object.keys(n).forEach(u=>{const l=s[u],c=new kx(n[u].attr,l);c.isValid?(s[u]=c,l||(c.tagOrder+=o)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${_e(n[u].attr)}"`)}),s):n}function FA(r,e,t){if(r&&e){let n=0;for(let i=0,s=r.length;i<=s;i++){const a=r[i],o=e[i+n];a&&o&&a.index===o.index&&a.fragment.sn===o.fragment.sn?t(a,o):n--}}}function BA(r,e,t){const n=e.skippedSegments,i=Math.max(r.startSN,e.startSN)-e.startSN,s=(r.fragmentHint?1:0)+(n?e.endSN:Math.min(r.endSN,e.endSN))-e.startSN,a=e.startSN-r.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,u=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments;for(let l=i;l<=s;l++){const c=u[a+l];let d=o[l];if(n&&!d&&c&&(d=e.fragments[l]=c),c&&d){t(c,d,l,o);const f=c.relurl,h=d.relurl;if(f&&OA(f,h)){e.playlistParsingError=hp(`media sequence mismatch ${d.sn}:`,r,e,c,d);return}else if(c.cc!==d.cc){e.playlistParsingError=hp(`discontinuity sequence mismatch (${c.cc}!=${d.cc})`,r,e,c,d);return}}}}function hp(r,e,t,n,i){return new Error(`${r} ${i.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function Mx(r,e,t=!0){const n=e.startSN+e.skippedSegments-r.startSN,i=r.fragments,s=n>=0;let a=0;if(s&&n<i.length)a=i[n].start;else if(s&&e.startSN===r.endSN+1)a=r.fragmentEnd;else if(s&&t)a=r.fragmentStart+n*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)a=r.fragmentStart;else return;md(e,a)}function md(r,e){if(e){const t=r.fragments;for(let n=r.skippedSegments;n<t.length;n++)t[n].addStart(e);r.fragmentHint&&r.fragmentHint.addStart(e)}}function Nx(r,e=1/0){let t=1e3*r.targetduration;if(r.updated){const n=r.fragments;if(n.length&&t*4>e){const s=n[n.length-1].duration*1e3;s<t&&(t=s)}}else t/=2;return Math.round(t)}function $x(r,e,t){if(!r)return null;let n=r.fragments[e-r.startSN];return n||(n=r.fragmentHint,n&&n.sn===e)?n:e<r.startSN&&t&&t.sn===e?t:null}function pp(r,e,t){return r?Ux(r.partList,e,t):null}function Ux(r,e,t){if(r)for(let n=r.length;n--;){const i=r[n];if(i.index===t&&i.fragment.sn===e)return i}return null}function Gx(r){r.forEach((e,t)=>{var n;(n=e.details)==null||n.fragments.forEach(i=>{i.level=t,i.initSegment&&(i.initSegment.level=t)})})}function OA(r,e){return r!==e&&e?gp(r)!==gp(e):!1}function gp(r){return r.replace(/\?[^?]*$/,"")}function Cs(r,e){for(let n=0,i=r.length;n<i;n++){var t;if(((t=r[n])==null?void 0:t.cc)===e)return r[n]}return null}function MA(r,e){return!!(r&&e.startCC<r.endCC&&e.endCC>r.startCC)}function mp(r,e){const t=r.start+e;r.startPTS=t,r.setStart(t),r.endPTS=t+r.duration}function Hx(r,e){const t=e.fragments;for(let n=0,i=t.length;n<i;n++)mp(t[n],r);e.fragmentHint&&mp(e.fragmentHint,r),e.alignedSliding=!0}function NA(r,e){r&&(Vx(e,r),e.alignedSliding||Qo(e,r),!e.alignedSliding&&!e.skippedSegments&&Mx(r,e,!1))}function Vx(r,e){if(!MA(e,r))return;const t=Math.min(e.endCC,r.endCC),n=Cs(e.fragments,t),i=Cs(r.fragments,t);if(!n||!i)return;Ce.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const s=n.start-i.start;Hx(s,r)}function Qo(r,e){if(!r.hasProgramDateTime||!e.hasProgramDateTime)return;const t=r.fragments,n=e.fragments;if(!t.length||!n.length)return;let i,s;const a=Math.min(e.endCC,r.endCC);e.startCC<a&&r.startCC<a&&(i=Cs(n,a),s=Cs(t,a)),(!i||!s)&&(i=n[Math.floor(n.length/2)],s=Cs(t,i.cc)||t[Math.floor(t.length/2)]);const o=i.programDateTime,u=s.programDateTime;if(!o||!u)return;const l=(u-o)/1e3-(s.start-i.start);Hx(l,r)}function Rt(r,e,t){Bt(r,e,t),r.addEventListener(e,t)}function Bt(r,e,t){r.removeEventListener(e,t)}const $A={toString:function(r){let e="";const t=r.length;for(let n=0;n<t;n++)e+=`[${r.start(n).toFixed(3)}-${r.end(n).toFixed(3)}]`;return e}},z={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Vf extends _x{constructor(e,t,n,i,s){super(i,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=z.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:a,fragCurrent:o,media:u,mediaBuffer:l,state:c}=this,d=u?u.currentTime:0,f=ue.bufferInfo(l||u,d,a.maxBufferHole),h=!f.len;if(this.log(`Media seeking to ${Z(d)?d.toFixed(3):d}, state: ${c}, ${h?"out of":"in"} buffer`),this.state===z.ENDED)this.resetLoadingState();else if(o){const p=a.maxFragLookUpTolerance,x=o.start-p,v=o.start+o.duration+p;if(h||v<f.start||x>f.end){const y=d>v;(d<x||y)&&(y&&o.loader&&(this.log(`Cancelling fragment load for seek (sn: ${o.sn})`),o.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(u){this.fragmentTracker.removeFragmentsInRange(d,1/0,this.playlistType,!0);const p=this.lastCurrentTime;if(d>p&&(this.lastCurrentTime=d),!this.loadingParts){const x=Math.max(f.end,d),v=this.shouldLoadParts(this.getLevelDetails(),x);v&&(this.log(`LL-Part loading ON after seeking to ${d.toFixed(2)} with buffer @${x.toFixed(2)}`),this.loadingParts=v)}}this.hls.hasEnoughToStart||(this.log(`Setting ${h?"startPosition":"nextLoadPosition"} to ${d} for seek without enough to start`),this.nextLoadPosition=d,h&&(this.startPosition=d)),h&&this.state===z.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=s,this.hls=e,this.fragmentLoader=new hA(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new $f(e.config)}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===z.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=z.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const n=e.end||0,i=this.config.timelineOffset||0;if(n<=i)return!1;const s=e.buffered;this.config.maxBufferHole&&s&&s.length>1&&(e=ue.bufferedInfo(s,e.start,0));const a=e.nextStart;if(a&&a>i&&a<t.edge||this.media.currentTime<e.start)return!1;const u=t.partList;if(u!=null&&u.length){const c=u[u.length-1];return ue.isBuffered(this.media,c.start+c.duration/2)}const l=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(l)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const n=this.media=this.mediaBuffer=t.media;Rt(n,"seeking",this.onMediaSeeking),Rt(n,"ended",this.onMediaEnded);const i=this.config;this.levels&&i.autoStartLoad&&this.state===z.STOPPED&&this.startLoad(i.startPosition)}onMediaDetaching(e,t){const n=!!t.transferMedia,i=this.media;if(i!==null){if(i.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Bt(i,"seeking",this.onMediaSeeking),Bt(i,"ended",this.onMediaEnded),this.keyLoader&&!n&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,n){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=z.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this.startFragRequested=!0,this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){const i=s=>{const a=s.frag;if(this.fragContextChanged(a)){this.warn(`${a.type} sn: ${a.sn}${s.part?" part: "+s.part.index:""} of ${this.fragInfo(a,!1,s.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(a);return}a.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(e,t,n,i).then(s=>{if(!s)return;const a=this.state,o=s.frag;if(this.fragContextChanged(o)){(a===z.FRAG_LOADING||!this.fragCurrent&&a===z.PARSING)&&(this.fragmentTracker.removeFragment(o),this.state=z.IDLE);return}"payload"in s&&(this.log(`Loaded ${o.type} sn: ${o.sn} of ${this.playlistLabel()} ${o.level}`),this.hls.trigger(S.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===z.STOPPED||this.state===z.ERROR||(this.warn(`Frag error: ${(s==null?void 0:s.message)||s}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:n}=this;if(n.getState(e)===et.APPENDING){const s=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,s),o=Math.max(e.duration,a?a.len:this.config.maxBufferLength),u=this.backtrackFragment;((u?e.sn-u.sn:0)===1||this.reduceMaxBufferLength(o,e.duration))&&n.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===et.PARTIAL&&n.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,n=null){if(!(e-t))return;const i={startOffset:e,endOffset:t,type:n};this.hls.trigger(S.BUFFER_FLUSHING,i)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(n=>{const i=n==null?void 0:n.frag;if(!i||this.fragContextChanged(i)||!this.levels)throw new Error("init load aborted");return n}).then(n=>{const{hls:i}=this,{frag:s,payload:a}=n,o=s.decryptdata;if(a&&a.byteLength>0&&o!=null&&o.key&&o.iv&&wi(o.method)){const u=self.performance.now();return this.decrypter.decrypt(new Uint8Array(a),o.key.buffer,o.iv.buffer,Gf(o.method)).catch(l=>{throw i.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:N.FRAG_DECRYPT_ERROR,fatal:!1,error:l,reason:l.message,frag:s}),l}).then(l=>{const c=self.performance.now();return i.trigger(S.FRAG_DECRYPTED,{frag:s,payload:l,stats:{tstart:u,tdecrypt:c}}),n.payload=l,this.completeInitSegmentLoad(n)})}return this.completeInitSegmentLoad(n)}).catch(n=>{this.state===z.STOPPED||this.state===z.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const n=e.frag.stats;this.state!==z.STOPPED&&(this.state=z.IDLE),e.frag.data=new Uint8Array(e.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var n,i;const s=e.tracks;if(s&&!t.encrypted&&((n=s.audio)!=null&&n.encrypted||(i=s.video)!=null&&i.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const a=this.media,o=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${a?"attached mediaKeys: "+a.mediaKeys:"detached"})`);return this.warn(o.message),!a||a.mediaKeys?!1:(this.hls.trigger(S.ERROR,{type:re.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_KEYS,fatal:!1,error:o,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const n=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${n?$A.toString(ue.getBuffered(n)):"(detached)"})`),Xe(e)){var i;if(e.type!==ee.SUBTITLE){const a=e.elementaryStreams;if(!Object.keys(a).some(o=>!!a[o])){this.state=z.IDLE;return}}const s=(i=this.levels)==null?void 0:i[e.level];s!=null&&s.fragmentError&&(this.log(`Resetting level fragment error count of ${s.fragmentError} on frag buffered`),s.fragmentError=0)}this.state=z.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:n,part:i,partsLoaded:s}=e,a=!s||s.length===0||s.some(u=>!u),o=new Uf(n.level,n.sn,n.stats.chunkCount+1,0,i?i.index:-1,!a);t.flush(o)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,n=null,i){var s;this.fragCurrent=e;const a=t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let o=null;if(e.encrypted&&!((s=e.decryptdata)!=null&&s.key)){if(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=z.KEY_LOADING,this.fragCurrent=e,o=this.keyLoader.load(e).then(f=>{if(!this.fragContextChanged(f.frag))return this.hls.trigger(S.KEY_LOADED,f),this.state===z.KEY_LOADING&&(this.state=z.IDLE),f}),this.hls.trigger(S.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(o=this.keyLoader.loadClear(e,a.encryptedFragments,this.startFragRequested),o&&this.log("[eme] blocking frag load until media-keys acquired"));const u=this.fragPrevious;if(Xe(e)&&(!u||e.sn!==u.sn)){const f=this.shouldLoadParts(t.details,e.end);f!==this.loadingParts&&(this.log(`LL-Part loading ${f?"ON":"OFF"} loading sn ${u==null?void 0:u.sn}->${e.sn}`),this.loadingParts=f)}if(n=Math.max(e.start,n||0),this.loadingParts&&Xe(e)){const f=a.partList;if(f&&i){n>a.fragmentEnd&&a.fragmentHint&&(e=a.fragmentHint);const h=this.getNextPart(f,e,n);if(h>-1){const p=f[h];e=this.fragCurrent=p.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${p.index} (${h}/${f.length-1}) of ${this.fragInfo(e,!1,p)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=p.start+p.duration,this.state=z.FRAG_LOADING;let x;return o?x=o.then(v=>!v||this.fragContextChanged(v.frag)?null:this.doFragPartsLoad(e,p,t,i)).catch(v=>this.handleFragLoadError(v)):x=this.doFragPartsLoad(e,p,t,i).catch(v=>this.handleFragLoadError(v)),this.hls.trigger(S.FRAG_LOADING,{frag:e,part:p,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):x}else if(!e.url||this.loadedEndOfParts(f,n))return Promise.resolve(null)}}if(Xe(e)&&this.loadingParts){var l;this.log(`LL-Part loading OFF after next part miss @${n.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(l=a.partList)==null?void 0:l.filter(f=>f.loaded).map(f=>`[${f.start}-${f.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+a.startSN+"-"+a.endSN+"]"}, target: ${parseFloat(n.toFixed(3))}`),Z(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=z.FRAG_LOADING;const c=this.config.progressive;let d;return c&&o?d=o.then(f=>!f||this.fragContextChanged(f.frag)?null:this.fragmentLoader.load(e,i)).catch(f=>this.handleFragLoadError(f)):d=Promise.all([this.fragmentLoader.load(e,c?i:void 0),o]).then(([f])=>(!c&&i&&i(f),f)).catch(f=>this.handleFragLoadError(f)),this.hls.trigger(S.FRAG_LOADING,{frag:e,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):d}doFragPartsLoad(e,t,n,i){return new Promise((s,a)=>{var o;const u=[],l=(o=n.details)==null?void 0:o.partList,c=d=>{this.fragmentLoader.loadPart(e,d,i).then(f=>{u[d.index]=f;const h=f.part;this.hls.trigger(S.FRAG_LOADED,f);const p=pp(n.details,e.sn,d.index+1)||Ux(l,e.sn,d.index+1);if(p)c(p);else return s({frag:e,part:h,partsLoaded:u})}).catch(a)};c(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===N.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===re.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(S.ERROR,t)}else this.hls.trigger(S.ERROR,{type:re.OTHER_ERROR,details:N.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==z.PARSING){!this.fragCurrent&&this.state!==z.STOPPED&&this.state!==z.ERROR&&(this.state=z.IDLE);return}const{frag:n,part:i,level:s}=t,a=self.performance.now();n.stats.parsing.end=a,i&&(i.stats.parsing.end=a);const o=this.getLevelDetails(),l=o&&n.sn>o.endSN||this.shouldLoadParts(o,n.end);l!==this.loadingParts&&(this.log(`LL-Part loading ${l?"ON":"OFF"} after parsing segment ending @${n.end.toFixed(2)}`),this.loadingParts=l),this.updateLevelTiming(n,i,s,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var n;const s=e.partList[0];if(s.fragment.type===ee.SUBTITLE)return!1;const a=s.end+(((n=e.fragmentHint)==null?void 0:n.duration)||0);if(t>=a){var i;if((this.hls.hasEnoughToStart?((i=this.media)==null?void 0:i.currentTime)||this.lastCurrentTime:this.getLoadPosition())>s.start-s.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:n}=this,{level:i,sn:s,part:a}=e;if(!(t!=null&&t[i]))return this.warn(`Levels object was unset while buffering fragment ${s} of ${this.playlistLabel()} ${i}. The current chunk will not be buffered.`),null;const o=t[i],u=o.details,l=a>-1?pp(u,s,a):null,c=l?l.fragment:$x(u,s,n);return c?(n&&n!==c&&(c.stats=n.stats),{frag:c,part:l,level:o}):null}bufferFragmentData(e,t,n,i,s){if(this.state!==z.PARSING)return;const{data1:a,data2:o}=e;let u=a;if(o&&(u=or(a,o)),!u.length)return;const l=this.initPTS[t.cc],c=l?-l.baseTime/l.timescale:void 0,d={type:e.type,frag:t,part:n,chunkMeta:i,offset:c,parent:t.type,data:u};if(this.hls.trigger(S.BUFFER_APPENDING,d),e.dropped&&e.independent&&!n){if(s)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!ue.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const n=t.currentTime,i=ue.bufferInfo(t,n,0),s=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),o=Math.max(Math.min(e.start-a,i.end-a),n+a);e.start-o>a&&this.flushMainBuffer(o,e.start)}getFwdBufferInfo(e,t){var n;const i=this.getLoadPosition();if(!Z(i))return null;const a=this.lastCurrentTime>i||(n=this.media)!=null&&n.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,i,t,a)}getFwdBufferInfoAtPos(e,t,n,i){const s=ue.bufferInfo(e,t,i);if(s.len===0&&s.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(t,n);if(a&&(s.nextStart<=a.end||a.gap)){const o=Math.max(Math.min(s.nextStart,a.end)-t,i);return ue.bufferInfo(e,t,o)}}return s}getMaxBufferLength(e){const{config:t}=this;let n;return e?n=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):n=t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const n=this.config,i=Math.max(Math.min(e-t,n.maxBufferLength),t),s=Math.max(e-t*3,n.maxMaxBufferLength/2,i);return s>=i?(n.maxMaxBufferLength=s,this.warn(`Reduce max buffer length to ${s}s`),!0):!1}getAppendedFrag(e,t=ee.MAIN){const n=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return n&&"fragment"in n?n.fragment:n}getNextFragment(e,t){const n=t.fragments,i=n.length;if(!i)return null;const{config:s}=this,a=n[0].start,o=s.lowLatencyMode&&!!t.partList;let u=null;if(t.live){const d=s.initialLiveManifestSize;if(i<d)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${d})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a){var l;o&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),u=this.getInitialLiveFragment(t);const f=this.hls.startPosition,h=this.hls.liveSyncPosition,p=u?(f!==-1&&f>=a?f:h)||u.start:e;this.log(`Setting startPosition to ${p} to match start frag at live edge. mainStart: ${f} liveSyncPosition: ${h} frag.start: ${(l=u)==null?void 0:l.start}`),this.startPosition=this.nextLoadPosition=p}}else e<=a&&(u=n[0]);if(!u){const d=this.loadingParts?t.partEnd:t.fragmentEnd;u=this.getFragmentAtPosition(e,d,t)}let c=this.filterReplacedPrimary(u,t);if(!c&&u){const d=u.sn-t.startSN;c=this.filterReplacedPrimary(n[d+1]||null,t)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(e,t){const n=this.fragmentTracker.getState(e);return(n===et.OK||n===et.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,i,s){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t),a&&!a.gap&&n.nextStart)){const o=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,i,0);if(o!==null&&n.len+o.len>=s){const u=a.sn;return this.loopSn!==u&&(this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${u}`),this.loopSn=u),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(xp(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(xp(this.config)&&e.type!==ee.SUBTITLE){const n=this.hls.interstitialsManager,i=n==null?void 0:n.bufferingItem;if(i){const a=i.event;if(a){if(a.appendInPlace||Math.abs(e.start-i.start)>1||i.start===0)return null}else if(e.end<=i.start&&(t==null?void 0:t.live)===!1||e.start>i.end&&i.nextEvent&&(i.nextEvent.appendInPlace||e.start-i.end>1))return null}const s=n==null?void 0:n.playerQueue;if(s)for(let a=s.length;a--;){const o=s[a].interstitial;if(o.appendInPlace&&e.start>=o.startTime&&e.end<=o.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,n){let i=-1,s=!1,a=!0;for(let o=0,u=e.length;o<u;o++){const l=e[o];if(a=a&&!l.independent,i>-1&&n<l.start)break;const c=l.loaded;c?i=-1:(s||(l.independent||a)&&l.fragment===t)&&(l.fragment!==t&&this.warn(`Need buffer at ${n} but next unloaded part starts at ${l.start}`),i=o),s=c}return i}loadedEndOfParts(e,t){let n;for(let i=e.length;i--;){if(n=e[i],!n.loaded)return!1;if(t>n.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,n=this.fragPrevious;let i=null;if(n){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),i=tA(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const s=n.sn+1;if(s>=e.startSN&&s<=e.endSN){const a=t[s-e.startSN];n.cc===a.cc&&(i=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=Lx(e,n.cc,n.end),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{const s=this.hls.liveSyncPosition;s!==null&&(i=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,t,n){const{config:i}=this;let{fragPrevious:s}=this,{fragments:a,endSN:o}=n;const{fragmentHint:u}=n,{maxFragLookUpTolerance:l}=i,c=n.partList,d=!!(this.loadingParts&&c!=null&&c.length&&u);d&&!this.bitrateTest&&c[c.length-1].fragment.sn===u.sn&&(a=a.concat(u),o=u.sn);let f;if(e<t){var h;const x=e<this.lastCurrentTime||e>t-l||(h=this.media)!=null&&h.paused||!this.startFragRequested?0:l;f=Qn(s,a,e,x)}else f=a[a.length-1];if(f){const p=f.sn-n.startSN,x=this.fragmentTracker.getState(f);if((x===et.OK||x===et.PARTIAL&&f.gap)&&(s=f),s&&f.sn===s.sn&&(!d||c[0].fragment.sn>f.sn||!n.live)&&f.level===s.level){const y=a[p+1];f.sn<o&&this.fragmentTracker.getState(y)!==et.OK?f=y:f=null}}return f}alignPlaylists(e,t,n){const i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const s=e.fragmentStart,a=!t,o=e.alignedSliding&&Z(s);if(a||!o&&!s){NA(n,e);const u=e.fragmentStart;return this.log(`Live playlist sliding: ${u.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${i}`),u}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let n=this.startPosition;n<t&&(n=-1);const i=this.timelineOffset;if(n===-1){const s=this.startTimeOffset!==null,a=s?this.startTimeOffset:e.startTimeOffset;a!==null&&Z(a)?(n=t+a,a<0&&(n+=e.edge),n=Math.min(Math.max(t,n),t+e.totalduration),this.log(`Setting startPosition to ${n} for start time offset ${a} found in ${s?"multivariant":"media"} playlist`),this.startPosition=n):e.live?(n=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${n}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=n=0),this.lastCurrentTime=n+i}this.nextLoadPosition=n+i}getLoadPosition(){var e;const{media:t}=this;let n=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?n=t.currentTime:this.nextLoadPosition>=0&&(n=this.nextLoadPosition),n}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Xe(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==z.FRAG_LOADING_WAITING_RETRY)&&(this.state=z.IDLE)}onFragmentOrKeyLoadError(e,t){var n;if(t.chunkMeta&&!t.frag){const y=this.getCurrentContext(t.chunkMeta);y&&(t.frag=y.frag)}const i=t.frag;if(!i||i.type!==e||!this.levels)return;if(this.fragContextChanged(i)){var s;this.warn(`Frag load error must match current frag to retry ${i.url} > ${(s=this.fragCurrent)==null?void 0:s.url}`);return}const a=t.details===N.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(i,!0);const o=t.errorAction;if(!o){this.state=z.ERROR;return}const{action:u,flags:l,retryCount:c=0,retryConfig:d}=o,f=!!d,h=f&&u===ut.RetryRequest,p=f&&!o.resolved&&l===jt.MoveAllAlternatesMatchingHost,x=(n=this.hls.latestLevelDetails)==null?void 0:n.live;if(!h&&p&&Xe(i)&&!i.endList&&x&&!Ix(t))this.resetFragmentErrors(e),this.treatAsGap(i),o.resolved=!0;else if((h||p)&&c<d.maxNumRetry){var v;const y=fd((v=t.response)==null?void 0:v.code),g=Nf(d,c);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+g,this.state=z.FRAG_LOADING_WAITING_RETRY,o.resolved=!0,y){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${i.sn} of ${e} ${i.level} errored with ${t.details}, retrying loading ${c+1}/${d.maxNumRetry} in ${g}ms`)}else if(d)if(this.resetFragmentErrors(e),c<d.maxNumRetry)!a&&u!==ut.RemoveAlternatePermanently&&(o.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${c})`);return}else u===ut.SendAlternateToPenaltyBox?this.state=z.WAITING_LEVEL:this.state=z.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,n=t===1/0;(!t||e>=t||n&&!fd(0))&&(n&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=z.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===z.PARSING||this.state===z.PARSED){const t=e.frag,n=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,n),s=i&&i.len>.5;s&&this.reduceMaxBufferLength(i.len,(t==null?void 0:t.duration)||10);const a=!s;return a&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${n} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===ee.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==z.STOPPED&&(this.state=z.IDLE)}afterBufferFlushed(e,t,n){if(!e)return;const i=ue.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,n),this.state===z.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==z.STOPPED&&(this.state=z.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,i){const s=n.details;if(!s){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((u,l)=>{const c=e.elementaryStreams[l];if(c){const d=c.endPTS-c.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${e.sn} ${l} duration reliably (${d})`),u||!1;const f=i?0:Ox(s,e,c.startPTS,c.endPTS,c.startDTS,c.endDTS,this);return this.hls.trigger(S.LEVEL_PTS_UPDATED,{details:s,level:n,drift:f,type:l,frag:e,start:c.startPTS,end:c.endPTS}),!0}return u},!1)){var o;if(n.fragmentError===0&&this.treatAsGap(e,n),((o=this.transmuxer)==null?void 0:o.error)===null){const u=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(u.message),this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!1,error:u,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=z.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(S.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===ee.MAIN?"level":"track"}fragInfo(e,t=!0,n){var i,s;return`${this.playlistLabel()} ${e.level} (${n?"part":"frag"}:[${((i=t&&!n?e.startPTS:(n||e).start)!=null?i:NaN).toFixed(3)}-${((s=t&&!n?e.endPTS:(n||e).end)!=null?s:NaN).toFixed(3)}]${n&&e.type==="main"?"INDEPENDENT="+(n.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function xp(r){return!!r.interstitialsController&&r.enableInterstitialPlayback!==!1}class jx{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let n;if(e.length)e.length===1?n=e[0]:n=UA(e,t);else return new Uint8Array(0);return this.reset(),n}reset(){this.chunks.length=0,this.dataLength=0}}function UA(r,e){const t=new Uint8Array(e);let n=0;for(let i=0;i<r.length;i++){const s=r[i];t.set(s,n),n+=s.length}return t}var du={exports:{}},vp;function GA(){return vp||(vp=1,function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function i(u,l,c){this.fn=u,this.context=l,this.once=c||!1}function s(u,l,c,d,f){if(typeof c!="function")throw new TypeError("The listener must be a function");var h=new i(c,d||u,f),p=t?t+l:l;return u._events[p]?u._events[p].fn?u._events[p]=[u._events[p],h]:u._events[p].push(h):(u._events[p]=h,u._eventsCount++),u}function a(u,l){--u._eventsCount===0?u._events=new n:delete u._events[l]}function o(){this._events=new n,this._eventsCount=0}o.prototype.eventNames=function(){var l=[],c,d;if(this._eventsCount===0)return l;for(d in c=this._events)e.call(c,d)&&l.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},o.prototype.listeners=function(l){var c=t?t+l:l,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,h=d.length,p=new Array(h);f<h;f++)p[f]=d[f].fn;return p},o.prototype.listenerCount=function(l){var c=t?t+l:l,d=this._events[c];return d?d.fn?1:d.length:0},o.prototype.emit=function(l,c,d,f,h,p){var x=t?t+l:l;if(!this._events[x])return!1;var v=this._events[x],y=arguments.length,g,m;if(v.fn){switch(v.once&&this.removeListener(l,v.fn,void 0,!0),y){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,c),!0;case 3:return v.fn.call(v.context,c,d),!0;case 4:return v.fn.call(v.context,c,d,f),!0;case 5:return v.fn.call(v.context,c,d,f,h),!0;case 6:return v.fn.call(v.context,c,d,f,h,p),!0}for(m=1,g=new Array(y-1);m<y;m++)g[m-1]=arguments[m];v.fn.apply(v.context,g)}else{var E=v.length,T;for(m=0;m<E;m++)switch(v[m].once&&this.removeListener(l,v[m].fn,void 0,!0),y){case 1:v[m].fn.call(v[m].context);break;case 2:v[m].fn.call(v[m].context,c);break;case 3:v[m].fn.call(v[m].context,c,d);break;case 4:v[m].fn.call(v[m].context,c,d,f);break;default:if(!g)for(T=1,g=new Array(y-1);T<y;T++)g[T-1]=arguments[T];v[m].fn.apply(v[m].context,g)}}return!0},o.prototype.on=function(l,c,d){return s(this,l,c,d,!1)},o.prototype.once=function(l,c,d){return s(this,l,c,d,!0)},o.prototype.removeListener=function(l,c,d,f){var h=t?t+l:l;if(!this._events[h])return this;if(!c)return a(this,h),this;var p=this._events[h];if(p.fn)p.fn===c&&(!f||p.once)&&(!d||p.context===d)&&a(this,h);else{for(var x=0,v=[],y=p.length;x<y;x++)(p[x].fn!==c||f&&!p[x].once||d&&p[x].context!==d)&&v.push(p[x]);v.length?this._events[h]=v.length===1?v[0]:v:a(this,h)}return this},o.prototype.removeAllListeners=function(l){var c;return l?(c=t?t+l:l,this._events[c]&&a(this,c)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,r.exports=o}(du)),du.exports}var HA=GA(),jf=hT(HA);const Ys="1.6.14",Hi={};function VA(){return typeof __HLS_WORKER_BUNDLE__=="function"}function jA(){const r=Hi[Ys];if(r)return r.clientCount++,r;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),i={worker:new self.Worker(t),objectURL:t,clientCount:1};return Hi[Ys]=i,i}function KA(r){const e=Hi[r];if(e)return e.clientCount++,e;const t=new self.URL(r,self.location.href).href,i={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Hi[r]=i,i}function zA(r){const e=Hi[r||Ys];if(e&&e.clientCount--===1){const{worker:n,objectURL:i}=e;delete Hi[r||Ys],i&&self.URL.revokeObjectURL(i),n.terminate()}}function Kx(r,e){return e+10<=r.length&&r[e]===51&&r[e+1]===68&&r[e+2]===73&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128}function Kf(r,e){return e+10<=r.length&&r[e]===73&&r[e+1]===68&&r[e+2]===51&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128}function yl(r,e){let t=0;return t=(r[e]&127)<<21,t|=(r[e+1]&127)<<14,t|=(r[e+2]&127)<<7,t|=r[e+3]&127,t}function qs(r,e){const t=e;let n=0;for(;Kf(r,e);){n+=10;const i=yl(r,e+6);n+=i,Kx(r,e+10)&&(n+=10),e+=n}if(n>0)return r.subarray(t,t+n)}function WA(r,e,t,n){const i=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],s=e[t+2],a=s>>2&15;if(a>12){const h=new Error(`invalid ADTS sampling index:${a}`);r.emit(S.ERROR,S.ERROR,{type:re.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!0,error:h,reason:h.message});return}const o=(s>>6&3)+1,u=e[t+3]>>6&3|(s&1)<<2,l="mp4a.40."+o,c=i[a];let d=a;(o===5||o===29)&&(d-=3);const f=[o<<3|(d&14)>>1,(d&1)<<7|u<<3];return Ce.log(`manifest codec:${n}, parsed codec:${l}, channels:${u}, rate:${c} (ADTS object type:${o} sampling index:${a})`),{config:f,samplerate:c,channelCount:u,codec:l,parsedCodec:l,manifestCodec:n}}function zx(r,e){return r[e]===255&&(r[e+1]&246)===240}function Wx(r,e){return r[e+1]&1?7:9}function zf(r,e){return(r[e+3]&3)<<11|r[e+4]<<3|(r[e+5]&224)>>>5}function YA(r,e){return e+5<r.length}function Zo(r,e){return e+1<r.length&&zx(r,e)}function qA(r,e){return YA(r,e)&&zx(r,e)&&zf(r,e)<=r.length-e}function XA(r,e){if(Zo(r,e)){const t=Wx(r,e);if(e+t>=r.length)return!1;const n=zf(r,e);if(n<=t)return!1;const i=e+n;return i===r.length||Zo(r,i)}return!1}function Yx(r,e,t,n,i){if(!r.samplerate){const s=WA(e,t,n,i);if(!s)return;Re(r,s)}}function qx(r){return 1024*9e4/r}function QA(r,e){const t=Wx(r,e);if(e+t<=r.length){const n=zf(r,e)-t;if(n>0)return{headerLength:t,frameLength:n}}}function Xx(r,e,t,n,i){const s=qx(r.samplerate),a=n+i*s,o=QA(e,t);let u;if(o){const{frameLength:d,headerLength:f}=o,h=f+d,p=Math.max(0,t+h-e.length);p?(u=new Uint8Array(h-f),u.set(e.subarray(t+f,e.length),0)):u=e.subarray(t+f,t+h);const x={unit:u,pts:a};return p||r.samples.push(x),{sample:x,length:h,missing:p}}const l=e.length-t;return u=new Uint8Array(l),u.set(e.subarray(t,e.length),0),{sample:{unit:u,pts:a},length:l,missing:-1}}function ZA(r,e){return Kf(r,e)&&yl(r,e+6)+10<=r.length-e}function JA(r){return r instanceof ArrayBuffer?r:r.byteOffset==0&&r.byteLength==r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer}function fu(r,e=0,t=1/0){return eC(r,e,t,Uint8Array)}function eC(r,e,t,n){const i=tC(r);let s=1;"BYTES_PER_ELEMENT"in n&&(s=n.BYTES_PER_ELEMENT);const a=rC(r)?r.byteOffset:0,o=(a+r.byteLength)/s,u=(a+e)/s,l=Math.floor(Math.max(0,Math.min(u,o))),c=Math.floor(Math.min(l+Math.max(t,0),o));return new n(i,l,c-l)}function tC(r){return r instanceof ArrayBuffer?r:r.buffer}function rC(r){return r&&r.buffer instanceof ArrayBuffer&&r.byteLength!==void 0&&r.byteOffset!==void 0}function nC(r){const e={key:r.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(r.size<2)return;if(r.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const n=r.data.subarray(1).indexOf(0);if(n===-1)return;const i=Xt(fu(r.data,1,n)),s=r.data[2+n],a=r.data.subarray(3+n).indexOf(0);if(a===-1)return;const o=Xt(fu(r.data,3+n,a));let u;return i==="-->"?u=Xt(fu(r.data,4+n+a)):u=JA(r.data.subarray(4+n+a)),e.mimeType=i,e.pictureType=s,e.description=o,e.data=u,e}function iC(r){if(r.size<2)return;const e=Xt(r.data,!0),t=new Uint8Array(r.data.subarray(e.length+1));return{key:r.type,info:e,data:t.buffer}}function sC(r){if(r.size<2)return;if(r.type==="TXXX"){let t=1;const n=Xt(r.data.subarray(t),!0);t+=n.length+1;const i=Xt(r.data.subarray(t));return{key:r.type,info:n,data:i}}const e=Xt(r.data.subarray(1));return{key:r.type,info:"",data:e}}function aC(r){if(r.type==="WXXX"){if(r.size<2)return;let t=1;const n=Xt(r.data.subarray(t),!0);t+=n.length+1;const i=Xt(r.data.subarray(t));return{key:r.type,info:n,data:i}}const e=Xt(r.data);return{key:r.type,info:"",data:e}}function oC(r){return r.type==="PRIV"?iC(r):r.type[0]==="W"?aC(r):r.type==="APIC"?nC(r):sC(r)}function lC(r){const e=String.fromCharCode(r[0],r[1],r[2],r[3]),t=yl(r,4),n=10;return{type:e,size:t,data:r.subarray(n,n+t)}}const Na=10,uC=10;function Qx(r){let e=0;const t=[];for(;Kf(r,e);){const n=yl(r,e+6);r[e+5]>>6&1&&(e+=Na),e+=Na;const i=e+n;for(;e+uC<i;){const s=lC(r.subarray(e)),a=oC(s);a&&t.push(a),e+=s.size+Na}Kx(r,e)&&(e+=Na)}return t}function Zx(r){return r&&r.key==="PRIV"&&r.info==="com.apple.streaming.transportStreamTimestamp"}function cC(r){if(r.data.byteLength===8){const e=new Uint8Array(r.data),t=e[3]&1;let n=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return n/=45,t&&(n+=4772185884e-2),Math.round(n)}}function Wf(r){const e=Qx(r);for(let t=0;t<e.length;t++){const n=e[t];if(Zx(n))return cC(n)}}let Wt=function(r){return r.audioId3="org.id3",r.dateRange="com.apple.quicktime.HLS",r.emsg="https://aomedia.org/emsg/ID3",r.misbklv="urn:misb:KLV:bin:1910.1",r}({});function Ir(r="",e=9e4){return{type:r,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Yf{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=or(this.cachedData,e),this.cachedData=null);let n=qs(e,0),i=n?n.length:0,s;const a=this._audioTrack,o=this._id3Track,u=n?Wf(n):void 0,l=e.length;for((this.basePTS===null||this.frameIndex===0&&Z(u))&&(this.basePTS=dC(u,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),n&&n.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Wt.audioId3,duration:Number.POSITIVE_INFINITY});i<l;){if(this.canParse(e,i)){const c=this.appendFrame(a,e,i);c?(this.frameIndex++,this.lastPTS=c.sample.pts,i+=c.length,s=i):i=l}else ZA(e,i)?(n=qs(e,i),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Wt.audioId3,duration:Number.POSITIVE_INFINITY}),i+=n.length,s=i):i++;if(i===l&&s!==l){const c=e.slice(s);this.cachedData?this.cachedData=or(this.cachedData,c):this.cachedData=c}}return{audioTrack:a,videoTrack:Ir(),id3Track:o,textTrack:Ir()}}demuxSampleAes(e,t,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Ir(),id3Track:this._id3Track,textTrack:Ir()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const dC=(r,e,t)=>{if(Z(r))return r*90;const n=t?t.baseTime*9e4/t.timescale:0;return e*9e4+n};let $a=null;const fC=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],hC=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],pC=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],gC=[0,1,1,4];function Jx(r,e,t,n,i){if(t+24>e.length)return;const s=ev(e,t);if(s&&t+s.frameLength<=e.length){const a=s.samplesPerFrame*9e4/s.sampleRate,o=n+i*a,u={unit:e.subarray(t,t+s.frameLength),pts:o,dts:o};return r.config=[],r.channelCount=s.channelCount,r.samplerate=s.sampleRate,r.samples.push(u),{sample:u,length:s.frameLength,missing:0}}}function ev(r,e){const t=r[e+1]>>3&3,n=r[e+1]>>1&3,i=r[e+2]>>4&15,s=r[e+2]>>2&3;if(t!==1&&i!==0&&i!==15&&s!==3){const a=r[e+2]>>1&1,o=r[e+3]>>6,u=t===3?3-n:n===3?3:4,l=fC[u*14+i-1]*1e3,d=hC[(t===3?0:t===2?1:2)*3+s],f=o===3?1:2,h=pC[t][n],p=gC[n],x=h*8*p,v=Math.floor(h*l/d+a)*p;if($a===null){const m=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);$a=m?parseInt(m[1]):0}return!!$a&&$a<=87&&n===2&&l>=224e3&&o===0&&(r[e+3]=r[e+3]|128),{sampleRate:d,channelCount:f,frameLength:v,samplesPerFrame:x}}}function qf(r,e){return r[e]===255&&(r[e+1]&224)===224&&(r[e+1]&6)!==0}function tv(r,e){return e+1<r.length&&qf(r,e)}function mC(r,e){return qf(r,e)&&4<=r.length-e}function rv(r,e){if(e+1<r.length&&qf(r,e)){const n=ev(r,e);let i=4;n!=null&&n.frameLength&&(i=n.frameLength);const s=e+i;return s===r.length||tv(r,s)}return!1}class xC extends Yf{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const n=qs(e,0);let i=(n==null?void 0:n.length)||0;if(rv(e,i))return!1;for(let s=e.length;i<s;i++)if(XA(e,i))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return qA(e,t)}appendFrame(e,t,n){Yx(e,this.observer,t,n,e.manifestCodec);const i=Xx(e,t,n,this.basePTS,this.frameIndex);if(i&&i.missing===0)return i}}const nv=(r,e)=>{let t=0,n=5;e+=n;const i=new Uint32Array(1),s=new Uint32Array(1),a=new Uint8Array(1);for(;n>0;){a[0]=r[e];const o=Math.min(n,8),u=8-o;s[0]=4278190080>>>24+u<<u,i[0]=(a[0]&s[0])>>u,t=t?t<<o|i[0]:i[0],e+=1,n-=o}return t};class vC extends Yf{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,n){const i=iv(e,t,n,this.basePTS,this.frameIndex);if(i!==-1)return{sample:e.samples[e.samples.length-1],length:i,missing:0}}static probe(e){if(!e)return!1;const t=qs(e,0);if(!t)return!1;const n=t.length;return e[n]===11&&e[n+1]===119&&Wf(t)!==void 0&&nv(e,n)<16}}function iv(r,e,t,n,i){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const s=e[t+4]>>6;if(s>=3)return-1;const o=[48e3,44100,32e3][s],u=e[t+4]&63,c=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][u*3+s]*2;if(t+c>e.length)return-1;const d=e[t+6]>>5;let f=0;d===2?f+=2:(d&1&&d!==1&&(f+=2),d&4&&(f+=2));const h=(e[t+6]<<8|e[t+7])>>12-f&1,x=[2,1,2,3,3,4,4,5][d]+h,v=e[t+5]>>3,y=e[t+5]&7,g=new Uint8Array([s<<6|v<<1|y>>2,(y&3)<<6|d<<3|h<<2|u>>4,u<<4&224]),m=1536/o*9e4,E=n+i*m,T=e.subarray(t,t+c);return r.config=g,r.channelCount=x,r.samplerate=o,r.samples.push({unit:T,pts:E}),c}class yC extends Yf{resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=qs(e,0);let n=(t==null?void 0:t.length)||0;if(t&&e[n]===11&&e[n+1]===119&&Wf(t)!==void 0&&nv(e,n)<=16)return!1;for(let i=e.length;n<i;n++)if(rv(e,n))return Ce.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return mC(e,t)}appendFrame(e,t,n){if(this.basePTS!==null)return Jx(e,t,n,this.basePTS,this.frameIndex)}}const EC=/\/emsg[-/]ID3/i;class SC{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,i){const s=this.videoTrack=Ir("video",1),a=this.audioTrack=Ir("audio",1),o=this.txtTrack=Ir("text",1);if(this.id3Track=Ir("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const u=px(e);if(u.video){const{id:l,timescale:c,codec:d,supplemental:f}=u.video;s.id=l,s.timescale=o.timescale=c,s.codec=d,s.supplemental=f}if(u.audio){const{id:l,timescale:c,codec:d}=u.audio;a.id=l,a.timescale=c,a.codec=d}o.id=dx.text,s.sampleDuration=0,s.duration=a.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return vT(e)}demux(e,t){this.timeOffset=t;let n=e;const i=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=or(this.remainderData,e));const o=LT(n);this.remainderData=o.remainder,i.samples=o.valid||new Uint8Array}else i.samples=n;const a=this.extractID3Track(i,t);return s.samples=Oh(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return n.samples=Oh(e,t),{videoTrack:t,audioTrack:Ir(),id3Track:i,textTrack:Ir()}}extractID3Track(e,t){const n=this.id3Track;if(e.samples.length){const i=pe(e.samples,["emsg"]);i&&i.forEach(s=>{const a=IT(s);if(EC.test(a.schemeIdUri)){const o=yp(a,t);let u=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;u<=.001&&(u=Number.POSITIVE_INFINITY);const l=a.payload;n.samples.push({data:l,len:l.byteLength,dts:o,pts:o,type:Wt.emsg,duration:u})}else if(this.config.enableEmsgKLVMetadata&&a.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const o=yp(a,t);n.samples.push({data:a.payload,len:a.payload.byteLength,dts:o,pts:o,type:Wt.misbklv,duration:Number.POSITIVE_INFINITY})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function yp(r,e){return Z(r.presentationTime)?r.presentationTime/r.timeScale:e+r.presentationTimeDelta/r.timeScale}class TC{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new $f(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Cn.cbc)}decryptAacSample(e,t,n){const i=e[t].unit;if(i.length<=16)return;const s=i.subarray(16,i.length-i.length%16),a=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(a).then(o=>{const u=new Uint8Array(o);i.set(u,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)}).catch(n)}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length){n();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,n=new Int8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)n.set(e.subarray(s,s+16),i);return n}getAvcDecryptedUnit(e,t){const n=new Uint8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)e.set(n.subarray(i,i+16),s);return e}decryptAvcSample(e,t,n,i,s){const a=xx(s.data),o=this.getAvcEncryptedData(a);this.decryptBuffer(o.buffer).then(u=>{s.data=this.getAvcDecryptedUnit(a,u),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,i)}).catch(i)}decryptAvcSamples(e,t,n,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length){i();return}const s=e[t].units;for(;!(n>=s.length);n++){const a=s[n];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,n,i,a),!this.decrypter.isSync()))return}}}}class sv{constructor(){this.VideoSample=null}createVideoSample(e,t,n){return{key:e,frame:!1,pts:t,dts:n,units:[],length:0}}getLastNalUnit(e){var t;let n=this.VideoSample,i;if((!n||n.units.length===0)&&(n=e[e.length-1]),(t=n)!=null&&t.units){const s=n.units;i=s[s.length-1]}return i}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const n=t.samples,i=n.length;if(i){const s=n[i-1];e.pts=s.pts,e.dts=s.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,n){const i=t.byteLength;let s=e.naluState||0;const a=s,o=[];let u=0,l,c,d,f=-1,h=0;for(s===-1&&(f=0,h=this.getNALuType(t,0),s=0,u=1);u<i;){if(l=t[u++],!s){s=l?0:1;continue}if(s===1){s=l?0:2;continue}if(!l)s=3;else if(l===1){if(c=u-s-1,f>=0){const p={data:t.subarray(f,c),type:h};o.push(p)}else{const p=this.getLastNalUnit(e.samples);p&&(a&&u<=4-a&&p.state&&(p.data=p.data.subarray(0,p.data.byteLength-a)),c>0&&(p.data=or(p.data,t.subarray(0,c)),p.state=0))}u<i?(d=this.getNALuType(t,u),f=u,h=d,s=0):s=-1}else s=0}if(f>=0&&s>=0){const p={data:t.subarray(f,i),type:h,state:s};o.push(p)}if(o.length===0){const p=this.getLastNalUnit(e.samples);p&&(p.data=or(p.data,t))}return e.naluState=s,o}}class Ls{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,i=new Uint8Array(4),s=Math.min(4,t);if(s===0)throw new Error("no bytes available");i.set(e.subarray(n,n+s)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32&&Ce.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class AC extends sv{parsePES(e,t,n,i){const s=this.parseNALu(e,n.data,i);let a=this.VideoSample,o,u=!1;n.data=null,a&&s.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),s.forEach(l=>{var c,d;switch(l.type){case 1:{let x=!1;o=!0;const v=l.data;if(u&&v.length>4){const y=this.readSliceType(v);(y===2||y===4||y===7||y===9)&&(x=!0)}if(x){var f;(f=a)!=null&&f.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.frame=!0,a.key=x;break}case 5:o=!0,(c=a)!=null&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 6:{o=!0,Bf(l.data,1,n.pts,t.samples);break}case 7:{var h,p;o=!0,u=!0;const x=l.data,v=this.readSPS(x);if(!e.sps||e.width!==v.width||e.height!==v.height||((h=e.pixelRatio)==null?void 0:h[0])!==v.pixelRatio[0]||((p=e.pixelRatio)==null?void 0:p[1])!==v.pixelRatio[1]){e.width=v.width,e.height=v.height,e.pixelRatio=v.pixelRatio,e.sps=[x];const y=x.subarray(1,4);let g="avc1.";for(let m=0;m<3;m++){let E=y[m].toString(16);E.length<2&&(E="0"+E),g+=E}e.codec=g}break}case 8:o=!0,e.pps=[l.data];break;case 9:o=!0,e.audFound=!0,(d=a)!=null&&d.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;case 12:o=!0;break;default:o=!1;break}a&&o&&a.units.push(l)}),i&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new Ls(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let n=8,i=8,s;for(let a=0;a<e;a++)i!==0&&(s=t.readEG(),i=(n+s+256)%256),n=i===0?n:i}readSPS(e){const t=new Ls(e);let n=0,i=0,s=0,a=0,o,u,l;const c=t.readUByte.bind(t),d=t.readBits.bind(t),f=t.readUEG.bind(t),h=t.readBoolean.bind(t),p=t.skipBits.bind(t),x=t.skipEG.bind(t),v=t.skipUEG.bind(t),y=this.skipScalingList.bind(this);c();const g=c();if(d(5),p(3),c(),v(),g===100||g===110||g===122||g===244||g===44||g===83||g===86||g===118||g===128){const R=f();if(R===3&&p(1),v(),v(),p(1),h())for(u=R!==3?8:12,l=0;l<u;l++)h()&&(l<6?y(16,t):y(64,t))}v();const m=f();if(m===0)f();else if(m===1)for(p(1),x(),x(),o=f(),l=0;l<o;l++)x();v(),p(1);const E=f(),T=f(),L=d(1);L===0&&p(1),p(1),h()&&(n=f(),i=f(),s=f(),a=f());let A=[1,1];if(h()&&h())switch(c()){case 1:A=[1,1];break;case 2:A=[12,11];break;case 3:A=[10,11];break;case 4:A=[16,11];break;case 5:A=[40,33];break;case 6:A=[24,11];break;case 7:A=[20,11];break;case 8:A=[32,11];break;case 9:A=[80,33];break;case 10:A=[18,11];break;case 11:A=[15,11];break;case 12:A=[64,33];break;case 13:A=[160,99];break;case 14:A=[4,3];break;case 15:A=[3,2];break;case 16:A=[2,1];break;case 255:{A=[c()<<8|c(),c()<<8|c()];break}}return{width:Math.ceil((E+1)*16-n*2-i*2),height:(2-L)*(T+1)*16-(L?2:4)*(s+a),pixelRatio:A}}}class CC extends sv{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,n,i){const s=this.parseNALu(e,n.data,i);let a=this.VideoSample,o,u=!1;n.data=null,a&&s.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),s.forEach(l=>{var c,d;switch(l.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),a.frame=!0,o=!0;break;case 16:case 17:case 18:case 21:if(o=!0,u){var f;(f=a)!=null&&f.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:o=!0,(c=a)!=null&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 39:o=!0,Bf(l.data,2,n.pts,t.samples);break;case 32:o=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Re(e.params,this.readVPS(l.data)),this.initVPS=l.data),e.vps=[l.data];break;case 33:if(o=!0,u=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],l.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const h=this.readSPS(l.data);e.width=h.width,e.height=h.height,e.pixelRatio=h.pixelRatio,e.codec=h.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const p in h.params)e.params[p]=h.params[p]}this.pushParameterSet(e.sps,l.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0;break;case 34:if(o=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const h=this.readPPS(l.data);for(const p in h)e.params[p]=h[p]}this.pushParameterSet(e.pps,l.data,e.vps)}break;case 35:o=!0,e.audFound=!0,(d=a)!=null&&d.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;default:o=!1;break}a&&o&&a.units.push(l)}),i&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,n){(n&&n[0]===this.initVPS||!n&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let n=0;for(let i=0;i<e.byteLength;i++)i>=2&&e[i]===3&&e[i-1]===0&&e[i-2]===0||(t[n]=e[i],n++);return new Uint8Array(t.buffer,0,n)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Ls(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const n=t.readBits(3),i=t.readBoolean();return{numTemporalLayers:n+1,temporalIdNested:i}}readSPS(e){const t=new Ls(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const n=t.readBits(3);t.readBoolean();const i=t.readBits(2),s=t.readBoolean(),a=t.readBits(5),o=t.readUByte(),u=t.readUByte(),l=t.readUByte(),c=t.readUByte(),d=t.readUByte(),f=t.readUByte(),h=t.readUByte(),p=t.readUByte(),x=t.readUByte(),v=t.readUByte(),y=t.readUByte(),g=[],m=[];for(let fe=0;fe<n;fe++)g.push(t.readBoolean()),m.push(t.readBoolean());if(n>0)for(let fe=n;fe<8;fe++)t.readBits(2);for(let fe=0;fe<n;fe++)g[fe]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),m[fe]&&t.readUByte();t.readUEG();const E=t.readUEG();E==3&&t.skipBits(1);const T=t.readUEG(),L=t.readUEG(),A=t.readBoolean();let R=0,I=0,C=0,_=0;A&&(R+=t.readUEG(),I+=t.readUEG(),C+=t.readUEG(),_+=t.readUEG());const F=t.readUEG(),B=t.readUEG(),V=t.readUEG(),j=t.readBoolean();for(let fe=j?0:n;fe<=n;fe++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let Oe=0;Oe<4;Oe++)for(let ze=0;ze<(Oe===3?2:6);ze++)if(!t.readBoolean())t.readUEG();else{const qe=Math.min(64,1<<4+(Oe<<1));Oe>1&&t.readEG();for(let Te=0;Te<qe;Te++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const O=t.readUEG();let H=0;for(let fe=0;fe<O;fe++){let Oe=!1;if(fe!==0&&(Oe=t.readBoolean()),Oe){fe===O&&t.readUEG(),t.readBoolean(),t.readUEG();let ze=0;for(let kt=0;kt<=H;kt++){const qe=t.readBoolean();let Te=!1;qe||(Te=t.readBoolean()),(qe||Te)&&ze++}H=ze}else{const ze=t.readUEG(),kt=t.readUEG();H=ze+kt;for(let qe=0;qe<ze;qe++)t.readUEG(),t.readBoolean();for(let qe=0;qe<kt;qe++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const fe=t.readUEG();for(let Oe=0;Oe<fe;Oe++){for(let ze=0;ze<V+4;ze++)t.readBits(1);t.readBits(1)}}let w=0,P=1,U=1,$=!0,Q=1,J=0;t.readBoolean(),t.readBoolean();let he=!1;if(t.readBoolean()){if(t.readBoolean()){const Me=t.readUByte(),Ne=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],wt=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Me>0&&Me<16?(P=Ne[Me-1],U=wt[Me-1]):Me===255&&(P=t.readBits(16),U=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),he=t.readBoolean(),he&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(Q=t.readBits(32),J=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const wt=t.readBoolean(),ht=t.readBoolean();let Et=!1;(wt||ht)&&(Et=t.readBoolean(),Et&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Et&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let ur=0;ur<=n;ur++){$=t.readBoolean();const ri=$||t.readBoolean();let Br=!1;ri?t.readEG():Br=t.readBoolean();const Gt=Br?1:t.readUEG()+1;if(wt)for(let ot=0;ot<Gt;ot++)t.readUEG(),t.readUEG(),Et&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(ht)for(let ot=0;ot<Gt;ot++)t.readUEG(),t.readUEG(),Et&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),w=t.readUEG())}let Fe=T,Be=L;if(A){let fe=1,Oe=1;E===1?fe=Oe=2:E==2&&(fe=2),Fe=T-fe*I-fe*R,Be=L-Oe*_-Oe*C}const $t=i?["A","B","C"][i]:"",Ut=o<<24|u<<16|l<<8|c;let at=0;for(let fe=0;fe<32;fe++)at=(at|(Ut>>fe&1)<<31-fe)>>>0;let Ye=at.toString(16);return a===1&&Ye==="2"&&(Ye="6"),{codecString:`hvc1.${$t}${a}.${Ye}.${s?"H":"L"}${y}.B0`,params:{general_tier_flag:s,general_profile_idc:a,general_profile_space:i,general_profile_compatibility_flags:[o,u,l,c],general_constraint_indicator_flags:[d,f,h,p,x,v],general_level_idc:y,bit_depth:F+8,bit_depth_luma_minus8:F,bit_depth_chroma_minus8:B,min_spatial_segmentation_idc:w,chroma_format_idc:E,frame_rate:{fixed:$,fps:J/Q}},width:Fe,height:Be,pixelRatio:[P,U]}}readPPS(e){const t=new Ls(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const i=t.readBoolean(),s=t.readBoolean();let a=1;return s&&i?a=0:s?a=3:i&&(a=2),{parallelismType:a}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const rt=188;class ln{constructor(e,t,n,i){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.logger=i,this.videoParser=null}static probe(e,t){const n=ln.syncOffset(e);return n>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${n}`),n!==-1}static syncOffset(e){const t=e.length;let n=Math.min(rt*5,t-rt)+1,i=0;for(;i<n;){let s=!1,a=-1,o=0;for(let u=i;u<t;u+=rt)if(e[u]===71&&(t-u===rt||e[u+rt]===71)){if(o++,a===-1&&(a=u,a!==0&&(n=Math.min(a+rt*99,e.length-rt)+1)),s||(s=xd(e,u)===0),s&&o>1&&(a===0&&o>2||u+rt>n))return a}else{if(o)return-1;break}i++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:dx[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,n,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=ln.createTrack("video"),this._videoTrack.duration=i,this._audioTrack=ln.createTrack("audio",i),this._id3Track=ln.createTrack("id3"),this._txtTrack=ln.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,n=!1,i=!1){n||(this.sampleAes=null);let s;const a=this._videoTrack,o=this._audioTrack,u=this._id3Track,l=this._txtTrack;let c=a.pid,d=a.pesData,f=o.pid,h=u.pid,p=o.pesData,x=u.pesData,v=null,y=this.pmtParsed,g=this._pmtId,m=e.length;if(this.remainderData&&(e=or(this.remainderData,e),m=e.length,this.remainderData=null),m<rt&&!i)return this.remainderData=e,{audioTrack:o,videoTrack:a,id3Track:u,textTrack:l};const E=Math.max(0,ln.syncOffset(e));m-=(m-E)%rt,m<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,m,e.buffer.byteLength-m));let T=0;for(let A=E;A<m;A+=rt)if(e[A]===71){const R=!!(e[A+1]&64),I=xd(e,A),C=(e[A+3]&48)>>4;let _;if(C>1){if(_=A+5+e[A+4],_===A+rt)continue}else _=A+4;switch(I){case c:R&&(d&&(s=ai(d,this.logger))&&(this.readyVideoParser(a.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(a,l,s,!1)),d={data:[],size:0}),d&&(d.data.push(e.subarray(_,A+rt)),d.size+=A+rt-_);break;case f:if(R){if(p&&(s=ai(p,this.logger)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,s);break;case"mp3":this.parseMPEGPES(o,s);break;case"ac3":this.parseAC3PES(o,s);break}p={data:[],size:0}}p&&(p.data.push(e.subarray(_,A+rt)),p.size+=A+rt-_);break;case h:R&&(x&&(s=ai(x,this.logger))&&this.parseID3PES(u,s),x={data:[],size:0}),x&&(x.data.push(e.subarray(_,A+rt)),x.size+=A+rt-_);break;case 0:R&&(_+=e[_]+1),g=this._pmtId=LC(e,_);break;case g:{R&&(_+=e[_]+1);const F=RC(e,_,this.typeSupported,n,this.observer,this.logger);c=F.videoPid,c>0&&(a.pid=c,a.segmentCodec=F.segmentVideoCodec),f=F.audioPid,f>0&&(o.pid=f,o.segmentCodec=F.segmentAudioCodec),h=F.id3Pid,h>0&&(u.pid=h),v!==null&&!y&&(this.logger.warn(`MPEG-TS PMT found at ${A} after unknown PID '${v}'. Backtracking to sync byte @${E} to parse all TS packets.`),v=null,A=E-188),y=this.pmtParsed=!0;break}case 17:case 8191:break;default:v=I;break}}else T++;T>0&&vd(this.observer,new Error(`Found ${T} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=d,o.pesData=p,u.pesData=x;const L={audioTrack:o,videoTrack:a,id3Track:u,textTrack:l};return i&&this.extractRemainingSamples(L),L}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:n,id3Track:i,textTrack:s}=e,a=n.pesData,o=t.pesData,u=i.pesData;let l;if(a&&(l=ai(a,this.logger))?(this.readyVideoParser(n.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(n,s,l,!0),n.pesData=null)):n.pesData=a,o&&(l=ai(o,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,l);break;case"mp3":this.parseMPEGPES(t,l);break;case"ac3":this.parseAC3PES(t,l);break}t.pesData=null}else o!=null&&o.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=o;u&&(l=ai(u,this.logger))?(this.parseID3PES(i,l),i.pesData=null):i.pesData=u}demuxSampleAes(e,t,n){const i=this.demux(e,n,!0,!this.config.progressive),s=this.sampleAes=new TC(this.observer,this.config,t);return this.decrypt(i,s)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new AC:e==="hevc"&&(this.videoParser=new CC))}decrypt(e,t){return new Promise(n=>{const{audioTrack:i,videoTrack:s}=e;i.samples&&i.segmentCodec==="aac"?t.decryptAacSamples(i.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{n(e)}):n(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{n(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let n=0;const i=this.aacOverFlow;let s=t.data;if(i){this.aacOverFlow=null;const d=i.missing,f=i.sample.unit.byteLength;if(d===-1)s=or(i.sample.unit,s);else{const h=f-d;i.sample.unit.set(s.subarray(0,d),h),e.samples.push(i.sample),n=i.missing}}let a,o;for(a=n,o=s.length;a<o-1&&!Zo(s,a);a++);if(a!==n){let d;const f=a<o-1;if(f?d=`AAC PES did not start with ADTS header,offset:${a}`:d="No ADTS header found in AAC PES",vd(this.observer,new Error(d),f,this.logger),!f)return}Yx(e,this.observer,s,a,this.audioCodec);let u;if(t.pts!==void 0)u=t.pts;else if(i){const d=qx(e.samplerate);u=i.sample.pts+d}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let l=0,c;for(;a<o;)if(c=Xx(e,s,a,u,l),a+=c.length,c.missing){this.aacOverFlow=c;break}else for(l++;a<o-1&&!Zo(s,a);a++);}parseMPEGPES(e,t){const n=t.data,i=n.length;let s=0,a=0;const o=t.pts;if(o===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<i;)if(tv(n,a)){const u=Jx(e,n,a,o,s);if(u)a+=u.length,s++;else break}else a++}parseAC3PES(e,t){{const n=t.data,i=t.pts;if(i===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const s=n.length;let a=0,o=0,u;for(;o<s&&(u=iv(e,n,o,i,a++))>0;)o+=u}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const n=Re({},t,{type:this._videoTrack?Wt.emsg:Wt.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function xd(r,e){return((r[e+1]&31)<<8)+r[e+2]}function LC(r,e){return(r[e+10]&31)<<8|r[e+11]}function RC(r,e,t,n,i,s){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=(r[e+1]&15)<<8|r[e+2],u=e+3+o-4,l=(r[e+10]&15)<<8|r[e+11];for(e+=12+l;e<u;){const c=xd(r,e),d=(r[e+3]&15)<<8|r[e+4];switch(r[e]){case 207:if(!n){hu("ADTS AAC",s);break}case 15:a.audioPid===-1&&(a.audioPid=c);break;case 21:a.id3Pid===-1&&(a.id3Pid=c);break;case 219:if(!n){hu("H.264",s);break}case 27:a.videoPid===-1&&(a.videoPid=c);break;case 3:case 4:!t.mpeg&&!t.mp3?s.log("MPEG audio found, not supported in this browser"):a.audioPid===-1&&(a.audioPid=c,a.segmentAudioCodec="mp3");break;case 193:if(!n){hu("AC-3",s);break}case 129:t.ac3?a.audioPid===-1&&(a.audioPid=c,a.segmentAudioCodec="ac3"):s.log("AC-3 audio found, not supported in this browser");break;case 6:if(a.audioPid===-1&&d>0){let f=e+5,h=d;for(;h>2;){switch(r[f]){case 106:t.ac3!==!0?s.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=c,a.segmentAudioCodec="ac3");break}const x=r[f+1]+2;f+=x,h-=x}}break;case 194:case 135:return vd(i,new Error("Unsupported EC-3 in M2TS found"),void 0,s),a;case 36:a.videoPid===-1&&(a.videoPid=c,a.segmentVideoCodec="hevc",s.log("HEVC in M2TS found"));break}e+=d+5}return a}function vd(r,e,t,n){n.warn(`parsing error: ${e.message}`),r.emit(S.ERROR,S.ERROR,{type:re.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function hu(r,e){e.log(`${r} with AES-128-CBC encryption found in unencrypted stream`)}function ai(r,e){let t=0,n,i,s,a,o;const u=r.data;if(!r||r.size===0)return null;for(;u[0].length<19&&u.length>1;)u[0]=or(u[0],u[1]),u.splice(1,1);if(n=u[0],(n[0]<<16)+(n[1]<<8)+n[2]===1){if(i=(n[4]<<8)+n[5],i&&i>r.size-6)return null;const c=n[7];c&192&&(a=(n[9]&14)*536870912+(n[10]&255)*4194304+(n[11]&254)*16384+(n[12]&255)*128+(n[13]&254)/2,c&64?(o=(n[14]&14)*536870912+(n[15]&255)*4194304+(n[16]&254)*16384+(n[17]&255)*128+(n[18]&254)/2,a-o>60*9e4&&(e.warn(`${Math.round((a-o)/9e4)}s delta between PTS and DTS, align them`),a=o)):o=a),s=n[8];let d=s+9;if(r.size<=d)return null;r.size-=d;const f=new Uint8Array(r.size);for(let h=0,p=u.length;h<p;h++){n=u[h];let x=n.byteLength;if(d)if(d>x){d-=x;continue}else n=n.subarray(d),x-=d,d=0;f.set(n,t),t+=x}return i&&(i-=s+3),{data:f,pts:a,dts:o,len:i}}return null}class IC{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const rn=Math.pow(2,32)-1;class M{static init(){M.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in M.types)M.types.hasOwnProperty(e)&&(M.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);M.HDLR_TYPES={video:t,audio:n};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);M.STTS=M.STSC=M.STCO=s,M.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),M.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),M.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),M.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);M.FTYP=M.box(M.types.ftyp,a,u,a,o),M.DINF=M.box(M.types.dinf,M.box(M.types.dref,i))}static box(e,...t){let n=8,i=t.length;const s=i;for(;i--;)n+=t[i].byteLength;const a=new Uint8Array(n);for(a[0]=n>>24&255,a[1]=n>>16&255,a[2]=n>>8&255,a[3]=n&255,a.set(e,4),i=0,n=8;i<s;i++)a.set(t[i],n),n+=t[i].byteLength;return a}static hdlr(e){return M.box(M.types.hdlr,M.HDLR_TYPES[e])}static mdat(e){return M.box(M.types.mdat,e)}static mdhd(e,t){t*=e;const n=Math.floor(t/(rn+1)),i=Math.floor(t%(rn+1));return M.box(M.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,i>>24,i>>16&255,i>>8&255,i&255,85,196,0,0]))}static mdia(e){return M.box(M.types.mdia,M.mdhd(e.timescale||0,e.duration||0),M.hdlr(e.type),M.minf(e))}static mfhd(e){return M.box(M.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?M.box(M.types.minf,M.box(M.types.smhd,M.SMHD),M.DINF,M.stbl(e)):M.box(M.types.minf,M.box(M.types.vmhd,M.VMHD),M.DINF,M.stbl(e))}static moof(e,t,n){return M.box(M.types.moof,M.mfhd(e),M.traf(n,t))}static moov(e){let t=e.length;const n=[];for(;t--;)n[t]=M.trak(e[t]);return M.box.apply(null,[M.types.moov,M.mvhd(e[0].timescale||0,e[0].duration||0)].concat(n).concat(M.mvex(e)))}static mvex(e){let t=e.length;const n=[];for(;t--;)n[t]=M.trex(e[t]);return M.box.apply(null,[M.types.mvex,...n])}static mvhd(e,t){t*=e;const n=Math.floor(t/(rn+1)),i=Math.floor(t%(rn+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,i>>24,i>>16&255,i>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return M.box(M.types.mvhd,s)}static sdtp(e){const t=e.samples||[],n=new Uint8Array(4+t.length);let i,s;for(i=0;i<t.length;i++)s=t[i].flags,n[i+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return M.box(M.types.sdtp,n)}static stbl(e){return M.box(M.types.stbl,M.stsd(e),M.box(M.types.stts,M.STTS),M.box(M.types.stsc,M.STSC),M.box(M.types.stsz,M.STSZ),M.box(M.types.stco,M.STCO))}static avc1(e){let t=[],n=[],i,s,a;for(i=0;i<e.sps.length;i++)s=e.sps[i],a=s.byteLength,t.push(a>>>8&255),t.push(a&255),t=t.concat(Array.prototype.slice.call(s));for(i=0;i<e.pps.length;i++)s=e.pps[i],a=s.byteLength,n.push(a>>>8&255),n.push(a&255),n=n.concat(Array.prototype.slice.call(s));const o=M.box(M.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(n))),u=e.width,l=e.height,c=e.pixelRatio[0],d=e.pixelRatio[1];return M.box(M.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,u&255,l>>8&255,l&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,M.box(M.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),M.box(M.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,c&255,d>>24,d>>16&255,d>>8&255,d&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return M.box(M.types.mp4a,M.audioStsd(e),M.box(M.types.esds,M.esds(e)))}static mp3(e){return M.box(M.types[".mp3"],M.audioStsd(e))}static ac3(e){return M.box(M.types["ac-3"],M.audioStsd(e),M.box(M.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return M.box(M.types.stsd,M.STSD,M.mp4a(e));if(t==="ac3"&&e.config)return M.box(M.types.stsd,M.STSD,M.ac3(e));if(t==="mp3"&&e.codec==="mp3")return M.box(M.types.stsd,M.STSD,M.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return M.box(M.types.stsd,M.STSD,M.avc1(e));if(t==="hevc"&&e.vps)return M.box(M.types.stsd,M.STSD,M.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,n=(e.duration||0)*(e.timescale||0),i=e.width||0,s=e.height||0,a=Math.floor(n/(rn+1)),o=Math.floor(n%(rn+1));return M.box(M.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,o>>24,o>>16&255,o>>8&255,o&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,i&255,0,0,s>>8&255,s&255,0,0]))}static traf(e,t){const n=M.sdtp(e),i=e.id,s=Math.floor(t/(rn+1)),a=Math.floor(t%(rn+1));return M.box(M.types.traf,M.box(M.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])),M.box(M.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,a>>24,a>>16&255,a>>8&255,a&255])),M.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,M.box(M.types.trak,M.tkhd(e),M.mdia(e))}static trex(e){const t=e.id;return M.box(M.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const n=e.samples||[],i=n.length,s=12+16*i,a=new Uint8Array(s);let o,u,l,c,d,f;for(t+=8+s,a.set([e.type==="video"?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,i&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),o=0;o<i;o++)u=n[o],l=u.duration,c=u.size,d=u.flags,f=u.cts,a.set([l>>>24&255,l>>>16&255,l>>>8&255,l&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&61440,d.degradPrio&15,f>>>24&255,f>>>16&255,f>>>8&255,f&255],12+16*o);return M.box(M.types.trun,a)}static initSegment(e){M.types||M.init();const t=M.moov(e);return or(M.FTYP,t)}static hvc1(e){const t=e.params,n=[e.vps,e.sps,e.pps],i=4,s=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),i-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),n.length]);let a=s.length;for(let p=0;p<n.length;p+=1){a+=3;for(let x=0;x<n[p].length;x+=1)a+=2+n[p][x].length}const o=new Uint8Array(a);o.set(s,0),a=s.length;const u=n.length-1;for(let p=0;p<n.length;p+=1){o.set(new Uint8Array([32+p|(p===u?128:0),0,n[p].length]),a),a+=3;for(let x=0;x<n[p].length;x+=1)o.set(new Uint8Array([n[p][x].length>>8,n[p][x].length&255]),a),a+=2,o.set(n[p][x],a),a+=n[p][x].length}const l=M.box(M.types.hvcC,o),c=e.width,d=e.height,f=e.pixelRatio[0],h=e.pixelRatio[1];return M.box(M.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,c&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l,M.box(M.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),M.box(M.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,h>>24,h>>16&255,h>>8&255,h&255])))}}M.types=void 0;M.HDLR_TYPES=void 0;M.STTS=void 0;M.STSC=void 0;M.STCO=void 0;M.STSZ=void 0;M.VMHD=void 0;M.SMHD=void 0;M.STSD=void 0;M.FTYP=void 0;M.DINF=void 0;const av=9e4;function Xf(r,e,t=1,n=!1){const i=r*e*t;return n?Math.round(i):i}function _C(r,e,t=1,n=!1){return Xf(r,e,1/t,n)}function us(r,e=!1){return Xf(r,1e3,1/av,e)}function DC(r,e=1){return Xf(r,av,1/e)}function Ep(r){const{baseTime:e,timescale:t,trackId:n}=r;return`${e/t} (${e}/${t}) trackId: ${n}`}const kC=10*1e3,wC=1024,bC=1152,PC=1536;let oi=null,pu=null;function Sp(r,e,t,n){return{duration:e,size:t,cts:n,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:r?2:1,isNonSync:r?0:1}}}class ho extends lr{constructor(e,t,n,i){if(super("mp4-remuxer",i),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,oi===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);oi=a?parseInt(a[1]):0}if(pu===null){const s=navigator.userAgent.match(/Safari\/(\d+)/i);pu=s?parseInt(s[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&Ep(t)} > ${e&&Ep(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const n=e[0].pts,i=e.reduce((s,a)=>{let o=a.pts,u=o-s;return u<-4294967296&&(t=!0,o=Kt(o,n),u=o-s),u>0?s:o},n);return t&&this.debug("PTS rollover detected"),i}remux(e,t,n,i,s,a,o,u){let l,c,d,f,h,p,x=s,v=s;const y=e.pid>-1,g=t.pid>-1,m=t.samples.length,E=e.samples.length>0,T=o&&m>0||m>1;if((!y||E)&&(!g||T)||this.ISGenerated||o){if(this.ISGenerated){var A,R,I,C;const V=this.videoTrackConfig;(V&&(t.width!==V.width||t.height!==V.height||((A=t.pixelRatio)==null?void 0:A[0])!==((R=V.pixelRatio)==null?void 0:R[0])||((I=t.pixelRatio)==null?void 0:I[1])!==((C=V.pixelRatio)==null?void 0:C[1]))||!V&&T||this.nextAudioTs===null&&E)&&this.resetInitSegment()}this.ISGenerated||(d=this.generateIS(e,t,s,a));const _=this.isVideoContiguous;let F=-1,B;if(T&&(F=FC(t.samples),!_&&this.config.forceKeyFrameOnDiscontinuity))if(p=!0,F>0){this.warn(`Dropped ${F} out of ${m} video samples due to a missing keyframe`);const V=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(F),t.dropped+=F,v+=(t.samples[0].pts-V)/t.inputTimeScale,B=v}else F===-1&&(this.warn(`No keyframe found out of ${m} video samples`),p=!1);if(this.ISGenerated){if(E&&T){const V=this.getVideoStartPts(t.samples),G=(Kt(e.samples[0].pts,V)-V)/t.inputTimeScale;x+=Math.max(0,G),v+=Math.max(0,-G)}if(E){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),d=this.generateIS(e,t,s,a)),c=this.remuxAudio(e,x,this.isAudioContiguous,a,g||T||u===ee.AUDIO?v:void 0),T){const V=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),d=this.generateIS(e,t,s,a)),l=this.remuxVideo(t,v,_,V)}}else T&&(l=this.remuxVideo(t,v,_,0));l&&(l.firstKeyFrame=F,l.independent=F!==-1,l.firstKeyFramePTS=B)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(h=ov(n,s,this._initPTS,this._initDTS)),i.samples.length&&(f=lv(i,s,this._initPTS))),{audio:c,video:l,initSegment:d,independent:p,text:f,id3:h}}computeInitPts(e,t,n,i){const s=Math.round(n*t);let a=Kt(e,s);if(a<s+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(s-a)/t} ${i}`);a<s+t;)a+=8589934592;return a-s}generateIS(e,t,n,i){const s=e.samples,a=t.samples,o=this.typeSupported,u={},l=this._initPTS;let c=!l||i,d="audio/mp4",f,h,p,x=-1;if(c&&(f=h=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":o.mpeg?(d="audio/mpeg",e.codec=""):o.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}u.audio={id:"audio",container:d,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&o.mpeg?new Uint8Array(0):M.initSegment([e]),metadata:{channelCount:e.channelCount}},c&&(x=e.id,p=e.inputTimeScale,!l||p!==l.timescale?f=h=this.computeInitPts(s[0].pts,p,n,"audio"):c=!1)}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,u.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:M.initSegment([t]),metadata:{width:t.width,height:t.height}},c)if(x=t.id,p=t.inputTimeScale,!l||p!==l.timescale){const v=this.getVideoStartPts(a),y=Kt(a[0].dts,v),g=this.computeInitPts(y,p,n,"video"),m=this.computeInitPts(v,p,n,"video");h=Math.min(h,g),f=Math.min(f,m)}else c=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(u).length)return this.ISGenerated=!0,c?(l&&this.warn(`Timestamps at playlist time: ${i?"":"~"}${n} ${f/p} != initPTS: ${l.baseTime/l.timescale} (${l.baseTime}/${l.timescale}) trackId: ${l.trackId}`),this.log(`Found initPTS at playlist time: ${n} offset: ${f/p} (${f}/${p}) trackId: ${x}`),this._initPTS={baseTime:f,timescale:p,trackId:x},this._initDTS={baseTime:h,timescale:p,trackId:x}):f=p=void 0,{tracks:u,initPTS:f,timescale:p,trackId:x}}remuxVideo(e,t,n,i){const s=e.inputTimeScale,a=e.samples,o=[],u=a.length,l=this._initPTS,c=l.baseTime*s/l.timescale;let d=this.nextVideoTs,f=8,h=this.videoSampleDuration,p,x,v=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,g=!1;if(!n||d===null){const w=c+t*s,P=a[0].pts-Kt(a[0].dts,a[0].pts);oi&&d!==null&&Math.abs(w-P-(d+c))<15e3?n=!0:d=w-P-c}const m=d+c;for(let w=0;w<u;w++){const P=a[w];P.pts=Kt(P.pts,m),P.dts=Kt(P.dts,m),P.dts<a[w>0?w-1:w].dts&&(g=!0)}g&&a.sort(function(w,P){const U=w.dts-P.dts,$=w.pts-P.pts;return U||$}),p=a[0].dts,x=a[a.length-1].dts;const E=x-p,T=E?Math.round(E/(u-1)):h||e.inputTimeScale/30;if(n){const w=p-m,P=w>T,U=w<-1;if((P||U)&&(P?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${us(w,!0)} ms (${w}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${us(-w,!0)} ms (${w}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!U||m>=a[0].pts||oi)){p=m;const $=a[0].pts-w;if(P)a[0].dts=p,a[0].pts=$;else{let Q=!0;for(let J=0;J<a.length&&!(a[J].dts>$&&Q);J++){const he=a[J].pts;if(a[J].dts-=w,a[J].pts-=w,J<a.length-1){const ne=a[J+1].pts,Fe=a[J].pts,Be=ne<=Fe,$t=ne<=he;Q=Be==$t}}}this.log(`Video: Initial PTS/DTS adjusted: ${us($,!0)}/${us(p,!0)}, delta: ${us(w,!0)} ms`)}}p=Math.max(0,p);let L=0,A=0,R=p;for(let w=0;w<u;w++){const P=a[w],U=P.units,$=U.length;let Q=0;for(let J=0;J<$;J++)Q+=U[J].data.length;A+=Q,L+=$,P.length=Q,P.dts<R?(P.dts=R,R+=T/4|0||1):R=P.dts,v=Math.min(P.pts,v),y=Math.max(P.pts,y)}x=a[u-1].dts;const I=A+4*L+8;let C;try{C=new Uint8Array(I)}catch(w){this.observer.emit(S.ERROR,S.ERROR,{type:re.MUX_ERROR,details:N.REMUX_ALLOC_ERROR,fatal:!1,error:w,bytes:I,reason:`fail allocating video mdat ${I}`});return}const _=new DataView(C.buffer);_.setUint32(0,I),C.set(M.types.mdat,4);let F=!1,B=Number.POSITIVE_INFINITY,V=Number.POSITIVE_INFINITY,j=Number.NEGATIVE_INFINITY,G=Number.NEGATIVE_INFINITY;for(let w=0;w<u;w++){const P=a[w],U=P.units;let $=0;for(let he=0,ne=U.length;he<ne;he++){const Fe=U[he],Be=Fe.data,$t=Fe.data.byteLength;_.setUint32(f,$t),f+=4,C.set(Be,f),f+=$t,$+=4+$t}let Q;if(w<u-1)h=a[w+1].dts-P.dts,Q=a[w+1].pts-P.pts;else{const he=this.config,ne=w>0?P.dts-a[w-1].dts:T;if(Q=w>0?P.pts-a[w-1].pts:T,he.stretchShortVideoTrack&&this.nextAudioTs!==null){const Fe=Math.floor(he.maxBufferHole*s),Be=(i?v+i*s:this.nextAudioTs+c)-P.pts;Be>Fe?(h=Be-ne,h<0?h=ne:F=!0,this.log(`It is approximately ${Be/90} ms to the next segment; using duration ${h/90} ms for the last video frame.`)):h=ne}else h=ne}const J=Math.round(P.pts-P.dts);B=Math.min(B,h),j=Math.max(j,h),V=Math.min(V,Q),G=Math.max(G,Q),o.push(Sp(P.key,h,$,J))}if(o.length){if(oi){if(oi<70){const w=o[0].flags;w.dependsOn=2,w.isNonSync=0}}else if(pu&&G-V<j-B&&T/j<.025&&o[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let w=p;for(let P=0,U=o.length;P<U;P++){const $=w+o[P].duration,Q=w+o[P].cts;if(P<U-1){const J=$+o[P+1].cts;o[P].duration=J-Q}else o[P].duration=P?o[P-1].duration:T;o[P].cts=0,w=$}}}h=F||!h?T:h;const Y=x+h;this.nextVideoTs=d=Y-c,this.videoSampleDuration=h,this.isVideoContiguous=!0;const K={data1:M.moof(e.sequenceNumber++,p,Re(e,{samples:o})),data2:C,startPTS:(v-c)/s,endPTS:(y+h-c)/s,startDTS:(p-c)/s,endDTS:d/s,type:"video",hasAudio:!1,hasVideo:!0,nb:o.length,dropped:e.dropped};return e.samples=[],e.dropped=0,K}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return bC;case"ac3":return PC;default:return wC}}remuxAudio(e,t,n,i,s){const a=e.inputTimeScale,o=e.samplerate?e.samplerate:a,u=a/o,l=this.getSamplesPerFrame(e),c=l*u,d=this._initPTS,f=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,h=[],p=s!==void 0;let x=e.samples,v=f?0:8,y=this.nextAudioTs||-1;const g=d.baseTime*a/d.timescale,m=g+t*a;if(this.isAudioContiguous=n=n||x.length&&y>0&&(i&&Math.abs(m-(y+g))<9e3||Math.abs(Kt(x[0].pts,m)-(y+g))<20*c),x.forEach(function(G){G.pts=Kt(G.pts,m)}),!n||y<0){const G=x.length;if(x=x.filter(Y=>Y.pts>=0),G!==x.length&&this.warn(`Removed ${x.length-G} of ${G} samples (initPTS ${g} / ${a})`),!x.length)return;s===0?y=0:i&&!p?y=Math.max(0,m-g):y=x[0].pts-g}if(e.segmentCodec==="aac"){const G=this.config.maxAudioFramesDrift;for(let Y=0,O=y+g;Y<x.length;Y++){const H=x[Y],K=H.pts,w=K-O,P=Math.abs(1e3*w/a);if(w<=-G*c&&p)Y===0&&(this.warn(`Audio frame @ ${(K/a).toFixed(3)}s overlaps marker by ${Math.round(1e3*w/a)} ms.`),this.nextAudioTs=y=K-g,O=K);else if(w>=G*c&&P<kC&&p){let U=Math.round(w/c);for(O=K-U*c;O<0&&U&&c;)U--,O+=c;Y===0&&(this.nextAudioTs=y=O-g),this.warn(`Injecting ${U} audio frames @ ${((O-g)/a).toFixed(3)}s due to ${Math.round(1e3*w/a)} ms gap.`);for(let $=0;$<U;$++){let Q=IC.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);Q||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),Q=H.unit.subarray()),x.splice(Y,0,{unit:Q,pts:O}),O+=c,Y++}}H.pts=O,O+=c}}let E=null,T=null,L,A=0,R=x.length;for(;R--;)A+=x[R].unit.byteLength;for(let G=0,Y=x.length;G<Y;G++){const O=x[G],H=O.unit;let K=O.pts;if(T!==null){const P=h[G-1];P.duration=Math.round((K-T)/u)}else if(n&&e.segmentCodec==="aac"&&(K=y+g),E=K,A>0){A+=v;try{L=new Uint8Array(A)}catch(P){this.observer.emit(S.ERROR,S.ERROR,{type:re.MUX_ERROR,details:N.REMUX_ALLOC_ERROR,fatal:!1,error:P,bytes:A,reason:`fail allocating audio mdat ${A}`});return}f||(new DataView(L.buffer).setUint32(0,A),L.set(M.types.mdat,4))}else return;L.set(H,v);const w=H.byteLength;v+=w,h.push(Sp(!0,l,w,0)),T=K}const I=h.length;if(!I)return;const C=h[h.length-1];y=T-g,this.nextAudioTs=y+u*C.duration;const _=f?new Uint8Array(0):M.moof(e.sequenceNumber++,E/u,Re({},e,{samples:h}));e.samples=[];const F=(E-g)/a,B=y/a,j={data1:_,data2:L,startPTS:F,endPTS:B,startDTS:F,endDTS:B,type:"audio",hasAudio:!0,hasVideo:!1,nb:I};return this.isAudioContiguous=!0,j}}function Kt(r,e){let t;if(e===null)return r;for(e<r?t=-8589934592:t=8589934592;Math.abs(r-e)>4294967296;)r+=t;return r}function FC(r){for(let e=0;e<r.length;e++)if(r[e].key)return e;return-1}function ov(r,e,t,n){const i=r.samples.length;if(!i)return;const s=r.inputTimeScale;for(let o=0;o<i;o++){const u=r.samples[o];u.pts=Kt(u.pts-t.baseTime*s/t.timescale,e*s)/s,u.dts=Kt(u.dts-n.baseTime*s/n.timescale,e*s)/s}const a=r.samples;return r.samples=[],{samples:a}}function lv(r,e,t){const n=r.samples.length;if(!n)return;const i=r.inputTimeScale;for(let a=0;a<n;a++){const o=r.samples[a];o.pts=Kt(o.pts-t.baseTime*i/t.timescale,e*i)/i}r.samples.sort((a,o)=>a.pts-o.pts);const s=r.samples;return r.samples=[],{samples:s}}class BC extends lr{constructor(e,t,n,i){super("passthrough-remuxer",i),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,n,i){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(e,i),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:n,videoCodec:i}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:s,video:a}=this.initData=px(e);if(t)TT(e,t);else{const u=s||a;u!=null&&u.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${u.codec}")!`)}s&&(n=Tp(s,Ie.AUDIO,this)),a&&(i=Tp(a,Ie.VIDEO,this));const o={};s&&a?o.audiovideo={container:"video/mp4",codec:n+","+i,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:s?o.audio={container:"audio/mp4",codec:n,encrypted:s.encrypted,initSegment:e,id:"audio"}:a?o.video={container:"video/mp4",codec:i,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=o}remux(e,t,n,i,s,a){var o,u;let{initPTS:l,lastEndTime:c}=this;const d={audio:void 0,video:void 0,text:i,id3:n,initSegment:void 0};Z(c)||(c=this.lastEndTime=s||0);const f=t.samples;if(!f.length)return d;const h={initPTS:void 0,timescale:void 0,trackId:void 0};let p=this.initData;if((o=p)!=null&&o.length||(this.generateInitSegment(f),p=this.initData),!((u=p)!=null&&u.length))return this.warn("Failed to generate initSegment."),d;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);const x=CT(f,p,this),v=p.audio?x[p.audio.id]:null,y=p.video?x[p.video.id]:null,g=Ua(y,1/0),m=Ua(v,1/0),E=Ua(y,0,!0),T=Ua(v,0,!0);let L=s,A=0;const R=v&&(!y||!l&&m<g||l&&l.trackId===p.audio.id),I=R?v:y;if(I){const O=I.timescale,H=I.start-s*O,K=R?p.audio.id:p.video.id;L=I.start/O,A=R?T-m:E-g,(a||!l)&&(OC(l,L,s,A)||O!==l.timescale)&&(l&&this.warn(`Timestamps at playlist time: ${a?"":"~"}${s} ${H/O} != initPTS: ${l.baseTime/l.timescale} (${l.baseTime}/${l.timescale}) trackId: ${l.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${L-s} (${H}/${O}) trackId: ${K}`),l=null,h.initPTS=H,h.timescale=O,h.trackId=K)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${s}`);l?(h.initPTS=l.baseTime,h.timescale=l.timescale,h.trackId=l.trackId):((!h.timescale||h.trackId===void 0||h.initPTS===void 0)&&(this.warn("Could not set initPTS"),h.initPTS=L,h.timescale=1,h.trackId=-1),this.initPTS=l={baseTime:h.initPTS,timescale:h.timescale,trackId:h.trackId});const C=L-l.baseTime/l.timescale,_=C+A;A>0?this.lastEndTime=_:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const F=!!p.audio,B=!!p.video;let V="";F&&(V+="audio"),B&&(V+="video");const j=(p.audio?p.audio.encrypted:!1)||(p.video?p.video.encrypted:!1),G={data1:f,startPTS:C,startDTS:C,endPTS:_,endDTS:_,type:V,hasAudio:F,hasVideo:B,nb:1,dropped:0,encrypted:j};d.audio=F&&!B?G:void 0,d.video=B?G:void 0;const Y=y==null?void 0:y.sampleCount;if(Y){const O=y.keyFrameIndex,H=O!==-1;G.nb=Y,G.dropped=O===0||this.isVideoContiguous?0:H?O:Y,G.independent=H,G.firstKeyFrame=O,H&&y.keyFrameStart&&(G.firstKeyFramePTS=(y.keyFrameStart-l.baseTime)/l.timescale),this.isVideoContiguous||(d.independent=H),this.isVideoContiguous||(this.isVideoContiguous=H),G.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${O}/${Y} dropped: ${G.dropped} start: ${G.firstKeyFramePTS||"NA"}`)}return d.initSegment=h,d.id3=ov(n,s,l,l),i.samples.length&&(d.text=lv(i,s,l)),d}}function Ua(r,e,t=!1){return(r==null?void 0:r.start)!==void 0?(r.start+(t?r.duration:0))/r.timescale:e}function OC(r,e,t,n){if(r===null)return!0;const i=Math.max(n,1),s=e-r.baseTime/r.timescale;return Math.abs(s-t)>i}function Tp(r,e,t){const n=r.codec;return n&&n.length>4?n:e===Ie.AUDIO?n==="ec-3"||n==="ac-3"||n==="alac"?n:n==="fLaC"||n==="Opus"?jo(n,!1):(t.warn(`Unhandled audio codec "${n}" in mp4 MAP`),n||"mp4a"):(t.warn(`Unhandled video codec "${n}" in mp4 MAP`),n||"avc1")}let Gr;try{Gr=self.performance.now.bind(self.performance)}catch{Gr=Date.now}const po=[{demux:SC,remux:BC},{demux:ln,remux:ho},{demux:xC,remux:ho},{demux:yC,remux:ho}];po.splice(2,0,{demux:vC,remux:ho});class Ap{constructor(e,t,n,i,s,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.id=s,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,i){const s=n.transmuxing;s.executeStart=Gr();let a=new Uint8Array(e);const{currentTransmuxState:o,transmuxConfig:u}=this;i&&(this.currentTransmuxState=i);const{contiguous:l,discontinuity:c,trackSwitch:d,accurateTimeOffset:f,timeOffset:h,initSegmentChange:p}=i||o,{audioCodec:x,videoCodec:v,defaultInitPts:y,duration:g,initSegmentData:m}=u,E=MC(a,t);if(E&&wi(E.method)){const R=this.getDecrypter(),I=Gf(E.method);if(R.isSync()){let C=R.softwareDecrypt(a,E.key.buffer,E.iv.buffer,I);if(n.part>-1){const F=R.flush();C=F&&F.buffer}if(!C)return s.executeEnd=Gr(),gu(n);a=new Uint8Array(C)}else return this.asyncResult=!0,this.decryptionPromise=R.webCryptoDecrypt(a,E.key.buffer,E.iv.buffer,I).then(C=>{const _=this.push(C,null,n);return this.decryptionPromise=null,_}),this.decryptionPromise}const T=this.needsProbing(c,d);if(T){const R=this.configureTransmuxer(a);if(R)return this.logger.warn(`[transmuxer] ${R.message}`),this.observer.emit(S.ERROR,S.ERROR,{type:re.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!1,error:R,reason:R.message}),s.executeEnd=Gr(),gu(n)}(c||d||p||T)&&this.resetInitSegment(m,x,v,g,t),(c||p||T)&&this.resetInitialTimestamp(y),l||this.resetContiguity();const L=this.transmux(a,E,h,f,n);this.asyncResult=Xs(L);const A=this.currentTransmuxState;return A.contiguous=!0,A.discontinuity=!1,A.trackSwitch=!1,s.executeEnd=Gr(),L}flush(e){const t=e.transmuxing;t.executeStart=Gr();const{decrypter:n,currentTransmuxState:i,decryptionPromise:s}=this;if(s)return this.asyncResult=!0,s.then(()=>this.flush(e));const a=[],{timeOffset:o}=i;if(n){const d=n.flush();d&&a.push(this.push(d.buffer,null,e))}const{demuxer:u,remuxer:l}=this;if(!u||!l){t.executeEnd=Gr();const d=[gu(e)];return this.asyncResult?Promise.resolve(d):d}const c=u.flush(o);return Xs(c)?(this.asyncResult=!0,c.then(d=>(this.flushRemux(a,d,e),a))):(this.flushRemux(a,c,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,t,n){const{audioTrack:i,videoTrack:s,id3Track:a,textTrack:o}=t,{accurateTimeOffset:u,timeOffset:l}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${n.sn}${n.part>-1?" part: "+n.part:""} of ${this.id===ee.MAIN?"level":"track"} ${n.level}`);const c=this.remuxer.remux(i,s,a,o,l,u,!0,this.id);e.push({remuxResult:c,chunkMeta:n}),n.transmuxing.executeEnd=Gr()}resetInitialTimestamp(e){const{demuxer:t,remuxer:n}=this;!t||!n||(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,i,s){const{demuxer:a,remuxer:o}=this;!a||!o||(a.resetInitSegment(e,t,n,i),o.resetInitSegment(e,t,n,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,i,s){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,n,i,s):a=this.transmuxUnencrypted(e,n,i,s),a}transmuxUnencrypted(e,t,n,i){const{audioTrack:s,videoTrack:a,id3Track:o,textTrack:u}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,a,o,u,t,n,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,n,i,s){return this.demuxer.demuxSampleAes(e,t,n).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,n,i,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:t,observer:n,typeSupported:i}=this;let s;for(let d=0,f=po.length;d<f;d++){var a;if((a=po[d].demux)!=null&&a.probe(e,this.logger)){s=po[d];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");const o=this.demuxer,u=this.remuxer,l=s.remux,c=s.demux;(!u||!(u instanceof l))&&(this.remuxer=new l(n,t,i,this.logger)),(!o||!(o instanceof c))&&(this.demuxer=new c(n,t,i,this.logger),this.probe=c.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new $f(this.config)),e}}function MC(r,e){let t=null;return r.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const gu=r=>({remuxResult:{},chunkMeta:r});function Xs(r){return"then"in r&&r.then instanceof Function}class NC{constructor(e,t,n,i,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=i,this.defaultInitPts=s||null}}class $C{constructor(e,t,n,i,s,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=i,this.timeOffset=s,this.initSegmentChange=a}}let Cp=0;class uv{constructor(e,t,n,i){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Cp++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=u=>{const l=u.data,c=this.hls;if(!(!c||!(l!=null&&l.event)||l.instanceNo!==this.instanceNo))switch(l.event){case"init":{var d;const f=(d=this.workerContext)==null?void 0:d.objectURL;f&&self.URL.revokeObjectURL(f);break}case"transmuxComplete":{this.handleTransmuxComplete(l.data);break}case"flush":{this.onFlush(l.data);break}case"workerLog":{c.logger[l.data.logType]&&c.logger[l.data.logType](l.data.message);break}default:{l.data=l.data||{},l.data.frag=this.frag,l.data.part=this.part,l.data.id=this.id,c.trigger(l.event,l.data);break}}},this.onWorkerError=u=>{if(!this.hls)return;const l=new Error(`${u.message}  (${u.filename}:${u.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(S.ERROR,{type:re.OTHER_ERROR,details:N.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:l})};const s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=n,this.onFlush=i;const a=(u,l)=>{l=l||{},l.frag=this.frag||void 0,u===S.ERROR&&(l=l,l.parent=this.id,l.part=this.part,this.error=l.error),this.hls.trigger(u,l)};this.observer=new jf,this.observer.on(S.FRAG_DECRYPTED,a),this.observer.on(S.ERROR,a);const o=$h(s.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const u=this.hls.logger;if(s.workerPath||VA()){try{s.workerPath?(u.log(`loading Web Worker ${s.workerPath} for "${t}"`),this.workerContext=KA(s.workerPath)):(u.log(`injecting Web Worker for "${t}"`),this.workerContext=jA());const{worker:c}=this.workerContext;c.addEventListener("message",this.onWorkerMessage),c.addEventListener("error",this.onWorkerError),c.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:o,id:t,config:_e(s)})}catch(c){u.warn(`Error setting up "${t}" Web Worker, fallback to inline`,c),this.terminateWorker(),this.error=null,this.transmuxer=new Ap(this.observer,o,s,"",t,e.logger)}return}}this.transmuxer=new Ap(this.observer,o,s,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=Cp++;const t=this.hls.config,n=$h(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:n,id:this.id,config:_e(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),zA(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,n,i,s,a,o,u,l,c){var d,f;l.transmuxing.start=self.performance.now();const{instanceNo:h,transmuxer:p}=this,x=a?a.start:s.start,v=s.decryptdata,y=this.frag,g=!(y&&s.cc===y.cc),m=!(y&&l.level===y.level),E=y?l.sn-y.sn:-1,T=this.part?l.part-this.part.index:-1,L=E===0&&l.id>1&&l.id===(y==null?void 0:y.stats.chunkCount),A=!m&&(E===1||E===0&&(T===1||L&&T<=0)),R=self.performance.now();(m||E||s.stats.parsing.start===0)&&(s.stats.parsing.start=R),a&&(T||!A)&&(a.stats.parsing.start=R);const I=!(y&&((d=s.initSegment)==null?void 0:d.url)===((f=y.initSegment)==null?void 0:f.url)),C=new $C(g,A,u,m,x,I);if(!A||g||I){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${s.type} sn: ${l.sn}${l.part>-1?" part: "+l.part:""} ${this.id===ee.MAIN?"level":"track"}: ${l.level} id: ${l.id}
        discontinuity: ${g}
        trackSwitch: ${m}
        contiguous: ${A}
        accurateTimeOffset: ${u}
        timeOffset: ${x}
        initSegmentChange: ${I}`);const _=new NC(n,i,t,o,c);this.configureTransmuxer(_)}if(this.frag=s,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:h,cmd:"demux",data:e,decryptdata:v,chunkMeta:l,state:C},e instanceof ArrayBuffer?[e]:[]);else if(p){const _=p.push(e,v,l,C);Xs(_)?_.then(F=>{this.handleTransmuxComplete(F)}).catch(F=>{this.transmuxerError(F,l,"transmuxer-interface push error")}):this.handleTransmuxComplete(_)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:n}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(n){const i=n.flush(e);Xs(i)?i.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")}):this.handleFlushResult(i,e)}}transmuxerError(e,t,n){this.hls&&(this.error=e,this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(n=>{this.handleTransmuxComplete(n)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:n}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):n&&n.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const Lp=100;class UC extends Vf{constructor(e,t,n){super(e,t,n,"audio-stream-controller",ee.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(S.BUFFER_RESET,this.onBufferReset,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(S.BUFFER_RESET,this.onBufferReset,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:n,initPTS:i,timescale:s,trackId:a}){if(n===ee.MAIN){const o=t.cc,u=this.fragCurrent;if(this.initPTS[o]={baseTime:i,timescale:s,trackId:a},this.log(`InitPTS for cc: ${o} found from main: ${i/s} (${i}/${s}) trackId: ${a}`),this.mainAnchor=t,this.state===z.WAITING_INIT_PTS){const l=this.waitingData;(!l&&!this.loadingParts||l&&l.frag.cc!==o)&&this.syncWithAnchor(t,l==null?void 0:l.frag)}else!this.hls.hasEnoughToStart&&u&&u.cc!==o?(u.abortRequests(),this.syncWithAnchor(t,u)):this.state===z.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var n;const i=((n=this.mainFragLoading)==null?void 0:n.frag)||null;if(t&&(i==null?void 0:i.cc)===t.cc)return;const s=(i||e).cc,a=this.getLevelDetails(),o=this.getLoadPosition(),u=Lx(a,s,o);u&&(this.log(`Syncing with main frag at ${u.start} cc ${u.cc}`),this.startFragRequested=!1,this.nextLoadPosition=u.start,this.resetLoadingState(),this.state===z.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=z.STOPPED;return}const n=this.lastCurrentTime;this.stopLoad(),this.setInterval(Lp),n>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n,this.state=z.IDLE):this.state=z.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case z.IDLE:this.doTickIdle();break;case z.WAITING_TRACK:{const{levels:e,trackId:t}=this,n=e==null?void 0:e[t],i=n==null?void 0:n.details;if(i&&!this.waitForLive(n)){if(this.waitForCdnTuneIn(i))break;this.state=z.WAITING_INIT_PTS}break}case z.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case z.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:n,cache:i,complete:s}=e,a=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=z.FRAG_LOADING;const o=i.flush().buffer,u={frag:t,part:n,payload:o,networkDetails:null};this._handleFragmentLoadProgress(u),s&&super._handleFragmentLoadComplete(u)}else a&&a.cc!==e.frag.cc&&this.syncWithAnchor(a,e.frag)}else this.state=z.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:n,media:i,trackId:s}=this,a=t.config;if(!this.buffering||!i&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||!(n!=null&&n[s]))return;const o=n[s],u=o.details;if(!u||this.waitForLive(o)||this.waitForCdnTuneIn(u)){this.state=z.WAITING_TRACK,this.startFragRequested=!1;return}const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,Ie.AUDIO,ee.AUDIO));const c=this.getFwdBufferInfo(l,ee.AUDIO);if(c===null)return;if(!this.switchingTrack&&this._streamEnded(c,u)){t.trigger(S.BUFFER_EOS,{type:"audio"}),this.state=z.ENDED;return}const d=c.len,f=t.maxBufferLength,h=u.fragments,p=h[0].start,x=this.getLoadPosition(),v=this.flushing?x:c.end;if(this.switchingTrack&&i){const m=x;u.PTSKnown&&m<p&&(c.end>p||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=p+.05)}if(d>=f&&!this.switchingTrack&&v<h[h.length-1].start)return;let y=this.getNextFragment(v,u);if(y&&this.isLoopLoading(y,v)&&(y=this.getNextFragmentLoopLoading(y,u,c,ee.MAIN,f)),!y){this.bufferFlushed=!0;return}let g=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&g&&Xe(y)&&!y.endList&&(!u.live||!this.loadingParts&&v<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(g)===et.OK&&(this.mainFragLoading=g=null),g&&Xe(g))){if(y.start>g.end){const E=this.fragmentTracker.getFragAtPos(v,ee.MAIN);E&&E.end>g.end&&(g=E,this.mainFragLoading={frag:E,targetBufferTime:null})}if(y.start>g.end)return}this.loadFragment(y,o,v)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(n=>new Ws(n))}onAudioTrackSwitching(e,t){const n=!!t.url;this.trackId=t.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),n?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==z.STOPPED&&(this.setInterval(Lp),this.state=z.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const n=this.cachedTrackLoadedData;n&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(S.AUDIO_TRACK_LOADED,n))}onAudioTrackLoaded(e,t){var n;const{levels:i}=this,{details:s,id:a,groupId:o,track:u}=t;if(!i){this.warn(`Audio tracks reset while loading track ${a} "${u.name}" of "${o}"`);return}const l=this.mainDetails;if(!l||s.endCC>l.endCC||l.expired){this.cachedTrackLoadedData=t,this.state!==z.STOPPED&&(this.state=z.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${a} "${u.name}" of "${o}" loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const c=i[a];let d=0;if(s.live||(n=c.details)!=null&&n.live){if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;if(c.details){var f;d=this.alignPlaylists(s,c.details,(f=this.levelLastLoaded)==null?void 0:f.details)}s.alignedSliding||(Vx(s,l),s.alignedSliding||Qo(s,l),d=s.fragmentStart)}c.details=s,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(l,d),this.hls.trigger(S.AUDIO_TRACK_UPDATED,{details:s,id:a,groupId:t.groupId}),this.state===z.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=z.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:i,payload:s}=e,{config:a,trackId:o,levels:u}=this;if(!u){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const l=u[o];if(!l){this.warn("Audio track is undefined on fragment load progress");return}const c=l.details;if(!c){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(n.start);return}const d=a.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let f=this.transmuxer;f||(f=this.transmuxer=new uv(this.hls,ee.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const h=this.initPTS[n.cc],p=(t=n.initSegment)==null?void 0:t.data;if(h!==void 0){const v=i?i.index:-1,y=v!==-1,g=new Uf(n.level,n.sn,n.stats.chunkCount,s.byteLength,v,y);f.push(s,p,d,"",n,i,c.totalduration,!1,g,h)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${c.startSN} ,${c.endSN}],track ${o}`);const{cache:x}=this.waitingData=this.waitingData||{frag:n,part:i,cache:new jx,complete:!1};x.push(new Uint8Array(s)),this.state!==z.STOPPED&&(this.state=z.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===ee.MAIN&&Xe(t.frag)&&(this.mainFragLoading=t,this.state===z.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:n,part:i}=t;if(n.type!==ee.AUDIO){!this.audioOnly&&n.type===ee.MAIN&&!n.elementaryStreams.video&&!n.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${i?" p: "+i.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Xe(n)){this.fragPrevious=n;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(S.AUDIO_TRACK_SWITCHED,Ae({},s)))}this.fragBufferedComplete(n,i),this.media&&this.tick()}onError(e,t){var n;if(t.fatal){this.state=z.ERROR;return}switch(t.details){case N.FRAG_GAP:case N.FRAG_PARSING_ERROR:case N.FRAG_DECRYPT_ERROR:case N.FRAG_LOAD_ERROR:case N.FRAG_LOAD_TIMEOUT:case N.KEY_LOAD_ERROR:case N.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ee.AUDIO,t);break;case N.AUDIO_TRACK_LOAD_ERROR:case N.AUDIO_TRACK_LOAD_TIMEOUT:case N.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===z.WAITING_TRACK&&((n=t.context)==null?void 0:n.type)===me.AUDIO_TRACK&&(this.state=z.IDLE);break;case N.BUFFER_ADD_CODEC_ERROR:case N.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case N.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case N.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Ie.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Ie.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===z.ENDED&&(this.state=z.IDLE);const n=this.mediaBuffer||this.media;n&&(this.afterBufferFlushed(n,t,ee.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const n="audio",{hls:i}=this,{remuxResult:s,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o){this.resetWhenMissingContext(a);return}const{frag:u,part:l,level:c}=o,{details:d}=c,{audio:f,text:h,id3:p,initSegment:x}=s;if(this.fragContextChanged(u)||!d){this.fragmentTracker.removeFragment(u);return}if(this.state=z.PARSING,this.switchingTrack&&f&&this.completeAudioSwitch(this.switchingTrack),x!=null&&x.tracks){const v=u.initSegment||u;if(this.unhandledEncryptionError(x,u))return;this._bufferInitSegment(c,x.tracks,v,a),i.trigger(S.FRAG_PARSING_INIT_SEGMENT,{frag:v,id:n,tracks:x.tracks})}if(f){const{startPTS:v,endPTS:y,startDTS:g,endDTS:m}=f;l&&(l.elementaryStreams[Ie.AUDIO]={startPTS:v,endPTS:y,startDTS:g,endDTS:m}),u.setElementaryStreamInfo(Ie.AUDIO,v,y,g,m),this.bufferFragmentData(f,u,l,a)}if(p!=null&&(t=p.samples)!=null&&t.length){const v=Re({id:n,frag:u,details:d},p);i.trigger(S.FRAG_PARSING_METADATA,v)}if(h){const v=Re({id:n,frag:u,details:d},h);i.trigger(S.FRAG_PARSING_USERDATA,v)}}_bufferInitSegment(e,t,n,i){if(this.state!==z.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const s=t.audio;s.id=ee.AUDIO;const a=e.audioCodec;this.log(`Init audio buffer, container:${s.container}, codecs[level/parsed]=[${a}/${s.codec}]`),a&&a.split(",").length===1&&(s.levelCodec=a),this.hls.trigger(S.BUFFER_CODECS,t);const o=s.initSegment;if(o!=null&&o.byteLength){const u={type:"audio",frag:n,part:null,chunkMeta:i,parent:n.type,data:o};this.hls.trigger(S.BUFFER_APPENDING,u)}this.tickImmediate()}loadFragment(e,t,n){const i=this.fragmentTracker.getState(e);if(this.switchingTrack||i===et.NOT_LOADED||i===et.PARTIAL){var s;if(!Xe(e))this._loadInitSegment(e,t);else if((s=t.details)!=null&&s.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=z.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragmentStart!==t.details.fragmentStart&&Qo(t.details,a)}else super.loadFragment(e,t,n)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:n,assocLang:i,characteristics:s,audioCodec:a,channels:o}=this.bufferedTrack;jn({name:t,lang:n,assocLang:i,characteristics:s,audioCodec:a,channels:o},e,Nn)||(zo(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(S.AUDIO_TRACK_SWITCHED,Ae({},e))}}class Qf extends lr{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,n){const i=t==null?void 0:t.renditionReports;if(i){let s=-1;for(let a=0;a<i.length;a++){const o=i[a];let u;try{u=new self.URL(o.URI,t.url).href}catch(l){this.warn(`Could not construct new URL for Rendition Report: ${l}`),u=o.URI||""}if(u===e){s=a;break}else u===e.substring(0,u.length)&&(s=a)}if(s!==-1){const a=i[s],o=parseInt(a["LAST-MSN"])||t.lastPartSn;let u=parseInt(a["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const c=Math.min(t.age-t.partTarget,t.targetduration);u>=0&&c>t.partTarget&&(u+=1)}const l=n&&Uh(n);return new Gh(o,u>=0?u:void 0,l)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${n}`)}return e}playlistLoaded(e,t,n){const{details:i,stats:s}=t,a=self.performance.now(),o=s.loading.first?Math.max(0,a-s.loading.first):0;i.advancedDateTime=Date.now()-o;const u=this.hls.config.timelineOffset;if(u!==i.appliedTimelineOffset){const c=Math.max(u||0,0);i.appliedTimelineOffset=c,i.fragments.forEach(d=>{d.setStart(d.playlistOffset+c)})}if(i.live||n!=null&&n.live){const c="levelInfo"in t?t.levelInfo:t.track;if(i.reloaded(n),n&&i.fragments.length>0){bA(n,i,this);const g=i.playlistParsingError;if(g){this.warn(g);const m=this.hls;if(!m.config.ignorePlaylistParsingErrors){var l;const{networkDetails:E}=t;m.trigger(S.ERROR,{type:re.NETWORK_ERROR,details:N.LEVEL_PARSING_ERROR,fatal:!1,url:i.url,error:g,reason:g.message,level:t.level||void 0,parent:(l=i.fragments[0])==null?void 0:l.type,networkDetails:E,stats:s});return}i.playlistParsingError=null}}i.requestScheduled===-1&&(i.requestScheduled=s.loading.start);const d=this.hls.mainForwardBufferInfo,f=d?d.end-d.len:0,h=(i.edge-f)*1e3,p=Nx(i,h);if(i.requestScheduled+p<a?i.requestScheduled=a:i.requestScheduled+=p,this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),!this.canLoad||!i.live)return;let x,v,y;if(i.canBlockReload&&i.endSN&&i.advanced){const g=this.hls.config.lowLatencyMode,m=i.lastPartSn,E=i.endSN,T=i.lastPartIndex,L=T!==-1,A=m===E;L?A?(v=E+1,y=g?0:T):(v=m,y=g?T+1:i.maxPartIndex):v=E+1;const R=i.age,I=R+i.ageHeader;let C=Math.min(I-i.partTarget,i.targetduration*1.5);if(C>0){if(I>i.targetduration*3)this.log(`Playlist last advanced ${R.toFixed(2)}s ago. Omitting segment and part directives.`),v=void 0,y=void 0;else if(n!=null&&n.tuneInGoal&&I-i.partTarget>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${C} with playlist age: ${i.age}`),C=0;else{const _=Math.floor(C/i.targetduration);if(v+=_,y!==void 0){const F=Math.round(C%i.targetduration/i.partTarget);y+=F}this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${R.toFixed(2)}s goal: ${C} skip sn ${_} to part ${y}`)}i.tuneInGoal=C}if(x=this.getDeliveryDirectives(i,t.deliveryDirectives,v,y),g||!A){i.requestScheduled=a,this.loadingPlaylist(c,x);return}}else(i.canBlockReload||i.canSkipUntil)&&(x=this.getDeliveryDirectives(i,t.deliveryDirectives,v,y));x&&v!==void 0&&i.canBlockReload&&(i.requestScheduled=s.loading.first+Math.max(p-o*2,p/2)),this.scheduleLoading(c,x,i)}else this.clearTimer()}scheduleLoading(e,t,n){const i=n||e.details;if(!i){this.loadingPlaylist(e,t);return}const s=self.performance.now(),a=i.requestScheduled;if(s>=a){this.loadingPlaylist(e,t);return}const o=a-s;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(o)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),o)}getDeliveryDirectives(e,t,n,i){let s=Uh(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,i=t.part,s=co.No),new Gh(n,i,s)}checkRetry(e){const t=e.details,n=Wo(e),i=e.errorAction,{action:s,retryCount:a=0,retryConfig:o}=i||{},u=!!i&&!!o&&(s===ut.RetryRequest||!i.resolved&&s===ut.SendAlternateToPenaltyBox);if(u){var l;if(a>=o.maxNumRetry)return!1;if(n&&(l=e.context)!=null&&l.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const c=Nf(o,a);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),c),this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" in ${c}ms`)}e.levelRetry=!0,i.resolved=!0}return u}}function cv(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(!Qs(r[t].attrs,e[t].attrs))return!1;return!0}function Qs(r,e,t){const n=r["STABLE-RENDITION-ID"];return n&&!t?n===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(i=>r[i]!==e[i])}function yd(r,e){return e.label.toLowerCase()===r.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(r.lang||"").toLowerCase())}class GC extends Qf{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(S.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:n,groupId:i,details:s}=t,a=this.tracksInGroup[n];if(!a||a.groupId!==i){this.warn(`Audio track with id:${n} and group:${i} not found in active group ${a==null?void 0:a.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Audio track ${n} "${a.name}" lang:${a.lang} group:${i} loaded [${s.startSN}-${s.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.audioGroups||null,i=this.groupIds;let s=this.currentTrack;if(!n||(i==null?void 0:i.length)!==(n==null?void 0:n.length)||n!=null&&n.some(o=>(i==null?void 0:i.indexOf(o))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(f=>!n||n.indexOf(f.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(f=>f.default)&&(this.selectDefaultTrack=!1),o.forEach((f,h)=>{f.id=h});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const u=this.hls.config.audioPreference;if(!s&&u){const f=Dr(u,o,Nn);if(f>-1)s=o[f];else{const h=Dr(u,this.tracks);s=this.tracks[h]}}let l=this.findTrackId(s);l===-1&&s&&(l=this.findTrackId(null));const c={audioTracks:o};this.log(`Updating audio tracks, ${o.length} track(s) found in group(s): ${n==null?void 0:n.join(",")}`),this.hls.trigger(S.AUDIO_TRACKS_UPDATED,c);const d=this.trackId;if(l!==-1&&d===-1)this.setAudioTrack(l);else if(o.length&&d===-1){var a;const f=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${o.length}`);this.warn(f.message),this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:N.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:f})}}}onError(e,t){t.fatal||!t.context||t.context.type===me.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const i=this.currentTrack;if(i&&jn(e,i,Nn))return i;const s=Dr(e,this.tracksInGroup,Nn);if(s>-1){const a=this.tracksInGroup[s];return this.setAudioTrack(s),a}else if(i){let a=t.loadLevel;a===-1&&(a=t.firstAutoLevel);const o=JT(e,t.levels,n,a,Nn);if(o===-1)return null;t.nextLoadLevel=o}if(e.channels||e.audioCodec){const a=Dr(e,n);if(a>-1)return n[a]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,i=t[e],s=i.details&&!i.details.live;if(e===this.trackId&&i===n&&s||(this.log(`Switching to audio-track ${e} "${i.name}" lang:${i.lang} group:${i.groupId} channels:${i.channels}`),this.trackId=e,this.currentTrack=i,this.hls.trigger(S.AUDIO_TRACK_SWITCHING,Ae({},i)),s))return;const a=this.switchParams(i.url,n==null?void 0:n.details,i.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const i=t[n];if(!(this.selectDefaultTrack&&!i.default)&&(!e||jn(e,i,Nn)))return n}if(e){const{name:n,lang:i,assocLang:s,characteristics:a,audioCodec:o,channels:u}=e;for(let l=0;l<t.length;l++){const c=t[l];if(jn({name:n,lang:i,assocLang:s,characteristics:a,audioCodec:o,channels:u},c,Nn))return l}for(let l=0;l<t.length;l++){const c=t[l];if(Qs(e.attrs,c.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return l}for(let l=0;l<t.length;l++){const c=t[l];if(Qs(e.attrs,c.attrs,["LANGUAGE"]))return l}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&zo(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,i=e.groupId,s=this.getUrlWithDirectives(e.url,t),a=e.details,o=a==null?void 0:a.age;this.log(`Loading audio-track ${n} "${e.name}" lang:${e.lang} group:${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${s}`),this.hls.trigger(S.AUDIO_TRACK_LOADING,{url:s,id:n,groupId:i,deliveryDirectives:t||null,track:e})}}class HC{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,n){if(this.queues===null||this.tracks===null)return;const i=this.queues[t];i.push(e),i.length===1&&!n&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const n={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(n,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const n={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(n)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const n=(t=e[0])==null?void 0:t.label;(n==="async-blocker"||n==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const i=t[0];try{i.execute()}catch(s){var n;if(i.onError(s),this.queues===null||this.tracks===null)return;const a=(n=this.tracks[e])==null?void 0:n.buffer;a!=null&&a.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,n;return(t=this.queues)!=null&&t[e]||(n=this.tracks)!=null&&n[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const n=(t=this.tracks)==null?void 0:t[e],i=n==null?void 0:n.buffer;return i?`SourceBuffer${i.updating?" updating":""}${n.ended?" ended":""}${n.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(n=>n.label).join(", "))||""}}const Rp=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,dv="HlsJsTrackRemovedError";class VC extends Error{constructor(e){super(e),this.name=dv}}class jC extends lr{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=n=>{var i;this.hls&&((i=this.mediaSource)==null?void 0:i.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=n=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=n=>{const{media:i,mediaSource:s}=this;n&&this.log("Media source opened"),!(!i||!s)&&(s.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(S.MEDIA_ATTACHED,{media:i,mediaSource:s}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:n,_objectUrl:i}=this;n!==i&&this.error(`Media element src was set while attaching MediaSource (${i} > ${n})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=fT(An(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.BUFFER_RESET,this.onBufferReset,this),e.on(S.BUFFER_APPENDING,this.onBufferAppending,this),e.on(S.BUFFER_CODECS,this.onBufferCodecs,this),e.on(S.BUFFER_EOS,this.onBufferEos,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.FRAG_PARSED,this.onFragParsed,this),e.on(S.FRAG_CHANGED,this.onFragChanged,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.BUFFER_RESET,this.onBufferReset,this),e.off(S.BUFFER_APPENDING,this.onBufferAppending,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.BUFFER_EOS,this.onBufferEos,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.FRAG_PARSED,this.onFragParsed,this),e.off(S.FRAG_CHANGED,this.onFragChanged,this),e.off(S.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const n={};if(this.operationQueue){const s=this.isUpdating();s||this.operationQueue.removeBlockers();const a=this.isQueued();(s||a)&&this.warn(`Transfering MediaSource with${a?" operations in queue":""}${s?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const i=this.transferData;return!this.sourceBufferCount&&i&&i.mediaSource===t?Re(n,i.tracks):this.sourceBuffers.forEach(s=>{const[a]=s;a&&(n[a]=Re({},this.tracks[a]),this.removeBuffer(a)),s[0]=s[1]=null}),{media:e,mediaSource:t,tracks:n}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var n;let i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsTotal=i,this.log(`${i} bufferCodec event(s) expected.`),(n=this.transferData)!=null&&n.mediaSource&&this.sourceBufferCount&&i&&this.bufferCreated()}onMediaAttaching(e,t){const n=this.media=t.media;this.transferData=this.overrides=void 0;const i=An(this.appendSource);if(i){const s=!!t.mediaSource;(s||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const a=this.mediaSource=t.mediaSource||new i;if(this.assignMediaSource(a),s)this._objectUrl=n.src,this.attachTransferred();else{const o=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{n.removeAttribute("src");const u=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||u&&a instanceof u,Ip(n),KC(n,o),n.load()}catch{n.src=o}else n.src=o}n.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,n;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(n=e.constructor)==null?void 0:n.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const n=this.tracks,i=t.tracks,s=i?Object.keys(i):null,a=s?s.length:0,o=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(i&&s&&a){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${_e(n,(u,l)=>u==="initSegment"?void 0:l)};
transfer tracks: ${_e(i,(u,l)=>u==="initSegment"?void 0:l)}}`),!ox(i,n)){t.mediaSource=null,t.tracks=void 0;const u=e.currentTime,l=this.details,c=Math.max(u,(l==null?void 0:l.fragments[0].start)||0);if(c-u>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${u} -> ${c}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(i)}"->"${Object.keys(n)}") start time: ${c} currentTime: ${u}`),this.onMediaDetaching(S.MEDIA_DETACHING,{}),this.onMediaAttaching(S.MEDIA_ATTACHING,t),e.currentTime=c;return}this.transferData=void 0,s.forEach(u=>{const l=u,c=i[l];if(c){const d=c.buffer;if(d){const f=this.fragmentTracker,h=c.id;if(f.hasFragments(h)||f.hasParts(h)){const v=ue.getBuffered(d);f.detectEvictedFragments(l,v,h,null,!0)}const p=mu(l),x=[l,d];this.sourceBuffers[p]=x,d.updating&&this.operationQueue&&this.operationQueue.prependBlocker(l),this.trackSourceBuffer(l,c)}}}),o(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),o()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const n=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:i,mediaSource:s,_objectUrl:a}=this;if(s){if(this.log(`media source ${n?"transferring":"detaching"}`),n)this.sourceBuffers.forEach(([o])=>{o&&this.removeBuffer(o)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const o=s.readyState==="open";try{const u=s.sourceBuffers;for(let l=u.length;l--;)o&&u[l].abort(),s.removeSourceBuffer(u[l]);o&&s.endOfStream()}catch(u){this.warn(`onMediaDetaching: ${u.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(s.removeEventListener("startstreaming",this._onStartStreaming),s.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}i&&(i.removeEventListener("emptied",this._onMediaEmptied),n||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(i.removeAttribute("src"),this.appendSource&&Ip(i),i.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(S.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const n=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),n)try{var i;(i=this.mediaSource)!=null&&i.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(n)}catch(s){this.warn(`onBufferReset ${e}`,s)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[mu(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new HC(this.tracks)}onBufferCodecs(e,t){var n;const i=this.tracks,s=Object.keys(t);this.log(`BUFFER_CODECS: "${s}" (current SB count ${this.sourceBufferCount})`);const a="audiovideo"in t&&(i.audio||i.video)||i.audiovideo&&("audio"in t||"video"in t),o=!a&&this.sourceBufferCount&&this.media&&s.some(u=>!i[u]);if(a||o){this.warn(`Unsupported transition between "${Object.keys(i)}" and "${s}" SourceBuffers`);return}s.forEach(u=>{var l,c;const d=t[u],{id:f,codec:h,levelCodec:p,container:x,metadata:v,supplemental:y}=d;let g=i[u];const m=(l=this.transferData)==null||(l=l.tracks)==null?void 0:l[u],E=m!=null&&m.buffer?m:g,T=(E==null?void 0:E.pendingCodec)||(E==null?void 0:E.codec),L=E==null?void 0:E.levelCodec;g||(g=i[u]={buffer:void 0,listeners:[],codec:h,supplemental:y,container:x,levelCodec:p,metadata:v,id:f});const A=uo(T,L),R=A==null?void 0:A.replace(Rp,"$1");let I=uo(h,p);const C=(c=I)==null?void 0:c.replace(Rp,"$1");I&&A&&R!==C&&(u.slice(0,5)==="audio"&&(I=jo(I,this.appendSource)),this.log(`switching codec ${T} to ${I}`),I!==(g.pendingCodec||g.codec)&&(g.pendingCodec=I),g.container=x,this.appendChangeType(u,x,I))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((n=t.audio)==null?void 0:n.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const n=this.tracks[t];return e[t]={id:n.id,container:n.container,codec:n.codec,levelCodec:n.levelCodec},e},{})}appendChangeType(e,t,n){const i=`${t};codecs=${n}`,s={label:`change-type=${i}`,execute:()=>{const a=this.tracks[e];if(a){const o=a.buffer;o!=null&&o.changeType&&(this.log(`changing ${e} sourceBuffer type to ${i}`),o.changeType(i),a.codec=n,a.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn(`Failed to change ${e} SourceBuffer type`,a)}};this.append(s,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const n=e.start,i=n+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(n,ee.MAIN))==null?void 0:t.gap)===!0)return;const a={label:"block-audio",execute:()=>{var o;const u=this.tracks.video;(this.lastVideoAppendEnd>i||u!=null&&u.buffer&&ue.isBuffered(u.buffer,i)||((o=this.fragmentTracker.getAppendedFrag(i,ee.MAIN))==null?void 0:o.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn("Error executing block-audio operation",o)}};this.blockedAudioAppend={op:a,frag:e},this.append(a,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:n}=this,{data:i,type:s,parent:a,frag:o,part:u,chunkMeta:l,offset:c}=t,d=l.buffering[s],{sn:f,cc:h}=o,p=self.performance.now();d.start=p;const x=o.stats.buffering,v=u?u.stats.buffering:null;x.start===0&&(x.start=p),v&&v.start===0&&(v.start=p);const y=n.audio;let g=!1;s==="audio"&&(y==null?void 0:y.container)==="audio/mpeg"&&(g=!this.lastMpegAudioChunk||l.id===1||this.lastMpegAudioChunk.sn!==l.sn,this.lastMpegAudioChunk=l);const m=n.video,E=m==null?void 0:m.buffer;if(E&&f!=="initSegment"){const A=u||o,R=this.blockedAudioAppend;if(s==="audio"&&a!=="main"&&!this.blockedAudioAppend&&!(m.ending||m.ended)){const C=A.start+A.duration*.05,_=E.buffered,F=this.currentOp("video");!_.length&&!F?this.blockAudio(A):!F&&!ue.isBuffered(E,C)&&this.lastVideoAppendEnd<C&&this.blockAudio(A)}else if(s==="video"){const I=A.end;if(R){const C=R.frag.start;(I>C||I<this.lastVideoAppendEnd||ue.isBuffered(E,C))&&this.unblockAudio()}this.lastVideoAppendEnd=I}}const T=(u||o).start,L={label:`append-${s}`,execute:()=>{var A;d.executeStart=self.performance.now();const R=(A=this.tracks[s])==null?void 0:A.buffer;R&&(g?this.updateTimestampOffset(R,T,.1,s,f,h):c!==void 0&&Z(c)&&this.updateTimestampOffset(R,c,1e-6,s,f,h)),this.appendExecutor(i,s)},onStart:()=>{},onComplete:()=>{const A=self.performance.now();d.executeEnd=d.end=A,x.first===0&&(x.first=A),v&&v.first===0&&(v.first=A);const R={};this.sourceBuffers.forEach(([I,C])=>{I&&(R[I]=ue.getBuffered(C))}),this.appendErrors[s]=0,s==="audio"||s==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(S.BUFFER_APPENDED,{type:s,frag:o,part:u,chunkMeta:l,parent:o.type,timeRanges:R})},onError:A=>{var R;const I={type:re.MEDIA_ERROR,parent:o.type,details:N.BUFFER_APPEND_ERROR,sourceBufferName:s,frag:o,part:u,chunkMeta:l,error:A,err:A,fatal:!1},C=(R=this.media)==null?void 0:R.error;if(A.code===DOMException.QUOTA_EXCEEDED_ERR||A.name=="QuotaExceededError"||"quota"in A)I.details=N.BUFFER_FULL_ERROR;else if(A.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!C)I.errorAction=ki(!0);else if(A.name===dv&&this.sourceBufferCount===0)I.errorAction=ki(!0);else{const _=++this.appendErrors[s];this.warn(`Failed ${_}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${s}" sourceBuffer (${C||"no media error"})`),(_>=this.hls.config.appendErrorMaxRetry||C)&&(I.fatal=!0)}this.hls.trigger(S.ERROR,I)}};this.log(`queuing "${s}" append sn: ${f}${u?" p: "+u.index:""} of ${o.type===ee.MAIN?"level":"track"} ${o.level} cc: ${h}`),this.append(L,s,this.isPending(this.tracks[s]))}getFlushOp(e,t,n){return this.log(`queuing "${e}" remove ${t}-${n}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,n)},onStart:()=>{},onComplete:()=>{this.hls.trigger(S.BUFFER_FLUSHED,{type:e})},onError:i=>{this.warn(`Failed to remove ${t}-${n} from "${e}" SourceBuffer`,i)}}}onBufferFlushing(e,t){const{type:n,startOffset:i,endOffset:s}=t;n?this.append(this.getFlushOp(n,i,s),n):this.sourceBuffers.forEach(([a])=>{a&&this.append(this.getFlushOp(a,i,s),a)})}onFragParsed(e,t){const{frag:n,part:i}=t,s=[],a=i?i.elementaryStreams:n.elementaryStreams;a[Ie.AUDIOVIDEO]?s.push("audiovideo"):(a[Ie.AUDIO]&&s.push("audio"),a[Ie.VIDEO]&&s.push("video"));const o=()=>{const u=self.performance.now();n.stats.buffering.end=u,i&&(i.stats.buffering.end=u);const l=i?i.stats:n.stats;this.hls.trigger(S.FRAG_BUFFERED,{frag:n,part:i,stats:l,id:n.type})};s.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(o,s).catch(u=>{this.warn(`Fragment buffered callback ${u}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var n;this.sourceBuffers.forEach(([a])=>{if(a){const o=this.tracks[a];(!t.type||t.type===a)&&(o.ending=!0,o.ended||(o.ended=!0,this.log(`${a} buffer reached EOS`)))}});const i=((n=this.overrides)==null?void 0:n.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([a])=>{var o;return a&&!((o=this.tracks[a])!=null&&o.ended)})?i?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:a}=this;if(!a||a.readyState!=="open"){a&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${a.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),a.endOfStream(),this.hls.trigger(S.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(S.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===N.BUFFER_APPEND_ERROR&&t.frag){var n;const i=(n=t.errorAction)==null?void 0:n.nextAutoLevel;Z(i)&&i!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:n}=this;if(!n||t===null||!this.sourceBufferCount)return;const i=e.config,s=n.currentTime,a=t.levelTargetDuration,o=t.live&&i.liveBackBufferLength!==null?i.liveBackBufferLength:i.backBufferLength;if(Z(o)&&o>=0){const l=Math.max(o,a),c=Math.floor(s/a)*a-l;this.flushBackBuffer(s,a,c)}const u=i.frontBufferFlushThreshold;if(Z(u)&&u>0){const l=Math.max(i.maxBufferLength,u),c=Math.max(l,a),d=Math.floor(s/a)*a+c;this.flushFrontBuffer(s,a,d)}}flushBackBuffer(e,t,n){this.sourceBuffers.forEach(([i,s])=>{if(s){const o=ue.getBuffered(s);if(o.length>0&&n>o.start(0)){var a;this.hls.trigger(S.BACK_BUFFER_REACHED,{bufferEnd:n});const u=this.tracks[i];if((a=this.details)!=null&&a.live)this.hls.trigger(S.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(u!=null&&u.ended){this.log(`Cannot flush ${i} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:i})}}})}flushFrontBuffer(e,t,n){this.sourceBuffers.forEach(([i,s])=>{if(s){const a=ue.getBuffered(s),o=a.length;if(o<2)return;const u=a.start(o-1),l=a.end(o-1);if(n>u||e>=u&&e<=l)return;this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:u,endOffset:1/0,type:i})}})}getDurationAndRange(){var e;const{details:t,mediaSource:n}=this;if(!t||!this.media||(n==null?void 0:n.readyState)!=="open")return null;const i=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&n.setLiveSeekableRange){const l=Math.max(0,t.fragmentStart),c=Math.max(l,i);return{duration:1/0,start:l,end:c}}return{duration:1/0}}const s=(e=this.overrides)==null?void 0:e.duration;if(s)return Z(s)?{duration:s}:null;const a=this.media.duration,o=Z(n.duration)?n.duration:0;return i>o&&i>a||!Z(a)?{duration:i}:null}updateMediaSource({duration:e,start:t,end:n}){const i=this.mediaSource;!this.media||!i||i.readyState!=="open"||(i.duration!==e&&(Z(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),i.duration=e),t!==void 0&&n!==void 0&&(this.log(`MediaSource duration is set to ${i.duration}. Setting seekable range to ${t}-${n}.`),i.setLiveSeekableRange(t,n)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:n}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${_e(n)}`),this.tracksReady){var i;const s=(i=this.transferData)==null?void 0:i.tracks;s&&Object.keys(s).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,n])=>{if(t){const i=this.tracks[t];e[t]={buffer:n,container:i.container,codec:i.codec,supplemental:i.supplemental,levelCodec:i.levelCodec,id:i.id,metadata:i.metadata}}}),this.hls.trigger(S.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:N.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:n}=this;if(!n)throw new Error("createSourceBuffers called when mediaSource was null");for(const s in e){const a=s,o=e[a];if(this.isPending(o)){const u=this.getTrackCodec(o,a),l=`${o.container};codecs=${u}`;o.codec=u,this.log(`creating sourceBuffer(${l})${this.currentOp(a)?" Queued":""} ${_e(o)}`);try{const c=n.addSourceBuffer(l),d=mu(a),f=[a,c];t[d]=f,o.buffer=c}catch(c){var i;this.error(`error while trying to add sourceBuffer: ${c.message}`),this.shiftAndExecuteNext(a),(i=this.operationQueue)==null||i.removeBlockers(),delete this.tracks[a],this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:N.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:c,sourceBufferName:a,mimeType:l,parent:o.id});return}this.trackSourceBuffer(a,o)}}this.bufferCreated()}getTrackCodec(e,t){const n=e.supplemental;let i=e.codec;n&&(t==="video"||t==="audiovideo")&&Ks(n,"video")&&(i=FT(i,n));const s=uo(i,e.levelCodec);return s?t.slice(0,5)==="audio"?jo(s,this.appendSource):s:""}trackSourceBuffer(e,t){const n=t.buffer;if(!n)return;const i=this.getTrackCodec(t,e);this.tracks[e]={buffer:n,codec:i,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(s,a)=>{const o=a.removedRanges;o!=null&&o.length&&this.hls.trigger(S.BUFFER_FLUSHED,{type:s})})}get mediaSrc(){var e,t;const n=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return n==null?void 0:n.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const n=this.currentOp(e);n&&(n.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var n;const i=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(n=this.mediaSource)==null?void 0:n.readyState}`);this.error(`${i}`,t),this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:N.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});const s=this.currentOp(e);s&&s.onError(i)}updateTimestampOffset(e,t,n,i,s,a){const o=t-e.timestampOffset;Math.abs(o)>=n&&(this.log(`Updating ${i} SourceBuffer timestampOffset to ${t} (sn: ${s} cc: ${a})`),e.timestampOffset=t)}removeExecutor(e,t,n){const{media:i,mediaSource:s}=this,a=this.tracks[e],o=a==null?void 0:a.buffer;if(!i||!s||!o){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const u=Z(i.duration)?i.duration:1/0,l=Z(s.duration)?s.duration:1/0,c=Math.max(0,t),d=Math.min(n,u,l);d>c&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${c},${d}] from the ${e} SourceBuffer`),o.remove(c,d)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const n=this.tracks[t],i=n==null?void 0:n.buffer;if(!i)throw new VC(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);n.ending=!1,n.ended=!1,i.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:n}=this,i=t.map(a=>this.appendBlocker(a));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(i).then(a=>{n===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var n;const i=(n=this.tracks[t])==null?void 0:n.buffer;!i||i.updating||this.shiftAndExecuteNext(t)})}append(e,t,n){this.operationQueue&&this.operationQueue.append(e,t,n)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,n){const i=this.tracks[e];if(!i)return;const s=i.buffer;if(!s)return;const a=n.bind(this,e);i.listeners.push({event:t,listener:a}),s.addEventListener(t,a)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const n=t.buffer;n&&(t.listeners.forEach(i=>{n.removeEventListener(i.event,i.listener)}),t.listeners.length=0)}}function Ip(r){const e=r.querySelectorAll("source");[].slice.call(e).forEach(t=>{r.removeChild(t)})}function KC(r,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,r.appendChild(t)}function mu(r){return r==="audio"?1:0}class Zf{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(S.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.BUFFER_CODECS,this.onBufferCodecs,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(S.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&Z(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,n=this.getMaxLevel(e.length-1);n!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${n}: ${e[n].height}p@${e[n].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=n,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const n=t.filter((i,s)=>this.isLevelAllowed(i)&&s<=e);return this.clientRect=null,Zf.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,!t.width&&!t.height&&(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(n=>e.bitrate===n.bitrate&&e.width===n.width&&e.height===n.height)}static getMaxLevelByMediaSize(e,t,n){if(!(e!=null&&e.length))return-1;const i=(o,u)=>u?o.width!==u.width||o.height!==u.height:!0;let s=e.length-1;const a=Math.max(t,n);for(let o=0;o<e.length;o+=1){const u=e[o];if((u.width>=a||u.height>=a)&&i(u,e[o+1])){s=o;break}}return s}}const zC={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},bt=zC,WC={HLS:"h"},YC=WC;class Pr{constructor(e,t){Array.isArray(e)&&(e=e.map(n=>n instanceof Pr?n:new Pr(n))),this.value=e,this.params=t}}const qC="Dict";function XC(r){return Array.isArray(r)?JSON.stringify(r):r instanceof Map?"Map{}":r instanceof Set?"Set{}":typeof r=="object"?JSON.stringify(r):String(r)}function QC(r,e,t,n){return new Error(`failed to ${r} "${XC(e)}" as ${t}`,{cause:n})}function Fr(r,e,t){return QC("serialize",r,e,t)}class fv{constructor(e){this.description=e}}const _p="Bare Item",ZC="Boolean";function JC(r){if(typeof r!="boolean")throw Fr(r,ZC);return r?"?1":"?0"}function eL(r){return btoa(String.fromCharCode(...r))}const tL="Byte Sequence";function rL(r){if(ArrayBuffer.isView(r)===!1)throw Fr(r,tL);return`:${eL(r)}:`}const nL="Integer";function iL(r){return r<-999999999999999||999999999999999<r}function hv(r){if(iL(r))throw Fr(r,nL);return r.toString()}function sL(r){return`@${hv(r.getTime()/1e3)}`}function pv(r,e){if(r<0)return-pv(-r,e);const t=Math.pow(10,e);if(Math.abs(r*t%1-.5)<Number.EPSILON){const i=Math.floor(r*t);return(i%2===0?i:i+1)/t}else return Math.round(r*t)/t}const aL="Decimal";function oL(r){const e=pv(r,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Fr(r,aL);const t=e.toString();return t.includes(".")?t:`${t}.0`}const lL="String",uL=/[\x00-\x1f\x7f]+/;function cL(r){if(uL.test(r))throw Fr(r,lL);return`"${r.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function dL(r){return r.description||r.toString().slice(7,-1)}const fL="Token";function Dp(r){const e=dL(r);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Fr(e,fL);return e}function Ed(r){switch(typeof r){case"number":if(!Z(r))throw Fr(r,_p);return Number.isInteger(r)?hv(r):oL(r);case"string":return cL(r);case"symbol":return Dp(r);case"boolean":return JC(r);case"object":if(r instanceof Date)return sL(r);if(r instanceof Uint8Array)return rL(r);if(r instanceof fv)return Dp(r);default:throw Fr(r,_p)}}const hL="Key";function Sd(r){if(/^[a-z*][a-z0-9\-_.*]*$/.test(r)===!1)throw Fr(r,hL);return r}function Jf(r){return r==null?"":Object.entries(r).map(([e,t])=>t===!0?`;${Sd(e)}`:`;${Sd(e)}=${Ed(t)}`).join("")}function gv(r){return r instanceof Pr?`${Ed(r.value)}${Jf(r.params)}`:Ed(r)}function pL(r){return`(${r.value.map(gv).join(" ")})${Jf(r.params)}`}function gL(r,e={whitespace:!0}){if(typeof r!="object"||r==null)throw Fr(r,qC);const t=r instanceof Map?r.entries():Object.entries(r),n=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([i,s])=>{s instanceof Pr||(s=new Pr(s));let a=Sd(i);return s.value===!0?a+=Jf(s.params):(a+="=",Array.isArray(s.value)?a+=pL(s):a+=gv(s)),a}).join(`,${n}`)}function mv(r,e){return gL(r,e)}const Cr="CMCD-Object",je="CMCD-Request",Fn="CMCD-Session",nn="CMCD-Status",mL={br:Cr,ab:Cr,d:Cr,ot:Cr,tb:Cr,tpb:Cr,lb:Cr,tab:Cr,lab:Cr,url:Cr,pb:je,bl:je,tbl:je,dl:je,ltc:je,mtp:je,nor:je,nrr:je,rc:je,sn:je,sta:je,su:je,ttfb:je,ttfbb:je,ttlb:je,cmsdd:je,cmsds:je,smrt:je,df:je,cs:je,ts:je,cid:Fn,pr:Fn,sf:Fn,sid:Fn,st:Fn,v:Fn,msd:Fn,bs:nn,bsd:nn,cdn:nn,rtp:nn,bg:nn,pt:nn,ec:nn,e:nn},xL={REQUEST:je};function vL(r){return Object.keys(r).reduce((e,t)=>{var n;return(n=r[t])===null||n===void 0||n.forEach(i=>e[i]=t),e},{})}function yL(r,e){const t={};if(!r)return t;const n=Object.keys(r),i=e?vL(e):{};return n.reduce((s,a)=>{var o;const u=mL[a]||i[a]||xL.REQUEST,l=(o=s[u])!==null&&o!==void 0?o:s[u]={};return l[a]=r[a],s},t)}function EL(r){return["ot","sf","st","e","sta"].includes(r)}function SL(r){return typeof r=="number"?Z(r):r!=null&&r!==""&&r!==!1}const xv="event";function TL(r,e){const t=new URL(r),n=new URL(e);if(t.origin!==n.origin)return r;const i=t.pathname.split("/").slice(1),s=n.pathname.split("/").slice(1,-1);for(;i[0]===s[0];)i.shift(),s.shift();for(;s.length;)s.shift(),i.unshift("..");return i.join("/")+t.search+t.hash}const go=r=>Math.round(r),Td=(r,e)=>Array.isArray(r)?r.map(t=>Td(t,e)):r instanceof Pr&&typeof r.value=="string"?new Pr(Td(r.value,e),r.params):(e.baseUrl&&(r=TL(r,e.baseUrl)),e.version===1?encodeURIComponent(r):r),Ga=r=>go(r/100)*100,AL=(r,e)=>{let t=r;return e.version>=2&&(r instanceof Pr&&typeof r.value=="string"?t=new Pr([r]):typeof r=="string"&&(t=[r])),Td(t,e)},CL={br:go,d:go,bl:Ga,dl:Ga,mtp:Ga,nor:AL,rtp:Ga,tb:go},vv="request",yv="response",e0=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],LL=["e"],RL=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function El(r){return RL.test(r)}function IL(r){return e0.includes(r)||LL.includes(r)||El(r)}const Ev=["d","dl","nor","ot","rtp","su"];function _L(r){return e0.includes(r)||Ev.includes(r)||El(r)}const DL=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function kL(r){return e0.includes(r)||Ev.includes(r)||DL.includes(r)||El(r)}const wL=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function bL(r){return wL.includes(r)||El(r)}const PL={[yv]:kL,[xv]:IL,[vv]:_L};function Sv(r,e={}){const t={};if(r==null||typeof r!="object")return t;const n=e.version||r.v||1,i=e.reportingMode||vv,s=n===1?bL:PL[i];let a=Object.keys(r).filter(s);const o=e.filter;typeof o=="function"&&(a=a.filter(o));const u=i===yv||i===xv;u&&!a.includes("ts")&&a.push("ts"),n>1&&!a.includes("v")&&a.push("v");const l=Re({},CL,e.formatters),c={version:n,reportingMode:i,baseUrl:e.baseUrl};return a.sort().forEach(d=>{let f=r[d];const h=l[d];if(typeof h=="function"&&(f=h(f,c)),d==="v"){if(n===1)return;f=n}d=="pr"&&f===1||(u&&d==="ts"&&!Z(f)&&(f=Date.now()),SL(f)&&(EL(d)&&typeof f=="string"&&(f=new fv(f)),t[d]=f))}),t}function FL(r,e={}){const t={};if(!r)return t;const n=Sv(r,e),i=yL(n,e==null?void 0:e.customHeaderMap);return Object.entries(i).reduce((s,[a,o])=>{const u=mv(o,{whitespace:!1});return u&&(s[a]=u),s},t)}function BL(r,e,t){return Re(r,FL(e,t))}const OL="CMCD";function ML(r,e={}){return r?mv(Sv(r,e),{whitespace:!1}):""}function NL(r,e={}){if(!r)return"";const t=ML(r,e);return encodeURIComponent(t)}function $L(r,e={}){if(!r)return"";const t=NL(r,e);return`${OL}=${t}`}const kp=/CMCD=[^&#]+/;function UL(r,e,t){const n=$L(e,t);if(!n)return r;if(kp.test(r))return r.replace(kp,n);const i=r.includes("?")?"&":"?";return`${r}${i}${n}`}class GL{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=i=>{try{this.apply(i,{ot:bt.MANIFEST,su:!this.initialized})}catch(s){this.hls.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=i=>{try{const{frag:s,part:a}=i,o=this.hls.levels[s.level],u=this.getObjectType(s),l={d:(a||s).duration*1e3,ot:u};(u===bt.VIDEO||u===bt.AUDIO||u==bt.MUXED)&&(l.br=o.bitrate/1e3,l.tb=this.getTopBandwidth(u)/1e3,l.bl=this.getBufferLength(u));const c=a?this.getNextPart(a):this.getNextFrag(s);c!=null&&c.url&&c.url!==s.url&&(l.nor=c.url),this.apply(i,l)}catch(s){this.hls.logger.warn("Could not generate segment CMCD data.",s)}},this.hls=e;const t=this.config=e.config,{cmcd:n}=t;n!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||e.sessionId,this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHED,this.onMediaDetached,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHED,this.onMediaDetached,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,i;this.audioBuffer=(n=t.tracks.audio)==null?void 0:n.buffer,this.videoBuffer=(i=t.tracks.video)==null?void 0:i.buffer}createData(){var e;return{v:1,sf:YC.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Re(t,this.createData());const n=t.ot===bt.INIT||t.ot===bt.VIDEO||t.ot===bt.MUXED;this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:i}=this;i&&(t=Object.keys(t).reduce((a,o)=>(i.includes(o)&&(a[o]=t[o]),a),{}));const s={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),BL(e.headers,t,s)):e.url=UL(e.url,t,s)}getNextFrag(e){var t;const n=(t=this.hls.levels[e.level])==null?void 0:t.details;if(n){const i=e.sn-n.startSN;return n.fragments[i+1]}}getNextPart(e){var t;const{index:n,fragment:i}=e,s=(t=this.hls.levels[i.level])==null||(t=t.details)==null?void 0:t.partList;if(s){const{sn:a}=i;for(let o=s.length-1;o>=0;o--){const u=s[o];if(u.index===n&&u.fragment.sn===a)return s[o+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return bt.TIMED_TEXT;if(e.sn==="initSegment")return bt.INIT;if(t==="audio")return bt.AUDIO;if(t==="main")return this.hls.audioTracks.length?bt.VIDEO:bt.MUXED}getTopBandwidth(e){let t=0,n;const i=this.hls;if(e===bt.AUDIO)n=i.audioTracks;else{const s=i.maxAutoLevel,a=s>-1?s+1:i.levels.length;n=i.levels.slice(0,a)}return n.forEach(s=>{s.bitrate>t&&(t=s.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,n=e===bt.AUDIO?this.audioBuffer:this.videoBuffer;return!n||!t?NaN:ue.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new n(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,o){t(s),this.loader.load(s,a,o)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new n(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,o){t(s),this.loader.load(s,a,o)}}}}const HL=3e5;class VL extends lr{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(n=>n!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:n}=t;n!==null&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:n}=t;if((n==null?void 0:n.action)===ut.SendAlternateToPenaltyBox&&n.flags===jt.MoveAllAlternatesMatchingHost){const i=this.levels;let s=this._pathwayPriority,a=this.pathwayId;if(t.context){const{groupId:o,pathwayId:u,type:l}=t.context;o&&i?a=this.getPathwayForGroupId(o,l,a):u&&(a=u)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!s&&i&&(s=this.pathways()),s&&s.length>1&&(this.updatePathwayPriority(s),n.resolved=this.pathwayId!==a),t.details===N.BUFFER_APPEND_ERROR&&!t.fatal?n.resolved=!0:n.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${i&&i.length} priorities: ${_e(s)} penalized: ${_e(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const n=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const n=this.penalizedPathways,i=performance.now();Object.keys(n).forEach(s=>{i-n[s]>HL&&delete n[s]});for(let s=0;s<e.length;s++){const a=e[s];if(a in n)continue;if(a===this.pathwayId)return;const o=this.hls.nextLoadLevel,u=this.hls.levels[o];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,Gx(t),this.hls.trigger(S.LEVELS_UPDATED,{levels:t});const l=this.hls.levels[o];u&&l&&this.levels&&(l.attrs["STABLE-VARIANT-ID"]!==u.attrs["STABLE-VARIANT-ID"]&&l.bitrate!==u.bitrate&&this.log(`Unstable Pathways change from bitrate ${u.bitrate} to ${l.bitrate}`),this.hls.nextLoadLevel=o);break}}}getPathwayForGroupId(e,t,n){const i=this.getLevelsForPathway(n).concat(this.levels||[]);for(let s=0;s<i.length;s++)if(t===me.AUDIO_TRACK&&i[s].hasAudioGroup(e)||t===me.SUBTITLE_TRACK&&i[s].hasSubtitleGroup(e))return i[s].pathwayId;return n}clonePathways(e){const t=this.levels;if(!t)return;const n={},i={};e.forEach(s=>{const{ID:a,"BASE-ID":o,"URI-REPLACEMENT":u}=s;if(t.some(c=>c.pathwayId===a))return;const l=this.getLevelsForPathway(o).map(c=>{const d=new $e(c.attrs);d["PATHWAY-ID"]=a;const f=d.AUDIO&&`${d.AUDIO}_clone_${a}`,h=d.SUBTITLES&&`${d.SUBTITLES}_clone_${a}`;f&&(n[d.AUDIO]=f,d.AUDIO=f),h&&(i[d.SUBTITLES]=h,d.SUBTITLES=h);const p=Tv(c.uri,d["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",u),x=new Ws({attrs:d,audioCodec:c.audioCodec,bitrate:c.bitrate,height:c.height,name:c.name,url:p,videoCodec:c.videoCodec,width:c.width});if(c.audioGroups)for(let v=1;v<c.audioGroups.length;v++)x.addGroupId("audio",`${c.audioGroups[v]}_clone_${a}`);if(c.subtitleGroups)for(let v=1;v<c.subtitleGroups.length;v++)x.addGroupId("text",`${c.subtitleGroups[v]}_clone_${a}`);return x});t.push(...l),wp(this.audioTracks,n,u,a),wp(this.subtitleTracks,i,u,a)})}loadSteeringManifest(e){const t=this.hls.config,n=t.loader;this.loader&&this.loader.destroy(),this.loader=new n(t);let i;try{i=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(i.protocol!=="data:"){const c=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+c)}const s={responseType:"json",url:i.href},a=t.steeringManifestLoadPolicy.default,o=a.errorRetry||a.timeoutRetry||{},u={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},l={onSuccess:(c,d,f,h)=>{this.log(`Loaded steering manifest: "${i}"`);const p=c.data;if((p==null?void 0:p.VERSION)!==1){this.log(`Steering VERSION ${p.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=p.TTL;const{"RELOAD-URI":x,"PATHWAY-CLONES":v,"PATHWAY-PRIORITY":y}=p;if(x)try{this.uri=new self.URL(x,i).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${x}`);return}this.scheduleRefresh(this.uri||f.url),v&&this.clonePathways(v);const g={steeringManifest:p,url:i.toString()};this.hls.trigger(S.STEERING_MANIFEST_LOADED,g),y&&this.updatePathwayPriority(y)},onError:(c,d,f,h)=>{if(this.log(`Error loading steering manifest: ${c.code} ${c.text} (${d.url})`),this.stopLoad(),c.code===410){this.enabled=!1,this.log(`Steering manifest ${d.url} no longer available`);return}let p=this.timeToLoad*1e3;if(c.code===429){const x=this.loader;if(typeof(x==null?void 0:x.getResponseHeader)=="function"){const v=x.getResponseHeader("Retry-After");v&&(p=parseFloat(v)*1e3)}this.log(`Steering manifest ${d.url} rate limited`);return}this.scheduleRefresh(this.uri||d.url,p)},onTimeout:(c,d,f)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(s,u,l)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var n;const i=(n=this.hls)==null?void 0:n.media;if(i&&!i.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function wp(r,e,t,n){r&&Object.keys(e).forEach(i=>{const s=r.filter(a=>a.groupId===i).map(a=>{const o=Re({},a);return o.details=void 0,o.attrs=new $e(o.attrs),o.url=o.attrs.URI=Tv(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),o.groupId=o.attrs["GROUP-ID"]=e[i],o.attrs["PATHWAY-ID"]=n,o});r.push(...s)})}function Tv(r,e,t,n){const{HOST:i,PARAMS:s,[t]:a}=n;let o;e&&(o=a==null?void 0:a[e],o&&(r=o));const u=new self.URL(r);return i&&!o&&(u.host=i),s&&Object.keys(s).sort().forEach(l=>{l&&u.searchParams.set(l,s[l])}),u.href}class bi extends lr{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=bi.CDMCleanupPromise?[bi.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:n,initData:i}=t,s=`"${t.type}" event: init data type: "${n}"`;if(this.debug(s),i!==null){if(!this.keyFormatPromise){let a=Object.keys(this.keySystemAccessPromises);a.length||(a=ps(this.config));const o=a.map(lu).filter(u=>!!u);this.keyFormatPromise=this.getKeyFormatPromise(o)}this.keyFormatPromise.then(a=>{const o=fo(a);if(n!=="sinf"||o!==Ge.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${n}" for selected key-system ${o}`);return}let u;try{const h=Ze(new Uint8Array(i)),p=Hf(JSON.parse(h).sinf),x=mx(p);if(!x)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");u=new Uint8Array(x.subarray(8,24))}catch(h){this.warn(`${s} Failed to parse sinf: ${h}`);return}const l=Lt(u),{keyIdToKeySessionPromise:c,mediaKeySessions:d}=this;let f=c[l];for(let h=0;h<d.length;h++){const p=d[h],x=p.decryptdata;if(!x.keyId)continue;const v=Lt(x.keyId);if(qo(u,x.keyId)||x.uri.replace(/-/g,"").indexOf(l)!==-1){if(f=c[v],!f)continue;if(x.pssh)break;delete c[v],x.pssh=new Uint8Array(i),x.keyId=u,f=c[l]=f.then(()=>this.generateRequestWithPreferredKeySession(p,n,i,"encrypted-event-key-match")),f.catch(y=>this.handleError(y));break}}f||this.handleError(new Error(`Key ID ${l} not encountered in playlist. Key-system sessions ${d.length}.`))}).catch(a=>this.handleError(a))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(S.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(S.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(S.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(S.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(S.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(S.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:n}=this.config,i=t==null?void 0:t[e];if(i)return i.licenseUrl;if(e===Ge.WIDEVINE&&n)return n}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,n=t==null?void 0:t[e];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,n=(a,o,u)=>!!a&&u.indexOf(a)===o,i=t.map(a=>a.audioCodec).filter(n),s=t.map(a=>a.videoCodec).filter(n);return i.length+s.length===0&&s.push("avc1.42e01e"),new Promise((a,o)=>{const u=l=>{const c=l.shift();this.getMediaKeysPromise(c,i,s).then(d=>a({keySystem:c,mediaKeys:d})).catch(d=>{l.length?u(l):d instanceof Vt?o(d):o(new Vt({type:re.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_ACCESS,error:d,fatal:!0},d.message))})};u(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:n}=this.config;if(typeof n!="function"){let i=`Configured requestMediaKeySystemAccess is not a function ${n}`;return Px===null&&self.location.protocol==="http:"&&(i=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(i))}return n(e,t)}getMediaKeysPromise(e,t,n){var i;const s=AA(e,t,n,this.config.drmSystemOptions||{});let a=this.keySystemAccessPromises[e],o=(i=a)==null?void 0:i.keySystemAccess;if(!o){this.log(`Requesting encrypted media "${e}" key-system access with config: ${_e(s)}`),o=this.requestMediaKeySystemAccess(e,s);const u=a=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch(l=>{this.log(`Failed to obtain access to key-system "${e}": ${l}`)}),o.then(l=>{this.log(`Access for key-system "${l.keySystem}" obtained`);const c=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const d=u.mediaKeys=l.createMediaKeys().then(f=>(this.log(`Media-keys created for "${e}"`),u.hasMediaKeys=!0,c.then(h=>h?this.setMediaKeysServerCertificate(f,e,h):f)));return d.catch(f=>{this.error(`Failed to create media-keys for "${e}"}: ${f}`)}),d})}return o.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:n}){this.log(`Creating key-system session "${t}" keyId: ${Lt(e.keyId||[])} keyUri: ${e.uri}`);const i=n.createSession(),s={decryptdata:e,keySystem:t,mediaKeys:n,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const n=this.createMediaKeySessionContext(e),i=Ha(t),s="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(n,s,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const n=e.mediaKeysSession;return this.log(`Updating key-session "${n.sessionId}" for keyId ${Lt(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),n.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>lu(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:n})=>this.attemptSetMediaKeys(t,n))}selectKeySystem(e){return new Promise((t,n)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:i})=>{const s=lu(i);s?t(s):n(new Error(`Unable to find format for key-system "${i}"`))}).catch(n)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=ps(this.config),n=e.map(fo).filter(i=>!!i&&t.indexOf(i)!==-1);return this.selectKeySystem(n)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let n=0;n<t.length;n++){const i=jL(e,t[n]);if(i)return i}}loadKey(e){const t=e.keyInfo.decryptdata,n=Ha(t),i=this.bannedKeyIds[n];if(i||this.getKeyStatus(t)==="internal-error"){const o=bp(i||"internal-error",t);return this.handleError(o,e.frag),Promise.reject(o)}const s=`(keyId: ${n} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${s}`);const a=this.keyIdToKeySessionPromise[n];if(!a){const o=this.getKeySystemForKeyPromise(t).then(({keySystem:u,mediaKeys:l})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${s}`),this.attemptSetMediaKeys(u,l).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:u,mediaKeys:l,decryptdata:t}))))).then(u=>{const l="cenc",c=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(u,l,c,"playlist-key")});return o.catch(u=>this.handleError(u,e.frag)),this.keyIdToKeySessionPromise[n]=o,o}return a.catch(o=>{if(o instanceof Vt){const u=Ae({},o.data);this.getKeyStatus(t)==="internal-error"&&(u.decryptdata=t);const l=new Vt(u,o.message);this.handleError(l,e.frag)}}),a}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof Vt){t&&(e.data.frag=t);const n=e.data.decryptdata;this.error(`${e.message}${n?` (${Lt(n.keyId||[])})`:""}`),this.hls.trigger(S.ERROR,e.data)}else this.error(e.message),this.hls.trigger(S.ERROR,{type:re.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Ha(e),n=this.keyIdToKeySessionPromise[t];if(!n){const i=fo(e.keyFormat),s=i?[i]:ps(this.config);return this.attemptKeySystemAccess(s)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=ps(this.config)),e.length===0)throw new Vt({type:re.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${_e({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const i=Promise.all(n).then(()=>this.media?this.media.setMediaKeys(t):new Promise((s,a)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return a(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(s).catch(a)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(i),i.then(()=>{this.log(`Media-keys set for "${e}"`),n.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(s=>n.indexOf(s)===-1)})}generateRequestWithPreferredKeySession(e,t,n,i){var s;const a=(s=this.config.drmSystems)==null||(s=s[e.keySystem])==null?void 0:s.generateRequest;if(a)try{const p=a.call(this.hls,t,n,e);if(!p)throw new Error("Invalid response from configured generateRequest filter");t=p.initDataType,n=p.initData?p.initData:null,e.decryptdata.pssh=n?new Uint8Array(n):null}catch(p){if(this.warn(p.message),this.hls&&this.hls.config.debug)throw p}if(n===null)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(e);const o=Ha(e.decryptdata),u=e.decryptdata.uri;this.log(`Generating key-session request for "${i}" keyId: ${o} URI: ${u} (init data type: ${t} length: ${n.byteLength})`);const l=new jf,c=e._onmessage=p=>{const x=e.mediaKeysSession;if(!x){l.emit("error",new Error("invalid state"));return}const{messageType:v,message:y}=p;this.log(`"${v}" message event for session "${x.sessionId}" message size: ${y.byteLength}`),v==="license-request"||v==="license-renewal"?this.renewLicense(e,y).catch(g=>{l.eventNames().length?l.emit("error",g):this.handleError(g)}):v==="license-release"?e.keySystem===Ge.FAIRPLAY&&this.updateKeySession(e,pd("acknowledged")).then(()=>this.removeSession(e)).catch(g=>this.handleError(g)):this.warn(`unhandled media key message type "${v}"`)},d=(p,x)=>{x.keyStatus=p;let v;p.startsWith("usable")?l.emit("resolved"):p==="internal-error"||p==="output-restricted"||p==="output-downscaled"?v=bp(p,x.decryptdata):p==="expired"?v=new Error(`key expired (keyId: ${o})`):p==="released"?v=new Error("key released"):p==="status-pending"||this.warn(`unhandled key status change "${p}" (keyId: ${o})`),v&&(l.eventNames().length?l.emit("error",v):this.handleError(v))},f=e._onkeystatuseschange=p=>{if(!e.mediaKeysSession){l.emit("error",new Error("invalid state"));return}const v=this.getKeyStatuses(e);if(!Object.keys(v).some(E=>v[E]!=="status-pending"))return;if(v[o]==="expired"){this.log(`Expired key ${_e(v)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let g=v[o];if(g)d(g,e);else{var m;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(m=e.keyStatusTimeouts)[o]||(m[o]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const T=this.getKeyStatus(e.decryptdata);if(T&&T!=="status-pending")return this.log(`No status for keyId ${o} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${T} from other session.`),d(T,e);this.log(`key status for ${o} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),g="internal-error",d(g,e)},1e3)),this.log(`No status for keyId ${o} (${_e(v)}).`)}};Rt(e.mediaKeysSession,"message",c),Rt(e.mediaKeysSession,"keystatuseschange",f);const h=new Promise((p,x)=>{l.on("error",x),l.on("resolved",p)});return e.mediaKeysSession.generateRequest(t,n).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${o} URI: ${u}`)}).catch(p=>{throw new Vt({type:re.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_SESSION,error:p,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${p}`)}).then(()=>h).catch(p=>(l.removeAllListeners(),this.removeSession(e).then(()=>{throw p}))).then(()=>(l.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((n,i)=>{if(typeof i=="string"&&typeof n=="object"){const o=i;i=n,n=o}const s="buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i);e.keySystem===Ge.PLAYREADY&&s.length===16&&wx(s);const a=Lt(s);n==="internal-error"&&(this.bannedKeyIds[a]=n),this.log(`key status change "${n}" for keyStatuses keyId: ${a} key-session "${e.mediaKeysSession.sessionId}"`),t[a]=n}),t}fetchServerCertificate(e){const t=this.config,n=t.loader,i=new n(t),s=this.getServerCertificateUrl(e);return s?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,o)=>{const u={responseType:"arraybuffer",url:s},l=t.certLoadPolicy.default,c={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,h,p,x)=>{a(f.data)},onError:(f,h,p,x)=>{o(new Vt({type:re.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:p,response:Ae({url:u.url,data:void 0},f)},`"${e}" certificate request failed (${s}). Status: ${f.code} (${f.text})`))},onTimeout:(f,h,p)=>{o(new Vt({type:re.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:p,response:{url:u.url,data:void 0}},`"${e}" certificate request timed out (${s})`))},onAbort:(f,h,p)=>{o(new Error("aborted"))}};i.load(u,c,d)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((i,s)=>{e.setServerCertificate(n).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${n.byteLength}) on "${t}"`),i(e)}).catch(a=>{s(new Vt({type:re.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(n=>this.updateKeySession(e,new Uint8Array(n)).catch(i=>{throw new Vt({type:re.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:i,fatal:!1},i.message)}))}unpackPlayReadyKeyMessage(e,t){const n=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!n.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const i=new DOMParser().parseFromString(n,"application/xml"),s=i.querySelectorAll("HttpHeader");if(s.length>0){let c;for(let d=0,f=s.length;d<f;d++){var a,o;c=s[d];const h=(a=c.querySelector("name"))==null?void 0:a.textContent,p=(o=c.querySelector("value"))==null?void 0:o.textContent;h&&p&&e.setRequestHeader(h,p)}}const u=i.querySelector("Challenge"),l=u==null?void 0:u.textContent;if(!l)throw new Error("Cannot find <Challenge> in key message");return pd(atob(l))}setupLicenseXHR(e,t,n,i){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,t,n,i)}).catch(a=>{if(!n.decryptdata)throw a;return e.open("POST",t,!0),s.call(this.hls,e,t,n,i)}).then(a=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||i})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,t){const n=this.config.keyLoadPolicy.default;return new Promise((i,s)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(o.readyState===4)if(o.status===200){this._requestLicenseFailureCount=0;let u=o.response;this.log(`License received ${u instanceof ArrayBuffer?u.byteLength:u}`);const l=this.config.licenseResponseCallback;if(l)try{u=l.call(this.hls,o,a,e)}catch(c){this.error(c)}i(u)}else{const u=n.errorRetry,l=u?u.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||o.status>=400&&o.status<500)s(new Vt({type:re.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:o,response:{url:a,data:void 0,code:o.status,text:o.statusText}},`License Request XHR failed (${a}). Status: ${o.status} (${o.statusText})`));else{const c=l-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${c} attempts left`),this.requestLicense(e,t).then(i,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,this.setupLicenseXHR(o,a,e,t).then(({xhr:u,licenseChallenge:l})=>{e.keySystem==Ge.PLAYREADY&&(l=this.unpackPlayReadyKeyMessage(u,l)),u.send(l)}).catch(s)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const n=t.media;this.media=n,Rt(n,"encrypted",this.onMediaEncrypted),Rt(n,"waitingforkey",this.onWaitingForKey);const i=this.mediaResolved;i?i():this.mediaKeys=n.mediaKeys}onMediaDetached(){const e=this.media;e&&(Bt(e,"encrypted",this.onMediaEncrypted),Bt(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const n=this.media,i=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Kn.clearKeyUriToKeyIdMap();const s=i.length;bi.CDMCleanupPromise=Promise.all(i.map(a=>this.removeSession(a)).concat((n==null||(e=n.setMediaKeys(null))==null?void 0:e.catch(a=>{this.log(`Could not clear media keys: ${a}`),this.hls&&this.hls.trigger(S.ERROR,{type:re.OTHER_ERROR,details:N.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${a}`)})}))||Promise.resolve())).catch(a=>{this.log(`Could not close sessions and clear media keys: ${a}`),this.hls&&this.hls.trigger(S.ERROR,{type:re.OTHER_ERROR,details:N.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${a}`)})}).then(()=>{s&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const n=t.reduce((i,s)=>(i.indexOf(s.keyFormat)===-1&&i.push(s.keyFormat),i),[]);this.log(`Selecting key-system from session-keys ${n.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(n)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:n,decryptdata:i}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${Lt((i==null?void 0:i.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const s=this.mediaKeySessions.indexOf(e);s>-1&&this.mediaKeySessions.splice(s,1);const{keyStatusTimeouts:a}=e;a&&Object.keys(a).forEach(l=>self.clearTimeout(a[l]));const{drmSystemOptions:o}=this.config;return(LA(o)?new Promise((l,c)=>{self.setTimeout(()=>c(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(l).catch(c)}):Promise.resolve()).catch(l=>{this.log(`Could not remove session: ${l}`),this.hls&&this.hls.trigger(S.ERROR,{type:re.OTHER_ERROR,details:N.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${l}`)})}).then(()=>t.close()).catch(l=>{this.log(`Could not close session: ${l}`),this.hls&&this.hls.trigger(S.ERROR,{type:re.OTHER_ERROR,details:N.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${l}`)})})}return Promise.resolve()}}bi.CDMCleanupPromise=void 0;function Ha(r){if(!r)throw new Error("Could not read keyId of undefined decryptdata");if(r.keyId===null)throw new Error("keyId is null");return Lt(r.keyId)}function jL(r,e){if(r.keyId&&e.mediaKeysSession.keyStatuses.has(r.keyId))return e.mediaKeysSession.keyStatuses.get(r.keyId);if(r.matches(e.decryptdata))return e.keyStatus}class Vt extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function bp(r,e){const t=r==="output-restricted",n=t?N.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:N.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Vt({type:re.KEY_SYSTEM_ERROR,details:n,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${r}"`)}class KL{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(S.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(S.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const n=this.hls.config;if(n.capLevelOnFPSDrop){const i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,n){const i=performance.now();if(t){if(this.lastTime){const s=i-this.lastTime,a=n-this.lastDroppedFrames,o=t-this.lastDecodedFrames,u=1e3*a/s,l=this.hls;if(l.trigger(S.FPS_DROP,{currentDropped:a,currentDecoded:o,totalDroppedFrames:n}),u>0&&a>l.config.fpsDroppedMonitoringThreshold*o){let c=l.currentLevel;l.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(l.autoLevelCapping===-1||l.autoLevelCapping>=c)&&(c=c-1,l.trigger(S.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:l.currentLevel}),l.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function Av(r,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=r,e.dispatchEvent(t)}function Cv(r,e){const t=r.mode;if(t==="disabled"&&(r.mode="hidden"),r.cues&&!r.cues.getCueById(e.id))try{if(r.addCue(e),!r.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(n){Ce.debug(`[texttrack-utils]: ${n}`);try{const i=new self.TextTrackCue(e.startTime,e.endTime,e.text);i.id=e.id,r.addCue(i)}catch(i){Ce.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${i}`)}}t==="disabled"&&(r.mode=t)}function Ai(r,e){const t=r.mode;if(t==="disabled"&&(r.mode="hidden"),r.cues)for(let n=r.cues.length;n--;)e&&r.cues[n].removeEventListener("enter",e),r.removeCue(r.cues[n]);t==="disabled"&&(r.mode=t)}function Ad(r,e,t,n){const i=r.mode;if(i==="disabled"&&(r.mode="hidden"),r.cues&&r.cues.length>0){const s=WL(r.cues,e,t);for(let a=0;a<s.length;a++)(!n||n(s[a]))&&r.removeCue(s[a])}i==="disabled"&&(r.mode=i)}function zL(r,e){if(e<=r[0].startTime)return 0;const t=r.length-1;if(e>r[t].endTime)return-1;let n=0,i=t,s;for(;n<=i;)if(s=Math.floor((i+n)/2),e<r[s].startTime)i=s-1;else if(e>r[s].startTime&&n<t)n=s+1;else return s;return r[n].startTime-e<e-r[i].startTime?n:i}function WL(r,e,t){const n=[],i=zL(r,e);if(i>-1)for(let s=i,a=r.length;s<a;s++){const o=r[s];if(o.startTime>=e&&o.endTime<=t)n.push(o);else if(o.startTime>t)return n}return n}function mo(r){const e=[];for(let t=0;t<r.length;t++){const n=r[t];(n.kind==="subtitles"||n.kind==="captions")&&n.label&&e.push(r[t])}return e}class YL extends Qf{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const n=mo(this.media.textTracks);for(let s=0;s<n.length;s++)if(n[s].mode==="hidden")t=n[s];else if(n[s].mode==="showing"){t=n[s];break}const i=this.findTrackForTextTrack(t);this.subtitleTrack!==i&&this.setSubtitleTrack(i)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(S.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const n=this.media;if(!n)return;const i=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||n.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,i)return;mo(n.textTracks).forEach(a=>{Ai(a)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:n,groupId:i,details:s}=t,a=this.tracksInGroup[n];if(!a||a.groupId!==i){this.warn(`Subtitle track with id:${n} and group:${i} not found in active group ${a==null?void 0:a.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Subtitle track ${n} "${a.name}" lang:${a.lang} group:${i} loaded [${s.startSN}-${s.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.subtitleGroups||null,i=this.groupIds;let s=this.currentTrack;if(!n||(i==null?void 0:i.length)!==(n==null?void 0:n.length)||n!=null&&n.some(a=>(i==null?void 0:i.indexOf(a))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(c=>!n||n.indexOf(c.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(c=>c.default)&&(this.selectDefaultTrack=!1),a.forEach((c,d)=>{c.id=d});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const o=this.hls.config.subtitlePreference;if(!s&&o){this.selectDefaultTrack=!1;const c=Dr(o,a);if(c>-1)s=a[c];else{const d=Dr(o,this.tracks);s=this.tracks[d]}}let u=this.findTrackId(s);u===-1&&s&&(u=this.findTrackId(null));const l={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${n==null?void 0:n.join(",")}" group-id`),this.hls.trigger(S.SUBTITLE_TRACKS_UPDATED,l),u!==-1&&this.trackId===-1&&this.setSubtitleTrack(u)}}findTrackId(e){const t=this.tracksInGroup,n=this.selectDefaultTrack;for(let i=0;i<t.length;i++){const s=t[i];if(!(n&&!s.default||!n&&!e)&&(!e||jn(s,e)))return i}if(e){for(let i=0;i<t.length;i++){const s=t[i];if(Qs(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return i}for(let i=0;i<t.length;i++){const s=t[i];if(Qs(e.attrs,s.attrs,["LANGUAGE"]))return i}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const i=t[n];if(yd(i,e))return n}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===me.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const n=this.currentTrack;if(n&&jn(e,n))return n;const i=Dr(e,this.tracksInGroup);if(i>-1){const s=this.tracksInGroup[i];return this.setSubtitleTrack(i),s}else{if(n)return null;{const s=Dr(e,t);if(s>-1)return t[s]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,i=e.groupId,s=this.getUrlWithDirectives(e.url,t),a=e.details,o=a==null?void 0:a.age;this.log(`Loading subtitle ${n} "${e.name}" lang:${e.lang} group:${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${s}`),this.hls.trigger(S.SUBTITLE_TRACK_LOADING,{url:s,id:n,groupId:i,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=mo(e.textTracks),n=this.currentTrack;let i;if(n&&(i=t.filter(s=>yd(n,s))[0],i||this.warn(`Unable to find subtitle TextTrack with name "${n.name}" and language "${n.lang}"`)),[].slice.call(t).forEach(s=>{s.mode!=="disabled"&&s!==i&&(s.mode="disabled")}),i){const s=this.subtitleDisplay?"showing":"hidden";i.mode!==s&&(i.mode=s)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!Z(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,i=t[e]||null;if(this.trackId=e,this.currentTrack=i,this.toggleTrackModes(),!i){this.hls.trigger(S.SUBTITLE_TRACK_SWITCH,{id:e});return}const s=!!i.details&&!i.details.live;if(e===this.trackId&&i===n&&s)return;this.log(`Switching to subtitle-track ${e}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:""));const{id:a,groupId:o="",name:u,type:l,url:c}=i;this.hls.trigger(S.SUBTITLE_TRACK_SWITCH,{id:a,groupId:o,name:u,type:l,url:c});const d=this.switchParams(i.url,n==null?void 0:n.details,i.details);this.loadPlaylist(d)}}function qL(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,i=>{const s=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(i=="x"?s:s&3|8).toString(16)})}}}function Rs(r){let e=5381,t=r.length;for(;t;)e=e*33^r.charCodeAt(--t);return(e>>>0).toString()}const Pi=.025;let Jo=function(r){return r[r.Point=0]="Point",r[r.Range=1]="Range",r}({});function XL(r,e,t){return`${r.identifier}-${t+1}-${Rs(e)}`}class QL{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const n=this.playoutLimit;return e<=0||isNaN(n)?!1:n===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>n}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return xu(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,n=xu(t,e);return t-n<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=Z(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return xu(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Pi))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Jo.Range:Jo.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return ZL(this)}}function xu(r,e){return r-e.start<e.duration/2&&!(Math.abs(r-(e.start+e.duration))<Pi)?e.start:e.start+e.duration}function Lv(r,e,t){const n=new self.URL(r,t);return n.protocol!=="data:"&&n.searchParams.set("_HLS_primary_id",e),n}function vu(r,e){for(;(t=r.assetList[++e])!=null&&t.error;)var t;return e}function ZL(r){return`["${r.identifier}" ${r.cue.pre?"<pre>":r.cue.post?"<post>":""}${r.timelineStart.toFixed(2)}-${r.resumeTime.toFixed(2)}]`}function ci(r){const e=r.timelineStart,t=r.duration||0;return`["${r.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class JL{constructor(e,t,n,i){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(S.PLAYOUT_LIMIT_REACHED,{})};const s=this.hls=new e(t);this.interstitial=n,this.assetItem=i;const a=()=>{this.hasDetails=!0};s.once(S.LEVEL_LOADED,a),s.once(S.AUDIO_TRACK_LOADED,a),s.once(S.SUBTITLE_TRACK_LOADED,a),s.on(S.MEDIA_ATTACHING,(o,{media:u})=>{this.removeMediaListeners(),this.mediaAttached=u,this.interstitial.playoutLimit&&(u.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&s.on(S.BUFFER_APPENDED,()=>{const c=this.bufferedEnd;this.reachedPlayout(c)&&(this._bufferedEosTime=c,s.trigger(S.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=Lv(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const n=Math.min(this._bufferedEosTime||1/0,this.duration),i=this.timelineOffset,s=ue.bufferInfo(e,i,0);return this.getAssetTime(s.end)>=n-.02}reachedPlayout(e){const n=this.interstitial.playoutLimit;return this.startOffset+e>=n}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=ue.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const n=t-this.startOffset;if(n>0&&n<e)return n}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const n=e-t;if(Math.abs(n)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,n=this.duration;return Math.min(Math.max(0,e-t),n)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=n=>delete n.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,n){var i;(i=this.hls)==null||i.on(e,t)}once(e,t,n){var i;(i=this.hls)==null||i.once(e,t)}off(e,t,n){var i;(i=this.hls)==null||i.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${ci(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const Pp=.033;class e8 extends lr{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((n,i)=>e<=i.startOffset&&t>i.startOffset?(delete i.error,n+1):n,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let n=-1;e.nextEvent?n=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(n=this.findEventIndex(e.previousEvent.identifier)+1);const i=this.items;if(i)for(i[n]||(t===void 0&&(t=e.start),n=this.findItemIndexAtTime(t));n>=0&&(s=i[n])!=null&&s.event;){var s;n--}return n}findItemIndexAtTime(e,t){const n=this.items;if(n)for(let i=0;i<n.length;i++){let s=n[i];if(t&&t!=="primary"&&(s=s[t]),e===s.start||e>s.start&&e<s.end)return i}return-1}findJumpRestrictedIndex(e,t){const n=this.items;if(n)for(let i=e;i<=t&&n[i];i++){const s=n[i].event;if(s!=null&&s.restrictions.jump&&!s.appendInPlace)return i}return-1}findEventIndex(e){const t=this.items;if(t)for(let i=t.length;i--;){var n;if(((n=t[i].event)==null?void 0:n.identifier)===e)return i}return-1}findAssetIndex(e,t){const n=e.assetList,i=n.length;if(i>1)for(let s=0;s<i;s++){const a=n[s];if(!a.error){const o=a.timelineStart;if(t===o||t>o&&(t<o+(a.duration||0)||s===i-1))return s}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const n=t.assetList,i=n[n.length-1];if(i)return i.identifier}return null}parseInterstitialDateRanges(e,t){const n=e.main.details,{dateRanges:i}=n,s=this.events,a=this.parseDateRanges(i,{url:n.url},t),o=Object.keys(i),u=s?s.filter(l=>!o.includes(l.identifier)):[];a.length&&a.sort((l,c)=>{const d=l.cue.pre,f=l.cue.post,h=c.cue.pre,p=c.cue.post;if(d&&!h)return-1;if(h&&!d||f&&!p)return 1;if(p&&!f)return-1;if(!d&&!h&&!f&&!p){const x=l.startTime,v=c.startTime;if(x!==v)return x-v}return l.dateRange.tagOrder-c.dateRange.tagOrder}),this.events=a,u.forEach(l=>{this.removeEvent(l)}),this.updateSchedule(e,u)}updateSchedule(e,t=[],n=!1){const i=this.events||[];if(i.length||t.length||this.length<2){const s=this.items,a=this.parseSchedule(i,e);(n||t.length||(s==null?void 0:s.length)!==a.length||a.some((u,l)=>Math.abs(u.playout.start-s[l].playout.start)>.005||Math.abs(u.playout.end-s[l].playout.end)>.005))&&(this.items=a,this.onScheduleUpdate(t,s))}}parseDateRanges(e,t,n){const i=[],s=Object.keys(e);for(let a=0;a<s.length;a++){const o=s[a],u=e[o];if(u.isInterstitial){let l=this.eventMap[o];l?l.setDateRange(u):(l=new QL(u,t),this.eventMap[o]=l,n===!1&&(l.appendInPlace=n)),i.push(l)}}return i}parseSchedule(e,t){const n=[],i=t.main.details,s=i.live?1/0:i.edge;let a=0;if(e=e.filter(u=>!u.error&&!(u.cue.once&&u.hasPlayed)),e.length){this.resolveOffsets(e,t);let u=0,l=0;if(e.forEach((c,d)=>{const f=c.cue.pre,h=c.cue.post,p=e[d-1]||null,x=c.appendInPlace,v=h?s:c.startOffset,y=c.duration,g=c.timelineOccupancy===Jo.Range?y:0,m=c.resumptionOffset,E=(p==null?void 0:p.startTime)===v,T=v+c.cumulativeDuration;let L=x?T+y:v+m;if(f||!h&&v<=0){const R=l;l+=g,c.timelineStart=T;const I=a;a+=y,n.push({event:c,start:T,end:L,playout:{start:I,end:a},integrated:{start:R,end:l}})}else if(v<=s){if(!E){const C=v-u;if(C>Pp){const _=u,F=l;l+=C;const B=a;a+=C;const V={previousEvent:e[d-1]||null,nextEvent:c,start:_,end:_+C,playout:{start:B,end:a},integrated:{start:F,end:l}};n.push(V)}else C>0&&p&&(p.cumulativeDuration+=C,n[n.length-1].end=v)}h&&(L=T),c.timelineStart=T;const R=l;l+=g;const I=a;a+=y,n.push({event:c,start:T,end:L,playout:{start:I,end:a},integrated:{start:R,end:l}})}else return;const A=c.resumeTime;h||A>s?u=s:u=A}),u<s){var o;const c=u,d=l,f=s-u;l+=f;const h=a;a+=f,n.push({previousEvent:((o=n[n.length-1])==null?void 0:o.event)||null,nextEvent:null,start:u,end:c+f,playout:{start:h,end:a},integrated:{start:d,end:l}})}this.setDurations(s,a,l)}else n.push({previousEvent:null,nextEvent:null,start:0,end:s,playout:{start:0,end:s},integrated:{start:0,end:s}}),this.setDurations(s,s,s);return n}setDurations(e,t,n){this.durations={primary:e,playout:t,integrated:n}}resolveOffsets(e,t){const n=t.main.details,i=n.live?1/0:n.edge;let s=0,a=-1;e.forEach((o,u)=>{const l=o.cue.pre,c=o.cue.post,d=l?0:c?i:o.startTime;this.updateAssetDurations(o),a===d?o.cumulativeDuration=s:(s=0,a=d),!c&&o.snapOptions.in&&(o.resumeAnchor=Qn(null,n.fragments,o.startOffset+o.resumptionOffset,0,0)||void 0),o.appendInPlace&&!o.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(o,t)||(o.appendInPlace=!1)),!o.appendInPlace&&u+1<e.length&&e[u+1].startTime-e[u].resumeTime<Pp&&(e[u+1].appendInPlace=!1,e[u+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${o}`));const h=Z(o.resumeOffset)?o.resumeOffset:o.duration;s+=h})}primaryCanResumeInPlaceAt(e,t){const n=e.resumeTime,i=e.startTime+e.resumptionOffset;return Math.abs(n-i)>Pi?(this.log(`"${e.identifier}" resumption ${n} not aligned with estimated timeline end ${i}`),!1):!Object.keys(t).some(a=>{const o=t[a].details,u=o.edge;if(n>=u)return this.log(`"${e.identifier}" resumption ${n} past ${a} playlist end ${u}`),!1;const l=Qn(null,o.fragments,n);if(!l)return this.log(`"${e.identifier}" resumption ${n} does not align with any fragments in ${a} playlist (${o.fragStart}-${o.fragmentEnd})`),!0;const c=a==="audio"?.175:0;return Math.abs(l.start-n)<Pi+c||Math.abs(l.end-n)<Pi+c?!1:(this.log(`"${e.identifier}" resumption ${n} not aligned with ${a} fragment bounds (${l.start}-${l.end} sn: ${l.sn} cc: ${l.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let n=0,i=!1,s=!1;for(let a=0;a<e.assetList.length;a++){const o=e.assetList[a],u=t+n;o.startOffset=n,o.timelineStart=u,i||(i=o.duration===null),s||(s=!!o.error);const l=o.error?0:o.duration||0;n+=l}i&&!s?e.duration=Math.max(n,e.duration):e.duration=n}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function dr(r){return`[${r.event?'"'+r.event.identifier+'"':"primary"}: ${r.start.toFixed(2)}-${r.end.toFixed(2)}]`}class t8{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const n=e.assetListUrl;let i;try{i=Lv(n,this.hls.sessionId,e.baseUrl)}catch(f){const h=this.assignAssetListError(e,N.ASSET_LIST_LOAD_ERROR,f,n);this.hls.trigger(S.ERROR,h);return}t&&i.protocol!=="data:"&&i.searchParams.set("_HLS_start_offset",""+t);const s=this.hls.config,a=s.loader,o=new a(s),u={responseType:"json",url:i.href},l=s.interstitialAssetListLoadPolicy.default,c={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,h,p,x)=>{const v=f.data,y=v==null?void 0:v.ASSETS;if(!Array.isArray(y)){const g=this.assignAssetListError(e,N.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),p.url,h,x);this.hls.trigger(S.ERROR,g);return}e.assetListResponse=v,this.hls.trigger(S.ASSET_LIST_LOADED,{event:e,assetListResponse:v,networkDetails:x})},onError:(f,h,p,x)=>{const v=this.assignAssetListError(e,N.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${f.code} ${f.text} (${h.url})`),h.url,x,p);this.hls.trigger(S.ERROR,v)},onTimeout:(f,h,p)=>{const x=this.assignAssetListError(e,N.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${h.url})`),h.url,f,p);this.hls.trigger(S.ERROR,x)}};return o.load(u,c,d),this.hls.trigger(S.ASSET_LIST_LOADING,{event:e}),o}assignAssetListError(e,t,n,i,s,a){return e.error=n,{type:re.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:i,error:n,networkDetails:a,stats:s}}}function Fp(r){var e;r==null||(e=r.play())==null||e.catch(()=>{})}function Va(r,e){return`[${r}] Advancing timeline position to ${e}`}class r8 extends lr{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled||!this.schedule)return;const i=n-this.timelinePos;if(Math.abs(i)<1/7056e5)return;const a=i<=-.01;this.timelinePos=n,this.bufferedPos=n;const o=this.playingItem;if(!o){this.checkBuffer();return}if(a&&this.schedule.resetErrorsInRange(n,n-i)&&this.updateSchedule(!0),this.checkBuffer(),a&&n<o.start||n>=o.end){var u;const h=this.findItemIndex(o);let p=this.schedule.findItemIndexAtTime(n);if(p===-1&&(p=h+(a?-1:1),this.log(`seeked ${a?"back ":""}to position not covered by schedule ${n} (resolving from ${h} to ${p})`)),!this.isInterstitial(o)&&(u=this.media)!=null&&u.paused&&(this.shouldPlay=!1),!a&&p>h){const x=this.schedule.findJumpRestrictedIndex(h+1,p);if(x>h){this.setSchedulePosition(x);return}}this.setSchedulePosition(p);return}const l=this.playingAsset;if(!l){if(this.playingLastItem&&this.isInterstitial(o)){const h=o.event.assetList[0];h&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(n,h))}return}const c=l.timelineStart,d=l.duration||0;if(a&&n<c||n>=c+d){var f;(f=o.event)!=null&&f.appendInPlace&&(this.clearInterstitial(o.event,o),this.flushFrontBuffer(n)),this.setScheduleToAssetAtTime(n,l)}},this.onTimeupdate=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled)return;if(n>this.timelinePos)this.timelinePos=n,n>this.bufferedPos&&this.checkBuffer();else return;const i=this.playingItem;if(!i||this.playingLastItem)return;if(n>=i.end){this.timelinePos=i.end;const o=this.findItemIndex(i);this.setSchedulePosition(o+1)}const s=this.playingAsset;if(!s)return;const a=s.timelineStart+(s.duration||0);n>=a&&this.setScheduleToAssetAtTime(n,s)},this.onScheduleUpdate=(n,i)=>{const s=this.schedule;if(!s)return;const a=this.playingItem,o=s.events||[],u=s.items||[],l=s.durations,c=n.map(x=>x.identifier),d=!!(o.length||c.length);(d||i)&&this.log(`INTERSTITIALS_UPDATED (${o.length}): ${o}
Schedule: ${u.map(x=>dr(x))} pos: ${this.timelinePos}`),c.length&&this.log(`Removed events ${c}`);let f=null,h=null;a&&(f=this.updateItem(a,this.timelinePos),this.itemsMatch(a,f)?this.playingItem=f:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const p=this.bufferingItem;if(p&&(h=this.updateItem(p,this.bufferedPos),this.itemsMatch(p,h)?this.bufferingItem=h:p.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(p.event,null))),n.forEach(x=>{x.assetList.forEach(v=>{this.clearAssetPlayer(v.identifier,null)})}),this.playerQueue.forEach(x=>{if(x.interstitial.appendInPlace){const v=x.assetItem.timelineStart,y=x.timelineOffset-v;if(y)try{x.timelineOffset=v}catch(g){Math.abs(y)>Pi&&this.warn(`${g} ("${x.assetId}" ${x.timelineOffset}->${v})`)}}}),d||i){if(this.hls.trigger(S.INTERSTITIALS_UPDATED,{events:o.slice(0),schedule:u.slice(0),durations:l,removedIds:c}),this.isInterstitial(a)&&c.includes(a.event.identifier)){this.warn(`Interstitial "${a.event.identifier}" removed while playing`),this.primaryFallback(a.event);return}a&&this.trimInPlace(f,a),p&&h!==f&&this.trimInPlace(h,p),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new t8(e),this.schedule=new e8(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(S.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(S.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(S.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(S.MEDIA_ENDED,this.onMediaEnded,this),e.on(S.ERROR,this.onError,this),e.on(S.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(S.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(S.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(S.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(S.MEDIA_ENDED,this.onMediaEnded,this),e.off(S.ERROR,this.onError,this),e.off(S.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Bt(e,"play",this.onPlay),Bt(e,"pause",this.onPause),Bt(e,"seeking",this.onSeeking),Bt(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const n=this.media=t.media;Rt(n,"seeking",this.onSeeking),Rt(n,"timeupdate",this.onTimeupdate),Rt(n,"play",this.onPlay),Rt(n,"pause",this.onPause)}onMediaAttached(e,t){const n=this.effectivePlayingItem,i=this.detachedData;if(this.detachedData=null,n===null)this.checkStart();else if(!i){this.clearScheduleState();const s=this.findItemIndex(n);this.setSchedulePosition(s)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const n=!!t.transferMedia,i=this.media;if(this.media=null,!n&&(i&&this.removeMediaListeners(i),this.detachedData)){const s=this.getBufferingPlayer();s&&(this.log(`Removing schedule state for detachedData and ${s}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,s.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,n=d=>d&&e.getAssetPlayer(d.identifier),i=(d,f,h,p,x)=>{if(d){let v=d[f].start;const y=d.event;if(y){if(f==="playout"||y.timelineOccupancy!==Jo.Point){const g=n(h);(g==null?void 0:g.interstitial)===y&&(v+=g.assetItem.startOffset+g[x])}}else{const g=p==="bufferedPos"?a():e[p];v+=g-d.start}return v}return 0},s=(d,f)=>{var h;if(d!==0&&f!=="primary"&&(h=e.schedule)!=null&&h.length){var p;const x=e.schedule.findItemIndexAtTime(d),v=(p=e.schedule.items)==null?void 0:p[x];if(v){const y=v[f].start-v.start;return d+y}}return d},a=()=>{const d=e.bufferedPos;return d===Number.MAX_VALUE?o("primary"):Math.max(d,0)},o=d=>{var f,h;return(f=e.primaryDetails)!=null&&f.live?e.primaryDetails.edge:((h=e.schedule)==null?void 0:h.durations[d])||0},u=(d,f)=>{var h,p;const x=e.effectivePlayingItem;if(x!=null&&(h=x.event)!=null&&h.restrictions.skip||!e.schedule)return;e.log(`seek to ${d} "${f}"`);const v=e.effectivePlayingItem,y=e.schedule.findItemIndexAtTime(d,f),g=(p=e.schedule.items)==null?void 0:p[y],m=e.getBufferingPlayer(),E=m==null?void 0:m.interstitial,T=E==null?void 0:E.appendInPlace,L=v&&e.itemsMatch(v,g);if(v&&(T||L)){const A=n(e.playingAsset),R=(A==null?void 0:A.media)||e.primaryMedia;if(R){const I=f==="primary"?R.currentTime:i(v,f,e.playingAsset,"timelinePos","currentTime"),C=d-I,_=(T?I:R.currentTime)+C;if(_>=0&&(!A||T||_<=A.duration)){R.currentTime=_;return}}}if(g){let A=d;if(f!=="primary"){const I=g[f].start,C=d-I;A=g.start+C}const R=!e.isInterstitial(g);if((!e.isInterstitial(v)||v.event.appendInPlace)&&(R||g.event.appendInPlace)){const I=e.media||(T?m==null?void 0:m.media:null);I&&(I.currentTime=A)}else if(v){const I=e.findItemIndex(v);if(y>I){const _=e.schedule.findJumpRestrictedIndex(I+1,y);if(_>I){e.setSchedulePosition(_);return}}let C=0;if(R)e.timelinePos=A,e.checkBuffer();else{const _=g.event.assetList,F=d-(g[f]||g).start;for(let B=_.length;B--;){const V=_[B];if(V.duration&&F>=V.startOffset&&F<V.startOffset+V.duration){C=B;break}}}e.setSchedulePosition(y,C)}}},l=()=>{const d=e.effectivePlayingItem;if(e.isInterstitial(d))return d;const f=t();return e.isInterstitial(f)?f:null},c={get bufferedEnd(){const d=t(),f=e.bufferingItem;if(f&&f===d){var h;return i(f,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-f.playout.start||((h=e.bufferingAsset)==null?void 0:h.startOffset)||0}return 0},get currentTime(){const d=l(),f=e.effectivePlayingItem;return f&&f===d?i(f,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-f.playout.start:0},set currentTime(d){const f=l(),h=e.effectivePlayingItem;h&&h===f&&u(d+h.playout.start,"playout")},get duration(){const d=l();return d?d.playout.end-d.playout.start:0},get assetPlayers(){var d;const f=(d=l())==null?void 0:d.event.assetList;return f?f.map(h=>e.getAssetPlayer(h.identifier)):[]},get playingIndex(){var d;const f=(d=l())==null?void 0:d.event;return f&&e.effectivePlayingAsset?f.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return l()}};return this.manager={get events(){var d;return((d=e.schedule)==null||(d=d.events)==null?void 0:d.slice(0))||[]},get schedule(){var d;return((d=e.schedule)==null||(d=d.items)==null?void 0:d.slice(0))||[]},get interstitialPlayer(){return l()?c:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const d=t();return e.findItemIndex(d)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const d=e.effectivePlayingItem;return e.findItemIndex(d)},primary:{get bufferedEnd(){return a()},get currentTime(){const d=e.timelinePos;return d>0?d:0},set currentTime(d){u(d,"primary")},get duration(){return o("primary")},get seekableStart(){var d;return((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0}},integrated:{get bufferedEnd(){return i(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return i(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(d){u(d,"integrated")},get duration(){return o("integrated")},get seekableStart(){var d;return s(((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0,"integrated")}},skip:()=>{const d=e.effectivePlayingItem,f=d==null?void 0:d.event;if(f&&!f.restrictions.skip){const h=e.findItemIndex(d);if(f.appendInPlace){const p=d.playout.start+d.event.duration;u(p+.001,"playout")}else e.advanceAfterAssetEnded(f,h,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,n=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!n?!1:this.findItemIndex(t)===n.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const n=this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&!n.event.appendInPlace)return;let i=this.media;!i&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(i=this.primaryMedia);const s=(t=i)==null?void 0:t.currentTime;if(!(s===void 0||!Z(s)))return s}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const n=this.getAssetPlayer(e);n&&this.transferMediaFromPlayer(n,t)}transferMediaFromPlayer(e,t){const n=e.interstitial.appendInPlace,i=e.media;if(n&&i===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&i){this.detachedData={media:i};return}const s=e.transferMedia();this.log(`transfer MediaSource from ${e} ${_e(s)}`),this.detachedData=s}else t&&i&&(this.shouldPlay||(this.shouldPlay=!i.paused))}transferMediaTo(e,t){var n,i;if(e.media===t)return;let s=null;const a=this.hls,o=e!==a,u=o&&e.interstitial.appendInPlace,l=(n=this.detachedData)==null?void 0:n.mediaSource;let c;if(a.media)u&&(s=a.transferMedia(),this.detachedData=s),c="Primary";else if(l){const p=this.getBufferingPlayer();p?(s=p.transferMedia(),c=`${p}`):c="detached MediaSource"}else c="detached media";if(!s){if(l)s=this.detachedData,this.log(`using detachedData: MediaSource ${_e(s)}`);else if(!this.detachedData||a.media===t){const p=this.playerQueue;p.length>1&&p.forEach(x=>{if(o&&x.interstitial.appendInPlace!==u){const v=x.interstitial;this.clearInterstitial(x.interstitial,null),v.appendInPlace=!1,v.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${v}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const d=s&&"mediaSource"in s&&((i=s.mediaSource)==null?void 0:i.readyState)!=="closed",f=d&&s?s:t;this.log(`${d?"transfering MediaSource":"attaching media"} to ${o?e:"Primary"} from ${c} (media.currentTime: ${t.currentTime})`);const h=this.schedule;if(f===s&&h){const p=o&&e.assetId===h.assetIdAtEnd;f.overrides={duration:h.duration,endOfStream:!o||p,cueRemoval:!o}}e.attachMedia(f)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const n=this.timelinePos,i=this.effectivePlayingItem;if(n===-1){const s=this.hls.startPosition;if(this.log(Va("checkStart",s)),this.timelinePos=s,t.length&&t[0].cue.pre){const a=e.findEventIndex(t[0].identifier);this.setSchedulePosition(a)}else if(s>=0||!this.primaryLive){const a=this.timelinePos=s>0?s:0,o=e.findItemIndexAtTime(a);this.setSchedulePosition(o)}}else if(i&&!this.playingItem){const s=e.findItemIndex(i);this.setSchedulePosition(s)}}advanceAssetBuffering(e,t){const n=e.event,i=n.findAssetIndex(t),s=vu(n,i);if(!n.isAssetPastPlayoutLimit(s))this.bufferedToEvent(e,s);else if(this.schedule){var a;const o=(a=this.schedule.items)==null?void 0:a[this.findItemIndex(e)+1];o&&this.bufferedToItem(o)}}advanceAfterAssetEnded(e,t,n){const i=vu(e,n);if(e.isAssetPastPlayoutLimit(i)){if(this.schedule){const s=this.schedule.items;if(s){const a=t+1,o=s.length;if(a>=o){this.setSchedulePosition(-1);return}const u=e.resumeTime;this.timelinePos<u&&(this.log(Va("advanceAfterAssetEnded",u)),this.timelinePos=u,e.appendInPlace&&this.advanceInPlace(u),this.checkBuffer(this.bufferedPos<u)),this.setSchedulePosition(a)}}}else{if(e.appendInPlace){const s=e.assetList[i];s&&this.advanceInPlace(s.timelineStart)}this.setSchedulePosition(t,i)}}setScheduleToAssetAtTime(e,t){const n=this.schedule;if(!n)return;const i=t.parentIdentifier,s=n.getEvent(i);if(s){const a=n.findEventIndex(i),o=n.findAssetIndex(s,e);this.advanceAfterAssetEnded(s,a,o-1)}}setSchedulePosition(e,t){var n;const i=(n=this.schedule)==null?void 0:n.items;if(!i||this.playbackDisabled)return;const s=e>=0?i[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${s&&dr(s)}) pos: ${this.timelinePos}`);const a=this.waitingItem||this.playingItem,o=this.playingLastItem;if(this.isInterstitial(a)){const c=a.event,d=this.playingAsset,f=d==null?void 0:d.identifier,h=f?this.getAssetPlayer(f):null;if(h&&f&&(!this.eventItemsMatch(a,s)||t!==void 0&&f!==c.assetList[t].identifier)){var u;const p=c.findAssetIndex(d);if(this.log(`INTERSTITIAL_ASSET_ENDED ${p+1}/${c.assetList.length} ${ci(d)}`),this.endedAsset=d,this.playingAsset=null,this.hls.trigger(S.INTERSTITIAL_ASSET_ENDED,{asset:d,assetListIndex:p,event:c,schedule:i.slice(0),scheduleIndex:e,player:h}),a!==this.playingItem){this.itemsMatch(a,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(c,this.findItemIndex(this.playingItem),p);return}this.retreiveMediaSource(f,s),h.media&&!((u=this.detachedData)!=null&&u.mediaSource)&&h.detachMedia()}if(!this.eventItemsMatch(a,s)&&(this.endedItem=a,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${c} ${dr(a)}`),c.hasPlayed=!0,this.hls.trigger(S.INTERSTITIAL_ENDED,{event:c,schedule:i.slice(0),scheduleIndex:e}),c.cue.once)){var l;this.updateSchedule();const p=(l=this.schedule)==null?void 0:l.items;if(s&&p){const x=this.findItemIndex(s);this.advanceSchedule(x,p,t,a,o)}return}}this.advanceSchedule(e,i,t,a,o)}advanceSchedule(e,t,n,i,s){const a=this.schedule;if(!a)return;const o=t[e]||null,u=this.primaryMedia,l=this.playerQueue;if(l.length&&l.forEach(c=>{const d=c.interstitial,f=a.findEventIndex(d.identifier);(f<e||f>e+1)&&this.clearInterstitial(d,o)}),this.isInterstitial(o)){this.timelinePos=Math.min(Math.max(this.timelinePos,o.start),o.end);const c=o.event;if(n===void 0){n=a.findAssetIndex(c,this.timelinePos);const p=vu(c,n-1);if(c.isAssetPastPlayoutLimit(p)||c.appendInPlace&&this.timelinePos===o.end){this.advanceAfterAssetEnded(c,e,n);return}n=p}const d=this.waitingItem;this.assetsBuffered(o,u)||this.setBufferingItem(o);let f=this.preloadAssets(c,n);if(this.eventItemsMatch(o,d||i)||(this.waitingItem=o,this.log(`INTERSTITIAL_STARTED ${dr(o)} ${c.appendInPlace?"append in place":""}`),this.hls.trigger(S.INTERSTITIAL_STARTED,{event:c,schedule:t.slice(0),scheduleIndex:e})),!c.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${c}`);return}if(c.assetListLoader&&(c.assetListLoader.destroy(),c.assetListLoader=void 0),!u){this.log(`Waiting for attachMedia to start Interstitial ${c}`);return}this.waitingItem=this.endedItem=null,this.playingItem=o;const h=c.assetList[n];if(!h){this.advanceAfterAssetEnded(c,e,n||0);return}if(f||(f=this.getAssetPlayer(h.identifier)),f===null||f.destroyed){const p=c.assetList.length;this.warn(`asset ${n+1}/${p} player destroyed ${c}`),f=this.createAssetPlayer(c,h,n),f.loadSource()}if(!this.eventItemsMatch(o,this.bufferingItem)&&c.appendInPlace&&this.isAssetBuffered(h))return;this.startAssetPlayer(f,n,t,e,u),this.shouldPlay&&Fp(f.media)}else o?(this.resumePrimary(o,e,i),this.shouldPlay&&Fp(this.hls.media)):s&&this.isInterstitial(i)&&(this.endedItem=null,this.playingItem=i,i.event.appendInPlace||this.attachPrimary(a.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,n){var i,s;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${dr(e)}`),!((i=this.detachedData)!=null&&i.mediaSource)){let o=this.timelinePos;(o<e.start||o>=e.end)&&(o=this.getPrimaryResumption(e,t),this.log(Va("resumePrimary",o)),this.timelinePos=o),this.attachPrimary(o,e)}if(!n)return;const a=(s=this.schedule)==null?void 0:s.items;a&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${dr(e)}`),this.hls.trigger(S.INTERSTITIALS_PRIMARY_RESUMED,{schedule:a.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const n=e.start;if(this.primaryLive){const i=this.primaryDetails;if(t===0)return this.hls.startPosition;if(i&&(n<i.fragmentStart||n>i.edge))return this.hls.liveSyncPosition||-1}return n}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:ue.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,n){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const i=this.primaryMedia;if(!i)return;const s=this.hls;s.media?this.checkBuffer():(this.transferMediaTo(s,i),n&&this.startLoadingPrimaryAt(e,n)),n||(this.log(Va("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,n))}startLoadingPrimaryAt(e,t){var n;const i=this.hls;!i.loadingEnabled||!i.media||Math.abs((((n=i.mainForwardBufferInfo)==null?void 0:n.start)||i.media.currentTime)-e)>.5?i.startLoad(e,t):i.bufferingEnabled||i.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(S.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(S.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const n=this.hls.levels[t.level];if(!n.details)return;const i=Ae(Ae({},this.mediaSelection||this.altSelection),{},{main:n});this.mediaSelection=i,this.schedule.parseInterstitialDateRanges(i,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const n=this.hls.audioTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=Ae(Ae({},this.altSelection),{},{audio:n});return}const s=Ae(Ae({},i),{},{audio:n});this.mediaSelection=s}onSubtitleTrackUpdated(e,t){const n=this.hls.subtitleTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=Ae(Ae({},this.altSelection),{},{subtitles:n});return}const s=Ae(Ae({},i),{},{subtitles:n});this.mediaSelection=s}onAudioTrackSwitching(e,t){const n=Vh(t);this.playerQueue.forEach(({hls:i})=>i&&(i.setAudioOption(t)||i.setAudioOption(n)))}onSubtitleTrackSwitch(e,t){const n=Vh(t);this.playerQueue.forEach(({hls:i})=>i&&(i.setSubtitleOption(t)||t.id!==-1&&i.setSubtitleOption(n)))}onBufferCodecs(e,t){const n=t.tracks;n&&(this.requiredTracks=n)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const n=this.playingItem;if(n&&!this.itemsMatch(n,this.bufferingItem)&&!this.isInterstitial(n)){const i=this.timelinePos;this.bufferedPos=i,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let i=0;i<t.length;i++){const s=t[i];if(s.cue.post){var n;const a=this.schedule.findEventIndex(s.identifier),o=(n=this.schedule.items)==null?void 0:n[a];this.isInterstitial(o)&&this.eventItemsMatch(o,this.bufferingItem)&&this.bufferedToItem(o,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const n=this.findItemIndex(t);this.setSchedulePosition(n+1)}else this.shouldPlay=!1}updateItem(e,t){var n;const i=(n=this.schedule)==null?void 0:n.items;if(e&&i){const s=this.findItemIndex(e,t);return i[s]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((s,a)=>{e.event.isAssetPastPlayoutLimit(a)&&this.clearAssetPlayer(s.identifier,null)});const n=e.end+.25,i=ue.bufferInfo(this.primaryMedia,n,0);(i.end>n||(i.nextStart||0)>n)&&(this.log(`trim buffered interstitial ${dr(e)} (was ${dr(t)})`),this.attachPrimary(n,null,!0),this.flushFrontBuffer(n))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var n;return!!t&&(e===t||e.event.identifier===((n=t.event)==null?void 0:n.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const n=this.mediaSelection;n&&((t=this.schedule)==null||t.updateSchedule(n,[],e))}checkBuffer(e){var t;const n=(t=this.schedule)==null?void 0:t.items;if(!n)return;const i=ue.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=i.len<1),this.updateBufferedPos(i.end,n,e)}updateBufferedPos(e,t,n){const i=this.schedule,s=this.bufferingItem;if(this.bufferedPos>e||!i)return;if(t.length===1&&this.itemsMatch(t[0],s)){this.bufferedPos=e;return}const a=this.playingItem,o=this.findItemIndex(a);let u=i.findItemIndexAtTime(e);if(this.bufferedPos<e){var l;const c=this.findItemIndex(s),d=Math.min(c+1,t.length-1),f=t[d];if((u===-1&&s&&e>=s.end||(l=f.event)!=null&&l.appendInPlace&&e+.01>=f.start)&&(u=d),this.isInterstitial(s)){const h=s.event;if(d-o>1&&h.appendInPlace===!1||h.assetList.length===0&&h.assetListLoader)return}if(this.bufferedPos=e,u>c&&u>o)this.bufferedToItem(f);else{const h=this.primaryDetails;this.primaryLive&&h&&e>h.edge-h.targetduration&&f.start<h.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(f)&&this.preloadAssets(f.event,0)}}else n&&a&&!this.itemsMatch(a,s)&&(u===o?this.bufferedToItem(a):u===o+1&&this.bufferedToItem(t[u]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(i=>{const s=this.getAssetPlayer(i.identifier);return!(s!=null&&s.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,n=this.schedule;if(!this.itemsMatch(e,t)&&n){const{items:i,events:s}=n;if(!i||!s)return t;const a=this.isInterstitial(e),o=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const u=o?o.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${dr(e)}`+(t?` (${u.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(a){const l=n.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((c,d)=>{const f=this.getAssetPlayer(c.identifier);f&&(d===l&&f.loadSource(),f.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(l=>l.pauseBuffering());this.hls.trigger(S.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:s.slice(0),schedule:i.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const n=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(n!==null){this.bufferingAsset=null;const i=this.detachedData;i?i.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),n=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(n)}bufferedToEvent(e,t){const n=e.event,i=n.assetList.length===0&&!n.assetListLoader,s=n.cue.once;if(i||!s){const a=this.preloadAssets(n,t);if(a!=null&&a.interstitial.appendInPlace){const o=this.primaryMedia;o&&this.bufferAssetPlayer(a,o)}}}preloadAssets(e,t){const n=e.assetUrl,i=e.assetList.length,s=i===0&&!e.assetListLoader,a=e.cue.once;if(s){const u=e.timelineStart;if(e.appendInPlace){var o;const f=this.playingItem;!this.isInterstitial(f)&&(f==null||(o=f.nextEvent)==null?void 0:o.identifier)===e.identifier&&this.flushFrontBuffer(u+.25)}let l,c=0;if(!this.playingItem&&this.primaryLive&&(c=this.hls.startPosition,c===-1&&(c=this.hls.liveSyncPosition||0)),c&&!(e.cue.pre||e.cue.post)){const f=c-u;f>0&&(l=Math.round(f*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${n?1:i} ${e}${l?` live-start: ${c} start-offset: ${l}`:""}`),n)return this.createAsset(e,0,0,u,e.duration,n);const d=this.assetListLoader.loadAssetList(e,l);d&&(e.assetListLoader=d)}else if(!a&&i){for(let l=t;l<i;l++){const c=e.assetList[l],d=this.getAssetPlayerQueueIndex(c.identifier);(d===-1||this.playerQueue[d].destroyed)&&!c.error&&this.createAssetPlayer(e,c,l)}const u=e.assetList[t];if(u){const l=this.getAssetPlayer(u.identifier);return l&&l.loadSource(),l}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(i=>{this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:i})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let n=0;n<t.length;n++)if(e===t[n].assetId)return n;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let n=0;n<e.length;n++)if(e[n].media===t)return e[n]}return null}createAsset(e,t,n,i,s,a){const o={parentIdentifier:e.identifier,identifier:XL(e,a,t),duration:s,startOffset:n,timelineStart:i,uri:a};return this.createAssetPlayer(e,o,t)}createAssetPlayer(e,t,n){const i=this.hls,s=i.userConfig;let a=s.videoPreference;const o=i.loadLevelObj||i.levels[i.currentLevel];(a||o)&&(a=Re({},a),o.videoCodec&&(a.videoCodec=o.videoCodec),o.videoRange&&(a.allowedVideoRanges=[o.videoRange]));const u=i.audioTracks[i.audioTrack],l=i.subtitleTracks[i.subtitleTrack];let c=0;if(this.primaryLive||e.appendInPlace){const E=this.timelinePos-t.timelineStart;if(E>1){const T=t.duration;T&&E<T&&(c=E)}}const d=t.identifier,f=Ae(Ae({},s),{},{maxMaxBufferLength:Math.min(180,i.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:i.sessionId,assetPlayerId:d,abrEwmaDefaultEstimate:i.bandwidthEstimate,interstitialsController:void 0,startPosition:c,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:u||s.audioPreference,subtitlePreference:l||s.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(f.timelineOffset=t.timelineStart));const h=f.cmcd;h!=null&&h.sessionId&&h.contentId&&(f.cmcd=Re({},h,{contentId:Rs(t.uri)})),this.getAssetPlayer(d)&&this.warn(`Duplicate date range identifier ${e} and asset ${d}`);const p=new JL(this.HlsPlayerClass,f,e,t);this.playerQueue.push(p),e.assetList[n]=t;let x=!0;const v=E=>{if(E.live){var T;const R=new Error(`Interstitials MUST be VOD assets ${e}`),I={fatal:!0,type:re.OTHER_ERROR,details:N.INTERSTITIAL_ASSET_ITEM_ERROR,error:R},C=((T=this.schedule)==null?void 0:T.findEventIndex(e.identifier))||-1;this.handleAssetItemError(I,e,C,n,R.message);return}const L=E.edge-E.fragmentStart,A=t.duration;(x||A===null||L>A)&&(x=!1,this.log(`Interstitial asset "${d}" duration change ${A} > ${L}`),t.duration=L,this.updateSchedule())};p.on(S.LEVEL_UPDATED,(E,{details:T})=>v(T)),p.on(S.LEVEL_PTS_UPDATED,(E,{details:T})=>v(T)),p.on(S.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const y=(E,T)=>{const L=this.getAssetPlayer(d);if(L&&T.tracks){L.off(S.BUFFER_CODECS,y),L.tracks=T.tracks;const A=this.primaryMedia;this.bufferingAsset===L.assetItem&&A&&!L.media&&this.bufferAssetPlayer(L,A)}};p.on(S.BUFFER_CODECS,y);const g=()=>{var E;const T=this.getAssetPlayer(d);if(this.log(`buffered to end of asset ${T}`),!T||!this.schedule)return;const L=this.schedule.findEventIndex(e.identifier),A=(E=this.schedule.items)==null?void 0:E[L];this.isInterstitial(A)&&this.advanceAssetBuffering(A,t)};p.on(S.BUFFERED_TO_END,g);const m=E=>()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;this.shouldPlay=!0;const L=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,L,E)};return p.once(S.MEDIA_ENDED,m(n)),p.once(S.PLAYOUT_LIMIT_REACHED,m(1/0)),p.on(S.ERROR,(E,T)=>{if(!this.schedule)return;const L=this.getAssetPlayer(d);if(T.details===N.BUFFER_STALLED_ERROR){if(L!=null&&L.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(T,e,this.schedule.findEventIndex(e.identifier),n,`Asset player error ${T.error} ${e}`)}),p.on(S.DESTROYING,()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;const T=new Error(`Asset player destroyed unexpectedly ${d}`),L={fatal:!0,type:re.OTHER_ERROR,details:N.INTERSTITIAL_ASSET_ITEM_ERROR,error:T};this.handleAssetItemError(L,e,this.schedule.findEventIndex(e.identifier),n,T.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${ci(t)}`),this.hls.trigger(S.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:n,event:e,player:p}),p}clearInterstitial(e,t){e.assetList.forEach(n=>{this.clearAssetPlayer(n.identifier,t)}),e.reset()}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const n=this.playerQueue[t];this.transferMediaFromPlayer(n,null),n.resetDetails()}}clearAssetPlayer(e,t){const n=this.getAssetPlayerQueueIndex(e);if(n!==-1){const i=this.playerQueue[n];this.log(`clear ${i} toSegment: ${t&&dr(t)}`),this.transferMediaFromPlayer(i,t),this.playerQueue.splice(n,1),i.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,n,i,s){const{interstitial:a,assetItem:o,assetId:u}=e,l=a.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=o,(!c||c.identifier!==u)&&(c&&(this.clearAssetPlayer(c.identifier,n[i]),delete c.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${l} ${ci(o)}`),this.hls.trigger(S.INTERSTITIAL_ASSET_STARTED,{asset:o,assetListIndex:t,event:a,schedule:n.slice(0),scheduleIndex:i,player:e})),this.bufferAssetPlayer(e,s)}bufferAssetPlayer(e,t){var n,i;if(!this.schedule)return;const{interstitial:s,assetItem:a}=e,o=this.schedule.findEventIndex(s.identifier),u=(n=this.schedule.items)==null?void 0:n[o];if(!u)return;e.loadSource(),this.setBufferingItem(u),this.bufferingAsset=a;const l=this.getBufferingPlayer();if(l===e)return;const c=s.appendInPlace;if(c&&(l==null?void 0:l.interstitial.appendInPlace)===!1)return;const d=(l==null?void 0:l.tracks)||((i=this.detachedData)==null?void 0:i.tracks)||this.requiredTracks;if(c&&a!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(d&&!ox(d,e.tracks)){const f=new Error(`Asset ${ci(a)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(d)}')`),h={fatal:!0,type:re.OTHER_ERROR,details:N.INTERSTITIAL_ASSET_ITEM_ERROR,error:f},p=s.findAssetIndex(a);this.handleAssetItemError(h,s,o,p,f.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,n=this.primaryMedia;if(!t||!n)return;const i=n.currentTime,s=t.findAssetIndex(e,i),a=e.assetList[s];if(a){const o=this.getAssetPlayer(a.identifier);if(o){const u=o.currentTime||i-a.timelineStart,l=o.duration-u;if(this.warn(`Stalled at ${u} of ${u+l} in ${o} ${e} (media.currentTime: ${i})`),u&&(l/n.playbackRate<.5||o.bufferedInPlaceToEnd(n))&&o.hls){const c=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,c,s)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,n,i,s){if(e.details===N.BUFFER_STALLED_ERROR)return;const a=t.assetList[i]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${a&&ci(a)} ${e.error}`),!this.schedule)return;const o=(a==null?void 0:a.identifier)||"",u=this.getAssetPlayerQueueIndex(o),l=this.playerQueue[u]||null,c=this.schedule.items,d=Re({},e,{fatal:!1,errorAction:ki(!0),asset:a,assetListIndex:i,event:t,schedule:c,scheduleIndex:n,player:l});if(this.hls.trigger(S.INTERSTITIAL_ASSET_ERROR,d),!e.fatal)return;const f=this.playingAsset,h=this.bufferingAsset,p=new Error(s);if(a&&(this.clearAssetPlayer(o,null),a.error=p),!t.assetList.some(x=>!x.error))t.error=p;else for(let x=i;x<t.assetList.length;x++)this.resetAssetPlayer(t.assetList[x].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):f&&f.identifier===o?this.advanceAfterAssetEnded(t,n,i):h&&h.identifier===o&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,h)}primaryFallback(e){const t=e.timelineStart,n=this.effectivePlayingItem;if(n){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${dr(n)} error: ${e.error}`);let i=this.timelinePos;i===-1&&(i=this.hls.startPosition);const s=this.updateItem(n,i);if(this.itemsMatch(n,s)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t)),!this.schedule)return;const a=this.schedule.findItemIndexAtTime(i);this.setSchedulePosition(a)}else this.checkStart()}onAssetListLoaded(e,t){var n,i;const s=t.event,a=s.identifier,o=t.assetListResponse.ASSETS;if(!((n=this.schedule)!=null&&n.hasEvent(a)))return;const u=s.timelineStart,l=s.duration;let c=0;o.forEach((x,v)=>{const y=parseFloat(x.DURATION);this.createAsset(s,v,c,u+c,y,x.URI),c+=y}),s.duration=c,this.log(`Loaded asset-list with duration: ${c} (was: ${l}) ${s}`);const d=this.waitingItem,f=(d==null?void 0:d.event.identifier)===a;this.updateSchedule();const h=(i=this.bufferingItem)==null?void 0:i.event;if(f){var p;const x=this.schedule.findEventIndex(a),v=(p=this.schedule.items)==null?void 0:p[x];if(v){if(!this.playingItem&&this.timelinePos>v.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==x){s.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${s}`),this.updateSchedule(!0),this.primaryFallback(s);return}this.setBufferingItem(v)}this.setSchedulePosition(x)}else if((h==null?void 0:h.identifier)===a){const x=s.assetList[0];if(x){const v=this.getAssetPlayer(x.identifier);if(h.appendInPlace){const y=this.primaryMedia;v&&y&&this.bufferAssetPlayer(v,y)}else v&&v.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case N.ASSET_LIST_PARSING_ERROR:case N.ASSET_LIST_LOAD_ERROR:case N.ASSET_LIST_LOAD_TIMEOUT:{const n=t.interstitial;n&&(this.updateSchedule(!0),this.primaryFallback(n));break}case N.BUFFER_STALLED_ERROR:{const n=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&n.event.appendInPlace){this.handleInPlaceStall(n.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const Bp=500;class n8 extends Vf{constructor(e,t,n){super(e,t,n,"subtitle-stream-controller",ee.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(S.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(S.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=z.IDLE,this.setInterval(Bp),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:n,success:i}=t;if(this.fragContextChanged(n)||(Xe(n)&&(this.fragPrevious=n),this.state=z.IDLE),!i)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let a;const o=n.start;for(let l=0;l<s.length;l++)if(o>=s[l].start&&o<=s[l].end){a=s[l];break}const u=n.start+n.duration;a?a.end=u:(a={start:o,end:u},s.push(a)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:n,endOffset:i}=t;if(n===0&&i!==Number.POSITIVE_INFINITY){const s=i-1;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(a=>{for(let o=0;o<a.length;){if(a[o].end<=s){a.shift();continue}else if(a[o].start<s)a[o].start=s;else break;o++}}),this.fragmentTracker.removeFragmentsInRange(n,s,ee.SUBTITLE)}}onError(e,t){const n=t.frag;(n==null?void 0:n.type)===ee.SUBTITLE&&(t.details===N.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==z.STOPPED&&(this.state=z.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&cv(this.levels,t)){this.levels=t.map(n=>new Ws(n));return}this.tracksBuffered=[],this.levels=t.map(n=>{const i=new Ws(n);return this.tracksBuffered[i.id]=[],i}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,ee.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var n;if(this.currentTrackId=t.id,!((n=this.levels)!=null&&n.length)||this.currentTrackId===-1){this.clearInterval();return}const i=this.levels[this.currentTrackId];i!=null&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.state!==z.STOPPED&&this.setInterval(Bp)}onSubtitleTrackLoaded(e,t){var n;const{currentTrackId:i,levels:s}=this,{details:a,id:o}=t;if(!s){this.warn(`Subtitle tracks were reset while loading level ${o}`);return}const u=s[o];if(o>=s.length||!u)return;this.log(`Subtitle track ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(a.live||(n=u.details)!=null&&n.live){if(a.deltaUpdateFailed)return;const d=this.mainDetails;if(!d){this.startFragRequested=!1;return}const f=d.fragments[0];if(!u.details)a.hasProgramDateTime&&d.hasProgramDateTime?(Qo(a,d),l=a.fragmentStart):f&&(l=f.start,md(a,l));else{var c;l=this.alignPlaylists(a,u.details,(c=this.levelLastLoaded)==null?void 0:c.details),l===0&&f&&(l=f.start,md(a,l))}d&&!this.startFragRequested&&this.setStartPosition(d,l)}u.details=a,this.levelLastLoaded=u,o===i&&(this.hls.trigger(S.SUBTITLE_TRACK_UPDATED,{details:a,id:o,groupId:t.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===z.IDLE&&(Qn(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),u.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:n}=e,i=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&i!=null&&i.key&&i.iv&&wi(i.method)){const a=performance.now();this.decrypter.decrypt(new Uint8Array(n),i.key.buffer,i.iv.buffer,Gf(i.method)).catch(o=>{throw s.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:N.FRAG_DECRYPT_ERROR,fatal:!1,error:o,reason:o.message,frag:t}),o}).then(o=>{const u=performance.now();s.trigger(S.FRAG_DECRYPTED,{frag:t,payload:o,stats:{tstart:a,tdecrypt:u}})}).catch(o=>{this.warn(`${o.name}: ${o.message}`),this.state=z.IDLE})}}doTick(){if(!this.media){this.state=z.IDLE;return}if(this.state===z.IDLE){const{currentTrackId:e,levels:t}=this,n=t==null?void 0:t[e];if(!n||!t.length||!n.details||this.waitForLive(n))return;const{config:i}=this,s=this.getLoadPosition(),a=ue.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,i.maxBufferHole),{end:o,len:u}=a,l=n.details,c=this.hls.maxBufferLength+l.levelTargetDuration;if(u>c)return;const d=l.fragments,f=d.length,h=l.edge;let p=null;const x=this.fragPrevious;if(o<h){const g=i.maxFragLookUpTolerance,m=o>h-g?0:g;p=Qn(x,d,Math.max(d[0].start,o),m),!p&&x&&x.start<d[0].start&&(p=d[0])}else p=d[f-1];if(p=this.filterReplacedPrimary(p,n.details),!p)return;const v=p.sn-l.startSN,y=d[v-1];if(y&&y.cc===p.cc&&this.fragmentTracker.getState(y)===et.NOT_LOADED&&(p=y),this.fragmentTracker.getState(p)===et.NOT_LOADED){const g=this.mapToInitFragWhenRequired(p);g&&this.loadFragment(g,n,o)}}}loadFragment(e,t,n){Xe(e)?super.loadFragment(e,t,n):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new i8(this.tracksBuffered[this.currentTrackId]||[])}}class i8{constructor(e){this.buffered=void 0;const t=(n,i,s)=>{if(i=i>>>0,i>s-1)throw new DOMException(`Failed to execute '${n}' on 'TimeRanges': The index provided (${i}) is greater than the maximum bound (${s})`);return e[i][n]};this.buffered={get length(){return e.length},end(n){return t("end",n,e.length)},start(n){return t("start",n,e.length)}}}}const s8={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Rv=r=>String.fromCharCode(s8[r]||r),fr=15,Nr=100,a8={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},o8={17:2,18:4,21:6,22:8,23:10,19:13,20:15},l8={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},u8={25:2,26:4,29:6,30:8,31:10,27:13,28:15},c8=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class d8{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const n=typeof t=="function"?t():t;Ce.log(`${this.time} [${e}] ${n}`)}}}const Bn=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t};class Iv{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){const i=t[n];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class f8{constructor(){this.uchar=" ",this.penState=new Iv}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class h8{constructor(e){this.chars=[],this.pos=0,this.currPenState=new Iv,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Nr;t++)this.chars.push(new f8);this.logger=e}equals(e){for(let t=0;t<Nr;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Nr;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Nr;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Nr&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Nr)}moveCursor(e){const t=this.pos+e;if(e>1)for(let n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Rv(e);if(this.pos>=Nr){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Nr;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let n=0;n<Nr;n++){const i=this.chars[n].uchar;i!==" "&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class yu{constructor(e){this.rows=[],this.currRow=fr-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<fr;t++)this.rows.push(new h8(e));this.logger=e}reset(){for(let e=0;e<fr;e++)this.rows[e].clear();this.currRow=fr-1}equals(e){let t=!0;for(let n=0;n<fr;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<fr;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<fr;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+_e(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let o=0;o<fr;o++)this.rows[o].clear();const s=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const o=a.rows[s].cueStartTime,u=this.logger.time;if(o!==null&&u!==null&&o<u)for(let l=0;l<this.nrRollUpRows;l++)this.rows[t-this.nrRollUpRows+l+1].copy(a.rows[s+l])}}this.currRow=t;const n=this.rows[this.currRow];if(e.indent!==null){const s=e.indent,a=Math.max(s-1,0);n.setCursor(e.indent),e.color=n.chars[a].penState.foreground}const i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+_e(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let n="",i=-1;for(let s=0;s<fr;s++){const a=this.rows[s].getTextString();a&&(i=s+1,e?t.push("Row "+i+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?n="["+t.join(" | ")+"]":n=t.join(`
`)),n}getTextAndFormat(){return this.rows}}class Op{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new yu(n),this.nonDisplayedMemory=new yu(n),this.lastOutputScreen=new yu(n),this.currRollUpRow=this.displayedMemory.rows[fr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[fr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const n=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[n]}this.logger.log(2,"MIDROW: "+_e(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Mp{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=g8(),this.logger=void 0;const i=this.logger=new d8;this.channels=[null,new Op(e,t,i),new Op(e+1,n,i)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let n=0;n<t.length;n+=2){const i=t[n]&127,s=t[n+1]&127;let a=!1,o=null;if(i===0&&s===0)continue;this.logger.log(3,()=>"["+Bn([t[n],t[n+1]])+"] -> ("+Bn([i,s])+")");const u=this.cmdHistory;if(i>=16&&i<=31){if(p8(i,s,u)){ja(null,null,u),this.logger.log(3,()=>"Repeated command ("+Bn([i,s])+") is dropped");continue}ja(i,s,this.cmdHistory),a=this.parseCmd(i,s),a||(a=this.parseMidrow(i,s)),a||(a=this.parsePAC(i,s)),a||(a=this.parseBackgroundAttributes(i,s))}else ja(null,null,u);if(!a&&(o=this.parseChars(i,s),o)){const c=this.currentChannel;c&&c>0?this.channels[c].insertChars(o):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!a&&!o&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Bn([i,s])+" orig: "+Bn([t[n],t[n+1]]))}}parseCmd(e,t){const n=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=33&&t<=35;if(!(n||i))return!1;const s=e===20||e===21||e===23?1:2,a=this.channels[s];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),this.currentChannel=s,!0}parseMidrow(e,t){let n=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?n=1:n=2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[n];return i?(i.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Bn([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let n;const i=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,s=(e===16||e===24)&&t>=64&&t<=95;if(!(i||s))return!1;const a=e<=23?1:2;t>=64&&t<=95?n=a===1?a8[e]:l8[e]:n=a===1?o8[e]:u8[e];const o=this.channels[a];return o?(o.setPAC(this.interpretPAC(n,t)),this.currentChannel=a,!0):!1}interpretPAC(e,t){let n;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?n=t-96:n=t-64,i.underline=(n&1)===1,n<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(i.italics=!0,i.color="white"):i.indent=Math.floor((n-16)/2)*4,i}parseChars(e,t){let n,i=null,s=null;if(e>=25?(n=2,s=e-8):(n=1,s=e),s>=17&&s<=19){let a;s===17?a=t+80:s===18?a=t+112:a=t+144,this.logger.log(2,()=>"Special char '"+Rv(a)+"' in channel "+n),i=[a]}else e>=32&&e<=127&&(i=t===0?[e]:[e,t]);return i&&this.logger.log(3,()=>"Char codes =  "+Bn(i).join(",")),i}parseBackgroundAttributes(e,t){const n=(e===16||e===24)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=45&&t<=47;if(!(n||i))return!1;let s;const a={};e===16||e===24?(s=Math.floor((t-32)/2),a.background=c8[s],t%2===1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));const o=e<=23?1:2;return this.channels[o].setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}ja(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const n=this.channels[t];n&&n.cueSplitAtTime(e)}}}function ja(r,e,t){t.a=r,t.b=e}function p8(r,e,t){return t.a===r&&t.b===e}function g8(){return{a:null,b:null}}var t0=function(){if(Xo!=null&&Xo.VTTCue)return self.VTTCue;const r=["","lr","rl"],e=["start","middle","end","left","right"];function t(o,u){if(typeof u!="string"||!Array.isArray(o))return!1;const l=u.toLowerCase();return~o.indexOf(l)?l:!1}function n(o){return t(r,o)}function i(o){return t(e,o)}function s(o,...u){let l=1;for(;l<arguments.length;l++){const c=arguments[l];for(const d in c)o[d]=c[d]}return o}function a(o,u,l){const c=this,d={enumerable:!0};c.hasBeenReset=!1;let f="",h=!1,p=o,x=u,v=l,y=null,g="",m=!0,E="auto",T="start",L=50,A="middle",R=50,I="middle";Object.defineProperty(c,"id",s({},d,{get:function(){return f},set:function(C){f=""+C}})),Object.defineProperty(c,"pauseOnExit",s({},d,{get:function(){return h},set:function(C){h=!!C}})),Object.defineProperty(c,"startTime",s({},d,{get:function(){return p},set:function(C){if(typeof C!="number")throw new TypeError("Start time must be set to a number.");p=C,this.hasBeenReset=!0}})),Object.defineProperty(c,"endTime",s({},d,{get:function(){return x},set:function(C){if(typeof C!="number")throw new TypeError("End time must be set to a number.");x=C,this.hasBeenReset=!0}})),Object.defineProperty(c,"text",s({},d,{get:function(){return v},set:function(C){v=""+C,this.hasBeenReset=!0}})),Object.defineProperty(c,"region",s({},d,{get:function(){return y},set:function(C){y=C,this.hasBeenReset=!0}})),Object.defineProperty(c,"vertical",s({},d,{get:function(){return g},set:function(C){const _=n(C);if(_===!1)throw new SyntaxError("An invalid or illegal string was specified.");g=_,this.hasBeenReset=!0}})),Object.defineProperty(c,"snapToLines",s({},d,{get:function(){return m},set:function(C){m=!!C,this.hasBeenReset=!0}})),Object.defineProperty(c,"line",s({},d,{get:function(){return E},set:function(C){if(typeof C!="number"&&C!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");E=C,this.hasBeenReset=!0}})),Object.defineProperty(c,"lineAlign",s({},d,{get:function(){return T},set:function(C){const _=i(C);if(!_)throw new SyntaxError("An invalid or illegal string was specified.");T=_,this.hasBeenReset=!0}})),Object.defineProperty(c,"position",s({},d,{get:function(){return L},set:function(C){if(C<0||C>100)throw new Error("Position must be between 0 and 100.");L=C,this.hasBeenReset=!0}})),Object.defineProperty(c,"positionAlign",s({},d,{get:function(){return A},set:function(C){const _=i(C);if(!_)throw new SyntaxError("An invalid or illegal string was specified.");A=_,this.hasBeenReset=!0}})),Object.defineProperty(c,"size",s({},d,{get:function(){return R},set:function(C){if(C<0||C>100)throw new Error("Size must be between 0 and 100.");R=C,this.hasBeenReset=!0}})),Object.defineProperty(c,"align",s({},d,{get:function(){return I},set:function(C){const _=i(C);if(!_)throw new SyntaxError("An invalid or illegal string was specified.");I=_,this.hasBeenReset=!0}})),c.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}();class m8{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function _v(r){function e(n,i,s,a){return(n|0)*3600+(i|0)*60+(s|0)+parseFloat(a||0)}const t=r.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class x8{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let i=0;i<n.length;++i)if(t===n[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function Dv(r,e,t,n){const i=n?r.split(n):[r];for(const s in i){if(typeof i[s]!="string")continue;const a=i[s].split(t);if(a.length!==2)continue;const o=a[0],u=a[1];e(o,u)}}const Cd=new t0(0,0,""),Ka=Cd.align==="middle"?"middle":"center";function v8(r,e,t){const n=r;function i(){const o=_v(r);if(o===null)throw new Error("Malformed timestamp: "+n);return r=r.replace(/^[^\sa-zA-Z-]+/,""),o}function s(o,u){const l=new x8;Dv(o,function(f,h){let p;switch(f){case"region":for(let x=t.length-1;x>=0;x--)if(t[x].id===h){l.set(f,t[x].region);break}break;case"vertical":l.alt(f,h,["rl","lr"]);break;case"line":p=h.split(","),l.integer(f,p[0]),l.percent(f,p[0])&&l.set("snapToLines",!1),l.alt(f,p[0],["auto"]),p.length===2&&l.alt("lineAlign",p[1],["start",Ka,"end"]);break;case"position":p=h.split(","),l.percent(f,p[0]),p.length===2&&l.alt("positionAlign",p[1],["start",Ka,"end","line-left","line-right","auto"]);break;case"size":l.percent(f,h);break;case"align":l.alt(f,h,["start",Ka,"end","left","right"]);break}},/:/,/\s/),u.region=l.get("region",null),u.vertical=l.get("vertical","");let c=l.get("line","auto");c==="auto"&&Cd.line===-1&&(c=-1),u.line=c,u.lineAlign=l.get("lineAlign","start"),u.snapToLines=l.get("snapToLines",!0),u.size=l.get("size",100),u.align=l.get("align",Ka);let d=l.get("position","auto");d==="auto"&&Cd.position===50&&(d=u.align==="start"||u.align==="left"?0:u.align==="end"||u.align==="right"?100:50),u.position=d}function a(){r=r.replace(/^\s+/,"")}if(a(),e.startTime=i(),a(),r.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);r=r.slice(3),a(),e.endTime=i(),a(),s(r,e)}function kv(r){return r.replace(/<br(?: \/)?>/gi,`
`)}class y8{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new m8,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function n(){let s=t.buffer,a=0;for(s=kv(s);a<s.length&&s[a]!=="\r"&&s[a]!==`
`;)++a;const o=s.slice(0,a);return s[a]==="\r"&&++a,s[a]===`
`&&++a,t.buffer=s.slice(a),o}function i(s){Dv(s,function(a,o){},/:/)}try{let s="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;s=n();const o=s.match(/^()?WEBVTT([ \t].*)?$/);if(!(o!=null&&o[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:s=n(),t.state){case"HEADER":/:/.test(s)?i(s):s||(t.state="ID");continue;case"NOTE":s||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){t.state="NOTE";break}if(!s)continue;if(t.cue=new t0(0,0,""),t.state="CUE",s.indexOf("-->")===-1){t.cue.id=s;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{v8(s,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const o=s.indexOf("-->")!==-1;if(!s||o&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=s}continue;case"BADCUE":s||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const E8=/\r\n|\n\r|\n|\r/g,Eu=function(e,t,n=0){return e.slice(n,n+t.length)===t},S8=function(e){let t=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!Z(t)||!Z(n)||!Z(i)||!Z(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*n,t+=60*1e3*i,t+=60*60*1e3*s,t};function r0(r,e,t){return Rs(r.toString())+Rs(e.toString())+Rs(t)}const T8=function(e,t,n){let i=e[t],s=e[i.prevCC];if(!s||!s.new&&i.new){e.ccOffset=e.presentationOffset=i.start,i.new=!1;return}for(;(a=s)!=null&&a.new;){var a;e.ccOffset+=i.start-s.start,i.new=!1,i=s,s=e[i.prevCC]}e.presentationOffset=n};function A8(r,e,t,n,i,s,a){const o=new y8,u=Xt(new Uint8Array(r)).trim().replace(E8,`
`).split(`
`),l=[],c=e?DC(e.baseTime,e.timescale):0;let d="00:00.000",f=0,h=0,p,x=!0;o.oncue=function(v){const y=t[n];let g=t.ccOffset;const m=(f-c)/9e4;if(y!=null&&y.new&&(h!==void 0?g=t.ccOffset=y.start:T8(t,n,m)),m){if(!e){p=new Error("Missing initPTS for VTT MPEGTS");return}g=m-t.presentationOffset}const E=v.endTime-v.startTime,T=Kt((v.startTime+g-h)*9e4,i*9e4)/9e4;v.startTime=Math.max(T,0),v.endTime=Math.max(T+E,0);const L=v.text.trim();v.text=decodeURIComponent(encodeURIComponent(L)),v.id||(v.id=r0(v.startTime,v.endTime,L)),v.endTime>0&&l.push(v)},o.onparsingerror=function(v){p=v},o.onflush=function(){if(p){a(p);return}s(l)},u.forEach(v=>{if(x)if(Eu(v,"X-TIMESTAMP-MAP=")){x=!1,v.slice(16).split(",").forEach(y=>{Eu(y,"LOCAL:")?d=y.slice(6):Eu(y,"MPEGTS:")&&(f=parseInt(y.slice(7)))});try{h=S8(d)/1e3}catch(y){p=y}return}else v===""&&(x=!1);o.parse(v+`
`)}),o.flush()}const Su="stpp.ttml.im1t",wv=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,bv=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,C8={left:"start",center:"center",right:"end",start:"start",end:"end"};function Np(r,e,t,n){const i=pe(new Uint8Array(r),["mdat"]);if(i.length===0){n(new Error("Could not parse IMSC1 mdat"));return}const s=i.map(o=>Xt(o)),a=_C(e.baseTime,1,e.timescale);try{s.forEach(o=>t(L8(o,a)))}catch(o){n(o)}}function L8(r,e){const i=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(s).reduce((d,f)=>(d[f]=i.getAttribute(`ttp:${f}`)||s[f],d),{}),o=i.getAttribute("xml:space")!=="preserve",u=$p(Tu(i,"styling","style")),l=$p(Tu(i,"layout","region")),c=Tu(i,"body","[begin]");return[].map.call(c,d=>{const f=Pv(d,o);if(!f||!d.hasAttribute("begin"))return null;const h=Cu(d.getAttribute("begin"),a),p=Cu(d.getAttribute("dur"),a);let x=Cu(d.getAttribute("end"),a);if(h===null)throw Up(d);if(x===null){if(p===null)throw Up(d);x=h+p}const v=new t0(h-e,x-e,f);v.id=r0(v.startTime,v.endTime,v.text);const y=l[d.getAttribute("region")],g=u[d.getAttribute("style")],m=R8(y,g,u),{textAlign:E}=m;if(E){const T=C8[E];T&&(v.lineAlign=T),v.align=E}return Re(v,m),v}).filter(d=>d!==null)}function Tu(r,e,t){const n=r.getElementsByTagName(e)[0];return n?[].slice.call(n.querySelectorAll(t)):[]}function $p(r){return r.reduce((e,t)=>{const n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function Pv(r,e){return[].slice.call(r.childNodes).reduce((t,n,i)=>{var s;return n.nodeName==="br"&&i?t+`
`:(s=n.childNodes)!=null&&s.length?Pv(n,e):e?t+n.textContent.trim().replace(/\s+/g," "):t+n.textContent},"")}function R8(r,e,t){const n="http://www.w3.org/ns/ttml#styling";let i=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=r!=null&&r.hasAttribute("style")?r.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(i=t[a]),s.reduce((o,u)=>{const l=Au(e,n,u)||Au(r,n,u)||Au(i,n,u);return l&&(o[u]=l),o},{})}function Au(r,e,t){return r&&r.hasAttributeNS(e,t)?r.getAttributeNS(e,t):null}function Up(r){return new Error(`Could not parse ttml timestamp ${r}`)}function Cu(r,e){if(!r)return null;let t=_v(r);return t===null&&(wv.test(r)?t=I8(r,e):bv.test(r)&&(t=_8(r,e))),t}function I8(r,e){const t=wv.exec(r),n=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+n/e.frameRate}function _8(r,e){const t=bv.exec(r),n=Number(t[1]);switch(t[2]){case"h":return n*3600;case"m":return n*60;case"ms":return n*1e3;case"f":return n/e.frameRate;case"t":return n/e.tickRate}return n}class za{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class D8{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Hp(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this),e.on(S.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(S.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(S.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this),e.off(S.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(S.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(S.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new za(this,"textTrack1"),t=new za(this,"textTrack2"),n=new za(this,"textTrack3"),i=new za(this,"textTrack4");this.cea608Parser1=new Mp(1,e,t),this.cea608Parser2=new Mp(3,n,i)}addCues(e,t,n,i,s){let a=!1;for(let o=s.length;o--;){const u=s[o],l=k8(u[0],u[1],t,n);if(l>=0&&(u[0]=Math.min(u[0],t),u[1]=Math.max(u[1],n),a=!0,l/(n-t)>.5))return}if(a||s.push([t,n]),this.config.renderTextTracksNatively){const o=this.captionsTracks[e];this.Cues.newCue(o,t,n,i)}else{const o=this.Cues.newCue(null,t,n,i);this.hls.trigger(S.CUES_PARSED,{type:"captions",cues:o,track:e})}}onInitPtsFound(e,{frag:t,id:n,initPTS:i,timescale:s,trackId:a}){const{unparsedVttFrags:o}=this;n===ee.MAIN&&(this.initPTS[t.cc]={baseTime:i,timescale:s,trackId:a}),o.length&&(this.unparsedVttFrags=[],o.forEach(u=>{this.initPTS[u.frag.cc]?this.onFragLoaded(S.FRAG_LOADED,u):this.hls.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:u.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:n}=this;if(n)for(let i=0;i<n.textTracks.length;i++){const s=n.textTracks[i];if(Gp(s,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:n,media:i}=this,{label:s,languageCode:a}=t[e],o=this.getExistingTrack(s,a);if(o)n[e]=o,Ai(n[e]),Av(n[e],i);else{const u=this.createTextTrack("captions",s,a);u&&(u[e]=!0,n[e]=u)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const n=t.label,i={_id:e,label:n,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(S.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}createTextTrack(e,t,n){const i=this.media;if(i)return i.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const n=!!t.transferMedia;if(this.media=null,n)return;const{captionsTracks:i}=this;Object.keys(i).forEach(s=>{Ai(i[s]),delete i[s]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Hp(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let n=0;n<t.length;n++)Ai(t[n])}onSubtitleTracksUpdated(e,t){const n=t.subtitleTracks||[],i=n.some(s=>s.textCodec===Su);if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(cv(this.tracks,n)){this.tracks=n;return}if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const a=this.media,o=a?mo(a.textTracks):null;if(this.tracks.forEach((u,l)=>{let c;if(o){let d=null;for(let f=0;f<o.length;f++)if(o[f]&&Gp(o[f],u)){d=o[f],o[f]=null;break}d&&(c=d)}if(c)Ai(c);else{const d=Fv(u);c=this.createTextTrack(d,u.name,u.lang),c&&(c.mode="disabled")}c&&this.textTracks.push(c)}),o!=null&&o.length){const u=o.filter(l=>l!==null).map(l=>l.label);u.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${u.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(o=>({label:o.name,kind:o.type.toLowerCase(),default:o.default,subtitleTrack:o}));this.hls.trigger(S.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(n=>{const i=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(!i)return;const s=`textTrack${i[1]}`,a=this.captionsProperties[s];a&&(a.label=n.name,n.lang&&(a.languageCode=n.lang),a.media=n)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===ee.MAIN){var n,i;const{cea608Parser1:s,cea608Parser2:a,lastSn:o}=this,{cc:u,sn:l}=t.frag,c=(n=(i=t.part)==null?void 0:i.index)!=null?n:-1;s&&a&&(l!==o+1||l===o&&c!==this.lastPartIndex+1||u!==this.lastCc)&&(s.reset(),a.reset()),this.lastCc=u,this.lastSn=l,this.lastPartIndex=c}}onFragLoaded(e,t){const{frag:n,payload:i}=t;if(n.type===ee.SUBTITLE)if(i.byteLength){const s=n.decryptdata,a="stats"in t;if(s==null||!s.encrypted||a){const o=this.tracks[n.level],u=this.vttCCs;u[n.cc]||(u[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),o&&o.textCodec===Su?this._parseIMSC1(n,i):this._parseVTTs(t)}}else this.hls.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const n=this.hls;Np(t,this.initPTS[e.cc],i=>{this._appendCues(i,e.level),n.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},i=>{n.logger.log(`Failed to parse IMSC1: ${i}`),n.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:i})})}_parseVTTs(e){var t;const{frag:n,payload:i}=e,{initPTS:s,unparsedVttFrags:a}=this,o=s.length-1;if(!s[n.cc]&&o===-1){a.push(e);return}const u=this.hls,l=(t=n.initSegment)!=null&&t.data?or(n.initSegment.data,new Uint8Array(i)).buffer:i;A8(l,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,c=>{this._appendCues(c,n.level),u.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},c=>{const d=c.message==="Missing initPTS for VTT MPEGTS";d?a.push(e):this._fallbackToIMSC1(n,i),u.logger.log(`Failed to parse VTT cue: ${c}`),!(d&&o>n.cc)&&u.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:c})})}_fallbackToIMSC1(e,t){const n=this.tracks[e.level];n.textCodec||Np(t,this.initPTS[e.cc],()=>{n.textCodec=Su,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){const n=this.hls;if(this.config.renderTextTracksNatively){const i=this.textTracks[t];if(!i||i.mode==="disabled")return;e.forEach(s=>Cv(i,s))}else{const i=this.tracks[t];if(!i)return;const s=i.default?"default":"subtitles"+t;n.trigger(S.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,t){const{frag:n}=t;n.type===ee.SUBTITLE&&this.onFragLoaded(S.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:n,samples:i}=t;if(!(n.type===ee.MAIN&&this.closedCaptionsForLevel(n)==="NONE"))for(let s=0;s<i.length;s++){const a=i[s].bytes;if(a){this.cea608Parser1||this.initCea608Parsers();const o=this.extractCea608Data(a);this.cea608Parser1.addData(i[s].pts,o[0]),this.cea608Parser2.addData(i[s].pts,o[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:n,endOffsetSubtitles:i,type:s}){const{media:a}=this;if(!(!a||a.currentTime<n)){if(!s||s==="video"){const{captionsTracks:o}=this;Object.keys(o).forEach(u=>Ad(o[u],t,n))}if(this.config.renderTextTracksNatively&&t===0&&i!==void 0){const{textTracks:o}=this;Object.keys(o).forEach(u=>Ad(o[u],t,i))}}}extractCea608Data(e){const t=[[],[]],n=e[0]&31;let i=2;for(let s=0;s<n;s++){const a=e[i++],o=127&e[i++],u=127&e[i++];if(o===0&&u===0)continue;if((4&a)!==0){const c=3&a;(c===0||c===1)&&(t[c].push(o),t[c].push(u))}}return t}}function Fv(r){return r.characteristics&&/transcribes-spoken-dialog/gi.test(r.characteristics)&&/describes-music-and-sound/gi.test(r.characteristics)?"captions":"subtitles"}function Gp(r,e){return!!r&&r.kind===Fv(e)&&yd(e,r)}function k8(r,e,t,n){return Math.min(e,n)-Math.max(r,t)}function Hp(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const w8=/\s/,b8={newCue(r,e,t,n){const i=[];let s,a,o,u,l;const c=self.VTTCue||self.TextTrackCue;for(let f=0;f<n.rows.length;f++)if(s=n.rows[f],o=!0,u=0,l="",!s.isEmpty()){var d;for(let x=0;x<s.chars.length;x++)w8.test(s.chars[x].uchar)&&o?u++:(l+=s.chars[x].uchar,o=!1);s.cueStartTime=e,e===t&&(t+=1e-4),u>=16?u--:u++;const h=kv(l.trim()),p=r0(e,t,h);r!=null&&(d=r.cues)!=null&&d.getCueById(p)||(a=new c(e,t,h),a.id=p,a.line=f+1,a.align="left",a.position=10+Math.min(80,Math.floor(u*8/32)*10),i.push(a))}return r&&i.length&&(i.sort((f,h)=>f.line==="auto"||h.line==="auto"?0:f.line>8&&h.line>8?h.line-f.line:f.line-h.line),i.forEach(f=>Cv(r,f))),i}};function P8(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const F8=/(\d+)-(\d+)\/(\d+)/;class Vp{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||N8,this.controller=new self.AbortController,this.stats=new Ff}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const s=B8(e,this.controller.signal),a=e.responseType==="arraybuffer",o=a?"byteLength":"length",{maxTimeToFirstByteMs:u,maxLoadTimeMs:l}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=u&&Z(u)?u:l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},t.timeout),(Xs(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(d=>{var f;this.response=this.loader=d;const h=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},l-(h-i.loading.start)),!d.ok){const{status:x,statusText:v}=d;throw new $8(v||"fetch, bad network response",x,d)}i.loading.first=h,i.total=M8(d.headers)||i.total;const p=(f=this.callbacks)==null?void 0:f.onProgress;return p&&Z(t.highWaterMark)?this.loadProgressively(d,i,e,t.highWaterMark,p):a?d.arrayBuffer():e.responseType==="json"?d.json():d.text()}).then(d=>{var f,h;const p=this.response;if(!p)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const x=d[o];x&&(i.loaded=i.total=x);const v={url:p.url,data:d,code:p.status},y=(f=this.callbacks)==null?void 0:f.onProgress;y&&!Z(t.highWaterMark)&&y(i,e,d,p),(h=this.callbacks)==null||h.onSuccess(v,i,e,p)}).catch(d=>{var f;if(self.clearTimeout(this.requestTimeout),i.aborted)return;const h=d&&d.code||0,p=d?d.message:null;(f=this.callbacks)==null||f.onError({code:h,text:p},e,d?d.details:null,i)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n,i=0,s){const a=new jx,o=e.body.getReader(),u=()=>o.read().then(l=>{if(l.done)return a.dataLength&&s(t,n,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const c=l.value,d=c.length;return t.loaded+=d,d<i||a.dataLength?(a.push(c),a.dataLength>=i&&s(t,n,a.flush().buffer,e)):s(t,n,c.buffer,e),u()}).catch(()=>Promise.reject());return u()}}function B8(r,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Re({},r.headers))};return r.rangeEnd&&t.headers.set("Range","bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)),t}function O8(r){const e=F8.exec(r);if(e)return parseInt(e[2])-parseInt(e[1])+1}function M8(r){const e=r.get("Content-Range");if(e){const n=O8(e);if(Z(n))return n}const t=r.get("Content-Length");if(t)return parseInt(t)}function N8(r,e){return new self.Request(r.url,e)}class $8 extends Error{constructor(e,t,n){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=n}}const U8=/^age:\s*[\d.]+\s*$/im;class Bv{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Ff,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const n=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!(this.loader!==n||this.stats.aborted))return s(n,t.url)}).catch(a=>{if(!(this.loader!==n||this.stats.aborted))return n.open("GET",t.url,!0),s(n,t.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(a=>{var o;(o=this.callbacks)==null||o.onError({code:n.status,text:a.message},t,n,i)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);const i=t.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:a}=n.loadPolicy;if(i)for(const o in i)e.setRequestHeader(o,i[o]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=s&&Z(s)?s:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:n}=this;if(!e||!t)return;const i=t.readyState,s=this.config;if(!n.aborted&&i>=2&&(n.loading.first===0&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),i===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const l=t.status,c=t.responseType==="text"?t.responseText:null;if(l>=200&&l<300){const p=c??t.response;if(p!=null){var a,o;n.loading.end=Math.max(self.performance.now(),n.loading.first);const x=t.responseType==="arraybuffer"?p.byteLength:p.length;n.loaded=n.total=x,n.bwEstimate=n.total*8e3/(n.loading.end-n.loading.first);const v=(a=this.callbacks)==null?void 0:a.onProgress;v&&v(n,e,p,t);const y={url:t.responseURL,data:p,code:l};(o=this.callbacks)==null||o.onSuccess(y,n,e,t);return}}const d=s.loadPolicy.errorRetry,f=n.retry,h={url:e.url,data:void 0,code:l};if(Yo(d,f,!1,h))this.retry(d);else{var u;Ce.error(`${l} while loading ${e.url}`),(u=this.callbacks)==null||u.onError({code:l,text:t.statusText},e,t,n)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Yo(e,t,!0))this.retry(e);else{var n;Ce.warn(`timeout while loading ${(n=this.context)==null?void 0:n.url}`);const i=this.callbacks;i&&(this.abortInternal(),i.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:n}=this;this.retryDelay=Nf(e,n.retry),n.retry++,Ce.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${n.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&U8.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const G8={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},H8=Ae(Ae({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:Bv,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:eA,bufferController:jC,capLevelController:Zf,errorController:sA,fpsController:KL,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Px,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:G8},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},V8()),{},{subtitleStreamController:n8,subtitleTrackController:YL,timelineController:D8,audioStreamController:UC,audioTrackController:GC,emeController:bi,cmcdController:GL,contentSteeringController:VL,interstitialsController:r8});function V8(){return{cueHandler:b8,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function j8(r,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const n=Ld(r),i=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return i.forEach(a=>{const o=`${a==="level"?"playlist":a}LoadPolicy`,u=e[o]===void 0,l=[];s.forEach(c=>{const d=`${a}Loading${c}`,f=e[d];if(f!==void 0&&u){l.push(d);const h=n[o].default;switch(e[o]={default:h},c){case"TimeOut":h.maxLoadTimeMs=f,h.maxTimeToFirstByteMs=f;break;case"MaxRetry":h.errorRetry.maxNumRetry=f,h.timeoutRetry.maxNumRetry=f;break;case"RetryDelay":h.errorRetry.retryDelayMs=f,h.timeoutRetry.retryDelayMs=f;break;case"MaxRetryTimeout":h.errorRetry.maxRetryDelayMs=f,h.timeoutRetry.maxRetryDelayMs=f;break}}}),l.length&&t.warn(`hls.js config: "${l.join('", "')}" setting(s) are deprecated, use "${o}": ${_e(e[o])}`)}),Ae(Ae({},n),e)}function Ld(r){return r&&typeof r=="object"?Array.isArray(r)?r.map(Ld):Object.keys(r).reduce((e,t)=>(e[t]=Ld(r[t]),e),{}):r}function K8(r,e){const t=r.loader;t!==Vp&&t!==Bv?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),r.progressive=!1):P8()&&(r.loader=Vp,r.progressive=!0,r.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const xo=2,z8=.1,W8=.05,Y8=100;class q8 extends _x{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var n;(n=this.media)!=null&&n.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var n;this.ended=((n=this.media)==null?void 0:n.currentTime)||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(Y8),this.mediaSource=t.mediaSource;const n=this.media=t.media;Rt(n,"playing",this.onMediaPlaying),Rt(n,"waiting",this.onMediaWaiting),Rt(n,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:n}=this;n&&(Bt(n,"playing",this.onMediaPlaying),Bt(n,"waiting",this.onMediaWaiting),Bt(n,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var n,i;const s=(n=this.hls)==null?void 0:n.config;if(!s)return;const a=this.media;if(!a)return;const{seeking:o}=a,u=this.seeking&&!o,l=!this.seeking&&o,c=a.paused&&!o||a.ended||a.playbackRate===0;if(this.seeking=o,e!==t){t&&(this.ended=0),this.moved=!0,o||(this.nudgeRetry=0,s.nudgeOnVideoHole&&!c&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(l||u){u&&this.stallResolved(e);return}if(c){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!1}));return}if(!ue.getBuffered(a).length){this.nudgeRetry=0;return}const d=ue.bufferInfo(a,e,0),f=d.nextStart||0,h=this.fragmentTracker;if(o&&h&&this.hls){const L=jp(this.hls.inFlightFragments,e),A=d.len>xo,R=!f||L||f-e>xo&&!h.getPartialFragment(e);if(A||R)return;this.moved=!1}const p=(i=this.hls)==null?void 0:i.latestLevelDetails;if(!this.moved&&this.stalled!==null&&h){if(!(d.len>0)&&!f)return;const A=Math.max(f,d.start||0)-e,I=!!(p!=null&&p.live)?p.targetduration*2:xo,C=Wa(e,h);if(A>0&&(A<=I||C)){a.paused||this._trySkipBufferHole(C);return}}const x=s.detectStallWithCurrentTimeMs,v=self.performance.now(),y=this.waiting;let g=this.stalled;if(g===null)if(y>0&&v-y<x)g=this.stalled=y;else{this.stalled=v;return}const m=v-g;if(!o&&(m>=x||y)&&this.hls){var E;if(((E=this.mediaSource)==null?void 0:E.readyState)==="ended"&&!(p!=null&&p.live)&&Math.abs(e-((p==null?void 0:p.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(d),!this.media||!this.hls)return}const T=ue.bufferInfo(a,e,s.maxBufferHole);this._tryFixBufferStall(T,m,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const n=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(n)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(S.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var n;const i=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(n=this.buffered.audio)!=null&&n.length&&i&&i.length>1&&e>i.end(0)){const s=ue.bufferedInfo(ue.timeRangesToArray(this.buffered.audio),e,0);if(s.len>1&&t>=s.start){const a=ue.timeRangesToArray(i),o=ue.bufferedInfo(a,t,0).bufferedIndex;if(o>-1&&o<a.length-1){const u=ue.bufferedInfo(a,e,0).bufferedIndex,l=a[o].end,c=a[o+1].start;if((u===-1||u>o)&&c-l<1&&e-l<2){const d=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${l} -> ${c} buffered index: ${u}`);this.warn(d.message),this.media.currentTime+=1e-6;let f=Wa(e,this.fragmentTracker);f&&"fragment"in f?f=f.fragment:f||(f=void 0);const h=ue.bufferInfo(this.media,e,0);this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:N.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:d,reason:d.message,frag:f,buffer:h.len,bufferInfo:h})}}}}}_tryFixBufferStall(e,t,n){var i,s;const{fragmentTracker:a,media:o}=this,u=(i=this.hls)==null?void 0:i.config;if(!o||!a||!u)return;const l=(s=this.hls)==null?void 0:s.latestLevelDetails,c=Wa(n,a);if((c||l!=null&&l.live&&n<l.fragmentStart)&&(this._trySkipBufferHole(c)||!this.media))return;const d=e.buffered,f=this.adjacentTraversal(e,n);(d&&d.length>1&&e.len>u.maxBufferHole||e.nextStart&&(e.nextStart-n<u.maxBufferHole||f))&&(t>u.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const n=this.fragmentTracker,i=e.nextStart;if(n&&i){const s=n.getFragAtPos(t,ee.MAIN),a=n.getFragAtPos(i,ee.MAIN);if(s&&a)return a.sn-s.sn<2}return!1}_reportStall(e){const{hls:t,media:n,stallReported:i,stalled:s}=this;if(!i&&s!==null&&n&&t){this.stallReported=!0;const a=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${_e(e)})`);this.warn(a.message),t.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:N.BUFFER_STALLED_ERROR,fatal:!1,error:a,buffer:e.len,bufferInfo:e,stalled:{start:s}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:n,media:i}=this,s=(t=this.hls)==null?void 0:t.config;if(!i||!n||!s)return 0;const a=i.currentTime,o=ue.bufferInfo(i,a,0),u=a<o.start?o.start:o.nextStart;if(u&&this.hls){const c=o.len<=s.maxBufferHole,d=o.len>0&&o.len<1&&i.readyState<3,f=u-a;if(f>0&&(c||d)){if(f>s.maxBufferHole){let p=!1;if(a===0){const x=n.getAppendedFrag(0,ee.MAIN);x&&u<x.end&&(p=!0)}if(!p&&e){var l;if(!((l=this.hls.loadLevelObj)!=null&&l.details)||jp(this.hls.inFlightFragments,u))return 0;let v=!1,y=e.end;for(;y<u;){const g=Wa(y,n);if(g)y+=g.duration;else{v=!0;break}}if(v)return 0}}const h=Math.max(u+W8,a+z8);if(this.warn(`skipping hole, adjusting currentTime from ${a} to ${h}`),this.moved=!0,i.currentTime=h,!(e!=null&&e.gap)){const p=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${h}`),x={type:re.MEDIA_ERROR,details:N.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:p,reason:p.message,buffer:o.len,bufferInfo:o};e&&("fragment"in e?x.part=e:x.frag=e),this.hls.trigger(S.ERROR,x)}return h}}return 0}_tryNudgeBuffer(e){const{hls:t,media:n,nudgeRetry:i}=this,s=t==null?void 0:t.config;if(!n||!s)return 0;const a=n.currentTime;if(this.nudgeRetry++,i<s.nudgeMaxRetry){const o=a+(i+1)*s.nudgeOffset,u=new Error(`Nudging 'currentTime' from ${a} to ${o}`);this.warn(u.message),n.currentTime=o,t.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:N.BUFFER_NUDGE_ON_STALL,error:u,fatal:!1,buffer:e.len,bufferInfo:e})}else{const o=new Error(`Playhead still not moving while enough data buffered @${a} after ${s.nudgeMaxRetry} nudges`);this.error(o.message),t.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:N.BUFFER_STALLED_ERROR,error:o,fatal:!0,buffer:e.len,bufferInfo:e})}}}function jp(r,e){const t=Kp(r.main);if(t&&t.start<=e)return t;const n=Kp(r.audio);return n&&n.start<=e?n:null}function Kp(r){if(!r)return null;switch(r.state){case z.IDLE:case z.STOPPED:case z.ENDED:case z.ERROR:return null}return r.frag}function Wa(r,e){return e.getAppendedFrag(r,ee.MAIN)||e.getPartialFragment(r)}const X8=.25;function Rd(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Lu(r,e,t,n,i){let s=new r(e,t,"");try{s.value=n,i&&(s.type=i)}catch{s=new r(e,t,_e(i?Ae({type:i},n):n))}return s}const Ya=(()=>{const r=Rd();try{r&&new r(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class Q8{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(S.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var n;this.media=t.media,((n=t.overrides)==null?void 0:n.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Ai(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const n=e[t];if(n.kind==="metadata"&&n.label==="id3")return Av(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:n,enableID3MetadataCues:i}=this.hls.config;if(!n&&!i)return;const{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=Rd();if(a)for(let o=0;o<s.length;o++){const u=s[o].type;if(u===Wt.emsg&&!n||!i)continue;const l=Qx(s[o].data),c=s[o].pts;let d=c+s[o].duration;d>Ya&&(d=Ya),d-c<=0&&(d=c+X8);for(let h=0;h<l.length;h++){const p=l[h];if(!Zx(p)){this.updateId3CueEnds(c,u);const x=Lu(a,c,d,p,u);x&&this.id3Track.addCue(x)}}}}updateId3CueEnds(e,t){var n;const i=(n=this.id3Track)==null?void 0:n.cues;if(i)for(let s=i.length;s--;){const a=i[s];a.type===t&&a.startTime<e&&a.endTime===Ya&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:n,type:i}){const{id3Track:s,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:u}}=a;if(s&&(o||u)){let l;i==="audio"?l=c=>c.type===Wt.audioId3&&u:i==="video"?l=c=>c.type===Wt.emsg&&o:l=c=>c.type===Wt.audioId3&&u||c.type===Wt.emsg&&o,Ad(s,t,n,l)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:n,timelineOffset:i,enableDateRangeMetadataCues:s,interstitialsController:a}=this.hls.config;if(!s)return;const o=Rd();if(n&&i&&!a){const{fragmentStart:x,fragmentEnd:v}=e;let y=this.assetCue;y?(y.startTime=x,y.endTime=v):o&&(y=this.assetCue=Lu(o,x,v,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),y&&(y.id=n,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(y),y.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:u}=this,{dateRanges:l}=e,c=Object.keys(l);let d=this.dateRangeCuesAppended;if(u&&t){var f;if((f=u.cues)!=null&&f.length){const x=Object.keys(d).filter(v=>!c.includes(v));for(let v=x.length;v--;){var h;const y=x[v],g=(h=d[y])==null?void 0:h.cues;delete d[y],g&&Object.keys(g).forEach(m=>{const E=g[m];if(E){E.removeEventListener("enter",this.onEventCueEnter);try{u.removeCue(E)}catch{}}})}}else d=this.dateRangeCuesAppended={}}const p=e.fragments[e.fragments.length-1];if(!(c.length===0||!Z(p==null?void 0:p.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let x=0;x<c.length;x++){const v=c[x],y=l[v],g=y.startTime,m=d[v],E=(m==null?void 0:m.cues)||{};let T=(m==null?void 0:m.durationKnown)||!1,L=Ya;const{duration:A,endDate:R}=y;if(R&&A!==null)L=g+A,T=!0;else if(y.endOnNext&&!T){const C=c.reduce((_,F)=>{if(F!==y.id){const B=l[F];if(B.class===y.class&&B.startDate>y.startDate&&(!_||y.startDate<_.startDate))return B}return _},null);C&&(L=C.startTime,T=!0)}const I=Object.keys(y.attr);for(let C=0;C<I.length;C++){const _=I[C];if(!vA(_))continue;const F=E[_];if(F)T&&!(m!=null&&m.durationKnown)?F.endTime=L:Math.abs(F.startTime-g)>.01&&(F.startTime=g,F.endTime=L);else if(o){let B=y.attr[_];yA(_)&&(B=lx(B));const j=Lu(o,g,L,{key:_,data:B},Wt.dateRange);j&&(j.id=v,this.id3Track.addCue(j),E[_]=j,a&&(_==="X-ASSET-LIST"||_==="X-ASSET-URL")&&j.addEventListener("enter",this.onEventCueEnter))}}d[v]={cues:E,dateRange:y,durationKnown:T}}}}}class Z8{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,n=this.levelDetails;if(!t||!n)return;this.currentTime=t.currentTime;const i=this.computeLatency();if(i===null)return;this._latency=i;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:a}=this.config;if(!s||a===1||!n.live)return;const o=this.targetLatency;if(o===null)return;const u=i-o,l=Math.min(this.maxLatency,o+n.targetduration);if(u<l&&u>.05&&this.forwardBufferLength>1){const d=Math.min(2,Math.max(1,a)),f=Math.round(2/(1+Math.exp(-.75*u-this.edgeStalled))*20)/20,h=Math.min(d,Math.max(1,f));this.changeMediaPlaybackRate(t,h)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:n,targetduration:i}=e,{liveSyncDuration:s,liveSyncDurationCount:a,lowLatencyMode:o}=this.config,u=this.hls.userConfig;let l=o&&n||t;(this._targetLatencyUpdated||u.liveSyncDuration||u.liveSyncDurationCount||l===0)&&(l=s!==void 0?s:a*i);const c=i;return l+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const n=this.levelDetails;if(n===null)return null;const i=n.edge,s=e-t-this.edgeStalled,a=i-n.totalduration,o=i-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(a,s),o)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var n;t.details===N.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(n=this.levelDetails)!=null&&n.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var n,i;e.playbackRate!==t&&((n=this.hls)==null||n.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(i=this.targetLatency)==null?void 0:i.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class J8 extends Qf{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const n=this.hls.config.preferManagedMediaSource,i=[],s={},a={};let o=!1,u=!1,l=!1;t.levels.forEach(c=>{const d=c.attrs;let{audioCodec:f,videoCodec:h}=c;f&&(c.audioCodec=f=jo(f,n)||void 0),h&&(h=c.videoCodec=BT(h));const{width:p,height:x,unknownCodecs:v}=c,y=(v==null?void 0:v.length)||0;if(o||(o=!!(p&&x)),u||(u=!!h),l||(l=!!f),y||f&&!this.isAudioSupported(f)||h&&!this.isVideoSupported(h)){this.log(`Some or all CODECS not supported "${d.CODECS}"`);return}const{CODECS:g,"FRAME-RATE":m,"HDCP-LEVEL":E,"PATHWAY-ID":T,RESOLUTION:L,"VIDEO-RANGE":A}=d,I=`${`${T||"."}-`}${c.bitrate}-${L}-${m}-${g}-${A}-${E}`;if(s[I])if(s[I].uri!==c.url&&!c.attrs["PATHWAY-ID"]){const C=a[I]+=1;c.attrs["PATHWAY-ID"]=new Array(C+1).join(".");const _=this.createLevel(c);s[I]=_,i.push(_)}else s[I].addGroupId("audio",d.AUDIO),s[I].addGroupId("text",d.SUBTITLES);else{const C=this.createLevel(c);s[I]=C,a[I]=1,i.push(C)}}),this.filterAndSortMediaOptions(i,t,o,u,l)}createLevel(e){const t=new Ws(e),n=e.supplemental;if(n!=null&&n.videoCodec&&!this.isVideoSupported(n.videoCodec)){const i=new Error(`SUPPLEMENTAL-CODECS not supported "${n.videoCodec}"`);this.log(i.message),t.supportedResult=Ex(i,[])}return t}isAudioSupported(e){return Ks(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Ks(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,n,i,s){var a;let o=[],u=[],l=e;const c=((a=t.stats)==null?void 0:a.parsing)||{};if((n||i)&&s&&(l=l.filter(({videoCodec:g,videoRange:m,width:E,height:T})=>(!!g||!!(E&&T))&&KT(m))),l.length===0){Promise.resolve().then(()=>{if(this.hls){let g="no level with compatible codecs found in manifest",m=g;t.levels.length&&(m=`one or more CODECS in variant not supported: ${_e(t.levels.map(T=>T.attrs.CODECS).filter((T,L,A)=>A.indexOf(T)===L))}`,this.warn(m),g+=` (${m})`);const E=new Error(g);this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:N.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:E,reason:m})}}),c.end=performance.now();return}t.audioTracks&&(o=t.audioTracks.filter(g=>!g.audioCodec||this.isAudioSupported(g.audioCodec)),zp(o)),t.subtitles&&(u=t.subtitles,zp(u));const d=l.slice(0);l.sort((g,m)=>{if(g.attrs["HDCP-LEVEL"]!==m.attrs["HDCP-LEVEL"])return(g.attrs["HDCP-LEVEL"]||"")>(m.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&g.height!==m.height)return g.height-m.height;if(g.frameRate!==m.frameRate)return g.frameRate-m.frameRate;if(g.videoRange!==m.videoRange)return Ko.indexOf(g.videoRange)-Ko.indexOf(m.videoRange);if(g.videoCodec!==m.videoCodec){const E=Mh(g.videoCodec),T=Mh(m.videoCodec);if(E!==T)return T-E}if(g.uri===m.uri&&g.codecSet!==m.codecSet){const E=Vo(g.codecSet),T=Vo(m.codecSet);if(E!==T)return T-E}return g.averageBitrate!==m.averageBitrate?g.averageBitrate-m.averageBitrate:0});let f=d[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==d.length)){for(let g=0;g<d.length;g++)if(d[g].pathwayId===l[0].pathwayId){f=d[g];break}}this._levels=l;for(let g=0;g<l.length;g++)if(l[g]===f){var h;this._firstLevel=g;const m=f.bitrate,E=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${l.length} level(s) found, first bitrate: ${m}`),((h=this.hls.userConfig)==null?void 0:h.abrEwmaDefaultEstimate)===void 0){const T=Math.min(m,this.hls.config.abrEwmaDefaultEstimateMax);T>E&&E===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=T)}break}const p=s&&!i,x=this.hls.config,v=!!(x.audioStreamController&&x.audioTrackController),y={levels:l,audioTracks:o,subtitleTracks:u,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:i,altAudio:v&&!p&&o.some(g=>!!g.url)};c.end=performance.now(),this.hls.trigger(S.MANIFEST_PARSED,y)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const c=new Error("invalid level idx"),d=e<0;if(this.hls.trigger(S.ERROR,{type:re.OTHER_ERROR,details:N.LEVEL_SWITCH_ERROR,level:e,fatal:d,error:c,reason:c.message}),d)return;e=Math.min(e,t.length-1)}const n=this.currentLevelIndex,i=this.currentLevel,s=i?i.attrs["PATHWAY-ID"]:void 0,a=t[e],o=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,n===e&&i&&s===o)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${o?" with Pathway "+o:""} from level ${n}${s?" with Pathway "+s:""}`);const u={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(S.LEVEL_SWITCHING,u);const l=a.details;if(!l||l.live){const c=this.switchParams(a.uri,i==null?void 0:i.details,l);this.loadPlaylist(c)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),n=e.filter(i=>t.indexOf(i)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=n}}onError(e,t){t.fatal||!t.context||t.context.type===me.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===ee.MAIN){const n=t.elementaryStreams;if(!Object.keys(n).some(s=>!!n[s]))return;const i=this._levels[t.level];i!=null&&i.loadError&&(this.log(`Resetting level error count of ${i.loadError} on frag buffered`),i.loadError=0)}}onLevelLoaded(e,t){var n;const{level:i,details:s}=t,a=t.levelInfo;if(!a){var o;this.warn(`Invalid level index ${i}`),(o=t.deliveryDirectives)!=null&&o.skip&&(s.deltaUpdateFailed=!0);return}if(a===this.currentLevel||t.withoutMultiVariant){a.fragmentError===0&&(a.loadError=0);let u=a.details;u===t.details&&u.advanced&&(u=void 0),this.playlistLoaded(i,t,u)}else(n=t.deliveryDirectives)!=null&&n.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=this.getUrlWithDirectives(e.uri,t),i=this.currentLevelIndex,s=e.attrs["PATHWAY-ID"],a=e.details,o=a==null?void 0:a.age;this.log(`Loading level index ${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${s?" Pathway "+s:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${n}`),this.hls.trigger(S.LEVEL_LOADING,{url:n,level:i,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const n=this._levels.filter((s,a)=>a!==e?!0:(this.steering&&this.steering.removeLevel(s),s===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,s.details&&s.details.fragments.forEach(o=>o.level=-1)),!1));Gx(n),this._levels=n,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const i=n.length-1;this._firstLevel=Math.min(this._firstLevel,i),this._startLevel&&(this._startLevel=Math.min(this._startLevel,i)),this.hls.trigger(S.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(S.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function zp(r){const e={};r.forEach(t=>{const n=t.groupId||"";t.id=e[n]=e[n]||0,e[n]++})}function Ov(){return self.SourceBuffer||self.WebKitSourceBuffer}function Mv(){if(!An())return!1;const e=Ov();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function e4(){if(!Mv())return!1;const r=An();return typeof(r==null?void 0:r.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>r.isTypeSupported(zs(e,"video")))||["mp4a.40.2","fLaC"].some(e=>r.isTypeSupported(zs(e,"audio"))))}function t4(){var r;const e=Ov();return typeof(e==null||(r=e.prototype)==null?void 0:r.changeType)=="function"}const r4=100;class n4 extends Vf{constructor(e,t,n){super(e,t,n,"stream-controller",ee.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const i=this.media,s=i?i.currentTime:null;if(s===null||!Z(s)||(this.log(`Media seeked to ${s.toFixed(3)}`),!this.getBufferedFrag(s)))return;const a=this.getFwdBufferInfoAtPos(i,s,ee.MAIN,0);if(a===null||a.len===0){this.warn(`Main forward buffer length at ${s} on "seeked" event ${a?a.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:n,hls:i}=this;if(this.stopLoad(),this.setInterval(r4),this.level=-1,!this.startFragRequested){let s=i.startLevel;s===-1&&(i.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=i.firstAutoLevel),i.nextLoadLevel=s,this.level=i.loadLevel,this._hasEnoughToStart=!!t}n>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n),this.state=z.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=z.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case z.WAITING_LEVEL:{const{levels:e,level:t}=this,n=e==null?void 0:e[t],i=n==null?void 0:n.details;if(i&&(!i.live||this.levelLastLoaded===n&&!this.waitForLive(n))){if(this.waitForCdnTuneIn(i))break;this.state=z.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=z.IDLE;break}break}case z.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===z.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:n,media:i}=this;if(t===null||!i&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const s=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(n!=null&&n[s]))return;const a=n[s],o=this.getMainFwdBufferInfo();if(o===null)return;const u=this.getLevelDetails();if(u&&this._streamEnded(o,u)){const x={};this.altAudio===2&&(x.type="video"),this.hls.trigger(S.BUFFER_EOS,x),this.state=z.ENDED;return}if(!this.buffering)return;e.loadLevel!==s&&e.manualLevel===-1&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;const l=a.details;if(!l||this.state===z.WAITING_LEVEL||this.waitForLive(a)){this.level=s,this.state=z.WAITING_LEVEL,this.startFragRequested=!1;return}const c=o.len,d=this.getMaxBufferLength(a.maxBitrate);if(c>=d)return;this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);const f=this.backtrackFragment?this.backtrackFragment.start:o.end;let h=this.getNextFragment(f,l);if(this.couldBacktrack&&!this.fragPrevious&&h&&Xe(h)&&this.fragmentTracker.getState(h)!==et.OK){var p;const v=((p=this.backtrackFragment)!=null?p:h).sn-l.startSN,y=l.fragments[v-1];y&&h.cc===y.cc&&(h=y,this.fragmentTracker.removeFragment(y))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(h&&this.isLoopLoading(h,f)){if(!h.gap){const v=this.audioOnly&&!this.altAudio?Ie.AUDIO:Ie.VIDEO,y=(v===Ie.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;y&&this.afterBufferFlushed(y,v,ee.MAIN)}h=this.getNextFragmentLoopLoading(h,l,o,ee.MAIN,d)}h&&(h.initSegment&&!h.initSegment.data&&!this.bitrateTest&&(h=h.initSegment),this.loadFragment(h,a,f))}loadFragment(e,t,n){const i=this.fragmentTracker.getState(e);i===et.NOT_LOADED||i===et.PARTIAL?Xe(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,n):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,ee.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let n;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const s=this.getLevelDetails();if(s!=null&&s.live){const o=this.getMainFwdBufferInfo();if(!o||o.len<s.targetduration*2)return}if(!t.paused&&e){const o=this.hls.nextLoadLevel,u=e[o],l=this.fragLastKbps;l&&this.fragCurrent?n=this.fragCurrent.duration*u.maxBitrate/(1e3*l)+1:n=0}else n=0;const a=this.getBufferedFrag(t.currentTime+n);if(a){const o=this.followingBufferedFrag(a);if(o){this.abortCurrentFrag();const u=o.maxStartPTS?o.maxStartPTS:o.start,l=o.duration,c=Math.max(a.end,u+Math.min(Math.max(l-this.config.maxFragLookUpTolerance,l*(this.couldBacktrack?.5:.125)),l*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(c,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case z.KEY_LOADING:case z.FRAG_LOADING:case z.FRAG_LOADING_WAITING_RETRY:case z.PARSING:case z.PARSED:this.state=z.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const n=t.media;Rt(n,"playing",this.onMediaPlaying),Rt(n,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:n}=this;n&&(Bt(n,"playing",this.onMediaPlaying),Bt(n,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(S.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let n=!1,i=!1;for(let s=0;s<t.levels.length;s++){const a=t.levels[s].audioCodec;a&&(n=n||a.indexOf("mp4a.40.2")!==-1,i=i||a.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=n&&i&&!t4(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:n}=this;if(!n||this.state!==z.IDLE)return;const i=t.levelInfo;(!i.details||i.details.live&&(this.levelLastLoaded!==i||i.details.expired)||this.waitForCdnTuneIn(i.details))&&(this.state=z.WAITING_LEVEL)}onLevelLoaded(e,t){var n;const{levels:i,startFragRequested:s}=this,a=t.level,o=t.details,u=o.totalduration;if(!i){this.warn(`Levels were reset while loading level ${a}`);return}this.log(`Level ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""}, cc [${o.startCC}, ${o.endCC}] duration:${u}`);const l=t.levelInfo,c=this.fragCurrent;c&&(this.state===z.FRAG_LOADING||this.state===z.FRAG_LOADING_WAITING_RETRY)&&c.level!==t.level&&c.loader&&this.abortCurrentFrag();let d=0;if(o.live||(n=l.details)!=null&&n.live){var f;if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;d=this.alignPlaylists(o,l.details,(f=this.levelLastLoaded)==null?void 0:f.details)}if(l.details=o,this.levelLastLoaded=l,s||this.setStartPosition(o,d),this.hls.trigger(S.LEVEL_UPDATED,{details:o,level:a}),this.state===z.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=z.IDLE}s&&o.live&&this.synchronizeToLiveEdge(o),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:n}=this;if(!n)return;const i=this.hls.liveSyncPosition,s=this.getLoadPosition(),a=e.fragmentStart,o=e.edge,u=s>=a-t.maxFragLookUpTolerance&&s<=o;if(i!==null&&n.duration>i&&(s<i||!u)){const c=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!u&&n.readyState<4||s<o-c)&&(this._hasEnoughToStart||(this.nextLoadPosition=i),n.readyState))if(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${o}, reset currentTime to : ${i.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var l;const d=ue.bufferInfo(n,i,0);if(!((l=d.buffered)!=null&&l.length)){n.currentTime=i;return}if(d.start<=s){n.currentTime=i;return}const{nextStart:h}=ue.bufferedInfo(d.buffered,s,0);h&&(n.currentTime=h)}else n.currentTime=i}}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:i,payload:s}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const o=a[n.level];if(!o){this.warn(`Level ${n.level} not found on progress`);return}const u=o.details;if(!u){this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),this.fragmentTracker.removeFragment(n);return}const l=o.videoCodec,c=u.PTSKnown||!u.live,d=(t=n.initSegment)==null?void 0:t.data,f=this._getAudioCodec(o),h=this.transmuxer=this.transmuxer||new uv(this.hls,ee.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),p=i?i.index:-1,x=p!==-1,v=new Uf(n.level,n.sn,n.stats.chunkCount,s.byteLength,p,x),y=this.initPTS[n.cc];h.push(s,d,f,l,n,i,u.totalduration,c,v,y)}onAudioTrackSwitching(e,t){const n=this.hls,i=this.altAudio===2;if(zo(t.url,n))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(i){this.fragmentTracker.removeAllFragments(),n.once(S.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(S.AUDIO_TRACK_SWITCHED,t)}),n.trigger(S.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}n.trigger(S.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const n=zo(t.url,this.hls);if(n){const i=this.videoBuffer;i&&this.mediaBuffer!==i&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=n?2:0,this.tick()}onBufferCreated(e,t){const n=t.tracks;let i,s,a=!1;for(const o in n){const u=n[o];if(u.id==="main"){if(s=o,i=u,o==="video"){const l=n[o];l&&(this.videoBuffer=l.buffer)}}else a=!0}a&&i?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:n,part:i}=t,s=n.type===ee.MAIN;if(s){if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${i?" p: "+i.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),this.state===z.PARSED&&(this.state=z.IDLE);return}const o=i?i.stats:n.stats;this.fragLastKbps=Math.round(8*o.total/(o.buffering.end-o.loading.first)),Xe(n)&&(this.fragPrevious=n),this.fragBufferedComplete(n,i)}const a=this.media;a&&(!this._hasEnoughToStart&&ue.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),s&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var n;if(t.fatal){this.state=z.ERROR;return}switch(t.details){case N.FRAG_GAP:case N.FRAG_PARSING_ERROR:case N.FRAG_DECRYPT_ERROR:case N.FRAG_LOAD_ERROR:case N.FRAG_LOAD_TIMEOUT:case N.KEY_LOAD_ERROR:case N.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ee.MAIN,t);break;case N.LEVEL_LOAD_ERROR:case N.LEVEL_LOAD_TIMEOUT:case N.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===z.WAITING_LEVEL&&((n=t.context)==null?void 0:n.type)===me.LEVEL&&(this.state=z.IDLE);break;case N.BUFFER_ADD_CODEC_ERROR:case N.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case N.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case N.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=z.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Ie.AUDIO||!this.altAudio){const n=(t===Ie.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;n&&(this.afterBufferFlushed(n,t,ee.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let n=this.startPosition;if(n>=0&&t<n){if(e.seeking){this.log(`could not seek to ${n}, already seeking at ${t}`);return}const i=this.timelineOffset;i&&n&&(n+=i);const s=this.getLevelDetails(),a=ue.getBuffered(e),o=a.length?a.start(0):0,u=o-n,l=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||u>0&&(u<l||this.loadingParts&&u<2*((s==null?void 0:s.partTarget)||0)))&&(this.log(`adjusting start position by ${u} to match buffer start`),n+=u,this.startPosition=n),t<n&&(this.log(`seek to target start position ${n} from current time ${t} buffer start ${o}`),e.currentTime=n)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(n=>{const{hls:i}=this,s=n==null?void 0:n.frag;if(!s||this.fragContextChanged(s))return;t.fragmentError=0,this.state=z.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const a=s.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),i.trigger(S.FRAG_LOADED,n),s.bitrateTest=!1}).catch(n=>{this.state===z.STOPPED||this.state===z.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:n}=this,{remuxResult:i,chunkMeta:s}=e,a=this.getCurrentContext(s);if(!a){this.resetWhenMissingContext(s);return}const{frag:o,part:u,level:l}=a,{video:c,text:d,id3:f,initSegment:h}=i,{details:p}=l,x=this.altAudio?void 0:i.audio;if(this.fragContextChanged(o)){this.fragmentTracker.removeFragment(o);return}if(this.state=z.PARSING,h){const v=h.tracks;if(v){const E=o.initSegment||o;if(this.unhandledEncryptionError(h,o))return;this._bufferInitSegment(l,v,E,s),n.trigger(S.FRAG_PARSING_INIT_SEGMENT,{frag:E,id:t,tracks:v})}const y=h.initPTS,g=h.timescale,m=this.initPTS[o.cc];if(Z(y)&&(!m||m.baseTime!==y||m.timescale!==g)){const E=h.trackId;this.initPTS[o.cc]={baseTime:y,timescale:g,trackId:E},n.trigger(S.INIT_PTS_FOUND,{frag:o,id:t,initPTS:y,timescale:g,trackId:E})}}if(c&&p){x&&c.type==="audiovideo"&&this.logMuxedErr(o);const v=p.fragments[o.sn-1-p.startSN],y=o.sn===p.startSN,g=!v||o.cc>v.cc;if(i.independent!==!1){const{startPTS:m,endPTS:E,startDTS:T,endDTS:L}=c;if(u)u.elementaryStreams[c.type]={startPTS:m,endPTS:E,startDTS:T,endDTS:L};else if(c.firstKeyFrame&&c.independent&&s.id===1&&!g&&(this.couldBacktrack=!0),c.dropped&&c.independent){const A=this.getMainFwdBufferInfo(),R=(A?A.end:this.getLoadPosition())+this.config.maxBufferHole,I=c.firstKeyFramePTS?c.firstKeyFramePTS:m;if(!y&&R<I-this.config.maxBufferHole&&!g){this.backtrack(o);return}else g&&(o.gap=!0);o.setElementaryStreamInfo(c.type,o.start,E,o.start,L,!0)}else y&&m-(p.appliedTimelineOffset||0)>xo&&(o.gap=!0);o.setElementaryStreamInfo(c.type,m,E,T,L),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(c,o,u,s,y||g)}else if(y||g)o.gap=!0;else{this.backtrack(o);return}}if(x){const{startPTS:v,endPTS:y,startDTS:g,endDTS:m}=x;u&&(u.elementaryStreams[Ie.AUDIO]={startPTS:v,endPTS:y,startDTS:g,endDTS:m}),o.setElementaryStreamInfo(Ie.AUDIO,v,y,g,m),this.bufferFragmentData(x,o,u,s)}if(p&&f!=null&&f.samples.length){const v={id:t,frag:o,details:p,samples:f.samples};n.trigger(S.FRAG_PARSING_METADATA,v)}if(p&&d){const v={id:t,frag:o,details:p,samples:d.samples};n.trigger(S.FRAG_PARSING_USERDATA,v)}}logMuxedErr(e){this.warn(`${Xe(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,n,i){if(this.state!==z.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(n));const{audio:s,video:a,audiovideo:o}=t;if(s){const l=e.audioCodec;let c=uo(s.codec,l);c==="mp4a"&&(c="mp4a.40.5");const d=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){c&&(c.indexOf("mp4a.40.5")!==-1?c="mp4a.40.2":c="mp4a.40.5");const f=s.metadata;f&&"channelCount"in f&&(f.channelCount||1)!==1&&d.indexOf("firefox")===-1&&(c="mp4a.40.5")}c&&c.indexOf("mp4a.40.5")!==-1&&d.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(c="mp4a.40.2",this.log(`Android: force audio codec to ${c}`)),l&&l!==c&&this.log(`Swapping manifest audio codec "${l}" for "${c}"`),s.levelCodec=c,s.id=ee.MAIN,this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${c||""}/${l||""}/${s.codec}]`),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=ee.MAIN;const l=a.codec;if((l==null?void 0:l.length)===4)switch(l){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${l}]${a.codec!==l?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete t.audiovideo}o&&(this.log(`Init audiovideo buffer, container:${o.container}, codecs[level/parsed]=[${e.codecs}/${o.codec}]`),delete t.video,delete t.audio);const u=Object.keys(t);if(u.length){if(this.hls.trigger(S.BUFFER_CODECS,t),!this.hls)return;u.forEach(l=>{const d=t[l].initSegment;d!=null&&d.byteLength&&this.hls.trigger(S.BUFFER_APPENDING,{type:l,data:d,frag:n,part:null,chunkMeta:i,parent:n.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,ee.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,n=e==null?void 0:e[t];return n?this.getMaxBufferLength(n.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=z.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const n=e.currentTime;if(ue.isBuffered(e,n)?t=this.getAppendedFrag(n):ue.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;const i=this.fragPlaying,s=t.level;(!i||t.sn!==i.sn||i.level!==s)&&(this.fragPlaying=t,this.hls.trigger(S.FRAG_CHANGED,{frag:t}),(!i||i.level!==s)&&this.hls.trigger(S.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return Z(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(Z(t)){const n=this.getLevelDetails(),i=this.currentFrag||(n?Qn(null,n.fragments,t):null);if(i){const s=i.programDateTime;if(s!==null){const a=s+(t-i.start)*1e3;return new Date(a)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class i4 extends lr{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const n in this.keyIdToKeyInfo){const i=this.keyIdToKeyInfo[n].loader;if(i){var t;if(e&&e!==((t=i.context)==null?void 0:t.frag.type))return;i.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=N.KEY_LOAD_ERROR,n,i,s){return new Ur({type:re.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:n,networkDetails:i})}loadClear(e,t,n){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let i=0,s=t.length;i<s;i++){const a=t[i];if(e.cc<=a.cc&&(!Xe(e)||!Xe(a)||e.sn<a.sn)||!n&&i==s-1)return this.emeController.selectKeySystemFormat(a).then(o=>{if(!this.emeController)return;a.setKeyFormat(o);const u=fo(o);if(u)return this.emeController.getKeySystemAccess([u])})}if(this.config.requireKeySystemAccessOnStart){const i=ps(this.config);if(i.length)return this.emeController.getKeySystemAccess(i)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var n,i;t&&e.setKeyFormat(t);const s=e.decryptdata;if(!s){const l=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,N.KEY_LOAD_ERROR,l))}const a=s.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,N.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));const o=Ru(s);let u=this.keyIdToKeyInfo[o];if((n=u)!=null&&n.decryptdata.key)return s.key=u.decryptdata.key,Promise.resolve({frag:e,keyInfo:u});if(this.emeController&&(i=u)!=null&&i.keyLoadPromise)switch(this.emeController.getKeyStatus(u.decryptdata)){case"usable":case"usable-in-future":return u.keyLoadPromise.then(c=>{const{keyInfo:d}=c;return s.key=d.decryptdata.key,{frag:e,keyInfo:d}})}switch(this.log(`${this.keyIdToKeyInfo[o]?"Rel":"L"}oading${s.keyId?" keyId: "+Lt(s.keyId):""} URI: ${s.uri} from ${e.type} ${e.level}`),u=this.keyIdToKeyInfo[o]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(u,e):this.loadKeyEME(u,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(u,e);default:return Promise.reject(this.createKeyLoadError(e,N.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){const n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var i;if(!e.decryptdata.keyId&&(i=t.initSegment)!=null&&i.data){const a=AT(t.initSegment.data);if(a.length){const o=a[0];o.some(u=>u!==0)&&(this.log(`Using keyId found in init segment ${Lt(o)}`),e.decryptdata.keyId=o,Kn.setKeyIdForUri(e.decryptdata.uri,o))}}const s=this.emeController.loadKey(n);return(e.keyLoadPromise=s.then(a=>(e.mediaKeySessionContext=a,n))).catch(a=>{throw e.keyLoadPromise=null,"data"in a&&(a.data.frag=t),a})}return Promise.resolve(n)}loadKeyHTTP(e,t){const n=this.config,i=n.loader,s=new i(n);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((a,o)=>{const u={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},l=n.keyLoadPolicy.default,c={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,h,p,x)=>{const{frag:v,keyInfo:y}=p,g=Ru(y.decryptdata);if(!v.decryptdata||y!==this.keyIdToKeyInfo[g])return o(this.createKeyLoadError(v,N.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),x));y.decryptdata.key=v.decryptdata.key=new Uint8Array(f.data),v.keyLoader=null,y.loader=null,a({frag:v,keyInfo:y})},onError:(f,h,p,x)=>{this.resetLoader(h),o(this.createKeyLoadError(t,N.KEY_LOAD_ERROR,new Error(`HTTP Error ${f.code} loading key ${f.text}`),p,Ae({url:u.url,data:void 0},f)))},onTimeout:(f,h,p)=>{this.resetLoader(h),o(this.createKeyLoadError(t,N.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),p))},onAbort:(f,h,p)=>{this.resetLoader(h),o(this.createKeyLoadError(t,N.INTERNAL_ABORTED,new Error("key loading aborted"),p))}};s.load(u,c,d)})}resetLoader(e){const{frag:t,keyInfo:n,url:i}=e,s=n.loader;t.keyLoader===s&&(t.keyLoader=null,n.loader=null);const a=Ru(n.decryptdata)||i;delete this.keyIdToKeyInfo[a],s&&s.destroy()}}function Ru(r){if(r.keyFormat!==ct.FAIRPLAY){const e=r.keyId;if(e)return Lt(e)}return r.uri}function Wp(r){const{type:e}=r;switch(e){case me.AUDIO_TRACK:return ee.AUDIO;case me.SUBTITLE_TRACK:return ee.SUBTITLE;default:return ee.MAIN}}function Iu(r,e){let t=r.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class s4{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(S.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(S.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,n=t.pLoader,i=t.loader,s=n||i,a=new s(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:me.MANIFEST,url:n,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:n,level:i,pathwayId:s,url:a,deliveryDirectives:o,levelInfo:u}=t;this.load({id:n,level:i,pathwayId:s,responseType:"text",type:me.LEVEL,url:a,deliveryDirectives:o,levelOrTrack:u})}onAudioTrackLoading(e,t){const{id:n,groupId:i,url:s,deliveryDirectives:a,track:o}=t;this.load({id:n,groupId:i,level:null,responseType:"text",type:me.AUDIO_TRACK,url:s,deliveryDirectives:a,levelOrTrack:o})}onSubtitleTrackLoading(e,t){const{id:n,groupId:i,url:s,deliveryDirectives:a,track:o}=t;this.load({id:n,groupId:i,level:null,responseType:"text",type:me.SUBTITLE_TRACK,url:s,deliveryDirectives:a,levelOrTrack:o})}onLevelsUpdated(e,t){const n=this.loaders[me.LEVEL];if(n){const i=n.context;i&&!t.levels.some(s=>s===i.levelOrTrack)&&(n.abort(),delete this.loaders[me.LEVEL])}}load(e){var t;const n=this.hls.config;let i=this.getInternalLoader(e);if(i){const l=this.hls.logger,c=i.context;if(c&&c.levelOrTrack===e.levelOrTrack&&(c.url===e.url||c.deliveryDirectives&&!e.deliveryDirectives)){c.url===e.url?l.log(`[playlist-loader]: ignore ${e.url} ongoing request`):l.log(`[playlist-loader]: ignore ${e.url} in favor of ${c.url}`);return}l.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),i.abort()}let s;if(e.type===me.MANIFEST?s=n.manifestLoadPolicy.default:s=Re({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(e),Z((t=e.deliveryDirectives)==null?void 0:t.part)){let l;if(e.type===me.LEVEL&&e.level!==null?l=this.hls.levels[e.level].details:e.type===me.AUDIO_TRACK&&e.id!==null?l=this.hls.audioTracks[e.id].details:e.type===me.SUBTITLE_TRACK&&e.id!==null&&(l=this.hls.subtitleTracks[e.id].details),l){const c=l.partTarget,d=l.targetduration;if(c&&d){const f=Math.max(c*3,d*.8)*1e3;s=Re({},s,{maxTimeToFirstByteMs:Math.min(f,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(f,s.maxTimeToFirstByteMs)})}}}const a=s.errorRetry||s.timeoutRetry||{},o={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},u={onSuccess:(l,c,d,f)=>{const h=this.getInternalLoader(d);this.resetInternalLoader(d.type);const p=l.data;c.parsing.start=performance.now(),kr.isMediaPlaylist(p)||d.type!==me.MANIFEST?this.handleTrackOrLevelPlaylist(l,c,d,f||null,h):this.handleMasterPlaylist(l,c,d,f)},onError:(l,c,d,f)=>{this.handleNetworkError(c,d,!1,l,f)},onTimeout:(l,c,d)=>{this.handleNetworkError(c,d,!0,void 0,l)}};i.load(e,o,u)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:n}=this.hls;(e||n)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,n,i){const s=this.hls,a=e.data,o=Iu(e,n),u=kr.parseMasterPlaylist(a,o);if(u.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,n,u.playlistParsingError,i,t);return}const{contentSteering:l,levels:c,sessionData:d,sessionKeys:f,startTimeOffset:h,variableList:p}=u;this.variableList=p,c.forEach(g=>{const{unknownCodecs:m}=g;if(m){const{preferManagedMediaSource:E}=this.hls.config;let{audioCodec:T,videoCodec:L}=g;for(let A=m.length;A--;){const R=m[A];Ks(R,"audio",E)?(g.audioCodec=T=T?`${T},${R}`:R,Gi.audio[T.substring(0,4)]=2,m.splice(A,1)):Ks(R,"video",E)&&(g.videoCodec=L=L?`${L},${R}`:R,Gi.video[L.substring(0,4)]=2,m.splice(A,1))}}});const{AUDIO:x=[],SUBTITLES:v,"CLOSED-CAPTIONS":y}=kr.parseMasterPlaylistMedia(a,o,u);x.length&&!x.some(m=>!m.url)&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),x.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new $e({}),bitrate:0,url:""})),s.trigger(S.MANIFEST_LOADED,{levels:c,audioTracks:x,subtitles:v,captions:y,contentSteering:l,url:o,stats:t,networkDetails:i,sessionData:d,sessionKeys:f,startTimeOffset:h,variableList:p})}handleTrackOrLevelPlaylist(e,t,n,i,s){const a=this.hls,{id:o,level:u,type:l}=n,c=Iu(e,n),d=Z(u)?u:Z(o)?o:0,f=Wp(n),h=kr.parseLevelPlaylist(e.data,c,d,f,0,this.variableList);if(l===me.MANIFEST){const p={attrs:new $e({}),bitrate:0,details:h,name:"",url:c};h.requestScheduled=t.loading.start+Nx(h,0),a.trigger(S.MANIFEST_LOADED,{levels:[p],audioTracks:[],url:c,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=h,this.handlePlaylistLoaded(h,e,t,n,i,s)}handleManifestParsingError(e,t,n,i,s){this.hls.trigger(S.ERROR,{type:re.NETWORK_ERROR,details:N.MANIFEST_PARSING_ERROR,fatal:t.type===me.MANIFEST,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:i,stats:s})}handleNetworkError(e,t,n=!1,i,s){let a=`A network ${n?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===me.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===me.AUDIO_TRACK||e.type===me.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const o=new Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let u=N.UNKNOWN,l=!1;const c=this.getInternalLoader(e);switch(e.type){case me.MANIFEST:u=n?N.MANIFEST_LOAD_TIMEOUT:N.MANIFEST_LOAD_ERROR,l=!0;break;case me.LEVEL:u=n?N.LEVEL_LOAD_TIMEOUT:N.LEVEL_LOAD_ERROR,l=!1;break;case me.AUDIO_TRACK:u=n?N.AUDIO_TRACK_LOAD_TIMEOUT:N.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case me.SUBTITLE_TRACK:u=n?N.SUBTITLE_TRACK_LOAD_TIMEOUT:N.SUBTITLE_LOAD_ERROR,l=!1;break}c&&this.resetInternalLoader(e.type);const d={type:re.NETWORK_ERROR,details:u,fatal:l,url:e.url,loader:c,context:e,error:o,networkDetails:t,stats:s};if(i){const f=(t==null?void 0:t.url)||e.url;d.response=Ae({url:f,data:void 0},i)}this.hls.trigger(S.ERROR,d)}handlePlaylistLoaded(e,t,n,i,s,a){const o=this.hls,{type:u,level:l,levelOrTrack:c,id:d,groupId:f,deliveryDirectives:h}=i,p=Iu(t,i),x=Wp(i);let v=typeof i.level=="number"&&x===ee.MAIN?l:void 0;const y=e.playlistParsingError;if(y){if(this.hls.logger.warn(`${y} ${e.url}`),!o.config.ignorePlaylistParsingErrors){o.trigger(S.ERROR,{type:re.NETWORK_ERROR,details:N.LEVEL_PARSING_ERROR,fatal:!1,url:p,error:y,reason:y.message,response:t,context:i,level:v,parent:x,networkDetails:s,stats:n});return}e.playlistParsingError=null}if(!e.fragments.length){const g=e.playlistParsingError=new Error("No Segments found in Playlist");o.trigger(S.ERROR,{type:re.NETWORK_ERROR,details:N.LEVEL_EMPTY_ERROR,fatal:!1,url:p,error:g,reason:g.message,response:t,context:i,level:v,parent:x,networkDetails:s,stats:n});return}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),u){case me.MANIFEST:case me.LEVEL:if(v){if(!c)v=0;else if(c!==o.levels[v]){const g=o.levels.indexOf(c);g>-1&&(v=g)}}o.trigger(S.LEVEL_LOADED,{details:e,levelInfo:c||o.levels[0],level:v||0,id:d||0,stats:n,networkDetails:s,deliveryDirectives:h,withoutMultiVariant:u===me.MANIFEST});break;case me.AUDIO_TRACK:o.trigger(S.AUDIO_TRACK_LOADED,{details:e,track:c,id:d||0,groupId:f||"",stats:n,networkDetails:s,deliveryDirectives:h});break;case me.SUBTITLE_TRACK:o.trigger(S.SUBTITLE_TRACK_LOADED,{details:e,track:c,id:d||0,groupId:f||"",stats:n,networkDetails:s,deliveryDirectives:h});break}}}class Ct{static get version(){return Ys}static isMSESupported(){return Mv()}static isSupported(){return e4()}static getMediaSource(){return An()}static get Events(){return S}static get MetadataSchema(){return Wt}static get ErrorTypes(){return re}static get ErrorDetails(){return N}static get DefaultConfig(){return Ct.defaultConfig?Ct.defaultConfig:H8}static set DefaultConfig(e){Ct.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new jf,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=dT(e.debug||!1,"Hls instance",e.assetPlayerId),n=this.config=j8(Ct.DefaultConfig,e,t);this.userConfig=e,n.progressive&&K8(n,t);const{abrController:i,bufferController:s,capLevelController:a,errorController:o,fpsController:u}=n,l=new o(this),c=this.abrController=new i(this),d=new aA(this),f=n.interstitialsController,h=f?this.interstitialsController=new f(this,Ct):null,p=this.bufferController=new s(this,d),x=this.capLevelController=new a(this),v=new u(this),y=new s4(this),g=n.contentSteeringController,m=g?new g(this):null,E=this.levelController=new J8(this,m),T=new Q8(this),L=new i4(this.config,this.logger),A=this.streamController=new n4(this,d,L),R=this.gapController=new q8(this,d);x.setStreamController(A),v.setStreamController(A);const I=[y,E,A];h&&I.splice(1,0,h),m&&I.splice(1,0,m),this.networkControllers=I;const C=[c,p,R,x,v,T,d];this.audioTrackController=this.createController(n.audioTrackController,I);const _=n.audioStreamController;_&&I.push(this.audioStreamController=new _(this,d,L)),this.subtitleTrackController=this.createController(n.subtitleTrackController,I);const F=n.subtitleStreamController;F&&I.push(this.subtititleStreamController=new F(this,d,L)),this.createController(n.timelineController,C),L.emeController=this.emeController=this.createController(n.emeController,C),this.cmcdController=this.createController(n.cmcdController,C),this.latencyController=this.createController(Z8,C),this.coreComponents=C,I.push(l);const B=l.onErrorOut;typeof B=="function"&&this.on(S.ERROR,B,l),this.on(S.MANIFEST_LOADED,y.onManifestLoaded,y)}createController(e,t){if(e){const n=new e(this);return t&&t.push(n),n}return null}on(e,t,n=this){this._emitter.on(e,t,n)}once(e,t,n=this){this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,n=this,i){this._emitter.off(e,t,n,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(n){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),!this.triggeringException){this.triggeringException=!0;const i=e===S.ERROR;this.trigger(S.ERROR,{type:re.OTHER_ERROR,details:N.INTERNAL_EXCEPTION,fatal:i,event:e,error:n}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(S.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const s=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(S.ERROR,{type:re.OTHER_ERROR,details:N.ATTACH_MEDIA_ERROR,fatal:!0,error:s});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,n=t?e.media:e,i=t?e:{media:n};this._media=n,this.trigger(S.MEDIA_ATTACHING,i)}detachMedia(){this.logger.log("detachMedia"),this.trigger(S.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(S.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,n=this._url,i=this._url=Pf.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${i}`),t&&n&&(n!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(S.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let n=0;n<this.networkControllers.length&&(this.networkControllers[n].startLoad(e,t),!(!this.started||!this.networkControllers));n++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[ee.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[ee.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[ee.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=qL()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){jT(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const n=e.length;for(let i=0;i<n;i++)if(e[i].maxBitrate>=t)return i;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this;let i;if(t===-1&&e!=null&&e.length?i=e.length-1:i=t,n)for(let s=i;s--;){const a=e[s].attrs["HDCP-LEVEL"];if(a&&a<=n)return s}return i}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const n=Ax(t);return Sx(e,n,navigator.mediaCapabilities)}}Ct.defaultConfig=void 0;const Yp="https://corsproxy.io/?";async function a4(r){try{const e=`https://libre-subs.fifthwit.net/search?id=${r.tmdb}`;let t;r.type==="movie"?t=e:t=`${e}&season=${r.season}&episode=${r.episode}`;const n=Yp+encodeURIComponent(t),i=await fetch(n);if(!i.ok)throw new Error("Failed to fetch subtitles");return(await i.json()).map(a=>({url:Yp+encodeURIComponent(a.url),lang:a.language,type:a.format}))}catch(e){return console.error("Subtitle fetch error:",e),[]}}function qp(r){return{English:"English",Spanish:"Spanish",French:"French",German:"German",Italian:"Italian",Portuguese:"Portuguese",RUS:"Russian",JAPANESSE:"Japanese",KOREAN:"Korean",CHINESE:"Chinese",Arabic:"Arabic",hindi:"Hindi",TURKISH:"Turkish",POLISH:"Polish",Dutch:"Dutch",SWEDISH:"Swedish",NORWEG:"Norwegian",DANISH:"Danish",FINNISH:"Finnish",GREEK:"Greek",HEBREW:"Hebrew",TAI:"Thai",VITNAM:"Vietnamese",Indonesian:"Indonesian",MALAY:"Malay",ROMANIAN:"Romanian",Czech:"Czech",HUNGARIAN:"Hungarian",Ukrainian:"Ukrainian"}[r]||r.toUpperCase()}const o4=async r=>{try{const t=await(await fetch(r)).text();let n=`WEBVTT

`;n+=t.replace(/(\d+:\d+:\d+),(\d+)/g,"$1.$2");const i=new Blob([n],{type:"text/vtt"});return URL.createObjectURL(i)}catch(e){throw console.error("SRT to VTT conversion error:",e),e}},Id="video-player-settings",_d="video-player-progress",_u=2,li=r=>{try{const t={...Dd(),...r};localStorage.setItem(Id,JSON.stringify(t))}catch(e){console.error("Failed to save player settings:",e)}},Dd=()=>{try{const r=localStorage.getItem(Id);if(r){const e=JSON.parse(r);return(!e.settingsVersion||e.settingsVersion<_u)&&(e.subtitleSettings.position=80,e.settingsVersion=_u,localStorage.setItem(Id,JSON.stringify(e))),e}}catch(r){console.error("Failed to load player settings:",r)}return{volume:1,isMuted:!1,playbackRate:1,subtitleSettings:{color:"#FFFFFF",size:100,backgroundOpacity:0,position:80,timing:0},preferredQuality:"-1",preferredSubtitleLang:"en",favoriteServer:void 0,settingsVersion:_u}},Xp=(r,e,t)=>{try{const n=localStorage.getItem(_d),i=n?JSON.parse(n):{};i[r]={currentTime:e,duration:t,timestamp:Date.now()},localStorage.setItem(_d,JSON.stringify(i))}catch(n){console.error("Failed to save video progress:",n)}},l4=r=>{try{const e=localStorage.getItem(_d);if(e){const n=JSON.parse(e)[r];if(n&&n.currentTime/n.duration*100<95)return{currentTime:n.currentTime,duration:n.duration}}}catch(e){console.error("Failed to load video progress:",e)}return null},Nv=({sources:r,mediaInfo:e,videoId:t="default",onError:n})=>{const i=b.useRef(null),s=b.useRef(null),a=b.useRef(null),o=b.useRef(null),u=b.useRef(!1),l=b.useRef([]),c=b.useRef(null),d=b.useRef(0),f=b.useRef(new Set),h=b.useRef(0),p=b.useRef(0),x=b.useRef(""),v=b.useMemo(()=>Dd(),[]),[y,g]=b.useState(v.favoriteServer),[m,E]=b.useState(""),[T,L]=b.useState(!1),[A,R]=b.useState(0),[I,C]=b.useState(0),[_,F]=b.useState(v.volume),[B,V]=b.useState(v.isMuted),[j,G]=b.useState(!1),[Y,O]=b.useState(0),[H,K]=b.useState(!0),[w,P]=b.useState(!1),[U,$]=b.useState(!1),[Q,J]=b.useState(v.playbackRate),[he,ne]=b.useState(!1),[Fe,Be]=b.useState(!1),[$t,Ut]=b.useState(!1),[at,Ye]=b.useState(!1),[Dn,fe]=b.useState(0),[Oe,ze]=b.useState(!1),[kt,qe]=b.useState([]),[Te,Me]=b.useState(v.preferredQuality),[Ne,wt]=b.useState([]),[ht,Et]=b.useState(null),[ur,ri]=b.useState(!1),[Br,Gt]=b.useState(null),[ot,Ht]=b.useState(!1),[sa,en]=b.useState(!1),[Ee,kn]=b.useState(v.subtitleSettings),[aa,qi]=b.useState(!1),[Tl,oa]=b.useState(!0),[Al,Xi]=b.useState(!1),[Qi,Cl]=b.useState(!1),[Ll,la]=b.useState(!0),[Rl,Il]=b.useState(!1),[ua,ca]=b.useState(!1),[da,St]=b.useState(!1),Tt=b.useRef(null),[wn,bn]=b.useState({}),[s0,a0]=b.useState(!1),[Hv,o0]=b.useState(""),l0=b.useCallback(k=>{if(isNaN(k))return"0:00";const W=Math.floor(k/3600),q=Math.floor(k%3600/60),ie=Math.floor(k%60);return W>0?`${W}:${q.toString().padStart(2,"0")}:${ie.toString().padStart(2,"0")}`:`${q}:${ie.toString().padStart(2,"0")}`},[]),Vv=b.useCallback(k=>{const W=y===k?void 0:k;g(W),li({favoriteServer:W})},[y]),jv=b.useCallback(()=>{var k;document.fullscreenElement?document.exitFullscreen():(k=a.current)==null||k.requestFullscreen()},[]),Kv=async()=>{if(e!=null&&e.tmdb){ri(!0);try{const k=[...Ne],W=await a4(e);W.forEach(q=>{k.some(ie=>ie.lang===q.lang)||k.push(q)}),wt(k),console.log(` Added ${W.length} libre-subs subtitles`)}catch(k){console.error("Failed to load libre-subs:",k)}finally{ri(!1)}}},fa=k=>{const W=i.current;if(!W)return;const q=W.textTracks;for(let se=0;se<q.length;se++)q[se].mode="disabled";if(W.querySelectorAll("track").forEach(se=>se.remove()),k){qi(!1);const se=k.type==="srt"||k.url.includes("format=srt"),de=le=>{const ce=document.createElement("track");ce.kind="subtitles",ce.label=qp(k.lang),ce.srclang=k.lang,ce.src=le,ce.default=!0,W.appendChild(ce),ce.addEventListener("load",()=>{const oe=ce.track;if(oe.mode="showing",Ee.timing!==0&&oe.cues){const Se=Ee.timing/1e3;for(let pt=0;pt<oe.cues.length;pt++){const gt=oe.cues[pt];gt&&(gt.startTime=Math.max(0,gt.startTime+Se),gt.endTime=Math.max(0,gt.endTime+Se))}}}),ce.track.mode="showing",Et(k.url)};se?o4(k.url).then(le=>{l.current.push(le),de(le)}).catch(le=>{console.error("Failed to convert subtitle:",le),de(k.url)}):de(k.url)}else qi(!0),Et(null)},zv=k=>{var ie;const W=(ie=k.target.files)==null?void 0:ie[0];if(!W)return;const q=new FileReader;q.onload=async se=>{var gt;const de=(gt=se.target)==null?void 0:gt.result,le=W.name.endsWith(".srt")||!de.startsWith("WEBVTT");let ce=de;le&&(ce=`WEBVTT

`+de.replace(/(\d+:\d+:\d+),(\d+)/g,"$1.$2"));const oe=new Blob([ce],{type:"text/vtt"}),Se=URL.createObjectURL(oe);l.current.push(Se);const pt={lang:"custom",url:Se,type:"vtt"};wt([...Ne,pt]),fa(pt)},q.readAsText(W)},ha=k=>{const W=Object.keys(r),q=W.indexOf(k);let ie=W.find((se,de)=>{if(de<=q||f.current.has(se))return!1;const le=r[se],ce=typeof le=="string"?le:le.url,oe=wn[se];return ce&&ce!==""&&oe==="online"});return ie||(ie=W.find((se,de)=>{if(de<=q||f.current.has(se))return!1;const le=r[se],ce=typeof le=="string"?le:le.url,oe=wn[se];return ce&&ce!==""&&oe!=="offline"})),ie||null},Wv=b.useCallback(async()=>{const k=i.current;if(k)try{document.pictureInPictureElement?await document.exitPictureInPicture():document.pictureInPictureEnabled&&await k.requestPictureInPicture()}catch(W){console.error("PiP error:",W)}},[]),Yv=b.useCallback(async()=>{const k=i.current;if(!(!k||!k.remote))try{const W=k.remote;W.state==="connected"?await W.prompt():await W.prompt()}catch(W){console.error("Cast error:",W)}},[]),pa=b.useCallback(async k=>{try{const W=r[k];if(!W){bn(ce=>({...ce,[k]:"offline"}));return}const q=typeof W=="string"?W:W.url,ie=typeof W=="object"?W.status:"online";if(!q||q===""||ie==="offline"){bn(ce=>({...ce,[k]:"offline"}));return}const se=new AbortController,de=setTimeout(()=>se.abort(),5e3),le=await fetch(q,{method:"HEAD",signal:se.signal,cache:"no-cache"});clearTimeout(de),le.ok||le.status===403||le.status===405?bn(ce=>({...ce,[k]:"online"})):bn(ce=>({...ce,[k]:"offline"}))}catch{bn(q=>({...q,[k]:"offline"}))}},[r]),Or=(k,W=!1)=>{_l(k,W),pa(k)},_l=(k,W=!1)=>{const q=i.current;if(!q)return;if(W&&f.current.clear(),f.current.has(k)){console.warn(`Server ${k} already failed, skipping`);const oe=ha(k);if(oe)Or(oe,!1);else{console.log("All servers tried, restarting from first server..."),f.current.clear();const Se=Object.keys(r);Se.length>0&&Or(Se[0],!1)}return}const ie=r[k];if(!ie){console.error(`Source ${k} not found`),f.current.add(k);return}const se=typeof ie=="string"?ie:ie.url;if((typeof ie=="object"?ie.type:"hls")==="iframe"){console.log(`Loading iframe fallback: ${k}`);let oe=se;e&&(e.type==="movie"?oe=`${se}/movie/${e.tmdb}`:e.type==="tv"&&e.season&&e.episode&&(oe=`${se}/tv/${e.tmdb}/${e.season}/${e.episode}`)),o0(oe),a0(!0),Be(!1),E(k);return}if(!se||se===""){console.error(`${k} has no URL`),f.current.add(k);const oe=ha(k);if(oe)Or(oe,!1);else{console.log("All servers have no URL, restarting from first server..."),f.current.clear();const Se=Object.keys(r);Se.length>0&&Or(Se[0],!1)}return}s0&&(a0(!1),o0(""));const le=q.currentTime,ce=!q.paused;if(Be(!0),E(k),qe([]),ie.subtitles&&ie.subtitles.length>0?(wt(ie.subtitles),console.log(`Loaded ${ie.subtitles.length} subtitles from ${k}`)):(wt([]),console.log(`No subtitles available for ${k}`)),s.current&&(s.current.destroy(),s.current=null),Ct.isSupported()){const oe=new Ct({enableWorker:!0,lowLatencyMode:!0,backBufferLength:90,maxBufferLength:30,maxMaxBufferLength:600,maxBufferSize:6e7,maxBufferHole:.5,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveDurationInfinity:!1,preferManagedMediaSource:!0,fragLoadingTimeOut:2e4,manifestLoadingTimeOut:1e4,fragLoadingMaxRetry:6,manifestLoadingMaxRetry:4,fragLoadingMaxRetryTimeout:64e3,manifestLoadingMaxRetryTimeout:64e3});s.current=oe,oe.loadSource(se),oe.attachMedia(q),oe.on(Ct.Events.MANIFEST_PARSED,()=>{Be(!1);const g0=oe.levels.map((Pn,Sr)=>({height:Pn.height,bitrate:Pn.bitrate,level:Sr}));qe(g0),Me("-1"),oe.currentLevel=-1,le>0&&(q.currentTime=le),ce&&q.play()});let Se=0,pt=0;const gt=3;oe.on(Ct.Events.ERROR,(g0,Pn)=>{if(console.error("HLS Error:",Pn),!Pn.fatal){Pn.type===Ct.ErrorTypes.NETWORK_ERROR&&console.warn("Non-fatal network error, HLS will retry automatically");return}switch(Pn.type){case Ct.ErrorTypes.NETWORK_ERROR:if(console.error("Fatal network error, attempting recovery..."),Se++,Se<=gt)console.log(`Network recovery attempt ${Se}/${gt}`),setTimeout(()=>{var Sr;oe&&!((Sr=oe.media)!=null&&Sr.paused)&&oe.startLoad()},1e3),setTimeout(()=>{if(q.paused&&q.readyState<2){console.error("Network recovery failed, trying next server..."),Se=0,f.current.add(k);const Sr=ha(k);if(Sr)Or(Sr,!1);else{console.log("All servers failed, restarting from first server..."),f.current.clear();const Ji=Object.keys(r);Ji.length>0&&Or(Ji[0],!1)}}},3e3);else{console.error("Max network recovery attempts reached, switching server..."),Se=0,f.current.add(k);const Sr=ha(k);if(Sr)Or(Sr,!1);else{console.log("Max recovery attempts on all servers, restarting from first server..."),f.current.clear();const Ji=Object.keys(r);Ji.length>0&&Or(Ji[0],!1)}}break;case Ct.ErrorTypes.MEDIA_ERROR:console.error("Fatal media error, attempting recovery..."),pt++,pt<=gt?(console.log(`Media recovery attempt ${pt}/${gt}`),setTimeout(()=>{oe&&oe.recoverMediaError()},500)):(console.error("Media recovery failed, trying to swap audio codec..."),oe.swapAudioCodec(),oe.recoverMediaError(),pt=0);break;default:console.error("Fatal unrecoverable error, destroying HLS instance"),oe.destroy(),n==null||n("Fatal playback error occurred");break}}),oe.on(Ct.Events.FRAG_LOADED,()=>{(Se>0||pt>0)&&(console.log("Playback recovered successfully, resetting error counters"),Se=0,pt=0)})}else q.canPlayType("application/vnd.apple.mpegurl")?(q.src=se,q.addEventListener("loadedmetadata",()=>{Be(!1),le>0&&(q.currentTime=le),ce&&q.play()})):(Be(!1),n==null||n("HLS not supported in this browser"))},u0=k=>{const W=s.current,q=i.current;if(!W||!q){console.warn("Cannot change quality: HLS or video not available");return}if(W.media!==q){console.warn("Cannot change quality: HLS media mismatch");return}if(k!==-1&&(k<0||k>=W.levels.length)){console.warn(`Invalid quality level: ${k}`);return}W.currentLevel=k,Me(k.toString()),$(!1),Gt(null)};b.useEffect(()=>{const k=Object.keys(r);k.length>0&&!m&&_l(k[0],!0)},[r]),b.useEffect(()=>{if(!m)return;pa(m);const k=setInterval(()=>{pa(m)},3e4);return()=>clearInterval(k)},[m,pa]),b.useEffect(()=>{const k=i.current;if(!k)return;Il("pictureInPictureEnabled"in document),St("remote"in k);const W=()=>ca(!0),q=()=>ca(!1);return k.addEventListener("enterpictureinpicture",W),k.addEventListener("leavepictureinpicture",q),()=>{k.removeEventListener("enterpictureinpicture",W),k.removeEventListener("leavepictureinpicture",q)}},[]),b.useEffect(()=>{const k=i.current;if(!k)return;const W=()=>{L(!0),la(!1),o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{u.current||K(!1)},2e3)},q=()=>L(!1),ie=()=>{const le=Date.now();if(!(le-h.current<100)&&(h.current=le,R(k.currentTime),k.buffered.length>0)){const ce=k.buffered.end(k.buffered.length-1);O(ce/k.duration*100)}},se=()=>C(k.duration),de=()=>{F(k.volume),V(k.muted)};return k.addEventListener("play",W),k.addEventListener("pause",q),k.addEventListener("timeupdate",ie),k.addEventListener("durationchange",se),k.addEventListener("volumechange",de),()=>{k.removeEventListener("play",W),k.removeEventListener("pause",q),k.removeEventListener("timeupdate",ie),k.removeEventListener("durationchange",se),k.removeEventListener("volumechange",de)}},[]),b.useEffect(()=>{const k=W=>{const q=i.current;if(q)switch(W.key){case" ":case"k":W.preventDefault(),Zi();break;case"f":h0();break;case"m":f0();break;case"ArrowLeft":q.currentTime=Math.max(0,q.currentTime-10);break;case"ArrowRight":q.currentTime=Math.min(q.duration,q.currentTime+10);break;case"ArrowUp":W.preventDefault(),q.volume=Math.min(1,q.volume+.1);break;case"ArrowDown":W.preventDefault(),q.volume=Math.max(0,q.volume-.1);break}};return window.addEventListener("keydown",k),()=>window.removeEventListener("keydown",k)},[T]),b.useEffect(()=>{const k=()=>{ne(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",k),()=>document.removeEventListener("fullscreenchange",k)},[]),b.useEffect(()=>{const k=i.current;if(!k)return;const W=()=>{const q=window.matchMedia("(orientation: landscape)").matches;/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)&&(q&&T&&!document.fullscreenElement&&setTimeout(()=>{var se;(se=a.current)==null||se.requestFullscreen().catch(de=>{console.log("Fullscreen request on orientation change failed:",de)})},300),setTimeout(()=>{k&&(k.style.width="100%",k.style.height="100%")},100)),K(!0),o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{T&&!u.current&&K(!1)},3e3)};return window.addEventListener("orientationchange",W),window.addEventListener("resize",W),screen.orientation&&screen.orientation.addEventListener("change",W),()=>{window.removeEventListener("orientationchange",W),window.removeEventListener("resize",W),screen.orientation&&screen.orientation.removeEventListener("change",W)}},[T]),b.useEffect(()=>()=>{s.current&&(s.current.destroy(),s.current=null),l.current.forEach(W=>{URL.revokeObjectURL(W)}),l.current=[],o.current&&(clearTimeout(o.current),o.current=null),Tt.current&&(clearTimeout(Tt.current),Tt.current=null);const k=i.current;k&&(k.pause(),k.removeAttribute("src"),k.load())},[]),b.useEffect(()=>{y&&r[y]&&r[y].status==="online"&&_l(y,!0)},[r,y]),b.useEffect(()=>{if(j)return window.addEventListener("mousemove",c0),window.addEventListener("mouseup",d0),()=>{window.removeEventListener("mousemove",c0),window.removeEventListener("mouseup",d0)}},[j]);const Zi=b.useCallback(()=>{const k=i.current;k&&(Qi||(Cl(!0),oa(!1)),Xi(!0),Tt.current&&clearTimeout(Tt.current),Tt.current=setTimeout(()=>{Xi(!1)},500),k.paused?k.play():k.pause())},[Qi]);b.useEffect(()=>{const k=i.current;if(!k)return;let W=document.getElementById("subtitle-custom-style");W||(W=document.createElement("style"),W.id="subtitle-custom-style",document.head.appendChild(W));const q=`
    video::cue {
      color: ${Ee.color} !important;
      font-size: ${Ee.size}% !important;
      background-color: rgba(0, 0, 0, ${Ee.backgroundOpacity/100}) !important;
      line-height: 1.4 !important;
      text-align: center !important;
    }
  `;x.current!==q&&(W.textContent=q,x.current=q);const ie=()=>{const de=k.textTracks;for(let le=0;le<de.length;le++)if(de[le].mode==="showing"){const ce=de[le].cues;if(ce)for(let oe=0;oe<ce.length;oe++){const Se=ce[oe];Se&&(Se.snapToLines=!1,Se.line=Ee.position,Se.position=50,Se.align="center",Se.size=100,Se.vertical="")}}};ie();const se=k.textTracks;for(let de=0;de<se.length;de++)se[de].mode==="showing"&&se[de].addEventListener("cuechange",ie);return()=>{const de=k.textTracks;for(let ce=0;ce<de.length;ce++)de[ce].removeEventListener("cuechange",ie);const le=document.getElementById("subtitle-custom-style");le&&le.parentNode&&le.parentNode.removeChild(le)}},[Ee,ht]);const qv=k=>{const W=i.current;if(!W)return;P(!1),$(!1),Ht(!1),Gt(null);const q=k.currentTarget.getBoundingClientRect(),se=(k.clientX-q.left)/q.width*W.duration;fe(se),Ye(!0),W.currentTime=se},Dl=k=>{const W=i.current,q=document.querySelector(".volume-slider-horizontal");if(!W||!q)return;const ie=q.getBoundingClientRect(),se=Math.max(0,Math.min(1,(k.clientX-ie.left)/ie.width));W.volume=se,W.muted=!1,V(!1)},Xv=k=>{k.preventDefault(),G(!0),Dl(k)},c0=k=>{j&&Dl(k)},d0=()=>{G(!1)},f0=b.useCallback(()=>{const k=i.current;k&&(k.muted=!k.muted)},[]);b.useEffect(()=>{const k=i.current;if(!k)return;const W=()=>{Ut(!0)},q=()=>{Ut(!1)},ie=()=>{Ut(!1)},se=()=>{Ut(!0)},de=()=>{Ut(!1),Ye(!1),fe(0)};return k.addEventListener("waiting",W),k.addEventListener("canplay",q),k.addEventListener("playing",ie),k.addEventListener("seeking",se),k.addEventListener("seeked",de),()=>{k.removeEventListener("waiting",W),k.removeEventListener("canplay",q),k.removeEventListener("playing",ie),k.removeEventListener("seeking",se),k.removeEventListener("seeked",de)}},[]),b.useEffect(()=>{const k=W=>{const q=W.target;q.closest(".menu")||q.closest(".control-btn")||q.closest(".server-btn-top-left")||(P(!1),$(!1),Ht(!1),Gt(null),en(!1))};return document.addEventListener("mousedown",k),()=>{document.removeEventListener("mousedown",k)}},[]),b.useEffect(()=>{li({volume:_,isMuted:B})},[_,B]),b.useEffect(()=>{li({playbackRate:Q})},[Q]),b.useEffect(()=>{Te&&li({preferredQuality:Te})},[Te]),b.useEffect(()=>{li({subtitleSettings:Ee})},[Ee]),b.useEffect(()=>{if(ht&&Ne.length>0){const k=Ne.find(W=>W.url===ht);k&&li({preferredSubtitleLang:k.lang})}},[ht,Ne]),b.useEffect(()=>{const k=i.current;if(!k||!t)return;const W=()=>{const q=l4(t);q&&q.currentTime>10&&(k.currentTime=q.currentTime)};if(k.readyState>=1)W();else{const q=()=>{W()};return k.addEventListener("loadedmetadata",q),()=>{k.removeEventListener("loadedmetadata",q)}}},[t]),b.useEffect(()=>{const k=i.current;if(!k||!t)return;const W=2e3;let q=0;const ie=(Se=!1)=>{if(!k.duration||k.currentTime<=0||!Se&&Math.abs(k.currentTime-q)<1)return;const pt=Date.now(),gt=pt-d.current;Se||gt>=W?(Xp(t,k.currentTime,k.duration),d.current=pt,q=k.currentTime,c.current&&(clearTimeout(c.current),c.current=null)):(c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{Xp(t,k.currentTime,k.duration),d.current=Date.now(),q=k.currentTime,c.current=null},W-gt))},se=setInterval(()=>ie(!1),1e4),de=()=>ie(!1),le=()=>ie(!1),ce=()=>ie(!0),oe=()=>{document.hidden&&ie(!0)};return k.addEventListener("pause",de),k.addEventListener("seeked",le),window.addEventListener("beforeunload",ce),document.addEventListener("visibilitychange",oe),()=>{clearInterval(se),k.removeEventListener("pause",de),k.removeEventListener("seeked",le),window.removeEventListener("beforeunload",ce),document.removeEventListener("visibilitychange",oe),c.current&&clearTimeout(c.current),ie(!0)}},[t]),b.useEffect(()=>{if(Ne.length===0||ht||aa)return;const W=Dd().preferredSubtitleLang;let q=Ne.find(ie=>ie.lang===W);!q&&W==="en"&&(q=Ne.find(ie=>ie.lang.startsWith("en"))),q||(q=Ne.find(ie=>ie.lang==="en"||ie.lang.startsWith("en"))),q&&(fa(q),console.log(`Auto-selected ${q.lang} subtitles`))},[Ne,ht,aa]);const h0=b.useCallback(()=>{a.current&&(document.fullscreenElement?document.exitFullscreen():a.current.requestFullscreen())},[]),Qv=b.useCallback(k=>{const W=i.current;W&&(W.playbackRate=k,J(k))},[]),p0=b.useCallback(k=>{const W=i.current;W&&(W.currentTime+=k)},[]),Zv=b.useMemo(()=>{if(Te==="-1")return"Auto";const k=parseInt(Te),W=s.current;return W&&k>=0&&k<W.levels.length?`${W.levels[k].height}p`:"Auto"},[Te]),Jv=()=>{const k=Date.now();k-p.current<100||(p.current=k,K(!0),o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{T&&!u.current&&(K(!1),$(!1),Ht(!1),P(!1),en(!1))},3e3))},ey=()=>{K(!0),o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{T&&!u.current&&K(!1)},2e3)},ty=()=>{T&&(K(!1),$(!1),Ht(!1),P(!1),en(!1))};return D.jsxs("div",{ref:a,className:`player-container ${H?"show-controls":""} ${he?"fullscreen":""} ${w||U||Oe||j?"menu-open":""}`,onMouseMove:Jv,onMouseLeave:ty,children:[s0?D.jsx("iframe",{src:Hv,className:"video-element iframe-fallback",allowFullScreen:!0,allow:"autoplay; fullscreen; picture-in-picture"}):D.jsx("video",{ref:i,className:"video-element",onClick:Zi,onDoubleClick:jv,onTouchStart:ey,crossOrigin:"anonymous"}),Ll&&(e==null?void 0:e.backdrop)&&D.jsx("div",{className:"backdrop-poster",onClick:Zi,children:D.jsx("img",{src:e.backdrop,alt:"Video backdrop"})}),!ot&&!U&&!w&&D.jsxs(D.Fragment,{children:[D.jsx("button",{className:"control-btn server-btn-top-left",onClick:()=>{P(!w),$(!1),Ht(!1)},title:"Change Server",children:D.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:D.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"})})}),da&&D.jsx("button",{className:"control-btn cast-btn-top-right",onClick:Yv,title:"Cast",children:D.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[D.jsx("path",{d:"M2 20.01L2.01 19.9989",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round"}),D.jsx("path",{d:"M15 20H20C21.1046 20 22 19.1046 22 18V6C22 4.89543 21.1046 4 20 4H4C2.89543 4 2 4.89543 2 6V7",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round"}),D.jsx("path",{d:"M2 16C4 16.5 5.5 18 6 20",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round"}),D.jsx("path",{d:"M2 12C6 12.5 9.5 16 10 20",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round"})]})})]}),w&&D.jsxs("div",{className:"menu server-menu server-menu-top-left",onMouseEnter:()=>{u.current=!0},onMouseLeave:()=>{u.current=!1},onTouchStart:()=>{u.current=!0},onTouchEnd:()=>{u.current=!1},children:[D.jsx("div",{className:"menu-title",children:"SELECT SERVER"}),Object.keys(r).map(k=>{const W=wn[k],q=W==="online",ie=W==="offline",se=y===k,de=m===k,le=de&&Fe&&!W,ce=()=>{de||Or(k,!0)};return D.jsxs("div",{className:`server-item ${de?"active":""} ${ie?"offline":""}`,onClick:ce,children:[D.jsxs("div",{className:"server-info",children:[D.jsx("div",{className:"server-flag",children:D.jsx("img",{src:"https://flagcdn.com/w40/us.png",alt:k,className:"flag-img"})}),D.jsxs("div",{className:"server-details",children:[D.jsx("div",{className:"server-name",children:k}),D.jsx("div",{className:"server-meta",children:"Original audio"})]})]}),D.jsxs("div",{className:"server-actions",children:[D.jsx("button",{className:`server-action-btn ${se?"favorite":""}`,onClick:oe=>{oe.stopPropagation(),Vv(k)},title:"Set as favorite",children:D.jsx("svg",{viewBox:"0 0 24 24",fill:se?"currentColor":"none",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})})}),!de&&!wn[k]&&D.jsx("div",{className:"server-status-icon play",children:D.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:D.jsx("path",{d:"M8 5v14l11-7z"})})}),le&&D.jsx("div",{className:"server-status-icon checking",children:D.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:D.jsx("circle",{cx:"12",cy:"12",r:"10",strokeWidth:"3",strokeLinecap:"round",strokeDasharray:"60",strokeDashoffset:"20"})})}),q&&!le&&D.jsx("div",{className:"server-status-icon online",children:D.jsxs("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:[D.jsx("circle",{cx:"12",cy:"12",r:"10"}),D.jsx("path",{fill:"white",d:"M9 12l2 2 4-4",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),ie&&!le&&D.jsx("div",{className:"server-status-icon offline",children:D.jsxs("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:[D.jsx("circle",{cx:"12",cy:"12",r:"10"}),D.jsx("path",{fill:"white",d:"M8 8l8 8M16 8l-8 8",stroke:"white",strokeWidth:"2",strokeLinecap:"round"})]})})]})]},k)})]}),Fe&&D.jsxs("div",{className:"loading-overlay",children:[D.jsx("div",{className:"spinner"}),D.jsx("p",{children:"Loading..."})]}),!Qi&&Tl&&!Fe&&D.jsx("button",{className:"center-play-btn show initial",onClick:Zi,children:D.jsx("div",{className:"center-btn-circle",children:D.jsx("svg",{viewBox:"0 0 24 24",className:"center-icon",children:D.jsx("path",{d:"M20.4086 9.35258C22.5305 10.5065 22.5305 13.4935 20.4086 14.6474L7.59662 21.6145C5.53435 22.736 3 21.2763 3 18.9671L3 5.0329C3 2.72368 5.53435 1.26402 7.59661 2.38548L20.4086 9.35258Z",fill:"currentColor"})})})}),Al&&D.jsx("div",{className:"center-play-animation",children:D.jsx("div",{className:"center-btn-circle",children:T?D.jsxs("svg",{viewBox:"0 0 24 24",className:"center-icon",children:[D.jsx("path",{d:"M2 6C2 4.11438 2 3.17157 2.58579 2.58579C3.17157 2 4.11438 2 6 2C7.88562 2 8.82843 2 9.41421 2.58579C10 3.17157 10 4.11438 10 6V18C10 19.8856 10 20.8284 9.41421 21.4142C8.82843 22 7.88562 22 6 22C4.11438 22 3.17157 22 2.58579 21.4142C2 20.8284 2 19.8856 2 18V6Z",fill:"currentColor"}),D.jsx("path",{d:"M14 6C14 4.11438 14 3.17157 14.5858 2.58579C15.1716 2 16.1144 2 18 2C19.8856 2 20.8284 2 21.4142 2.58579C22 3.17157 22 4.11438 22 6V18C22 19.8856 22 20.8284 21.4142 21.4142C20.8284 22 19.8856 22 18 22C16.1144 22 15.1716 22 14.5858 21.4142C14 20.8284 14 19.8856 14 18V6Z",fill:"currentColor"})]}):D.jsx("svg",{viewBox:"0 0 24 24",className:"center-icon",children:D.jsx("path",{d:"M20.4086 9.35258C22.5305 10.5065 22.5305 13.4935 20.4086 14.6474L7.59662 21.6145C5.53435 22.736 3 21.2763 3 18.9671L3 5.0329C3 2.72368 5.53435 1.26402 7.59661 2.38548L20.4086 9.35258Z",fill:"currentColor"})})})}),$t&&!Fe&&D.jsx("div",{className:"buffering-overlay",children:D.jsx("div",{className:"buffering-spinner"})}),D.jsxs("div",{className:"controls-overlay",children:[!ot&&!U&&!w&&D.jsxs("div",{className:"progress-container",onClick:qv,children:[D.jsx("div",{className:"progress-buffered",style:{width:`${Y}%`}}),D.jsx("div",{className:"progress-bar",style:{width:`${at?Dn/I*100:A/I*100||0}%`},children:D.jsx("div",{className:"progress-handle"})})]}),D.jsxs("div",{className:"controls-bottom",children:[D.jsxs("div",{className:"controls-left",children:[D.jsx("button",{className:"control-btn",onClick:Zi,children:T?D.jsxs("svg",{viewBox:"0 0 24 24",children:[D.jsx("path",{d:"M2 6C2 4.11438 2 3.17157 2.58579 2.58579C3.17157 2 4.11438 2 6 2C7.88562 2 8.82843 2 9.41421 2.58579C10 3.17157 10 4.11438 10 6V18C10 19.8856 10 20.8284 9.41421 21.4142C8.82843 22 7.88562 22 6 22C4.11438 22 3.17157 22 2.58579 21.4142C2 20.8284 2 19.8856 2 18V6Z",fill:"currentColor"}),D.jsx("path",{d:"M14 6C14 4.11438 14 3.17157 14.5858 2.58579C15.1716 2 16.1144 2 18 2C19.8856 2 20.8284 2 21.4142 2.58579C22 3.17157 22 4.11438 22 6V18C22 19.8856 22 20.8284 21.4142 21.4142C20.8284 22 19.8856 22 18 22C16.1144 22 15.1716 22 14.5858 21.4142C14 20.8284 14 19.8856 14 18V6Z",fill:"currentColor"})]}):D.jsx("svg",{viewBox:"0 0 24 24",children:D.jsx("path",{d:"M20.4086 9.35258C22.5305 10.5065 22.5305 13.4935 20.4086 14.6474L7.59662 21.6145C5.53435 22.736 3 21.2763 3 18.9671L3 5.0329C3 2.72368 5.53435 1.26402 7.59661 2.38548L20.4086 9.35258Z",fill:"currentColor"})})}),D.jsx("button",{className:"control-btn",onClick:()=>p0(-10),children:D.jsxs("svg",{viewBox:"0 0 24 24",children:[D.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.3249 7.82403C10.5848 7.94892 10.75 8.2117 10.75 8.50001V15.5C10.75 15.9142 10.4142 16.25 10 16.25C9.58581 16.25 9.25003 15.9142 9.25003 15.5V10.0605L7.96855 11.0857C7.6451 11.3444 7.17313 11.292 6.91438 10.9685C6.65562 10.6451 6.70806 10.1731 7.03151 9.91436L9.53151 7.91436C9.75663 7.73425 10.0651 7.69914 10.3249 7.82403ZM14.25 9.25001C13.6977 9.25001 13.25 9.69772 13.25 10.25V13.75C13.25 14.3023 13.6977 14.75 14.25 14.75C14.8023 14.75 15.25 14.3023 15.25 13.75V10.25C15.25 9.69772 14.8023 9.25001 14.25 9.25001ZM11.75 10.25C11.75 8.8693 12.8693 7.75001 14.25 7.75001C15.6307 7.75001 16.75 8.8693 16.75 10.25V13.75C16.75 15.1307 15.6307 16.25 14.25 16.25C12.8693 16.25 11.75 15.1307 11.75 13.75V10.25Z",fill:"currentColor"}),D.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.324 1.67511C11.4489 1.41526 11.7117 1.25 12 1.25C12.7353 1.25 13.4541 1.32394 14.1492 1.46503C19.0563 2.46112 22.75 6.79837 22.75 12C22.75 17.9371 17.9371 22.75 12 22.75C6.06294 22.75 1.25 17.9371 1.25 12C1.25 7.59065 3.90459 3.80298 7.69972 2.14482C8.07929 1.97898 8.52143 2.15224 8.68726 2.53181C8.8531 2.91137 8.67984 3.35351 8.30028 3.51935C5.03179 4.94742 2.75 8.20808 2.75 12C2.75 17.1086 6.89137 21.25 12 21.25C17.1086 21.25 21.25 17.1086 21.25 12C21.25 7.84953 18.5158 4.33622 14.75 3.16544V4.5C14.75 4.81852 14.5488 5.10229 14.2483 5.20772C13.9477 5.31315 13.6133 5.21724 13.4143 4.96852L11.4143 2.46852C11.2342 2.24339 11.1991 1.93496 11.324 1.67511Z",fill:"currentColor"})]})}),D.jsx("button",{className:"control-btn",onClick:()=>p0(10),children:D.jsxs("svg",{viewBox:"0 0 24 24",children:[D.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.3249 7.82403C10.5848 7.94892 10.75 8.2117 10.75 8.50001V15.5C10.75 15.9142 10.4142 16.25 10 16.25C9.58581 16.25 9.25003 15.9142 9.25003 15.5V10.0605L7.96855 11.0857C7.6451 11.3444 7.17313 11.292 6.91438 10.9685C6.65562 10.6451 6.70806 10.1731 7.03151 9.91436L9.53151 7.91436C9.75663 7.73425 10.0651 7.69914 10.3249 7.82403ZM14.25 9.25001C13.6977 9.25001 13.25 9.69772 13.25 10.25V13.75C13.25 14.3023 13.6977 14.75 14.25 14.75C14.8023 14.75 15.25 14.3023 15.25 13.75V10.25C15.25 9.69772 14.8023 9.25001 14.25 9.25001ZM11.75 10.25C11.75 8.8693 12.8693 7.75001 14.25 7.75001C15.6307 7.75001 16.75 8.8693 16.75 10.25V13.75C16.75 15.1307 15.6307 16.25 14.25 16.25C12.8693 16.25 11.75 15.1307 11.75 13.75V10.25Z",fill:"currentColor"}),D.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.676 1.67511C12.5511 1.41526 12.2883 1.25 12 1.25C11.2647 1.25 10.5459 1.32394 9.8508 1.46503C4.94367 2.46112 1.25 6.79837 1.25 12C1.25 17.9371 6.06294 22.75 12 22.75C17.9371 22.75 22.75 17.9371 22.75 12C22.75 7.59065 20.0954 3.80298 16.3003 2.14482C15.9207 1.97898 15.4786 2.15224 15.3127 2.53181C15.1469 2.91137 15.3202 3.35351 15.6997 3.51935C18.9682 4.94742 21.25 8.20808 21.25 12C21.25 17.1086 17.1086 21.25 12 21.25C6.89137 21.25 2.75 17.1086 2.75 12C2.75 7.84953 5.48421 4.33622 9.25 3.16544V4.5C9.25 4.81852 9.45118 5.10229 9.75175 5.20772C10.0523 5.31315 10.3867 5.21724 10.5857 4.96852L12.5857 2.46852C12.7658 2.24339 12.8009 1.93496 12.676 1.67511Z",fill:"currentColor"})]})}),D.jsxs("div",{className:"volume-container",onMouseEnter:()=>ze(!0),onMouseLeave:()=>ze(!1),children:[D.jsx("button",{className:"control-btn",onClick:f0,children:B||_===0?D.jsx("svg",{viewBox:"0 0 24 24",children:D.jsx("path",{d:"M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z",fill:"currentColor"})}):D.jsxs("svg",{viewBox:"0 0 24 24",children:[D.jsx("path",{d:"M10.9916 3.9756C11.6784 3.44801 12.4957 3.01957 13.367 3.38808C14.2302 3.75318 14.5076 4.63267 14.6274 5.49785C14.7502 6.38459 14.7502 7.60557 14.7502 9.12365V14.8794C14.7502 16.3975 14.7502 17.6185 14.6274 18.5052C14.5076 19.3704 14.2302 20.2499 13.367 20.615C12.4957 20.9835 11.6784 20.5551 10.9916 20.0275C10.2892 19.488 9.3966 18.5765 8.34667 17.5044L8.34663 17.5044C7.80717 16.9535 7.44921 16.6873 7.08663 16.5374C6.72221 16.3868 6.27914 16.3229 5.50619 16.3229C4.83768 16.3229 4.23963 16.3229 3.78679 16.2758C3.31184 16.2265 2.87088 16.1191 2.47421 15.8485C1.7184 15.3328 1.42917 14.5777 1.31957 13.8838C1.23785 13.3663 1.24723 12.7981 1.25479 12.3405V11.6626C1.24723 11.205 1.23785 10.6368 1.31957 10.1193C1.42917 9.42536 1.7184 8.67029 2.47421 8.15462C2.87088 7.88398 3.31184 7.77657 3.78679 7.72723C4.23963 7.68019 4.83768 7.68021 5.50619 7.68023C6.27914 7.68023 6.72221 7.61628 7.08663 7.46563C7.44922 7.31574 7.80717 7.04954 8.34663 6.49869L8.34664 6.49869C9.39659 5.42655 10.2892 4.51511 10.9916 3.9756Z",fill:"currentColor"}),D.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.3935 8.20504C16.8325 7.87003 17.4601 7.95439 17.7951 8.39347C18.5519 9.38539 19.0001 10.6418 19.0001 12.0001C19.0001 13.3583 18.5519 14.6147 17.7951 15.6066C17.4601 16.0457 16.8325 16.1301 16.3935 15.7951C15.9544 15.4601 15.87 14.8325 16.205 14.3935C16.699 13.746 17.0001 12.9149 17.0001 12.0001C17.0001 11.0852 16.699 10.2541 16.205 9.60664C15.87 9.16756 15.9544 8.54004 16.3935 8.20504Z",fill:"currentColor"}),D.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M19.3247 6.26245C19.7321 5.8895 20.3646 5.91738 20.7376 6.32472C22.1408 7.8573 23 9.83247 23 12C23 14.1675 22.1408 16.1427 20.7376 17.6753C20.3646 18.0826 19.7321 18.1105 19.3247 17.7376C18.9174 17.3646 18.8895 16.7321 19.2625 16.3247C20.3609 15.125 21 13.621 21 12C21 10.379 20.3609 8.87497 19.2625 7.6753C18.8895 7.26796 18.9174 6.63541 19.3247 6.26245Z",fill:"currentColor"})]})}),D.jsx("div",{className:"volume-slider-horizontal",onMouseDown:Xv,onClick:Dl,children:D.jsx("div",{className:"volume-track",children:D.jsx("div",{className:"volume-fill",style:{width:`${_*100}%`},children:D.jsx("div",{className:"volume-handle"})})})})]}),D.jsxs("div",{className:"time-display",children:[l0(A)," / ",l0(I)]})]}),D.jsxs("div",{className:"controls-right",children:[D.jsx("button",{className:"control-btn",onClick:()=>{Ht(!ot),$(!1),P(!1)},title:"Subtitles",children:D.jsx("svg",{viewBox:"0 0 24 24",children:D.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 8.22876 2 6.34315 3.17157 5.17157C4.34315 4 6.22876 4 10 4H14C17.7712 4 19.6569 4 20.8284 5.17157C22 6.34315 22 8.22876 22 12C22 15.7712 22 17.6569 20.8284 18.8284C19.6569 20 17.7712 20 14 20H10C6.22876 20 4.34315 20 3.17157 18.8284C2 17.6569 2 15.7712 2 12ZM6 15.25C5.58579 15.25 5.25 15.5858 5.25 16C5.25 16.4142 5.58579 16.75 6 16.75H10C10.4142 16.75 10.75 16.4142 10.75 16C10.75 15.5858 10.4142 15.25 10 15.25H6ZM7.75 13C7.75 12.5858 7.41421 12.25 7 12.25H6C5.58579 12.25 5.25 12.5858 5.25 13C5.25 13.4142 5.58579 13.75 6 13.75H7C7.41421 13.75 7.75 13.4142 7.75 13ZM11.5 12.25C11.9142 12.25 12.25 12.5858 12.25 13C12.25 13.4142 11.9142 13.75 11.5 13.75H9.5C9.08579 13.75 8.75 13.4142 8.75 13C8.75 12.5858 9.08579 12.25 9.5 12.25H11.5ZM18.75 13C18.75 12.5858 18.4142 12.25 18 12.25H14C13.5858 12.25 13.25 12.5858 13.25 13C13.25 13.4142 13.5858 13.75 14 13.75H18C18.4142 13.75 18.75 13.4142 18.75 13ZM12.5 15.25C12.0858 15.25 11.75 15.5858 11.75 16C11.75 16.4142 12.0858 16.75 12.5 16.75H14C14.4142 16.75 14.75 16.4142 14.75 16C14.75 15.5858 14.4142 15.25 14 15.25H12.5ZM15.75 16C15.75 15.5858 16.0858 15.25 16.5 15.25H18C18.4142 15.25 18.75 15.5858 18.75 16C18.75 16.4142 18.4142 16.75 18 16.75H16.5C16.0858 16.75 15.75 16.4142 15.75 16Z",fill:"currentColor"})})}),D.jsx("button",{className:`control-btn ${U?"settings-open":""}`,onClick:()=>{$(!U),P(!1),Ht(!1)},title:"Settings",children:D.jsx("svg",{viewBox:"0 0 24 24",children:D.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.2788 2.15224C13.9085 2 13.439 2 12.5 2C11.561 2 11.0915 2 10.7212 2.15224C10.2274 2.35523 9.83509 2.74458 9.63056 3.23463C9.53719 3.45834 9.50065 3.7185 9.48635 4.09799C9.46534 4.65568 9.17716 5.17189 8.69017 5.45093C8.20318 5.72996 7.60864 5.71954 7.11149 5.45876C6.77318 5.2813 6.52789 5.18262 6.28599 5.15102C5.75609 5.08178 5.22018 5.22429 4.79616 5.5472C4.47814 5.78938 4.24339 6.1929 3.7739 6.99993C3.30441 7.80697 3.06967 8.21048 3.01735 8.60491C2.94758 9.1308 3.09118 9.66266 3.41655 10.0835C3.56506 10.2756 3.77377 10.437 4.0977 10.639C4.57391 10.936 4.88032 11.4419 4.88029 12C4.88026 12.5581 4.57386 13.0639 4.0977 13.3608C3.77372 13.5629 3.56497 13.7244 3.41645 13.9165C3.09108 14.3373 2.94749 14.8691 3.01725 15.395C3.06957 15.7894 3.30432 16.193 3.7738 17C4.24329 17.807 4.47804 18.2106 4.79606 18.4527C5.22008 18.7756 5.75599 18.9181 6.28589 18.8489C6.52778 18.8173 6.77305 18.7186 7.11133 18.5412C7.60852 18.2804 8.2031 18.27 8.69012 18.549C9.17714 18.8281 9.46533 19.3443 9.48635 19.9021C9.50065 20.2815 9.53719 20.5417 9.63056 20.7654C9.83509 21.2554 10.2274 21.6448 10.7212 21.8478C11.0915 22 11.561 22 12.5 22C13.439 22 13.9085 22 14.2788 21.8478C14.7726 21.6448 15.1649 21.2554 15.3694 20.7654C15.4628 20.5417 15.4994 20.2815 15.5137 19.902C15.5347 19.3443 15.8228 18.8281 16.3098 18.549C16.7968 18.2699 17.3914 18.2804 17.8886 18.5412C18.2269 18.7186 18.4721 18.8172 18.714 18.8488C19.2439 18.9181 19.7798 18.7756 20.2038 18.4527C20.5219 18.2105 20.7566 17.807 21.2261 16.9999C21.6956 16.1929 21.9303 15.7894 21.9827 15.395C22.0524 14.8691 21.9088 14.3372 21.5835 13.9164C21.4349 13.7243 21.2262 13.5628 20.9022 13.3608C20.4261 13.0639 20.1197 12.558 20.1197 11.9999C20.1197 11.4418 20.4261 10.9361 20.9022 10.6392C21.2263 10.4371 21.435 10.2757 21.5836 10.0835C21.9089 9.66273 22.0525 9.13087 21.9828 8.60497C21.9304 8.21055 21.6957 7.80703 21.2262 7C20.7567 6.19297 20.522 5.78945 20.2039 5.54727C19.7799 5.22436 19.244 5.08185 18.7141 5.15109C18.4722 5.18269 18.2269 5.28136 17.8887 5.4588C17.3915 5.71959 16.7969 5.73002 16.3099 5.45096C15.8229 5.17191 15.5347 4.65566 15.5136 4.09794C15.4993 3.71848 15.4628 3.45833 15.3694 3.23463C15.1649 2.74458 14.7726 2.35523 14.2788 2.15224ZM12.5 15C14.1695 15 15.5228 13.6569 15.5228 12C15.5228 10.3431 14.1695 9 12.5 9C10.8305 9 9.47716 10.3431 9.47716 12C9.47716 13.6569 10.8305 15 12.5 15Z",fill:"currentColor"})})}),Rl&&D.jsx("button",{className:"control-btn",onClick:Wv,title:ua?"Exit Picture-in-Picture":"Picture-in-Picture",children:D.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[D.jsx("path",{strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",d:"M11.5 20H10C6.22876 20 4.34315 20 3.17157 18.8284C2 17.6569 2 15.7712 2 12C2 8.22876 2 6.34315 3.17157 5.17157C4.34315 4 6.22876 4 10 4H14C17.7712 4 19.6569 4 20.8284 5.17157C21.947 6.29018 21.9976 8.05974 21.9999 11.5"}),D.jsx("path",{strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",d:"M22 15.8002C22 14.1201 22 13.2801 21.673 12.638C21.3854 12.0735 20.9265 11.6146 20.362 11.327C19.7199 11.0002 18.8799 11.0002 17.2 11.0002H15.8C14.1199 11.0002 13.2799 11.0002 12.638 11.327C12.0735 11.6146 11.6146 12.0735 11.327 12.638C11 13.2801 11 14.1201 11 15.8002V17.2002C11 18.8803 11 19.7203 11.327 20.3624C11.6146 20.9269 12.0735 21.3857 12.638 21.6734C13.2799 22.0002 14.1199 22.0002 15.8 22.0002H17.2C18.8801 22.0002 19.7201 22.0002 20.362 21.6734C20.9265 21.3857 21.3854 20.9269 21.673 20.3624C22 19.7203 22 18.8803 22 17.2002V15.8002Z"})]})}),D.jsx("button",{className:"control-btn",onClick:h0,children:he?D.jsx("svg",{viewBox:"0 0 24 24",children:D.jsx("path",{d:"M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z",fill:"currentColor"})}):D.jsx("svg",{viewBox:"0 0 24 24",children:D.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.94358 1.25L10 1.25C10.4142 1.25 10.75 1.58579 10.75 2C10.75 2.41421 10.4142 2.75 10 2.75C8.09318 2.75 6.73851 2.75159 5.71085 2.88976C4.70476 3.02502 4.12511 3.27869 3.7019 3.7019C3.27869 4.12511 3.02502 4.70476 2.88976 5.71085C2.75159 6.73851 2.75 8.09318 2.75 10C2.75 10.4142 2.41421 10.75 2 10.75C1.58579 10.75 1.25 10.4142 1.25 10L1.25 9.94358C1.24998 8.10582 1.24997 6.65019 1.40314 5.51098C1.56076 4.33856 1.89288 3.38961 2.64124 2.64124C3.38961 1.89288 4.33856 1.56076 5.51098 1.40314C6.65019 1.24997 8.10582 1.24998 9.94358 1.25ZM18.2892 2.88976C17.2615 2.75159 15.9068 2.75 14 2.75C13.5858 2.75 13.25 2.41421 13.25 2C13.25 1.58579 13.5858 1.25 14 1.25L14.0564 1.25C15.8942 1.24998 17.3498 1.24997 18.489 1.40314C19.6614 1.56076 20.6104 1.89288 21.3588 2.64124C22.1071 3.38961 22.4392 4.33856 22.5969 5.51098C22.75 6.65019 22.75 8.10583 22.75 9.94359V10C22.75 10.4142 22.4142 10.75 22 10.75C21.5858 10.75 21.25 10.4142 21.25 10C21.25 8.09318 21.2484 6.73851 21.1102 5.71085C20.975 4.70476 20.7213 4.12511 20.2981 3.7019C19.8749 3.27869 19.2952 3.02502 18.2892 2.88976ZM2 13.25C2.41421 13.25 2.75 13.5858 2.75 14C2.75 15.9068 2.75159 17.2615 2.88976 18.2892C3.02502 19.2952 3.27869 19.8749 3.7019 20.2981C4.12511 20.7213 4.70476 20.975 5.71085 21.1102C6.73851 21.2484 8.09318 21.25 10 21.25C10.4142 21.25 10.75 21.5858 10.75 22C10.75 22.4142 10.4142 22.75 10 22.75H9.94359C8.10583 22.75 6.65019 22.75 5.51098 22.5969C4.33856 22.4392 3.38961 22.1071 2.64124 21.3588C1.89288 20.6104 1.56076 19.6614 1.40314 18.489C1.24997 17.3498 1.24998 15.8942 1.25 14.0564L1.25 14C1.25 13.5858 1.58579 13.25 2 13.25ZM22 13.25C22.4142 13.25 22.75 13.5858 22.75 14V14.0564C22.75 15.8942 22.75 17.3498 22.5969 18.489C22.4392 19.6614 22.1071 20.6104 21.3588 21.3588C20.6104 22.1071 19.6614 22.4392 18.489 22.5969C17.3498 22.75 15.8942 22.75 14.0564 22.75H14C13.5858 22.75 13.25 22.4142 13.25 22C13.25 21.5858 13.5858 21.25 14 21.25C15.9068 21.25 17.2615 21.2484 18.2892 21.1102C19.2952 20.975 19.8749 20.7213 20.2981 20.2981C20.7213 19.8749 20.975 19.2952 21.1102 18.2892C21.2484 17.2615 21.25 15.9068 21.25 14C21.25 13.5858 21.5858 13.25 22 13.25Z",fill:"currentColor"})})})]})]})]}),ot&&D.jsxs("div",{className:"menu subtitles-menu",onMouseEnter:()=>{u.current=!0},onMouseLeave:()=>{u.current=!1},onTouchStart:()=>{u.current=!0},onTouchEnd:()=>{u.current=!1},children:[!sa&&D.jsxs(D.Fragment,{children:[D.jsx("div",{className:"menu-title",children:"SUBTITLES"}),D.jsxs("div",{className:"menu-item",onClick:()=>en(!0),children:[D.jsx("svg",{viewBox:"0 0 24 24",className:"submenu-option-icon",children:D.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M22.25 12.0572C22.25 14.2479 22.25 15.9686 22.0694 17.312C21.8843 18.6886 21.4973 19.7809 20.6391 20.6391C19.7809 21.4973 18.6886 21.8843 17.312 22.0694C15.9686 22.25 14.2479 22.25 12.0572 22.25L12.0572 22.25L11.9428 22.25L11.9428 22.25C9.7521 22.25 8.03143 22.25 6.68802 22.0694C5.31136 21.8843 4.21911 21.4973 3.36091 20.6391C2.50271 19.7809 2.11568 18.6886 1.93059 17.312C1.74998 15.9686 1.74999 14.2479 1.75 12.0572L1.75 12.0572L1.75 11.9428L1.75 11.9428C1.74999 9.7521 1.74998 8.03143 1.93059 6.68802C2.11568 5.31137 2.50271 4.21911 3.36091 3.36091C4.21911 2.50271 5.31137 2.11568 6.68802 1.93059C8.03144 1.74998 9.75212 1.74999 11.9428 1.75L12.0572 1.75C14.2479 1.74999 15.9686 1.74998 17.312 1.93059C18.6886 2.11568 19.7809 2.50272 20.6391 3.36091C21.4973 4.21911 21.8843 5.31137 22.0694 6.68802C22.25 8.03144 22.25 9.75212 22.25 11.9428L22.25 12.0572ZM18 8.5C18 9.05228 17.5523 9.5 17 9.5L10.792 9.5C10.4062 10.383 9.52516 11 8.5 11C7.11929 11 6 9.88071 6 8.5C6 7.11929 7.11929 6 8.5 6C9.52516 6 10.4062 6.61705 10.792 7.5L17 7.5C17.5523 7.5 18 7.94772 18 8.5ZM18 15.5C18 14.1193 16.8807 13 15.5 13C14.4748 13 13.5938 13.617 13.208 14.5L7 14.5C6.44771 14.5 6 14.9477 6 15.5C6 16.0523 6.44771 16.5 7 16.5L13.208 16.5C13.5938 17.383 14.4748 18 15.5 18C16.8807 18 18 16.8807 18 15.5Z",fill:"currentColor"})}),D.jsx("span",{children:"Customize"}),D.jsx("svg",{viewBox:"0 0 24 24",className:"menu-arrow",children:D.jsx("path",{d:"M9 6l6 6-6 6",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})})]}),D.jsxs("div",{className:"menu-item",onClick:()=>{var k;return(k=document.getElementById("subtitle-upload"))==null?void 0:k.click()},children:[D.jsx("svg",{viewBox:"0 0 24 24",className:"submenu-option-icon",children:D.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.9428 22.25H12.0572C14.2479 22.25 15.9686 22.25 17.312 22.0694C18.6886 21.8843 19.7809 21.4973 20.6391 20.6391C21.4973 19.7809 21.8843 18.6886 22.0694 17.312C22.25 15.9686 22.25 14.2479 22.25 12.0572V11.9428C22.25 9.7521 22.25 8.03144 22.0694 6.68802C21.8843 5.31137 21.4973 4.21911 20.6391 3.36091C19.7809 2.50271 18.6886 2.11568 17.312 1.93059C15.9686 1.74998 14.2479 1.74999 12.0572 1.75H11.9428C9.7521 1.74999 8.03144 1.74998 6.68802 1.93059C5.31137 2.11568 4.21911 2.50271 3.36091 3.36091C2.50272 4.21911 2.11568 5.31137 1.93059 6.68802C1.74998 8.03144 1.74999 9.75211 1.75 11.9428V11.9428V12.0572V12.0572C1.74999 14.2479 1.74998 15.9686 1.93059 17.312C2.11568 18.6886 2.50272 19.7809 3.36091 20.6391C4.21911 21.4973 5.31137 21.8843 6.68802 22.0694C8.03144 22.25 9.75212 22.25 11.9428 22.25ZM13.0059 16C13.0059 16.5523 12.5581 17 12.0059 17C11.4536 17 11.0059 16.5523 11.0059 16V11.5L10.4116 11.5C10.236 11.5001 10.0203 11.5003 9.84387 11.4782L9.84053 11.4778C9.71408 11.462 9.13804 11.3902 8.86368 10.8246C8.58872 10.2577 8.89065 9.75761 8.95597 9.6494L8.95841 9.64537C9.05062 9.49235 9.18477 9.32147 9.29511 9.18092L9.31885 9.15067C9.61348 8.77485 9.99545 8.29063 10.3759 7.89962C10.5657 7.70451 10.783 7.50328 11.0139 7.34443C11.2191 7.20323 11.5693 6.99996 12 6.99996C12.4307 6.99996 12.7809 7.20323 12.9861 7.34443C13.217 7.50328 13.4343 7.70451 13.6241 7.89962C14.0046 8.29063 14.3865 8.77485 14.6812 9.15067L14.7049 9.18091C14.8152 9.32147 14.9494 9.49235 15.0416 9.64537L15.044 9.64941C15.1093 9.75761 15.4113 10.2578 15.1363 10.8246C14.862 11.3902 14.2859 11.462 14.1595 11.4778L14.1561 11.4782C13.9797 11.5003 13.764 11.5001 13.5884 11.5L13.0059 11.5V16Z",fill:"currentColor"})}),D.jsx("span",{children:"Upload Subtitles"}),D.jsx("svg",{viewBox:"0 0 24 24",className:"menu-arrow",children:D.jsx("path",{d:"M9 6l6 6-6 6",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})})]}),D.jsx("input",{id:"subtitle-upload",type:"file",accept:".srt,.vtt",style:{display:"none"},onChange:zv}),D.jsx("div",{className:"menu-divider"}),e&&!ur&&D.jsxs("div",{className:"menu-item",onClick:Kv,style:{background:"rgba(102, 126, 234, 0.1)"},children:[D.jsx("svg",{viewBox:"0 0 24 24",className:"menu-icon",fill:"currentColor",children:D.jsx("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"})}),D.jsx("span",{children:"Fetch More Subtitles"})]}),ur&&D.jsx("div",{className:"menu-item",children:D.jsx("span",{children:"Loading subtitles..."})}),D.jsxs("div",{className:`menu-item ${ht?"":"active"}`,onClick:()=>fa(null),children:[D.jsx("span",{children:"Off"}),D.jsx("span",{className:"radio-dot",children:ht?"":""})]}),Ne.map((k,W)=>D.jsxs("div",{className:`menu-item ${ht===k.url?"active":""}`,onClick:()=>fa(k),children:[D.jsx("span",{children:k.lang==="custom"?"Custom":qp(k.lang)}),D.jsx("span",{className:"radio-dot",children:ht===k.url?"":""})]},W))]}),sa&&D.jsxs(D.Fragment,{children:[D.jsxs("div",{className:"submenu-header",onClick:()=>en(!1),children:[D.jsx("svg",{viewBox:"0 0 24 24",className:"back-icon",children:D.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})}),D.jsx("span",{children:"Subtitles"})]}),D.jsxs("div",{className:"subtitle-customize-menu",children:[D.jsxs("div",{className:"customize-section",children:[D.jsx("div",{className:"customize-label",children:D.jsx("span",{children:"Font Color"})}),D.jsx("div",{className:"color-options",children:["#FFFFFF","#FFFF00","#00FFFF","#C0C0C0"].map(k=>D.jsx("div",{className:`color-option ${Ee.color===k?"active":""}`,style:{backgroundColor:k},onClick:()=>kn({...Ee,color:k})},k))})]}),D.jsxs("div",{className:"customize-section",children:[D.jsxs("div",{className:"customize-label",children:[D.jsx("span",{children:"Font Size"}),D.jsxs("span",{children:[Ee.size,"%"]})]}),D.jsx("input",{type:"range",min:"50",max:"200",value:Ee.size,onChange:k=>kn({...Ee,size:parseInt(k.target.value)}),className:"customize-slider",style:{"--slider-percent":`${(Ee.size-50)/150*100}%`}})]}),D.jsxs("div",{className:"customize-section",children:[D.jsxs("div",{className:"customize-label",children:[D.jsx("span",{children:"Background Opacity"}),D.jsxs("span",{children:[Ee.backgroundOpacity,"%"]})]}),D.jsx("input",{type:"range",min:"0",max:"100",value:Ee.backgroundOpacity,onChange:k=>kn({...Ee,backgroundOpacity:parseInt(k.target.value)}),className:"customize-slider",style:{"--slider-percent":`${Ee.backgroundOpacity}%`}})]}),D.jsxs("div",{className:"customize-section",children:[D.jsxs("div",{className:"customize-label",children:[D.jsx("span",{children:"Position"}),D.jsxs("span",{children:[Ee.position,"%"]})]}),D.jsx("input",{type:"range",min:"0",max:"100",value:Ee.position,onChange:k=>kn({...Ee,position:parseInt(k.target.value)}),className:"customize-slider",style:{"--slider-percent":`${Ee.position}%`}})]}),D.jsxs("div",{className:"customize-section",children:[D.jsxs("div",{className:"customize-label",children:[D.jsx("span",{children:"Timing"}),D.jsxs("span",{children:[Ee.timing>0?"+":"",(Ee.timing/1e3).toFixed(1),"s"]})]}),D.jsx("input",{type:"range",min:"-5000",max:"5000",step:"100",value:Ee.timing,onChange:k=>kn({...Ee,timing:parseInt(k.target.value)}),className:"customize-slider",style:{"--slider-percent":`${(Ee.timing+5e3)/1e4*100}%`}})]})]})]})]}),U&&D.jsxs("div",{className:"menu settings-menu",onMouseEnter:()=>{u.current=!0},onMouseLeave:()=>{u.current=!1},onTouchStart:()=>{u.current=!0},onTouchEnd:()=>{u.current=!1},children:[!Br&&D.jsxs(D.Fragment,{children:[D.jsxs("div",{className:"menu-section-header clickable",onClick:()=>Gt("speed"),children:[D.jsx("svg",{viewBox:"0 0 24 24",className:"menu-icon",children:D.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.312 1.93066C15.9686 1.75004 14.2479 1.75005 12.0572 1.75006H12.0572H11.9429H11.9429C9.75218 1.75005 8.0315 1.75004 6.68808 1.93066C5.31143 2.11574 4.21917 2.50278 3.36097 3.36097C2.50278 4.21917 2.11574 5.31143 1.93066 6.68808C1.75004 8.0315 1.75005 9.75218 1.75006 11.9429V11.9429V12.0572V12.0572C1.75005 14.2479 1.75004 15.9686 1.93066 17.312C2.11574 18.6887 2.50278 19.781 3.36097 20.6391C4.21917 21.4973 5.31143 21.8844 6.68808 22.0695C8.0315 22.2501 9.7522 22.2501 11.9429 22.2501H12.0573C14.248 22.2501 15.9686 22.2501 17.312 22.0695C18.6887 21.8844 19.781 21.4973 20.6391 20.6391C21.4973 19.781 21.8844 18.6887 22.0695 17.312C22.2501 15.9686 22.2501 14.2479 22.2501 12.0572V11.9429C22.2501 9.75217 22.2501 8.0315 22.0695 6.68808C21.8844 5.31143 21.4973 4.21917 20.6391 3.36097C19.781 2.50278 18.6887 2.11574 17.312 1.93066ZM17.5645 9.49395C17.8373 9.18222 17.8057 8.7084 17.4939 8.43564C17.1822 8.16288 16.7084 8.19447 16.4356 8.50619L12.9968 12.4363C12.6878 12.316 12.3516 12.2501 12.0001 12.2501C10.4813 12.2501 9.25006 13.4813 9.25006 15.0001C9.25006 16.5189 10.4813 17.7501 12.0001 17.7501C13.5188 17.7501 14.7501 16.5189 14.7501 15.0001C14.7501 14.3783 14.5437 13.8047 14.1957 13.344L17.5645 9.49395ZM12.0001 6.75006C9.10057 6.75006 6.75006 9.10057 6.75006 12.0001C6.75006 12.4143 6.41427 12.7501 6.00006 12.7501C5.58585 12.7501 5.25006 12.4143 5.25006 12.0001C5.25006 8.27214 8.27214 5.25006 12.0001 5.25006C13.2283 5.25006 14.382 5.57878 15.3756 6.15355C15.7342 6.36096 15.8567 6.81975 15.6493 7.1783C15.4419 7.53684 14.9831 7.65937 14.6245 7.45196C13.8531 7.0057 12.9576 6.75006 12.0001 6.75006Z",fill:"currentColor"})}),D.jsx("span",{children:"Playback speed"}),D.jsx("span",{className:"menu-value",children:Q===1?"Normal":`${Q}x`}),D.jsx("svg",{viewBox:"0 0 24 24",className:"menu-arrow",children:D.jsx("path",{d:"M9 6l6 6-6 6",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})})]}),kt.length>0&&D.jsxs("div",{className:"menu-section-header clickable",onClick:()=>Gt("quality"),children:[D.jsx("svg",{viewBox:"0 0 24 24",className:"menu-icon",children:D.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.0261 2.25C15.8081 2.24997 17.2444 2.24995 18.3741 2.40148C19.547 2.5588 20.5345 2.89536 21.3188 3.67786C22.1031 4.46035 22.4405 5.44558 22.5982 6.61573C22.75 7.74277 22.75 9.17578 22.75 10.9536V13.0464C22.75 14.8242 22.75 16.2572 22.5982 17.3843C22.4405 18.5544 22.1031 19.5397 21.3188 20.3221C20.5345 21.1046 19.547 21.4412 18.3741 21.5985C17.2444 21.75 15.8081 21.75 14.0261 21.75H9.97392C8.19192 21.75 6.75558 21.75 5.6259 21.5985C4.45303 21.4412 3.4655 21.1046 2.68118 20.3221C1.89687 19.5397 1.55952 18.5544 1.40183 17.3843C1.24995 16.2572 1.24997 14.8242 1.25 13.0464V13.0463V10.9537V10.9536C1.24997 9.17579 1.24995 7.74278 1.40183 6.61572C1.55952 5.44558 1.89687 4.46035 2.68118 3.67786C3.4655 2.89536 4.45303 2.5588 5.6259 2.40148C6.75558 2.24995 8.19193 2.24997 9.97393 2.25H9.97395H14.026H14.0261ZM10 8.5C10 9.32843 9.32843 10 8.5 10C7.67157 10 7 9.32843 7 8.5C7 7.67157 7.67157 7 8.5 7C9.32843 7 10 7.67157 10 8.5ZM4.06326 18.9433C3.70263 18.5835 3.4675 18.0784 3.33895 17.1244L3.33115 17.065L6.15441 13.8888C6.37423 13.6415 6.68931 13.5 7.02019 13.5C7.32741 13.5 7.62205 13.622 7.83928 13.8393L10 16L14.6571 11.3429C14.8767 11.1234 15.1745 11 15.485 11C15.8132 11 16.1263 11.1377 16.348 11.3797L20.7467 16.1783C20.7271 16.5248 20.6996 16.8382 20.6611 17.1244C20.5325 18.0784 20.2974 18.5835 19.9367 18.9433C19.5761 19.3031 19.0698 19.5377 18.1137 19.6659C17.1294 19.7979 15.8249 19.8 13.9546 19.8H10.0455C8.17507 19.8 6.87059 19.7979 5.88634 19.6659C4.93021 19.5377 4.42389 19.3031 4.06326 18.9433Z",fill:"currentColor"})}),D.jsx("span",{children:"Quality"}),D.jsx("span",{className:"menu-value",children:Zv}),D.jsx("svg",{viewBox:"0 0 24 24",className:"menu-arrow",children:D.jsx("path",{d:"M9 6l6 6-6 6",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})})]})]}),Br==="speed"&&D.jsxs(D.Fragment,{children:[D.jsxs("div",{className:"submenu-header",onClick:()=>Gt(null),children:[D.jsx("svg",{viewBox:"0 0 24 24",className:"back-icon",children:D.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})}),D.jsx("span",{children:"Playback speed"})]}),D.jsx("div",{className:"submenu-list",children:[.25,.5,.75,1,1.25,1.5,1.75,2].map(k=>D.jsxs("div",{className:`submenu-item ${Q===k?"active":""}`,onClick:()=>Qv(k),children:[D.jsx("span",{className:"radio-dot",children:Q===k?"":""}),D.jsx("span",{children:k===1?"Normal":`${k}x`})]},k))})]}),Br==="quality"&&D.jsxs(D.Fragment,{children:[D.jsxs("div",{className:"submenu-header",onClick:()=>Gt(null),children:[D.jsx("svg",{viewBox:"0 0 24 24",className:"back-icon",children:D.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})}),D.jsx("span",{children:"Quality"})]}),D.jsxs("div",{className:"submenu-list",children:[D.jsxs("div",{className:`submenu-item ${Te==="-1"?"active":""}`,onClick:()=>u0(-1),children:[D.jsx("span",{className:"radio-dot",children:Te==="-1"?"":""}),D.jsx("span",{children:"Auto"})]}),kt.map(k=>D.jsxs("div",{className:`submenu-item ${Te===k.level.toString()?"active":""}`,onClick:()=>u0(k.level),children:[D.jsx("span",{className:"radio-dot",children:Te===k.level.toString()?"":""}),D.jsxs("span",{children:[k.height,"p"]})]},k.level))]})]})]})]})};var $v={exports:{}};function u4(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Du={exports:{}};const c4={},d4=Object.freeze(Object.defineProperty({__proto__:null,default:c4},Symbol.toStringTag,{value:"Module"})),f4=ry(d4);var Qp;function ve(){return Qp||(Qp=1,function(r,e){(function(t,n){r.exports=n()})(ge,function(){var t=t||function(n,i){var s;if(typeof window<"u"&&window.crypto&&(s=window.crypto),typeof self<"u"&&self.crypto&&(s=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(s=globalThis.crypto),!s&&typeof window<"u"&&window.msCrypto&&(s=window.msCrypto),!s&&typeof ge<"u"&&ge.crypto&&(s=ge.crypto),!s&&typeof u4=="function")try{s=f4}catch{}var a=function(){if(s){if(typeof s.getRandomValues=="function")try{return s.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof s.randomBytes=="function")try{return s.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function g(){}return function(m){var E;return g.prototype=m,E=new g,g.prototype=null,E}}(),u={},l=u.lib={},c=l.Base=function(){return{extend:function(g){var m=o(this);return g&&m.mixIn(g),(!m.hasOwnProperty("init")||this.init===m.init)&&(m.init=function(){m.$super.init.apply(this,arguments)}),m.init.prototype=m,m.$super=this,m},create:function(){var g=this.extend();return g.init.apply(g,arguments),g},init:function(){},mixIn:function(g){for(var m in g)g.hasOwnProperty(m)&&(this[m]=g[m]);g.hasOwnProperty("toString")&&(this.toString=g.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),d=l.WordArray=c.extend({init:function(g,m){g=this.words=g||[],m!=i?this.sigBytes=m:this.sigBytes=g.length*4},toString:function(g){return(g||h).stringify(this)},concat:function(g){var m=this.words,E=g.words,T=this.sigBytes,L=g.sigBytes;if(this.clamp(),T%4)for(var A=0;A<L;A++){var R=E[A>>>2]>>>24-A%4*8&255;m[T+A>>>2]|=R<<24-(T+A)%4*8}else for(var I=0;I<L;I+=4)m[T+I>>>2]=E[I>>>2];return this.sigBytes+=L,this},clamp:function(){var g=this.words,m=this.sigBytes;g[m>>>2]&=4294967295<<32-m%4*8,g.length=n.ceil(m/4)},clone:function(){var g=c.clone.call(this);return g.words=this.words.slice(0),g},random:function(g){for(var m=[],E=0;E<g;E+=4)m.push(a());return new d.init(m,g)}}),f=u.enc={},h=f.Hex={stringify:function(g){for(var m=g.words,E=g.sigBytes,T=[],L=0;L<E;L++){var A=m[L>>>2]>>>24-L%4*8&255;T.push((A>>>4).toString(16)),T.push((A&15).toString(16))}return T.join("")},parse:function(g){for(var m=g.length,E=[],T=0;T<m;T+=2)E[T>>>3]|=parseInt(g.substr(T,2),16)<<24-T%8*4;return new d.init(E,m/2)}},p=f.Latin1={stringify:function(g){for(var m=g.words,E=g.sigBytes,T=[],L=0;L<E;L++){var A=m[L>>>2]>>>24-L%4*8&255;T.push(String.fromCharCode(A))}return T.join("")},parse:function(g){for(var m=g.length,E=[],T=0;T<m;T++)E[T>>>2]|=(g.charCodeAt(T)&255)<<24-T%4*8;return new d.init(E,m)}},x=f.Utf8={stringify:function(g){try{return decodeURIComponent(escape(p.stringify(g)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(g){return p.parse(unescape(encodeURIComponent(g)))}},v=l.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new d.init,this._nDataBytes=0},_append:function(g){typeof g=="string"&&(g=x.parse(g)),this._data.concat(g),this._nDataBytes+=g.sigBytes},_process:function(g){var m,E=this._data,T=E.words,L=E.sigBytes,A=this.blockSize,R=A*4,I=L/R;g?I=n.ceil(I):I=n.max((I|0)-this._minBufferSize,0);var C=I*A,_=n.min(C*4,L);if(C){for(var F=0;F<C;F+=A)this._doProcessBlock(T,F);m=T.splice(0,C),E.sigBytes-=_}return new d.init(m,_)},clone:function(){var g=c.clone.call(this);return g._data=this._data.clone(),g},_minBufferSize:0});l.Hasher=v.extend({cfg:c.extend(),init:function(g){this.cfg=this.cfg.extend(g),this.reset()},reset:function(){v.reset.call(this),this._doReset()},update:function(g){return this._append(g),this._process(),this},finalize:function(g){g&&this._append(g);var m=this._doFinalize();return m},blockSize:16,_createHelper:function(g){return function(m,E){return new g.init(E).finalize(m)}},_createHmacHelper:function(g){return function(m,E){return new y.HMAC.init(g,E).finalize(m)}}});var y=u.algo={};return u}(Math);return t})}(Du)),Du.exports}var ku={exports:{}},Zp;function Sl(){return Zp||(Zp=1,function(r,e){(function(t,n){r.exports=n(ve())})(ge,function(t){return function(n){var i=t,s=i.lib,a=s.Base,o=s.WordArray,u=i.x64={};u.Word=a.extend({init:function(l,c){this.high=l,this.low=c}}),u.WordArray=a.extend({init:function(l,c){l=this.words=l||[],c!=n?this.sigBytes=c:this.sigBytes=l.length*8},toX32:function(){for(var l=this.words,c=l.length,d=[],f=0;f<c;f++){var h=l[f];d.push(h.high),d.push(h.low)}return o.create(d,this.sigBytes)},clone:function(){for(var l=a.clone.call(this),c=l.words=this.words.slice(0),d=c.length,f=0;f<d;f++)c[f]=c[f].clone();return l}})}(),t})}(ku)),ku.exports}var wu={exports:{}},Jp;function h4(){return Jp||(Jp=1,function(r,e){(function(t,n){r.exports=n(ve())})(ge,function(t){return function(){if(typeof ArrayBuffer=="function"){var n=t,i=n.lib,s=i.WordArray,a=s.init,o=s.init=function(u){if(u instanceof ArrayBuffer&&(u=new Uint8Array(u)),(u instanceof Int8Array||typeof Uint8ClampedArray<"u"&&u instanceof Uint8ClampedArray||u instanceof Int16Array||u instanceof Uint16Array||u instanceof Int32Array||u instanceof Uint32Array||u instanceof Float32Array||u instanceof Float64Array)&&(u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength)),u instanceof Uint8Array){for(var l=u.byteLength,c=[],d=0;d<l;d++)c[d>>>2]|=u[d]<<24-d%4*8;a.call(this,c,l)}else a.apply(this,arguments)};o.prototype=s}}(),t.lib.WordArray})}(wu)),wu.exports}var bu={exports:{}},eg;function p4(){return eg||(eg=1,function(r,e){(function(t,n){r.exports=n(ve())})(ge,function(t){return function(){var n=t,i=n.lib,s=i.WordArray,a=n.enc;a.Utf16=a.Utf16BE={stringify:function(u){for(var l=u.words,c=u.sigBytes,d=[],f=0;f<c;f+=2){var h=l[f>>>2]>>>16-f%4*8&65535;d.push(String.fromCharCode(h))}return d.join("")},parse:function(u){for(var l=u.length,c=[],d=0;d<l;d++)c[d>>>1]|=u.charCodeAt(d)<<16-d%2*16;return s.create(c,l*2)}},a.Utf16LE={stringify:function(u){for(var l=u.words,c=u.sigBytes,d=[],f=0;f<c;f+=2){var h=o(l[f>>>2]>>>16-f%4*8&65535);d.push(String.fromCharCode(h))}return d.join("")},parse:function(u){for(var l=u.length,c=[],d=0;d<l;d++)c[d>>>1]|=o(u.charCodeAt(d)<<16-d%2*16);return s.create(c,l*2)}};function o(u){return u<<8&4278255360|u>>>8&16711935}}(),t.enc.Utf16})}(bu)),bu.exports}var Pu={exports:{}},tg;function ei(){return tg||(tg=1,function(r,e){(function(t,n){r.exports=n(ve())})(ge,function(t){return function(){var n=t,i=n.lib,s=i.WordArray,a=n.enc;a.Base64={stringify:function(u){var l=u.words,c=u.sigBytes,d=this._map;u.clamp();for(var f=[],h=0;h<c;h+=3)for(var p=l[h>>>2]>>>24-h%4*8&255,x=l[h+1>>>2]>>>24-(h+1)%4*8&255,v=l[h+2>>>2]>>>24-(h+2)%4*8&255,y=p<<16|x<<8|v,g=0;g<4&&h+g*.75<c;g++)f.push(d.charAt(y>>>6*(3-g)&63));var m=d.charAt(64);if(m)for(;f.length%4;)f.push(m);return f.join("")},parse:function(u){var l=u.length,c=this._map,d=this._reverseMap;if(!d){d=this._reverseMap=[];for(var f=0;f<c.length;f++)d[c.charCodeAt(f)]=f}var h=c.charAt(64);if(h){var p=u.indexOf(h);p!==-1&&(l=p)}return o(u,l,d)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function o(u,l,c){for(var d=[],f=0,h=0;h<l;h++)if(h%4){var p=c[u.charCodeAt(h-1)]<<h%4*2,x=c[u.charCodeAt(h)]>>>6-h%4*2,v=p|x;d[f>>>2]|=v<<24-f%4*8,f++}return s.create(d,f)}}(),t.enc.Base64})}(Pu)),Pu.exports}var Fu={exports:{}},rg;function g4(){return rg||(rg=1,function(r,e){(function(t,n){r.exports=n(ve())})(ge,function(t){return function(){var n=t,i=n.lib,s=i.WordArray,a=n.enc;a.Base64url={stringify:function(u,l){l===void 0&&(l=!0);var c=u.words,d=u.sigBytes,f=l?this._safe_map:this._map;u.clamp();for(var h=[],p=0;p<d;p+=3)for(var x=c[p>>>2]>>>24-p%4*8&255,v=c[p+1>>>2]>>>24-(p+1)%4*8&255,y=c[p+2>>>2]>>>24-(p+2)%4*8&255,g=x<<16|v<<8|y,m=0;m<4&&p+m*.75<d;m++)h.push(f.charAt(g>>>6*(3-m)&63));var E=f.charAt(64);if(E)for(;h.length%4;)h.push(E);return h.join("")},parse:function(u,l){l===void 0&&(l=!0);var c=u.length,d=l?this._safe_map:this._map,f=this._reverseMap;if(!f){f=this._reverseMap=[];for(var h=0;h<d.length;h++)f[d.charCodeAt(h)]=h}var p=d.charAt(64);if(p){var x=u.indexOf(p);x!==-1&&(c=x)}return o(u,c,f)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};function o(u,l,c){for(var d=[],f=0,h=0;h<l;h++)if(h%4){var p=c[u.charCodeAt(h-1)]<<h%4*2,x=c[u.charCodeAt(h)]>>>6-h%4*2,v=p|x;d[f>>>2]|=v<<24-f%4*8,f++}return s.create(d,f)}}(),t.enc.Base64url})}(Fu)),Fu.exports}var Bu={exports:{}},ng;function ti(){return ng||(ng=1,function(r,e){(function(t,n){r.exports=n(ve())})(ge,function(t){return function(n){var i=t,s=i.lib,a=s.WordArray,o=s.Hasher,u=i.algo,l=[];(function(){for(var x=0;x<64;x++)l[x]=n.abs(n.sin(x+1))*4294967296|0})();var c=u.MD5=o.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(x,v){for(var y=0;y<16;y++){var g=v+y,m=x[g];x[g]=(m<<8|m>>>24)&16711935|(m<<24|m>>>8)&4278255360}var E=this._hash.words,T=x[v+0],L=x[v+1],A=x[v+2],R=x[v+3],I=x[v+4],C=x[v+5],_=x[v+6],F=x[v+7],B=x[v+8],V=x[v+9],j=x[v+10],G=x[v+11],Y=x[v+12],O=x[v+13],H=x[v+14],K=x[v+15],w=E[0],P=E[1],U=E[2],$=E[3];w=d(w,P,U,$,T,7,l[0]),$=d($,w,P,U,L,12,l[1]),U=d(U,$,w,P,A,17,l[2]),P=d(P,U,$,w,R,22,l[3]),w=d(w,P,U,$,I,7,l[4]),$=d($,w,P,U,C,12,l[5]),U=d(U,$,w,P,_,17,l[6]),P=d(P,U,$,w,F,22,l[7]),w=d(w,P,U,$,B,7,l[8]),$=d($,w,P,U,V,12,l[9]),U=d(U,$,w,P,j,17,l[10]),P=d(P,U,$,w,G,22,l[11]),w=d(w,P,U,$,Y,7,l[12]),$=d($,w,P,U,O,12,l[13]),U=d(U,$,w,P,H,17,l[14]),P=d(P,U,$,w,K,22,l[15]),w=f(w,P,U,$,L,5,l[16]),$=f($,w,P,U,_,9,l[17]),U=f(U,$,w,P,G,14,l[18]),P=f(P,U,$,w,T,20,l[19]),w=f(w,P,U,$,C,5,l[20]),$=f($,w,P,U,j,9,l[21]),U=f(U,$,w,P,K,14,l[22]),P=f(P,U,$,w,I,20,l[23]),w=f(w,P,U,$,V,5,l[24]),$=f($,w,P,U,H,9,l[25]),U=f(U,$,w,P,R,14,l[26]),P=f(P,U,$,w,B,20,l[27]),w=f(w,P,U,$,O,5,l[28]),$=f($,w,P,U,A,9,l[29]),U=f(U,$,w,P,F,14,l[30]),P=f(P,U,$,w,Y,20,l[31]),w=h(w,P,U,$,C,4,l[32]),$=h($,w,P,U,B,11,l[33]),U=h(U,$,w,P,G,16,l[34]),P=h(P,U,$,w,H,23,l[35]),w=h(w,P,U,$,L,4,l[36]),$=h($,w,P,U,I,11,l[37]),U=h(U,$,w,P,F,16,l[38]),P=h(P,U,$,w,j,23,l[39]),w=h(w,P,U,$,O,4,l[40]),$=h($,w,P,U,T,11,l[41]),U=h(U,$,w,P,R,16,l[42]),P=h(P,U,$,w,_,23,l[43]),w=h(w,P,U,$,V,4,l[44]),$=h($,w,P,U,Y,11,l[45]),U=h(U,$,w,P,K,16,l[46]),P=h(P,U,$,w,A,23,l[47]),w=p(w,P,U,$,T,6,l[48]),$=p($,w,P,U,F,10,l[49]),U=p(U,$,w,P,H,15,l[50]),P=p(P,U,$,w,C,21,l[51]),w=p(w,P,U,$,Y,6,l[52]),$=p($,w,P,U,R,10,l[53]),U=p(U,$,w,P,j,15,l[54]),P=p(P,U,$,w,L,21,l[55]),w=p(w,P,U,$,B,6,l[56]),$=p($,w,P,U,K,10,l[57]),U=p(U,$,w,P,_,15,l[58]),P=p(P,U,$,w,O,21,l[59]),w=p(w,P,U,$,I,6,l[60]),$=p($,w,P,U,G,10,l[61]),U=p(U,$,w,P,A,15,l[62]),P=p(P,U,$,w,V,21,l[63]),E[0]=E[0]+w|0,E[1]=E[1]+P|0,E[2]=E[2]+U|0,E[3]=E[3]+$|0},_doFinalize:function(){var x=this._data,v=x.words,y=this._nDataBytes*8,g=x.sigBytes*8;v[g>>>5]|=128<<24-g%32;var m=n.floor(y/4294967296),E=y;v[(g+64>>>9<<4)+15]=(m<<8|m>>>24)&16711935|(m<<24|m>>>8)&4278255360,v[(g+64>>>9<<4)+14]=(E<<8|E>>>24)&16711935|(E<<24|E>>>8)&4278255360,x.sigBytes=(v.length+1)*4,this._process();for(var T=this._hash,L=T.words,A=0;A<4;A++){var R=L[A];L[A]=(R<<8|R>>>24)&16711935|(R<<24|R>>>8)&4278255360}return T},clone:function(){var x=o.clone.call(this);return x._hash=this._hash.clone(),x}});function d(x,v,y,g,m,E,T){var L=x+(v&y|~v&g)+m+T;return(L<<E|L>>>32-E)+v}function f(x,v,y,g,m,E,T){var L=x+(v&g|y&~g)+m+T;return(L<<E|L>>>32-E)+v}function h(x,v,y,g,m,E,T){var L=x+(v^y^g)+m+T;return(L<<E|L>>>32-E)+v}function p(x,v,y,g,m,E,T){var L=x+(y^(v|~g))+m+T;return(L<<E|L>>>32-E)+v}i.MD5=o._createHelper(c),i.HmacMD5=o._createHmacHelper(c)}(Math),t.MD5})}(Bu)),Bu.exports}var Ou={exports:{}},ig;function Uv(){return ig||(ig=1,function(r,e){(function(t,n){r.exports=n(ve())})(ge,function(t){return function(){var n=t,i=n.lib,s=i.WordArray,a=i.Hasher,o=n.algo,u=[],l=o.SHA1=a.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(c,d){for(var f=this._hash.words,h=f[0],p=f[1],x=f[2],v=f[3],y=f[4],g=0;g<80;g++){if(g<16)u[g]=c[d+g]|0;else{var m=u[g-3]^u[g-8]^u[g-14]^u[g-16];u[g]=m<<1|m>>>31}var E=(h<<5|h>>>27)+y+u[g];g<20?E+=(p&x|~p&v)+1518500249:g<40?E+=(p^x^v)+1859775393:g<60?E+=(p&x|p&v|x&v)-1894007588:E+=(p^x^v)-899497514,y=v,v=x,x=p<<30|p>>>2,p=h,h=E}f[0]=f[0]+h|0,f[1]=f[1]+p|0,f[2]=f[2]+x|0,f[3]=f[3]+v|0,f[4]=f[4]+y|0},_doFinalize:function(){var c=this._data,d=c.words,f=this._nDataBytes*8,h=c.sigBytes*8;return d[h>>>5]|=128<<24-h%32,d[(h+64>>>9<<4)+14]=Math.floor(f/4294967296),d[(h+64>>>9<<4)+15]=f,c.sigBytes=d.length*4,this._process(),this._hash},clone:function(){var c=a.clone.call(this);return c._hash=this._hash.clone(),c}});n.SHA1=a._createHelper(l),n.HmacSHA1=a._createHmacHelper(l)}(),t.SHA1})}(Ou)),Ou.exports}var Mu={exports:{}},sg;function n0(){return sg||(sg=1,function(r,e){(function(t,n){r.exports=n(ve())})(ge,function(t){return function(n){var i=t,s=i.lib,a=s.WordArray,o=s.Hasher,u=i.algo,l=[],c=[];(function(){function h(y){for(var g=n.sqrt(y),m=2;m<=g;m++)if(!(y%m))return!1;return!0}function p(y){return(y-(y|0))*4294967296|0}for(var x=2,v=0;v<64;)h(x)&&(v<8&&(l[v]=p(n.pow(x,1/2))),c[v]=p(n.pow(x,1/3)),v++),x++})();var d=[],f=u.SHA256=o.extend({_doReset:function(){this._hash=new a.init(l.slice(0))},_doProcessBlock:function(h,p){for(var x=this._hash.words,v=x[0],y=x[1],g=x[2],m=x[3],E=x[4],T=x[5],L=x[6],A=x[7],R=0;R<64;R++){if(R<16)d[R]=h[p+R]|0;else{var I=d[R-15],C=(I<<25|I>>>7)^(I<<14|I>>>18)^I>>>3,_=d[R-2],F=(_<<15|_>>>17)^(_<<13|_>>>19)^_>>>10;d[R]=C+d[R-7]+F+d[R-16]}var B=E&T^~E&L,V=v&y^v&g^y&g,j=(v<<30|v>>>2)^(v<<19|v>>>13)^(v<<10|v>>>22),G=(E<<26|E>>>6)^(E<<21|E>>>11)^(E<<7|E>>>25),Y=A+G+B+c[R]+d[R],O=j+V;A=L,L=T,T=E,E=m+Y|0,m=g,g=y,y=v,v=Y+O|0}x[0]=x[0]+v|0,x[1]=x[1]+y|0,x[2]=x[2]+g|0,x[3]=x[3]+m|0,x[4]=x[4]+E|0,x[5]=x[5]+T|0,x[6]=x[6]+L|0,x[7]=x[7]+A|0},_doFinalize:function(){var h=this._data,p=h.words,x=this._nDataBytes*8,v=h.sigBytes*8;return p[v>>>5]|=128<<24-v%32,p[(v+64>>>9<<4)+14]=n.floor(x/4294967296),p[(v+64>>>9<<4)+15]=x,h.sigBytes=p.length*4,this._process(),this._hash},clone:function(){var h=o.clone.call(this);return h._hash=this._hash.clone(),h}});i.SHA256=o._createHelper(f),i.HmacSHA256=o._createHmacHelper(f)}(Math),t.SHA256})}(Mu)),Mu.exports}var Nu={exports:{}},ag;function m4(){return ag||(ag=1,function(r,e){(function(t,n,i){r.exports=n(ve(),n0())})(ge,function(t){return function(){var n=t,i=n.lib,s=i.WordArray,a=n.algo,o=a.SHA256,u=a.SHA224=o.extend({_doReset:function(){this._hash=new s.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var l=o._doFinalize.call(this);return l.sigBytes-=4,l}});n.SHA224=o._createHelper(u),n.HmacSHA224=o._createHmacHelper(u)}(),t.SHA224})}(Nu)),Nu.exports}var $u={exports:{}},og;function Gv(){return og||(og=1,function(r,e){(function(t,n,i){r.exports=n(ve(),Sl())})(ge,function(t){return function(){var n=t,i=n.lib,s=i.Hasher,a=n.x64,o=a.Word,u=a.WordArray,l=n.algo;function c(){return o.create.apply(o,arguments)}var d=[c(1116352408,3609767458),c(1899447441,602891725),c(3049323471,3964484399),c(3921009573,2173295548),c(961987163,4081628472),c(1508970993,3053834265),c(2453635748,2937671579),c(2870763221,3664609560),c(3624381080,2734883394),c(310598401,1164996542),c(607225278,1323610764),c(1426881987,3590304994),c(1925078388,4068182383),c(2162078206,991336113),c(2614888103,633803317),c(3248222580,3479774868),c(3835390401,2666613458),c(4022224774,944711139),c(264347078,2341262773),c(604807628,2007800933),c(770255983,1495990901),c(1249150122,1856431235),c(1555081692,3175218132),c(1996064986,2198950837),c(2554220882,3999719339),c(2821834349,766784016),c(2952996808,2566594879),c(3210313671,3203337956),c(3336571891,1034457026),c(3584528711,2466948901),c(113926993,3758326383),c(338241895,168717936),c(666307205,1188179964),c(773529912,1546045734),c(1294757372,1522805485),c(1396182291,2643833823),c(1695183700,2343527390),c(1986661051,1014477480),c(2177026350,1206759142),c(2456956037,344077627),c(2730485921,1290863460),c(2820302411,3158454273),c(3259730800,3505952657),c(3345764771,106217008),c(3516065817,3606008344),c(3600352804,1432725776),c(4094571909,1467031594),c(275423344,851169720),c(430227734,3100823752),c(506948616,1363258195),c(659060556,3750685593),c(883997877,3785050280),c(958139571,3318307427),c(1322822218,3812723403),c(1537002063,2003034995),c(1747873779,3602036899),c(1955562222,1575990012),c(2024104815,1125592928),c(2227730452,2716904306),c(2361852424,442776044),c(2428436474,593698344),c(2756734187,3733110249),c(3204031479,2999351573),c(3329325298,3815920427),c(3391569614,3928383900),c(3515267271,566280711),c(3940187606,3454069534),c(4118630271,4000239992),c(116418474,1914138554),c(174292421,2731055270),c(289380356,3203993006),c(460393269,320620315),c(685471733,587496836),c(852142971,1086792851),c(1017036298,365543100),c(1126000580,2618297676),c(1288033470,3409855158),c(1501505948,4234509866),c(1607167915,987167468),c(1816402316,1246189591)],f=[];(function(){for(var p=0;p<80;p++)f[p]=c()})();var h=l.SHA512=s.extend({_doReset:function(){this._hash=new u.init([new o.init(1779033703,4089235720),new o.init(3144134277,2227873595),new o.init(1013904242,4271175723),new o.init(2773480762,1595750129),new o.init(1359893119,2917565137),new o.init(2600822924,725511199),new o.init(528734635,4215389547),new o.init(1541459225,327033209)])},_doProcessBlock:function(p,x){for(var v=this._hash.words,y=v[0],g=v[1],m=v[2],E=v[3],T=v[4],L=v[5],A=v[6],R=v[7],I=y.high,C=y.low,_=g.high,F=g.low,B=m.high,V=m.low,j=E.high,G=E.low,Y=T.high,O=T.low,H=L.high,K=L.low,w=A.high,P=A.low,U=R.high,$=R.low,Q=I,J=C,he=_,ne=F,Fe=B,Be=V,$t=j,Ut=G,at=Y,Ye=O,Dn=H,fe=K,Oe=w,ze=P,kt=U,qe=$,Te=0;Te<80;Te++){var Me,Ne,wt=f[Te];if(Te<16)Ne=wt.high=p[x+Te*2]|0,Me=wt.low=p[x+Te*2+1]|0;else{var ht=f[Te-15],Et=ht.high,ur=ht.low,ri=(Et>>>1|ur<<31)^(Et>>>8|ur<<24)^Et>>>7,Br=(ur>>>1|Et<<31)^(ur>>>8|Et<<24)^(ur>>>7|Et<<25),Gt=f[Te-2],ot=Gt.high,Ht=Gt.low,sa=(ot>>>19|Ht<<13)^(ot<<3|Ht>>>29)^ot>>>6,en=(Ht>>>19|ot<<13)^(Ht<<3|ot>>>29)^(Ht>>>6|ot<<26),Ee=f[Te-7],kn=Ee.high,aa=Ee.low,qi=f[Te-16],Tl=qi.high,oa=qi.low;Me=Br+aa,Ne=ri+kn+(Me>>>0<Br>>>0?1:0),Me=Me+en,Ne=Ne+sa+(Me>>>0<en>>>0?1:0),Me=Me+oa,Ne=Ne+Tl+(Me>>>0<oa>>>0?1:0),wt.high=Ne,wt.low=Me}var Al=at&Dn^~at&Oe,Xi=Ye&fe^~Ye&ze,Qi=Q&he^Q&Fe^he&Fe,Cl=J&ne^J&Be^ne&Be,Ll=(Q>>>28|J<<4)^(Q<<30|J>>>2)^(Q<<25|J>>>7),la=(J>>>28|Q<<4)^(J<<30|Q>>>2)^(J<<25|Q>>>7),Rl=(at>>>14|Ye<<18)^(at>>>18|Ye<<14)^(at<<23|Ye>>>9),Il=(Ye>>>14|at<<18)^(Ye>>>18|at<<14)^(Ye<<23|at>>>9),ua=d[Te],ca=ua.high,da=ua.low,St=qe+Il,Tt=kt+Rl+(St>>>0<qe>>>0?1:0),St=St+Xi,Tt=Tt+Al+(St>>>0<Xi>>>0?1:0),St=St+da,Tt=Tt+ca+(St>>>0<da>>>0?1:0),St=St+Me,Tt=Tt+Ne+(St>>>0<Me>>>0?1:0),wn=la+Cl,bn=Ll+Qi+(wn>>>0<la>>>0?1:0);kt=Oe,qe=ze,Oe=Dn,ze=fe,Dn=at,fe=Ye,Ye=Ut+St|0,at=$t+Tt+(Ye>>>0<Ut>>>0?1:0)|0,$t=Fe,Ut=Be,Fe=he,Be=ne,he=Q,ne=J,J=St+wn|0,Q=Tt+bn+(J>>>0<St>>>0?1:0)|0}C=y.low=C+J,y.high=I+Q+(C>>>0<J>>>0?1:0),F=g.low=F+ne,g.high=_+he+(F>>>0<ne>>>0?1:0),V=m.low=V+Be,m.high=B+Fe+(V>>>0<Be>>>0?1:0),G=E.low=G+Ut,E.high=j+$t+(G>>>0<Ut>>>0?1:0),O=T.low=O+Ye,T.high=Y+at+(O>>>0<Ye>>>0?1:0),K=L.low=K+fe,L.high=H+Dn+(K>>>0<fe>>>0?1:0),P=A.low=P+ze,A.high=w+Oe+(P>>>0<ze>>>0?1:0),$=R.low=$+qe,R.high=U+kt+($>>>0<qe>>>0?1:0)},_doFinalize:function(){var p=this._data,x=p.words,v=this._nDataBytes*8,y=p.sigBytes*8;x[y>>>5]|=128<<24-y%32,x[(y+128>>>10<<5)+30]=Math.floor(v/4294967296),x[(y+128>>>10<<5)+31]=v,p.sigBytes=x.length*4,this._process();var g=this._hash.toX32();return g},clone:function(){var p=s.clone.call(this);return p._hash=this._hash.clone(),p},blockSize:1024/32});n.SHA512=s._createHelper(h),n.HmacSHA512=s._createHmacHelper(h)}(),t.SHA512})}($u)),$u.exports}var Uu={exports:{}},lg;function x4(){return lg||(lg=1,function(r,e){(function(t,n,i){r.exports=n(ve(),Sl(),Gv())})(ge,function(t){return function(){var n=t,i=n.x64,s=i.Word,a=i.WordArray,o=n.algo,u=o.SHA512,l=o.SHA384=u.extend({_doReset:function(){this._hash=new a.init([new s.init(3418070365,3238371032),new s.init(1654270250,914150663),new s.init(2438529370,812702999),new s.init(355462360,4144912697),new s.init(1731405415,4290775857),new s.init(2394180231,1750603025),new s.init(3675008525,1694076839),new s.init(1203062813,3204075428)])},_doFinalize:function(){var c=u._doFinalize.call(this);return c.sigBytes-=16,c}});n.SHA384=u._createHelper(l),n.HmacSHA384=u._createHmacHelper(l)}(),t.SHA384})}(Uu)),Uu.exports}var Gu={exports:{}},ug;function v4(){return ug||(ug=1,function(r,e){(function(t,n,i){r.exports=n(ve(),Sl())})(ge,function(t){return function(n){var i=t,s=i.lib,a=s.WordArray,o=s.Hasher,u=i.x64,l=u.Word,c=i.algo,d=[],f=[],h=[];(function(){for(var v=1,y=0,g=0;g<24;g++){d[v+5*y]=(g+1)*(g+2)/2%64;var m=y%5,E=(2*v+3*y)%5;v=m,y=E}for(var v=0;v<5;v++)for(var y=0;y<5;y++)f[v+5*y]=y+(2*v+3*y)%5*5;for(var T=1,L=0;L<24;L++){for(var A=0,R=0,I=0;I<7;I++){if(T&1){var C=(1<<I)-1;C<32?R^=1<<C:A^=1<<C-32}T&128?T=T<<1^113:T<<=1}h[L]=l.create(A,R)}})();var p=[];(function(){for(var v=0;v<25;v++)p[v]=l.create()})();var x=c.SHA3=o.extend({cfg:o.cfg.extend({outputLength:512}),_doReset:function(){for(var v=this._state=[],y=0;y<25;y++)v[y]=new l.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(v,y){for(var g=this._state,m=this.blockSize/2,E=0;E<m;E++){var T=v[y+2*E],L=v[y+2*E+1];T=(T<<8|T>>>24)&16711935|(T<<24|T>>>8)&4278255360,L=(L<<8|L>>>24)&16711935|(L<<24|L>>>8)&4278255360;var A=g[E];A.high^=L,A.low^=T}for(var R=0;R<24;R++){for(var I=0;I<5;I++){for(var C=0,_=0,F=0;F<5;F++){var A=g[I+5*F];C^=A.high,_^=A.low}var B=p[I];B.high=C,B.low=_}for(var I=0;I<5;I++)for(var V=p[(I+4)%5],j=p[(I+1)%5],G=j.high,Y=j.low,C=V.high^(G<<1|Y>>>31),_=V.low^(Y<<1|G>>>31),F=0;F<5;F++){var A=g[I+5*F];A.high^=C,A.low^=_}for(var O=1;O<25;O++){var C,_,A=g[O],H=A.high,K=A.low,w=d[O];w<32?(C=H<<w|K>>>32-w,_=K<<w|H>>>32-w):(C=K<<w-32|H>>>64-w,_=H<<w-32|K>>>64-w);var P=p[f[O]];P.high=C,P.low=_}var U=p[0],$=g[0];U.high=$.high,U.low=$.low;for(var I=0;I<5;I++)for(var F=0;F<5;F++){var O=I+5*F,A=g[O],Q=p[O],J=p[(I+1)%5+5*F],he=p[(I+2)%5+5*F];A.high=Q.high^~J.high&he.high,A.low=Q.low^~J.low&he.low}var A=g[0],ne=h[R];A.high^=ne.high,A.low^=ne.low}},_doFinalize:function(){var v=this._data,y=v.words;this._nDataBytes*8;var g=v.sigBytes*8,m=this.blockSize*32;y[g>>>5]|=1<<24-g%32,y[(n.ceil((g+1)/m)*m>>>5)-1]|=128,v.sigBytes=y.length*4,this._process();for(var E=this._state,T=this.cfg.outputLength/8,L=T/8,A=[],R=0;R<L;R++){var I=E[R],C=I.high,_=I.low;C=(C<<8|C>>>24)&16711935|(C<<24|C>>>8)&4278255360,_=(_<<8|_>>>24)&16711935|(_<<24|_>>>8)&4278255360,A.push(_),A.push(C)}return new a.init(A,T)},clone:function(){for(var v=o.clone.call(this),y=v._state=this._state.slice(0),g=0;g<25;g++)y[g]=y[g].clone();return v}});i.SHA3=o._createHelper(x),i.HmacSHA3=o._createHmacHelper(x)}(Math),t.SHA3})}(Gu)),Gu.exports}var Hu={exports:{}},cg;function y4(){return cg||(cg=1,function(r,e){(function(t,n){r.exports=n(ve())})(ge,function(t){/** @preserve
			(c) 2012 by Cdric Mesnil. All rights reserved.

			Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

			    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
			    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

			THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
			*/return function(n){var i=t,s=i.lib,a=s.WordArray,o=s.Hasher,u=i.algo,l=a.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),c=a.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),d=a.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),f=a.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),h=a.create([0,1518500249,1859775393,2400959708,2840853838]),p=a.create([1352829926,1548603684,1836072691,2053994217,0]),x=u.RIPEMD160=o.extend({_doReset:function(){this._hash=a.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(L,A){for(var R=0;R<16;R++){var I=A+R,C=L[I];L[I]=(C<<8|C>>>24)&16711935|(C<<24|C>>>8)&4278255360}var _=this._hash.words,F=h.words,B=p.words,V=l.words,j=c.words,G=d.words,Y=f.words,O,H,K,w,P,U,$,Q,J,he;U=O=_[0],$=H=_[1],Q=K=_[2],J=w=_[3],he=P=_[4];for(var ne,R=0;R<80;R+=1)ne=O+L[A+V[R]]|0,R<16?ne+=v(H,K,w)+F[0]:R<32?ne+=y(H,K,w)+F[1]:R<48?ne+=g(H,K,w)+F[2]:R<64?ne+=m(H,K,w)+F[3]:ne+=E(H,K,w)+F[4],ne=ne|0,ne=T(ne,G[R]),ne=ne+P|0,O=P,P=w,w=T(K,10),K=H,H=ne,ne=U+L[A+j[R]]|0,R<16?ne+=E($,Q,J)+B[0]:R<32?ne+=m($,Q,J)+B[1]:R<48?ne+=g($,Q,J)+B[2]:R<64?ne+=y($,Q,J)+B[3]:ne+=v($,Q,J)+B[4],ne=ne|0,ne=T(ne,Y[R]),ne=ne+he|0,U=he,he=J,J=T(Q,10),Q=$,$=ne;ne=_[1]+K+J|0,_[1]=_[2]+w+he|0,_[2]=_[3]+P+U|0,_[3]=_[4]+O+$|0,_[4]=_[0]+H+Q|0,_[0]=ne},_doFinalize:function(){var L=this._data,A=L.words,R=this._nDataBytes*8,I=L.sigBytes*8;A[I>>>5]|=128<<24-I%32,A[(I+64>>>9<<4)+14]=(R<<8|R>>>24)&16711935|(R<<24|R>>>8)&4278255360,L.sigBytes=(A.length+1)*4,this._process();for(var C=this._hash,_=C.words,F=0;F<5;F++){var B=_[F];_[F]=(B<<8|B>>>24)&16711935|(B<<24|B>>>8)&4278255360}return C},clone:function(){var L=o.clone.call(this);return L._hash=this._hash.clone(),L}});function v(L,A,R){return L^A^R}function y(L,A,R){return L&A|~L&R}function g(L,A,R){return(L|~A)^R}function m(L,A,R){return L&R|A&~R}function E(L,A,R){return L^(A|~R)}function T(L,A){return L<<A|L>>>32-A}i.RIPEMD160=o._createHelper(x),i.HmacRIPEMD160=o._createHmacHelper(x)}(),t.RIPEMD160})}(Hu)),Hu.exports}var Vu={exports:{}},dg;function i0(){return dg||(dg=1,function(r,e){(function(t,n){r.exports=n(ve())})(ge,function(t){(function(){var n=t,i=n.lib,s=i.Base,a=n.enc,o=a.Utf8,u=n.algo;u.HMAC=s.extend({init:function(l,c){l=this._hasher=new l.init,typeof c=="string"&&(c=o.parse(c));var d=l.blockSize,f=d*4;c.sigBytes>f&&(c=l.finalize(c)),c.clamp();for(var h=this._oKey=c.clone(),p=this._iKey=c.clone(),x=h.words,v=p.words,y=0;y<d;y++)x[y]^=1549556828,v[y]^=909522486;h.sigBytes=p.sigBytes=f,this.reset()},reset:function(){var l=this._hasher;l.reset(),l.update(this._iKey)},update:function(l){return this._hasher.update(l),this},finalize:function(l){var c=this._hasher,d=c.finalize(l);c.reset();var f=c.finalize(this._oKey.clone().concat(d));return f}})})()})}(Vu)),Vu.exports}var ju={exports:{}},fg;function E4(){return fg||(fg=1,function(r,e){(function(t,n,i){r.exports=n(ve(),n0(),i0())})(ge,function(t){return function(){var n=t,i=n.lib,s=i.Base,a=i.WordArray,o=n.algo,u=o.SHA256,l=o.HMAC,c=o.PBKDF2=s.extend({cfg:s.extend({keySize:128/32,hasher:u,iterations:25e4}),init:function(d){this.cfg=this.cfg.extend(d)},compute:function(d,f){for(var h=this.cfg,p=l.create(h.hasher,d),x=a.create(),v=a.create([1]),y=x.words,g=v.words,m=h.keySize,E=h.iterations;y.length<m;){var T=p.update(f).finalize(v);p.reset();for(var L=T.words,A=L.length,R=T,I=1;I<E;I++){R=p.finalize(R),p.reset();for(var C=R.words,_=0;_<A;_++)L[_]^=C[_]}x.concat(T),g[0]++}return x.sigBytes=m*4,x}});n.PBKDF2=function(d,f,h){return c.create(h).compute(d,f)}}(),t.PBKDF2})}(ju)),ju.exports}var Ku={exports:{}},hg;function _n(){return hg||(hg=1,function(r,e){(function(t,n,i){r.exports=n(ve(),Uv(),i0())})(ge,function(t){return function(){var n=t,i=n.lib,s=i.Base,a=i.WordArray,o=n.algo,u=o.MD5,l=o.EvpKDF=s.extend({cfg:s.extend({keySize:128/32,hasher:u,iterations:1}),init:function(c){this.cfg=this.cfg.extend(c)},compute:function(c,d){for(var f,h=this.cfg,p=h.hasher.create(),x=a.create(),v=x.words,y=h.keySize,g=h.iterations;v.length<y;){f&&p.update(f),f=p.update(c).finalize(d),p.reset();for(var m=1;m<g;m++)f=p.finalize(f),p.reset();x.concat(f)}return x.sigBytes=y*4,x}});n.EvpKDF=function(c,d,f){return l.create(f).compute(c,d)}}(),t.EvpKDF})}(Ku)),Ku.exports}var zu={exports:{}},pg;function st(){return pg||(pg=1,function(r,e){(function(t,n,i){r.exports=n(ve(),_n())})(ge,function(t){t.lib.Cipher||function(n){var i=t,s=i.lib,a=s.Base,o=s.WordArray,u=s.BufferedBlockAlgorithm,l=i.enc;l.Utf8;var c=l.Base64,d=i.algo,f=d.EvpKDF,h=s.Cipher=u.extend({cfg:a.extend(),createEncryptor:function(C,_){return this.create(this._ENC_XFORM_MODE,C,_)},createDecryptor:function(C,_){return this.create(this._DEC_XFORM_MODE,C,_)},init:function(C,_,F){this.cfg=this.cfg.extend(F),this._xformMode=C,this._key=_,this.reset()},reset:function(){u.reset.call(this),this._doReset()},process:function(C){return this._append(C),this._process()},finalize:function(C){C&&this._append(C);var _=this._doFinalize();return _},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function C(_){return typeof _=="string"?I:L}return function(_){return{encrypt:function(F,B,V){return C(B).encrypt(_,F,B,V)},decrypt:function(F,B,V){return C(B).decrypt(_,F,B,V)}}}}()});s.StreamCipher=h.extend({_doFinalize:function(){var C=this._process(!0);return C},blockSize:1});var p=i.mode={},x=s.BlockCipherMode=a.extend({createEncryptor:function(C,_){return this.Encryptor.create(C,_)},createDecryptor:function(C,_){return this.Decryptor.create(C,_)},init:function(C,_){this._cipher=C,this._iv=_}}),v=p.CBC=function(){var C=x.extend();C.Encryptor=C.extend({processBlock:function(F,B){var V=this._cipher,j=V.blockSize;_.call(this,F,B,j),V.encryptBlock(F,B),this._prevBlock=F.slice(B,B+j)}}),C.Decryptor=C.extend({processBlock:function(F,B){var V=this._cipher,j=V.blockSize,G=F.slice(B,B+j);V.decryptBlock(F,B),_.call(this,F,B,j),this._prevBlock=G}});function _(F,B,V){var j,G=this._iv;G?(j=G,this._iv=n):j=this._prevBlock;for(var Y=0;Y<V;Y++)F[B+Y]^=j[Y]}return C}(),y=i.pad={},g=y.Pkcs7={pad:function(C,_){for(var F=_*4,B=F-C.sigBytes%F,V=B<<24|B<<16|B<<8|B,j=[],G=0;G<B;G+=4)j.push(V);var Y=o.create(j,B);C.concat(Y)},unpad:function(C){var _=C.words[C.sigBytes-1>>>2]&255;C.sigBytes-=_}};s.BlockCipher=h.extend({cfg:h.cfg.extend({mode:v,padding:g}),reset:function(){var C;h.reset.call(this);var _=this.cfg,F=_.iv,B=_.mode;this._xformMode==this._ENC_XFORM_MODE?C=B.createEncryptor:(C=B.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==C?this._mode.init(this,F&&F.words):(this._mode=C.call(B,this,F&&F.words),this._mode.__creator=C)},_doProcessBlock:function(C,_){this._mode.processBlock(C,_)},_doFinalize:function(){var C,_=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(_.pad(this._data,this.blockSize),C=this._process(!0)):(C=this._process(!0),_.unpad(C)),C},blockSize:128/32});var m=s.CipherParams=a.extend({init:function(C){this.mixIn(C)},toString:function(C){return(C||this.formatter).stringify(this)}}),E=i.format={},T=E.OpenSSL={stringify:function(C){var _,F=C.ciphertext,B=C.salt;return B?_=o.create([1398893684,1701076831]).concat(B).concat(F):_=F,_.toString(c)},parse:function(C){var _,F=c.parse(C),B=F.words;return B[0]==1398893684&&B[1]==1701076831&&(_=o.create(B.slice(2,4)),B.splice(0,4),F.sigBytes-=16),m.create({ciphertext:F,salt:_})}},L=s.SerializableCipher=a.extend({cfg:a.extend({format:T}),encrypt:function(C,_,F,B){B=this.cfg.extend(B);var V=C.createEncryptor(F,B),j=V.finalize(_),G=V.cfg;return m.create({ciphertext:j,key:F,iv:G.iv,algorithm:C,mode:G.mode,padding:G.padding,blockSize:C.blockSize,formatter:B.format})},decrypt:function(C,_,F,B){B=this.cfg.extend(B),_=this._parse(_,B.format);var V=C.createDecryptor(F,B).finalize(_.ciphertext);return V},_parse:function(C,_){return typeof C=="string"?_.parse(C,this):C}}),A=i.kdf={},R=A.OpenSSL={execute:function(C,_,F,B,V){if(B||(B=o.random(64/8)),V)var j=f.create({keySize:_+F,hasher:V}).compute(C,B);else var j=f.create({keySize:_+F}).compute(C,B);var G=o.create(j.words.slice(_),F*4);return j.sigBytes=_*4,m.create({key:j,iv:G,salt:B})}},I=s.PasswordBasedCipher=L.extend({cfg:L.cfg.extend({kdf:R}),encrypt:function(C,_,F,B){B=this.cfg.extend(B);var V=B.kdf.execute(F,C.keySize,C.ivSize,B.salt,B.hasher);B.iv=V.iv;var j=L.encrypt.call(this,C,_,V.key,B);return j.mixIn(V),j},decrypt:function(C,_,F,B){B=this.cfg.extend(B),_=this._parse(_,B.format);var V=B.kdf.execute(F,C.keySize,C.ivSize,_.salt,B.hasher);B.iv=V.iv;var j=L.decrypt.call(this,C,_,V.key,B);return j}})}()})}(zu)),zu.exports}var Wu={exports:{}},gg;function S4(){return gg||(gg=1,function(r,e){(function(t,n,i){r.exports=n(ve(),st())})(ge,function(t){return t.mode.CFB=function(){var n=t.lib.BlockCipherMode.extend();n.Encryptor=n.extend({processBlock:function(s,a){var o=this._cipher,u=o.blockSize;i.call(this,s,a,u,o),this._prevBlock=s.slice(a,a+u)}}),n.Decryptor=n.extend({processBlock:function(s,a){var o=this._cipher,u=o.blockSize,l=s.slice(a,a+u);i.call(this,s,a,u,o),this._prevBlock=l}});function i(s,a,o,u){var l,c=this._iv;c?(l=c.slice(0),this._iv=void 0):l=this._prevBlock,u.encryptBlock(l,0);for(var d=0;d<o;d++)s[a+d]^=l[d]}return n}(),t.mode.CFB})}(Wu)),Wu.exports}var Yu={exports:{}},mg;function T4(){return mg||(mg=1,function(r,e){(function(t,n,i){r.exports=n(ve(),st())})(ge,function(t){return t.mode.CTR=function(){var n=t.lib.BlockCipherMode.extend(),i=n.Encryptor=n.extend({processBlock:function(s,a){var o=this._cipher,u=o.blockSize,l=this._iv,c=this._counter;l&&(c=this._counter=l.slice(0),this._iv=void 0);var d=c.slice(0);o.encryptBlock(d,0),c[u-1]=c[u-1]+1|0;for(var f=0;f<u;f++)s[a+f]^=d[f]}});return n.Decryptor=i,n}(),t.mode.CTR})}(Yu)),Yu.exports}var qu={exports:{}},xg;function A4(){return xg||(xg=1,function(r,e){(function(t,n,i){r.exports=n(ve(),st())})(ge,function(t){/** @preserve
 * Counter block mode compatible with  Dr Brian Gladman fileenc.c
 * derived from CryptoJS.mode.CTR
 * Jan Hruby jhruby.web@gmail.com
 */return t.mode.CTRGladman=function(){var n=t.lib.BlockCipherMode.extend();function i(o){if((o>>24&255)===255){var u=o>>16&255,l=o>>8&255,c=o&255;u===255?(u=0,l===255?(l=0,c===255?c=0:++c):++l):++u,o=0,o+=u<<16,o+=l<<8,o+=c}else o+=1<<24;return o}function s(o){return(o[0]=i(o[0]))===0&&(o[1]=i(o[1])),o}var a=n.Encryptor=n.extend({processBlock:function(o,u){var l=this._cipher,c=l.blockSize,d=this._iv,f=this._counter;d&&(f=this._counter=d.slice(0),this._iv=void 0),s(f);var h=f.slice(0);l.encryptBlock(h,0);for(var p=0;p<c;p++)o[u+p]^=h[p]}});return n.Decryptor=a,n}(),t.mode.CTRGladman})}(qu)),qu.exports}var Xu={exports:{}},vg;function C4(){return vg||(vg=1,function(r,e){(function(t,n,i){r.exports=n(ve(),st())})(ge,function(t){return t.mode.OFB=function(){var n=t.lib.BlockCipherMode.extend(),i=n.Encryptor=n.extend({processBlock:function(s,a){var o=this._cipher,u=o.blockSize,l=this._iv,c=this._keystream;l&&(c=this._keystream=l.slice(0),this._iv=void 0),o.encryptBlock(c,0);for(var d=0;d<u;d++)s[a+d]^=c[d]}});return n.Decryptor=i,n}(),t.mode.OFB})}(Xu)),Xu.exports}var Qu={exports:{}},yg;function L4(){return yg||(yg=1,function(r,e){(function(t,n,i){r.exports=n(ve(),st())})(ge,function(t){return t.mode.ECB=function(){var n=t.lib.BlockCipherMode.extend();return n.Encryptor=n.extend({processBlock:function(i,s){this._cipher.encryptBlock(i,s)}}),n.Decryptor=n.extend({processBlock:function(i,s){this._cipher.decryptBlock(i,s)}}),n}(),t.mode.ECB})}(Qu)),Qu.exports}var Zu={exports:{}},Eg;function R4(){return Eg||(Eg=1,function(r,e){(function(t,n,i){r.exports=n(ve(),st())})(ge,function(t){return t.pad.AnsiX923={pad:function(n,i){var s=n.sigBytes,a=i*4,o=a-s%a,u=s+o-1;n.clamp(),n.words[u>>>2]|=o<<24-u%4*8,n.sigBytes+=o},unpad:function(n){var i=n.words[n.sigBytes-1>>>2]&255;n.sigBytes-=i}},t.pad.Ansix923})}(Zu)),Zu.exports}var Ju={exports:{}},Sg;function I4(){return Sg||(Sg=1,function(r,e){(function(t,n,i){r.exports=n(ve(),st())})(ge,function(t){return t.pad.Iso10126={pad:function(n,i){var s=i*4,a=s-n.sigBytes%s;n.concat(t.lib.WordArray.random(a-1)).concat(t.lib.WordArray.create([a<<24],1))},unpad:function(n){var i=n.words[n.sigBytes-1>>>2]&255;n.sigBytes-=i}},t.pad.Iso10126})}(Ju)),Ju.exports}var ec={exports:{}},Tg;function _4(){return Tg||(Tg=1,function(r,e){(function(t,n,i){r.exports=n(ve(),st())})(ge,function(t){return t.pad.Iso97971={pad:function(n,i){n.concat(t.lib.WordArray.create([2147483648],1)),t.pad.ZeroPadding.pad(n,i)},unpad:function(n){t.pad.ZeroPadding.unpad(n),n.sigBytes--}},t.pad.Iso97971})}(ec)),ec.exports}var tc={exports:{}},Ag;function D4(){return Ag||(Ag=1,function(r,e){(function(t,n,i){r.exports=n(ve(),st())})(ge,function(t){return t.pad.ZeroPadding={pad:function(n,i){var s=i*4;n.clamp(),n.sigBytes+=s-(n.sigBytes%s||s)},unpad:function(n){for(var i=n.words,s=n.sigBytes-1,s=n.sigBytes-1;s>=0;s--)if(i[s>>>2]>>>24-s%4*8&255){n.sigBytes=s+1;break}}},t.pad.ZeroPadding})}(tc)),tc.exports}var rc={exports:{}},Cg;function k4(){return Cg||(Cg=1,function(r,e){(function(t,n,i){r.exports=n(ve(),st())})(ge,function(t){return t.pad.NoPadding={pad:function(){},unpad:function(){}},t.pad.NoPadding})}(rc)),rc.exports}var nc={exports:{}},Lg;function w4(){return Lg||(Lg=1,function(r,e){(function(t,n,i){r.exports=n(ve(),st())})(ge,function(t){return function(n){var i=t,s=i.lib,a=s.CipherParams,o=i.enc,u=o.Hex,l=i.format;l.Hex={stringify:function(c){return c.ciphertext.toString(u)},parse:function(c){var d=u.parse(c);return a.create({ciphertext:d})}}}(),t.format.Hex})}(nc)),nc.exports}var ic={exports:{}},Rg;function b4(){return Rg||(Rg=1,function(r,e){(function(t,n,i){r.exports=n(ve(),ei(),ti(),_n(),st())})(ge,function(t){return function(){var n=t,i=n.lib,s=i.BlockCipher,a=n.algo,o=[],u=[],l=[],c=[],d=[],f=[],h=[],p=[],x=[],v=[];(function(){for(var m=[],E=0;E<256;E++)E<128?m[E]=E<<1:m[E]=E<<1^283;for(var T=0,L=0,E=0;E<256;E++){var A=L^L<<1^L<<2^L<<3^L<<4;A=A>>>8^A&255^99,o[T]=A,u[A]=T;var R=m[T],I=m[R],C=m[I],_=m[A]*257^A*16843008;l[T]=_<<24|_>>>8,c[T]=_<<16|_>>>16,d[T]=_<<8|_>>>24,f[T]=_;var _=C*16843009^I*65537^R*257^T*16843008;h[A]=_<<24|_>>>8,p[A]=_<<16|_>>>16,x[A]=_<<8|_>>>24,v[A]=_,T?(T=R^m[m[m[C^R]]],L^=m[m[L]]):T=L=1}})();var y=[0,1,2,4,8,16,32,64,128,27,54],g=a.AES=s.extend({_doReset:function(){var m;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var E=this._keyPriorReset=this._key,T=E.words,L=E.sigBytes/4,A=this._nRounds=L+6,R=(A+1)*4,I=this._keySchedule=[],C=0;C<R;C++)C<L?I[C]=T[C]:(m=I[C-1],C%L?L>6&&C%L==4&&(m=o[m>>>24]<<24|o[m>>>16&255]<<16|o[m>>>8&255]<<8|o[m&255]):(m=m<<8|m>>>24,m=o[m>>>24]<<24|o[m>>>16&255]<<16|o[m>>>8&255]<<8|o[m&255],m^=y[C/L|0]<<24),I[C]=I[C-L]^m);for(var _=this._invKeySchedule=[],F=0;F<R;F++){var C=R-F;if(F%4)var m=I[C];else var m=I[C-4];F<4||C<=4?_[F]=m:_[F]=h[o[m>>>24]]^p[o[m>>>16&255]]^x[o[m>>>8&255]]^v[o[m&255]]}}},encryptBlock:function(m,E){this._doCryptBlock(m,E,this._keySchedule,l,c,d,f,o)},decryptBlock:function(m,E){var T=m[E+1];m[E+1]=m[E+3],m[E+3]=T,this._doCryptBlock(m,E,this._invKeySchedule,h,p,x,v,u);var T=m[E+1];m[E+1]=m[E+3],m[E+3]=T},_doCryptBlock:function(m,E,T,L,A,R,I,C){for(var _=this._nRounds,F=m[E]^T[0],B=m[E+1]^T[1],V=m[E+2]^T[2],j=m[E+3]^T[3],G=4,Y=1;Y<_;Y++){var O=L[F>>>24]^A[B>>>16&255]^R[V>>>8&255]^I[j&255]^T[G++],H=L[B>>>24]^A[V>>>16&255]^R[j>>>8&255]^I[F&255]^T[G++],K=L[V>>>24]^A[j>>>16&255]^R[F>>>8&255]^I[B&255]^T[G++],w=L[j>>>24]^A[F>>>16&255]^R[B>>>8&255]^I[V&255]^T[G++];F=O,B=H,V=K,j=w}var O=(C[F>>>24]<<24|C[B>>>16&255]<<16|C[V>>>8&255]<<8|C[j&255])^T[G++],H=(C[B>>>24]<<24|C[V>>>16&255]<<16|C[j>>>8&255]<<8|C[F&255])^T[G++],K=(C[V>>>24]<<24|C[j>>>16&255]<<16|C[F>>>8&255]<<8|C[B&255])^T[G++],w=(C[j>>>24]<<24|C[F>>>16&255]<<16|C[B>>>8&255]<<8|C[V&255])^T[G++];m[E]=O,m[E+1]=H,m[E+2]=K,m[E+3]=w},keySize:256/32});n.AES=s._createHelper(g)}(),t.AES})}(ic)),ic.exports}var sc={exports:{}},Ig;function P4(){return Ig||(Ig=1,function(r,e){(function(t,n,i){r.exports=n(ve(),ei(),ti(),_n(),st())})(ge,function(t){return function(){var n=t,i=n.lib,s=i.WordArray,a=i.BlockCipher,o=n.algo,u=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],l=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],d=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],f=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],h=o.DES=a.extend({_doReset:function(){for(var y=this._key,g=y.words,m=[],E=0;E<56;E++){var T=u[E]-1;m[E]=g[T>>>5]>>>31-T%32&1}for(var L=this._subKeys=[],A=0;A<16;A++){for(var R=L[A]=[],I=c[A],E=0;E<24;E++)R[E/6|0]|=m[(l[E]-1+I)%28]<<31-E%6,R[4+(E/6|0)]|=m[28+(l[E+24]-1+I)%28]<<31-E%6;R[0]=R[0]<<1|R[0]>>>31;for(var E=1;E<7;E++)R[E]=R[E]>>>(E-1)*4+3;R[7]=R[7]<<5|R[7]>>>27}for(var C=this._invSubKeys=[],E=0;E<16;E++)C[E]=L[15-E]},encryptBlock:function(y,g){this._doCryptBlock(y,g,this._subKeys)},decryptBlock:function(y,g){this._doCryptBlock(y,g,this._invSubKeys)},_doCryptBlock:function(y,g,m){this._lBlock=y[g],this._rBlock=y[g+1],p.call(this,4,252645135),p.call(this,16,65535),x.call(this,2,858993459),x.call(this,8,16711935),p.call(this,1,1431655765);for(var E=0;E<16;E++){for(var T=m[E],L=this._lBlock,A=this._rBlock,R=0,I=0;I<8;I++)R|=d[I][((A^T[I])&f[I])>>>0];this._lBlock=A,this._rBlock=L^R}var C=this._lBlock;this._lBlock=this._rBlock,this._rBlock=C,p.call(this,1,1431655765),x.call(this,8,16711935),x.call(this,2,858993459),p.call(this,16,65535),p.call(this,4,252645135),y[g]=this._lBlock,y[g+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function p(y,g){var m=(this._lBlock>>>y^this._rBlock)&g;this._rBlock^=m,this._lBlock^=m<<y}function x(y,g){var m=(this._rBlock>>>y^this._lBlock)&g;this._lBlock^=m,this._rBlock^=m<<y}n.DES=a._createHelper(h);var v=o.TripleDES=a.extend({_doReset:function(){var y=this._key,g=y.words;if(g.length!==2&&g.length!==4&&g.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var m=g.slice(0,2),E=g.length<4?g.slice(0,2):g.slice(2,4),T=g.length<6?g.slice(0,2):g.slice(4,6);this._des1=h.createEncryptor(s.create(m)),this._des2=h.createEncryptor(s.create(E)),this._des3=h.createEncryptor(s.create(T))},encryptBlock:function(y,g){this._des1.encryptBlock(y,g),this._des2.decryptBlock(y,g),this._des3.encryptBlock(y,g)},decryptBlock:function(y,g){this._des3.decryptBlock(y,g),this._des2.encryptBlock(y,g),this._des1.decryptBlock(y,g)},keySize:192/32,ivSize:64/32,blockSize:64/32});n.TripleDES=a._createHelper(v)}(),t.TripleDES})}(sc)),sc.exports}var ac={exports:{}},_g;function F4(){return _g||(_g=1,function(r,e){(function(t,n,i){r.exports=n(ve(),ei(),ti(),_n(),st())})(ge,function(t){return function(){var n=t,i=n.lib,s=i.StreamCipher,a=n.algo,o=a.RC4=s.extend({_doReset:function(){for(var c=this._key,d=c.words,f=c.sigBytes,h=this._S=[],p=0;p<256;p++)h[p]=p;for(var p=0,x=0;p<256;p++){var v=p%f,y=d[v>>>2]>>>24-v%4*8&255;x=(x+h[p]+y)%256;var g=h[p];h[p]=h[x],h[x]=g}this._i=this._j=0},_doProcessBlock:function(c,d){c[d]^=u.call(this)},keySize:256/32,ivSize:0});function u(){for(var c=this._S,d=this._i,f=this._j,h=0,p=0;p<4;p++){d=(d+1)%256,f=(f+c[d])%256;var x=c[d];c[d]=c[f],c[f]=x,h|=c[(c[d]+c[f])%256]<<24-p*8}return this._i=d,this._j=f,h}n.RC4=s._createHelper(o);var l=a.RC4Drop=o.extend({cfg:o.cfg.extend({drop:192}),_doReset:function(){o._doReset.call(this);for(var c=this.cfg.drop;c>0;c--)u.call(this)}});n.RC4Drop=s._createHelper(l)}(),t.RC4})}(ac)),ac.exports}var oc={exports:{}},Dg;function B4(){return Dg||(Dg=1,function(r,e){(function(t,n,i){r.exports=n(ve(),ei(),ti(),_n(),st())})(ge,function(t){return function(){var n=t,i=n.lib,s=i.StreamCipher,a=n.algo,o=[],u=[],l=[],c=a.Rabbit=s.extend({_doReset:function(){for(var f=this._key.words,h=this.cfg.iv,p=0;p<4;p++)f[p]=(f[p]<<8|f[p]>>>24)&16711935|(f[p]<<24|f[p]>>>8)&4278255360;var x=this._X=[f[0],f[3]<<16|f[2]>>>16,f[1],f[0]<<16|f[3]>>>16,f[2],f[1]<<16|f[0]>>>16,f[3],f[2]<<16|f[1]>>>16],v=this._C=[f[2]<<16|f[2]>>>16,f[0]&4294901760|f[1]&65535,f[3]<<16|f[3]>>>16,f[1]&4294901760|f[2]&65535,f[0]<<16|f[0]>>>16,f[2]&4294901760|f[3]&65535,f[1]<<16|f[1]>>>16,f[3]&4294901760|f[0]&65535];this._b=0;for(var p=0;p<4;p++)d.call(this);for(var p=0;p<8;p++)v[p]^=x[p+4&7];if(h){var y=h.words,g=y[0],m=y[1],E=(g<<8|g>>>24)&16711935|(g<<24|g>>>8)&4278255360,T=(m<<8|m>>>24)&16711935|(m<<24|m>>>8)&4278255360,L=E>>>16|T&4294901760,A=T<<16|E&65535;v[0]^=E,v[1]^=L,v[2]^=T,v[3]^=A,v[4]^=E,v[5]^=L,v[6]^=T,v[7]^=A;for(var p=0;p<4;p++)d.call(this)}},_doProcessBlock:function(f,h){var p=this._X;d.call(this),o[0]=p[0]^p[5]>>>16^p[3]<<16,o[1]=p[2]^p[7]>>>16^p[5]<<16,o[2]=p[4]^p[1]>>>16^p[7]<<16,o[3]=p[6]^p[3]>>>16^p[1]<<16;for(var x=0;x<4;x++)o[x]=(o[x]<<8|o[x]>>>24)&16711935|(o[x]<<24|o[x]>>>8)&4278255360,f[h+x]^=o[x]},blockSize:128/32,ivSize:64/32});function d(){for(var f=this._X,h=this._C,p=0;p<8;p++)u[p]=h[p];h[0]=h[0]+1295307597+this._b|0,h[1]=h[1]+3545052371+(h[0]>>>0<u[0]>>>0?1:0)|0,h[2]=h[2]+886263092+(h[1]>>>0<u[1]>>>0?1:0)|0,h[3]=h[3]+1295307597+(h[2]>>>0<u[2]>>>0?1:0)|0,h[4]=h[4]+3545052371+(h[3]>>>0<u[3]>>>0?1:0)|0,h[5]=h[5]+886263092+(h[4]>>>0<u[4]>>>0?1:0)|0,h[6]=h[6]+1295307597+(h[5]>>>0<u[5]>>>0?1:0)|0,h[7]=h[7]+3545052371+(h[6]>>>0<u[6]>>>0?1:0)|0,this._b=h[7]>>>0<u[7]>>>0?1:0;for(var p=0;p<8;p++){var x=f[p]+h[p],v=x&65535,y=x>>>16,g=((v*v>>>17)+v*y>>>15)+y*y,m=((x&4294901760)*x|0)+((x&65535)*x|0);l[p]=g^m}f[0]=l[0]+(l[7]<<16|l[7]>>>16)+(l[6]<<16|l[6]>>>16)|0,f[1]=l[1]+(l[0]<<8|l[0]>>>24)+l[7]|0,f[2]=l[2]+(l[1]<<16|l[1]>>>16)+(l[0]<<16|l[0]>>>16)|0,f[3]=l[3]+(l[2]<<8|l[2]>>>24)+l[1]|0,f[4]=l[4]+(l[3]<<16|l[3]>>>16)+(l[2]<<16|l[2]>>>16)|0,f[5]=l[5]+(l[4]<<8|l[4]>>>24)+l[3]|0,f[6]=l[6]+(l[5]<<16|l[5]>>>16)+(l[4]<<16|l[4]>>>16)|0,f[7]=l[7]+(l[6]<<8|l[6]>>>24)+l[5]|0}n.Rabbit=s._createHelper(c)}(),t.Rabbit})}(oc)),oc.exports}var lc={exports:{}},kg;function O4(){return kg||(kg=1,function(r,e){(function(t,n,i){r.exports=n(ve(),ei(),ti(),_n(),st())})(ge,function(t){return function(){var n=t,i=n.lib,s=i.StreamCipher,a=n.algo,o=[],u=[],l=[],c=a.RabbitLegacy=s.extend({_doReset:function(){var f=this._key.words,h=this.cfg.iv,p=this._X=[f[0],f[3]<<16|f[2]>>>16,f[1],f[0]<<16|f[3]>>>16,f[2],f[1]<<16|f[0]>>>16,f[3],f[2]<<16|f[1]>>>16],x=this._C=[f[2]<<16|f[2]>>>16,f[0]&4294901760|f[1]&65535,f[3]<<16|f[3]>>>16,f[1]&4294901760|f[2]&65535,f[0]<<16|f[0]>>>16,f[2]&4294901760|f[3]&65535,f[1]<<16|f[1]>>>16,f[3]&4294901760|f[0]&65535];this._b=0;for(var v=0;v<4;v++)d.call(this);for(var v=0;v<8;v++)x[v]^=p[v+4&7];if(h){var y=h.words,g=y[0],m=y[1],E=(g<<8|g>>>24)&16711935|(g<<24|g>>>8)&4278255360,T=(m<<8|m>>>24)&16711935|(m<<24|m>>>8)&4278255360,L=E>>>16|T&4294901760,A=T<<16|E&65535;x[0]^=E,x[1]^=L,x[2]^=T,x[3]^=A,x[4]^=E,x[5]^=L,x[6]^=T,x[7]^=A;for(var v=0;v<4;v++)d.call(this)}},_doProcessBlock:function(f,h){var p=this._X;d.call(this),o[0]=p[0]^p[5]>>>16^p[3]<<16,o[1]=p[2]^p[7]>>>16^p[5]<<16,o[2]=p[4]^p[1]>>>16^p[7]<<16,o[3]=p[6]^p[3]>>>16^p[1]<<16;for(var x=0;x<4;x++)o[x]=(o[x]<<8|o[x]>>>24)&16711935|(o[x]<<24|o[x]>>>8)&4278255360,f[h+x]^=o[x]},blockSize:128/32,ivSize:64/32});function d(){for(var f=this._X,h=this._C,p=0;p<8;p++)u[p]=h[p];h[0]=h[0]+1295307597+this._b|0,h[1]=h[1]+3545052371+(h[0]>>>0<u[0]>>>0?1:0)|0,h[2]=h[2]+886263092+(h[1]>>>0<u[1]>>>0?1:0)|0,h[3]=h[3]+1295307597+(h[2]>>>0<u[2]>>>0?1:0)|0,h[4]=h[4]+3545052371+(h[3]>>>0<u[3]>>>0?1:0)|0,h[5]=h[5]+886263092+(h[4]>>>0<u[4]>>>0?1:0)|0,h[6]=h[6]+1295307597+(h[5]>>>0<u[5]>>>0?1:0)|0,h[7]=h[7]+3545052371+(h[6]>>>0<u[6]>>>0?1:0)|0,this._b=h[7]>>>0<u[7]>>>0?1:0;for(var p=0;p<8;p++){var x=f[p]+h[p],v=x&65535,y=x>>>16,g=((v*v>>>17)+v*y>>>15)+y*y,m=((x&4294901760)*x|0)+((x&65535)*x|0);l[p]=g^m}f[0]=l[0]+(l[7]<<16|l[7]>>>16)+(l[6]<<16|l[6]>>>16)|0,f[1]=l[1]+(l[0]<<8|l[0]>>>24)+l[7]|0,f[2]=l[2]+(l[1]<<16|l[1]>>>16)+(l[0]<<16|l[0]>>>16)|0,f[3]=l[3]+(l[2]<<8|l[2]>>>24)+l[1]|0,f[4]=l[4]+(l[3]<<16|l[3]>>>16)+(l[2]<<16|l[2]>>>16)|0,f[5]=l[5]+(l[4]<<8|l[4]>>>24)+l[3]|0,f[6]=l[6]+(l[5]<<16|l[5]>>>16)+(l[4]<<16|l[4]>>>16)|0,f[7]=l[7]+(l[6]<<8|l[6]>>>24)+l[5]|0}n.RabbitLegacy=s._createHelper(c)}(),t.RabbitLegacy})}(lc)),lc.exports}var uc={exports:{}},wg;function M4(){return wg||(wg=1,function(r,e){(function(t,n,i){r.exports=n(ve(),ei(),ti(),_n(),st())})(ge,function(t){return function(){var n=t,i=n.lib,s=i.BlockCipher,a=n.algo;const o=16,u=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],l=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var c={pbox:[],sbox:[]};function d(v,y){let g=y>>24&255,m=y>>16&255,E=y>>8&255,T=y&255,L=v.sbox[0][g]+v.sbox[1][m];return L=L^v.sbox[2][E],L=L+v.sbox[3][T],L}function f(v,y,g){let m=y,E=g,T;for(let L=0;L<o;++L)m=m^v.pbox[L],E=d(v,m)^E,T=m,m=E,E=T;return T=m,m=E,E=T,E=E^v.pbox[o],m=m^v.pbox[o+1],{left:m,right:E}}function h(v,y,g){let m=y,E=g,T;for(let L=o+1;L>1;--L)m=m^v.pbox[L],E=d(v,m)^E,T=m,m=E,E=T;return T=m,m=E,E=T,E=E^v.pbox[1],m=m^v.pbox[0],{left:m,right:E}}function p(v,y,g){for(let A=0;A<4;A++){v.sbox[A]=[];for(let R=0;R<256;R++)v.sbox[A][R]=l[A][R]}let m=0;for(let A=0;A<o+2;A++)v.pbox[A]=u[A]^y[m],m++,m>=g&&(m=0);let E=0,T=0,L=0;for(let A=0;A<o+2;A+=2)L=f(v,E,T),E=L.left,T=L.right,v.pbox[A]=E,v.pbox[A+1]=T;for(let A=0;A<4;A++)for(let R=0;R<256;R+=2)L=f(v,E,T),E=L.left,T=L.right,v.sbox[A][R]=E,v.sbox[A][R+1]=T;return!0}var x=a.Blowfish=s.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var v=this._keyPriorReset=this._key,y=v.words,g=v.sigBytes/4;p(c,y,g)}},encryptBlock:function(v,y){var g=f(c,v[y],v[y+1]);v[y]=g.left,v[y+1]=g.right},decryptBlock:function(v,y){var g=h(c,v[y],v[y+1]);v[y]=g.left,v[y+1]=g.right},blockSize:64/32,keySize:128/32,ivSize:64/32});n.Blowfish=s._createHelper(x)}(),t.Blowfish})}(uc)),uc.exports}(function(r,e){(function(t,n,i){r.exports=n(ve(),Sl(),h4(),p4(),ei(),g4(),ti(),Uv(),n0(),m4(),Gv(),x4(),v4(),y4(),i0(),E4(),_n(),st(),S4(),T4(),A4(),C4(),L4(),R4(),I4(),_4(),D4(),k4(),w4(),b4(),P4(),F4(),B4(),O4(),M4())})(ge,function(t){return t})})($v);var N4=$v.exports;const $4=Pg(N4),bg="e716f19ab4d25edc5247239a8f3494f8",cc={SCRAPIFY_URL:"/api/scrapify",ENCRYPTION_KEY:"moviesapi-secure-encryption-key-2024-v1",PLAYER_API_KEY:"moviesapi-player-auth-key-2024-secure"},dc=()=>{const r=aS(),[e]=QS(),t=r.type||(r.season?"tv":"movie"),n=r.id,i=parseInt(r.season||e.get("season")||"1"),s=parseInt(r.episode||e.get("episode")||"1"),[a,o]=b.useState(!0),[u,l]=b.useState(""),[c,d]=b.useState(null),[f,h]=b.useState(""),[p,x]=b.useState(void 0);b.useEffect(()=>{if(!n){l("No TMDB ID provided"),o(!1);return}v()},[n,t,i,s]);const v=async()=>{try{o(!0),l("");const T=await y();let L="";T&&T.backdrop_path&&(L=`https://image.tmdb.org/t/p/original${T.backdrop_path}`,h(L)),x({tmdb:n,type:t||"movie",season:t==="tv"?i:void 0,episode:t==="tv"?s:void 0,backdrop:L||void 0});const A=await E();if(A&&Object.keys(A.sources).length>0)d(A.sources);else throw new Error("No sources available");o(!1)}catch(T){console.error("Fetch error:",T),l(T instanceof Error?T.message:"Failed to load video"),o(!1)}},y=async()=>{try{const T=await fetch(`https://api.themoviedb.org/3/${t}/${n}?api_key=${bg}`);if(!T.ok)return console.warn("Failed to fetch TMDB data:",T.status),null;const L=await T.json();return console.log("TMDB Data:",L),L}catch(T){return console.warn("TMDB fetch error:",T),null}},g=async(T,L,A)=>{try{console.log(`Checking ${T}...`);const R={source:L,type:t,id:n,...t==="tv"&&{season:i,episode:s},...A&&{srv:A}},I=$4.AES.encrypt(JSON.stringify(R),cc.ENCRYPTION_KEY).toString(),C=new AbortController,_=setTimeout(()=>C.abort(),1e4),F=await fetch(`${cc.SCRAPIFY_URL}/v1/fetch`,{method:"POST",headers:{"Content-Type":"application/json","x-player-key":cc.PLAYER_API_KEY},body:JSON.stringify({payload:I}),signal:C.signal});if(clearTimeout(_),!F.ok)throw new Error(`${T}: HTTP ${F.status}`);const B=await F.json();let V,j=[];if(B.sources&&B.sources.length>0)V=B.sources[0].url,j=B.sources[0].tracks||B.sources[0].subtitles||[];else if(B.url)V=B.url,j=B.tracks||B.subtitles||[];else throw new Error(`${T}: Invalid response format`);if(!V)throw new Error(`${T}: No URL found`);(T==="Apollo"||T==="Nexon")&&(V=V.replace(/^https?:\/\//,""),V=`https://ax.1hd.su/${V}`);const G=j.map(Y=>({url:Y.file,lang:m(Y.label),type:Y.file.includes(".vtt")?"vtt":"srt"}));return console.log(` ${T} is online (${G.length} subtitles found)`),{url:V,subtitles:G,status:"online"}}catch(R){return console.error(` ${T} is offline:`,R),{url:"",subtitles:[],status:"offline"}}},m=T=>{const L=T.trim(),A=[/^(English|Spanish|French|German|Italian|Portuguese|Russian|Japanese|Korean|Chinese|Arabic)/i,/\b(EN|ES|FR|DE|IT|PT|RU|JA|KO|ZH|AR)\b/i,/Eng\.?\s*(full)?/i,/\.?/i];for(const R of A){const I=L.match(R);if(I){const C=I[1].toUpperCase();return{EN:"English",ES:"Spanish",FR:"French",DE:"German",IT:"Italian",PT:"Portuguese",RU:"Russian",:"Russian",JA:"Japanese",KO:"Korean",ZH:"Chinese",AR:"Arabic",ENG:"English"}[C]||C}}return L},E=async()=>{const T={},L=[{name:"Apollo",source:"sflix2",srv:"0"},{name:"Alpha",source:"sflix2",srv:"1"},{name:"Orion",source:"m4uhd"},{name:"Beta",source:"fmovies"},{name:"Nexon",source:"bmovies"},{name:"Zenith",source:"hianime"},{name:"Quantum",source:"1movies"},{name:"Stellar",source:"insertunit"},{name:"Nebula",source:"moviebox"},{name:"Vortex",source:"primewire"},{name:"Cosmos",source:"allmovieland"},{name:"Pulsar",source:"embed69"},{name:"Nova",source:"warezcdn"}];return(await Promise.all(L.map(R=>g(R.name,R.source,R.srv)))).forEach((R,I)=>{const C=L[I].name;T[C]={url:R.url,isM3U8:!0,quality:"auto",status:R.status,subtitles:R.subtitles}}),T.F2cloud={url:"https://w1.moviesapi.club",isM3U8:!1,quality:"Auto",type:"iframe"},{sources:T}};return u?D.jsx("div",{className:"embed-error",children:D.jsxs("div",{className:"error-content",children:[D.jsx("svg",{className:"error-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),D.jsx("h2",{children:"Failed to Load"}),D.jsx("p",{children:u}),D.jsx("button",{onClick:v,className:"retry-button",children:"Try Again"})]})}):a||!c?D.jsxs("div",{className:"embed-loading",style:{backgroundImage:f?`url(${f})`:"none"},children:[D.jsx("div",{className:"loading-backdrop"}),D.jsx("div",{className:"loading-content",children:D.jsx("div",{className:"spinner-container",children:D.jsx("div",{className:"spinner"})})})]}):D.jsx(Nv,{sources:c,mediaInfo:p,videoId:p?`${p.type}-${p.tmdb}-${p.season||0}-${p.episode||0}`:"default",onError:l})};function U4(){const[r,e]=b.useState(null),[t,n]=b.useState(""),[i,s]=b.useState(""),[a,o]=b.useState("1038392"),u=()=>{try{s("");const c=JSON.parse(t);if(!Array.isArray(c)||c.length===0)throw new Error("Invalid JSON format - Expected an array");const d=c[0];if(!d||typeof d!="object")throw new Error("Invalid server data");if(Object.keys(d).length===0)throw new Error("No servers found in JSON");e(d)}catch(c){s(c instanceof Error?c.message:"Failed to parse JSON")}},l=()=>{window.open(`https://ww2.moviesapi.to/primewire_tf1.php?id=${a}`,"_blank")};return r?D.jsx(Nv,{sources:r,onError:c=>{console.error("Player error:",c),s(c),e(null)}}):D.jsx("div",{className:"setup-container",children:D.jsxs("div",{className:"setup-card",children:[D.jsx("h1",{children:" Video Player"}),D.jsx("p",{className:"subtitle",children:"Two ways to use this player"}),D.jsxs("div",{className:"info-box",children:[D.jsx("strong",{children:" Embed Mode (Recommended)"}),D.jsxs("p",{children:["Visit: ",D.jsx("code",{children:"http://localhost:3000/embed/movie/1038392"})]}),D.jsx("p",{children:"Automatically fetches sources and shows loading with poster!"})]}),D.jsx("div",{className:"divider",children:"OR"}),D.jsxs("div",{className:"cors-warning",children:[D.jsx("strong",{children:" Manual Mode"}),D.jsxs("p",{children:["If embed mode doesn't work due to CORS:",D.jsx("br",{}),'1. Click "Open API" to get the JSON response',D.jsx("br",{}),"2. Copy the entire JSON from that page",D.jsx("br",{}),'3. Paste it below and click "Load Video"']})]}),D.jsxs("div",{className:"form-group",children:[D.jsx("label",{children:"TMDB ID"}),D.jsxs("div",{className:"input-row",children:[D.jsx("input",{type:"text",value:a,onChange:c=>o(c.target.value),placeholder:"e.g., 1038392"}),D.jsx("button",{onClick:l,className:"api-btn",children:" Open API"})]})]}),D.jsxs("div",{className:"form-group",children:[D.jsx("label",{children:"Paste JSON Response"}),D.jsx("textarea",{value:t,onChange:c=>n(c.target.value),placeholder:'[{"vidhide":"https://...","streamwish":"https://..."}]',className:"json-textarea"})]}),i&&D.jsx("div",{className:"error-message",children:i}),D.jsx("button",{onClick:u,className:"load-btn",children:"Load Video"}),D.jsx("div",{className:"help-text",children:D.jsxs("details",{children:[D.jsx("summary",{children:"Example JSON Format"}),D.jsx("pre",{children:`[
  {
    "vidhide": "https://...",
    "streamwish": "https://...",
    "primevid": "https://...",
    "vidmoly": "https://...",
    "voesx": "https://..."
  }
]`})]})})]})})}function G4(){return D.jsx(zS,{children:D.jsxs(TS,{children:[D.jsx(ui,{path:"/",element:D.jsx(U4,{})}),D.jsx(ui,{path:"/movie/:id",element:D.jsx(dc,{})}),D.jsx(ui,{path:"/tv/:id/:season/:episode",element:D.jsx(dc,{})}),D.jsx(ui,{path:"/embed/:type/:id",element:D.jsx(dc,{})}),D.jsx(ui,{path:"*",element:D.jsx(ES,{to:"/",replace:!0})})]})})}fc.createRoot(document.getElementById("root")).render(D.jsx(vy.StrictMode,{children:D.jsx(G4,{})}));
